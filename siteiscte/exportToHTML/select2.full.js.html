<html>
<head>
<title>select2.full.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #7a7e85;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #cf8e6d;}
.s4 { color: #6aab73;}
.s5 { color: #5f826b; font-style: italic;}
.s6 { color: #67a37c; font-style: italic;}
.s7 { color: #42c3d4;}
.s8 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
select2.full.js</font>
</center></td></tr></table>
<pre><span class="s0">/*! 
 * Select2 4.0.13 
 * https://select2.github.io 
 * 
 * Released under the MIT license 
 * https://github.com/select2/select2/blob/master/LICENSE.md 
 */</span>
<span class="s2">;(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">factory</span><span class="s2">) {</span>
  <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">define </span><span class="s2">=== </span><span class="s4">'function' </span><span class="s2">&amp;&amp; </span><span class="s1">define</span><span class="s2">.</span><span class="s1">amd</span><span class="s2">) {</span>
    <span class="s0">// AMD. Register as an anonymous module.</span>
    <span class="s1">define</span><span class="s2">([</span><span class="s4">'jquery'</span><span class="s2">], </span><span class="s1">factory</span><span class="s2">);</span>
  <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">module </span><span class="s2">=== </span><span class="s4">'object' </span><span class="s2">&amp;&amp; </span><span class="s1">module</span><span class="s2">.</span><span class="s1">exports</span><span class="s2">) {</span>
    <span class="s0">// Node/CommonJS</span>
    <span class="s1">module</span><span class="s2">.</span><span class="s1">exports </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">root</span><span class="s2">, </span><span class="s1">jQuery</span><span class="s2">) {</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">jQuery </span><span class="s2">=== </span><span class="s1">undefined</span><span class="s2">) {</span>
        <span class="s0">// require('jQuery') returns a factory that requires window to</span>
        <span class="s0">// build a jQuery instance, we normalize how we use modules</span>
        <span class="s0">// that require this pattern but the window provided is a noop</span>
        <span class="s0">// if it's defined (how jquery works)</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">window </span><span class="s2">!== </span><span class="s4">'undefined'</span><span class="s2">) {</span>
          <span class="s1">jQuery </span><span class="s2">= </span><span class="s1">require</span><span class="s2">(</span><span class="s4">'jquery'</span><span class="s2">);</span>
        <span class="s2">}</span>
        <span class="s3">else </span><span class="s2">{</span>
          <span class="s1">jQuery </span><span class="s2">= </span><span class="s1">require</span><span class="s2">(</span><span class="s4">'jquery'</span><span class="s2">)(</span><span class="s1">root</span><span class="s2">);</span>
        <span class="s2">}</span>
      <span class="s2">}</span>
      <span class="s1">factory</span><span class="s2">(</span><span class="s1">jQuery</span><span class="s2">);</span>
      <span class="s3">return </span><span class="s1">jQuery</span><span class="s2">;</span>
    <span class="s2">};</span>
  <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
    <span class="s0">// Browser globals</span>
    <span class="s1">factory</span><span class="s2">(</span><span class="s1">jQuery</span><span class="s2">);</span>
  <span class="s2">}</span>
<span class="s2">} (</span><span class="s3">function </span><span class="s2">(</span><span class="s1">jQuery</span><span class="s2">) {</span>
  <span class="s0">// This is needed so we can catch the AMD loader configuration and use it</span>
  <span class="s0">// The inner file should be wrapped (by `banner.start.js`) in a function that</span>
  <span class="s0">// returns the AMD loader references.</span>
  <span class="s3">var </span><span class="s1">S2 </span><span class="s2">=(</span><span class="s3">function </span><span class="s2">() {</span>
  <span class="s0">// Restore the Select2 AMD loader so it can be used</span>
  <span class="s0">// Needed mostly in the language files, where the loader is not inserted</span>
  <span class="s3">if </span><span class="s2">(</span><span class="s1">jQuery </span><span class="s2">&amp;&amp; </span><span class="s1">jQuery</span><span class="s2">.</span><span class="s1">fn </span><span class="s2">&amp;&amp; </span><span class="s1">jQuery</span><span class="s2">.</span><span class="s1">fn</span><span class="s2">.</span><span class="s1">select2 </span><span class="s2">&amp;&amp; </span><span class="s1">jQuery</span><span class="s2">.</span><span class="s1">fn</span><span class="s2">.</span><span class="s1">select2</span><span class="s2">.</span><span class="s1">amd</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">S2 </span><span class="s2">= </span><span class="s1">jQuery</span><span class="s2">.</span><span class="s1">fn</span><span class="s2">.</span><span class="s1">select2</span><span class="s2">.</span><span class="s1">amd</span><span class="s2">;</span>
  <span class="s2">}</span>
<span class="s3">var </span><span class="s1">S2</span><span class="s2">;(</span><span class="s3">function </span><span class="s2">() { </span><span class="s3">if </span><span class="s2">(!</span><span class="s1">S2 </span><span class="s2">|| !</span><span class="s1">S2</span><span class="s2">.</span><span class="s1">requirejs</span><span class="s2">) {</span>
<span class="s3">if </span><span class="s2">(!</span><span class="s1">S2</span><span class="s2">) { </span><span class="s1">S2 </span><span class="s2">= {}; } </span><span class="s3">else </span><span class="s2">{ </span><span class="s1">require </span><span class="s2">= </span><span class="s1">S2</span><span class="s2">; }</span>
<span class="s5">/**</span>
 <span class="s5">* </span><span class="s6">@license </span><span class="s5">almond 0.3.3 Copyright jQuery Foundation and other contributors.</span>
 <span class="s5">* Released under MIT license, http://github.com/requirejs/almond/LICENSE</span>
 <span class="s5">*/</span>
<span class="s0">//Going sloppy to avoid 'use strict' string cost, but strict practices should</span>
<span class="s0">//be followed.</span>
<span class="s0">/*global setTimeout: false */</span>

<span class="s3">var </span><span class="s1">requirejs</span><span class="s2">, </span><span class="s1">require</span><span class="s2">, </span><span class="s1">define</span><span class="s2">;</span>
<span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">undef</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">main</span><span class="s2">, </span><span class="s1">req</span><span class="s2">, </span><span class="s1">makeMap</span><span class="s2">, </span><span class="s1">handlers</span><span class="s2">,</span>
        <span class="s1">defined </span><span class="s2">= {},</span>
        <span class="s1">waiting </span><span class="s2">= {},</span>
        <span class="s1">config </span><span class="s2">= {},</span>
        <span class="s1">defining </span><span class="s2">= {},</span>
        <span class="s1">hasOwn </span><span class="s2">= </span><span class="s1">Object</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">hasOwnProperty</span><span class="s2">,</span>
        <span class="s1">aps </span><span class="s2">= [].</span><span class="s1">slice</span><span class="s2">,</span>
        <span class="s1">jsSuffixRegExp </span><span class="s2">= </span><span class="s7">/\.js$/</span><span class="s2">;</span>

    <span class="s3">function </span><span class="s1">hasProp</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">, </span><span class="s1">prop</span><span class="s2">) {</span>
        <span class="s3">return </span><span class="s1">hasOwn</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">, </span><span class="s1">prop</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s5">/**</span>
     <span class="s5">* Given a relative module name, like ./something, normalize it to</span>
     <span class="s5">* a real name that can be mapped to a path.</span>
     <span class="s5">* </span><span class="s6">@param </span><span class="s5">{String} name the relative name</span>
     <span class="s5">* </span><span class="s6">@param </span><span class="s5">{String} baseName a real name that the name arg is relative</span>
     <span class="s5">* to.</span>
     <span class="s5">* </span><span class="s6">@returns </span><span class="s5">{String} normalized name</span>
     <span class="s5">*/</span>
    <span class="s3">function </span><span class="s1">normalize</span><span class="s2">(</span><span class="s1">name</span><span class="s2">, </span><span class="s1">baseName</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">nameParts</span><span class="s2">, </span><span class="s1">nameSegment</span><span class="s2">, </span><span class="s1">mapValue</span><span class="s2">, </span><span class="s1">foundMap</span><span class="s2">, </span><span class="s1">lastIndex</span><span class="s2">,</span>
            <span class="s1">foundI</span><span class="s2">, </span><span class="s1">foundStarMap</span><span class="s2">, </span><span class="s1">starI</span><span class="s2">, </span><span class="s1">i</span><span class="s2">, </span><span class="s1">j</span><span class="s2">, </span><span class="s1">part</span><span class="s2">, </span><span class="s1">normalizedBaseParts</span><span class="s2">,</span>
            <span class="s1">baseParts </span><span class="s2">= </span><span class="s1">baseName </span><span class="s2">&amp;&amp; </span><span class="s1">baseName</span><span class="s2">.</span><span class="s1">split</span><span class="s2">(</span><span class="s4">&quot;/&quot;</span><span class="s2">),</span>
            <span class="s1">map </span><span class="s2">= </span><span class="s1">config</span><span class="s2">.</span><span class="s1">map</span><span class="s2">,</span>
            <span class="s1">starMap </span><span class="s2">= (</span><span class="s1">map </span><span class="s2">&amp;&amp; </span><span class="s1">map</span><span class="s2">[</span><span class="s4">'*'</span><span class="s2">]) || {};</span>

        <span class="s0">//Adjust any relative paths.</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">name</span><span class="s2">) {</span>
            <span class="s1">name </span><span class="s2">= </span><span class="s1">name</span><span class="s2">.</span><span class="s1">split</span><span class="s2">(</span><span class="s4">'/'</span><span class="s2">);</span>
            <span class="s1">lastIndex </span><span class="s2">= </span><span class="s1">name</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s8">1</span><span class="s2">;</span>

            <span class="s0">// If wanting node ID compatibility, strip .js from end</span>
            <span class="s0">// of IDs. Have to do this here, and not in nameToUrl</span>
            <span class="s0">// because node allows either .js or non .js to map</span>
            <span class="s0">// to same file.</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">config</span><span class="s2">.</span><span class="s1">nodeIdCompat </span><span class="s2">&amp;&amp; </span><span class="s1">jsSuffixRegExp</span><span class="s2">.</span><span class="s1">test</span><span class="s2">(</span><span class="s1">name</span><span class="s2">[</span><span class="s1">lastIndex</span><span class="s2">])) {</span>
                <span class="s1">name</span><span class="s2">[</span><span class="s1">lastIndex</span><span class="s2">] = </span><span class="s1">name</span><span class="s2">[</span><span class="s1">lastIndex</span><span class="s2">].</span><span class="s1">replace</span><span class="s2">(</span><span class="s1">jsSuffixRegExp</span><span class="s2">, </span><span class="s4">''</span><span class="s2">);</span>
            <span class="s2">}</span>

            <span class="s0">// Starts with a '.' so need the baseName</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">name</span><span class="s2">[</span><span class="s8">0</span><span class="s2">].</span><span class="s1">charAt</span><span class="s2">(</span><span class="s8">0</span><span class="s2">) === </span><span class="s4">'.' </span><span class="s2">&amp;&amp; </span><span class="s1">baseParts</span><span class="s2">) {</span>
                <span class="s0">//Convert baseName to array, and lop off the last part,</span>
                <span class="s0">//so that . matches that 'directory' and not name of the baseName's</span>
                <span class="s0">//module. For instance, baseName of 'one/two/three', maps to</span>
                <span class="s0">//'one/two/three.js', but we want the directory, 'one/two' for</span>
                <span class="s0">//this normalization.</span>
                <span class="s1">normalizedBaseParts </span><span class="s2">= </span><span class="s1">baseParts</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s8">0</span><span class="s2">, </span><span class="s1">baseParts</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s8">1</span><span class="s2">);</span>
                <span class="s1">name </span><span class="s2">= </span><span class="s1">normalizedBaseParts</span><span class="s2">.</span><span class="s1">concat</span><span class="s2">(</span><span class="s1">name</span><span class="s2">);</span>
            <span class="s2">}</span>

            <span class="s0">//start trimDots</span>
            <span class="s3">for </span><span class="s2">(</span><span class="s1">i </span><span class="s2">= </span><span class="s8">0</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">name</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">i</span><span class="s2">++) {</span>
                <span class="s1">part </span><span class="s2">= </span><span class="s1">name</span><span class="s2">[</span><span class="s1">i</span><span class="s2">];</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">part </span><span class="s2">=== </span><span class="s4">'.'</span><span class="s2">) {</span>
                    <span class="s1">name</span><span class="s2">.</span><span class="s1">splice</span><span class="s2">(</span><span class="s1">i</span><span class="s2">, </span><span class="s8">1</span><span class="s2">);</span>
                    <span class="s1">i </span><span class="s2">-= </span><span class="s8">1</span><span class="s2">;</span>
                <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">part </span><span class="s2">=== </span><span class="s4">'..'</span><span class="s2">) {</span>
                    <span class="s0">// If at the start, or previous value is still ..,</span>
                    <span class="s0">// keep them so that when converted to a path it may</span>
                    <span class="s0">// still work when converted to a path, even though</span>
                    <span class="s0">// as an ID it is less than ideal. In larger point</span>
                    <span class="s0">// releases, may be better to just kick out an error.</span>
                    <span class="s3">if </span><span class="s2">(</span><span class="s1">i </span><span class="s2">=== </span><span class="s8">0 </span><span class="s2">|| (</span><span class="s1">i </span><span class="s2">=== </span><span class="s8">1 </span><span class="s2">&amp;&amp; </span><span class="s1">name</span><span class="s2">[</span><span class="s8">2</span><span class="s2">] === </span><span class="s4">'..'</span><span class="s2">) || </span><span class="s1">name</span><span class="s2">[</span><span class="s1">i </span><span class="s2">- </span><span class="s8">1</span><span class="s2">] === </span><span class="s4">'..'</span><span class="s2">) {</span>
                        <span class="s3">continue</span><span class="s2">;</span>
                    <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">i </span><span class="s2">&gt; </span><span class="s8">0</span><span class="s2">) {</span>
                        <span class="s1">name</span><span class="s2">.</span><span class="s1">splice</span><span class="s2">(</span><span class="s1">i </span><span class="s2">- </span><span class="s8">1</span><span class="s2">, </span><span class="s8">2</span><span class="s2">);</span>
                        <span class="s1">i </span><span class="s2">-= </span><span class="s8">2</span><span class="s2">;</span>
                    <span class="s2">}</span>
                <span class="s2">}</span>
            <span class="s2">}</span>
            <span class="s0">//end trimDots</span>

            <span class="s1">name </span><span class="s2">= </span><span class="s1">name</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s4">'/'</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s0">//Apply map config if available.</span>
        <span class="s3">if </span><span class="s2">((</span><span class="s1">baseParts </span><span class="s2">|| </span><span class="s1">starMap</span><span class="s2">) &amp;&amp; </span><span class="s1">map</span><span class="s2">) {</span>
            <span class="s1">nameParts </span><span class="s2">= </span><span class="s1">name</span><span class="s2">.</span><span class="s1">split</span><span class="s2">(</span><span class="s4">'/'</span><span class="s2">);</span>

            <span class="s3">for </span><span class="s2">(</span><span class="s1">i </span><span class="s2">= </span><span class="s1">nameParts</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&gt; </span><span class="s8">0</span><span class="s2">; </span><span class="s1">i </span><span class="s2">-= </span><span class="s8">1</span><span class="s2">) {</span>
                <span class="s1">nameSegment </span><span class="s2">= </span><span class="s1">nameParts</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s8">0</span><span class="s2">, </span><span class="s1">i</span><span class="s2">).</span><span class="s1">join</span><span class="s2">(</span><span class="s4">&quot;/&quot;</span><span class="s2">);</span>

                <span class="s3">if </span><span class="s2">(</span><span class="s1">baseParts</span><span class="s2">) {</span>
                    <span class="s0">//Find the longest baseName segment match in the config.</span>
                    <span class="s0">//So, do joins on the biggest to smallest lengths of baseParts.</span>
                    <span class="s3">for </span><span class="s2">(</span><span class="s1">j </span><span class="s2">= </span><span class="s1">baseParts</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">j </span><span class="s2">&gt; </span><span class="s8">0</span><span class="s2">; </span><span class="s1">j </span><span class="s2">-= </span><span class="s8">1</span><span class="s2">) {</span>
                        <span class="s1">mapValue </span><span class="s2">= </span><span class="s1">map</span><span class="s2">[</span><span class="s1">baseParts</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s8">0</span><span class="s2">, </span><span class="s1">j</span><span class="s2">).</span><span class="s1">join</span><span class="s2">(</span><span class="s4">'/'</span><span class="s2">)];</span>

                        <span class="s0">//baseName segment has  config, find if it has one for</span>
                        <span class="s0">//this name.</span>
                        <span class="s3">if </span><span class="s2">(</span><span class="s1">mapValue</span><span class="s2">) {</span>
                            <span class="s1">mapValue </span><span class="s2">= </span><span class="s1">mapValue</span><span class="s2">[</span><span class="s1">nameSegment</span><span class="s2">];</span>
                            <span class="s3">if </span><span class="s2">(</span><span class="s1">mapValue</span><span class="s2">) {</span>
                                <span class="s0">//Match, update name to the new value.</span>
                                <span class="s1">foundMap </span><span class="s2">= </span><span class="s1">mapValue</span><span class="s2">;</span>
                                <span class="s1">foundI </span><span class="s2">= </span><span class="s1">i</span><span class="s2">;</span>
                                <span class="s3">break</span><span class="s2">;</span>
                            <span class="s2">}</span>
                        <span class="s2">}</span>
                    <span class="s2">}</span>
                <span class="s2">}</span>

                <span class="s3">if </span><span class="s2">(</span><span class="s1">foundMap</span><span class="s2">) {</span>
                    <span class="s3">break</span><span class="s2">;</span>
                <span class="s2">}</span>

                <span class="s0">//Check for a star map match, but just hold on to it,</span>
                <span class="s0">//if there is a shorter segment match later in a matching</span>
                <span class="s0">//config, then favor over this star map.</span>
                <span class="s3">if </span><span class="s2">(!</span><span class="s1">foundStarMap </span><span class="s2">&amp;&amp; </span><span class="s1">starMap </span><span class="s2">&amp;&amp; </span><span class="s1">starMap</span><span class="s2">[</span><span class="s1">nameSegment</span><span class="s2">]) {</span>
                    <span class="s1">foundStarMap </span><span class="s2">= </span><span class="s1">starMap</span><span class="s2">[</span><span class="s1">nameSegment</span><span class="s2">];</span>
                    <span class="s1">starI </span><span class="s2">= </span><span class="s1">i</span><span class="s2">;</span>
                <span class="s2">}</span>
            <span class="s2">}</span>

            <span class="s3">if </span><span class="s2">(!</span><span class="s1">foundMap </span><span class="s2">&amp;&amp; </span><span class="s1">foundStarMap</span><span class="s2">) {</span>
                <span class="s1">foundMap </span><span class="s2">= </span><span class="s1">foundStarMap</span><span class="s2">;</span>
                <span class="s1">foundI </span><span class="s2">= </span><span class="s1">starI</span><span class="s2">;</span>
            <span class="s2">}</span>

            <span class="s3">if </span><span class="s2">(</span><span class="s1">foundMap</span><span class="s2">) {</span>
                <span class="s1">nameParts</span><span class="s2">.</span><span class="s1">splice</span><span class="s2">(</span><span class="s8">0</span><span class="s2">, </span><span class="s1">foundI</span><span class="s2">, </span><span class="s1">foundMap</span><span class="s2">);</span>
                <span class="s1">name </span><span class="s2">= </span><span class="s1">nameParts</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s4">'/'</span><span class="s2">);</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">name</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">makeRequire</span><span class="s2">(</span><span class="s1">relName</span><span class="s2">, </span><span class="s1">forceSync</span><span class="s2">) {</span>
        <span class="s3">return function </span><span class="s2">() {</span>
            <span class="s0">//A version of a require function that passes a moduleName</span>
            <span class="s0">//value for items that may need to</span>
            <span class="s0">//look up paths relative to the moduleName</span>
            <span class="s3">var </span><span class="s1">args </span><span class="s2">= </span><span class="s1">aps</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">arguments</span><span class="s2">, </span><span class="s8">0</span><span class="s2">);</span>

            <span class="s0">//If first arg is not require('string'), and there is only</span>
            <span class="s0">//one arg, it is the array form without a callback. Insert</span>
            <span class="s0">//a null so that the following concat is correct.</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">args</span><span class="s2">[</span><span class="s8">0</span><span class="s2">] !== </span><span class="s4">'string' </span><span class="s2">&amp;&amp; </span><span class="s1">args</span><span class="s2">.</span><span class="s1">length </span><span class="s2">=== </span><span class="s8">1</span><span class="s2">) {</span>
                <span class="s1">args</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s3">null</span><span class="s2">);</span>
            <span class="s2">}</span>
            <span class="s3">return </span><span class="s1">req</span><span class="s2">.</span><span class="s1">apply</span><span class="s2">(</span><span class="s1">undef</span><span class="s2">, </span><span class="s1">args</span><span class="s2">.</span><span class="s1">concat</span><span class="s2">([</span><span class="s1">relName</span><span class="s2">, </span><span class="s1">forceSync</span><span class="s2">]));</span>
        <span class="s2">};</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">makeNormalize</span><span class="s2">(</span><span class="s1">relName</span><span class="s2">) {</span>
        <span class="s3">return function </span><span class="s2">(</span><span class="s1">name</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s1">normalize</span><span class="s2">(</span><span class="s1">name</span><span class="s2">, </span><span class="s1">relName</span><span class="s2">);</span>
        <span class="s2">};</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">makeLoad</span><span class="s2">(</span><span class="s1">depName</span><span class="s2">) {</span>
        <span class="s3">return function </span><span class="s2">(</span><span class="s1">value</span><span class="s2">) {</span>
            <span class="s1">defined</span><span class="s2">[</span><span class="s1">depName</span><span class="s2">] = </span><span class="s1">value</span><span class="s2">;</span>
        <span class="s2">};</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">callDep</span><span class="s2">(</span><span class="s1">name</span><span class="s2">) {</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">hasProp</span><span class="s2">(</span><span class="s1">waiting</span><span class="s2">, </span><span class="s1">name</span><span class="s2">)) {</span>
            <span class="s3">var </span><span class="s1">args </span><span class="s2">= </span><span class="s1">waiting</span><span class="s2">[</span><span class="s1">name</span><span class="s2">];</span>
            <span class="s3">delete </span><span class="s1">waiting</span><span class="s2">[</span><span class="s1">name</span><span class="s2">];</span>
            <span class="s1">defining</span><span class="s2">[</span><span class="s1">name</span><span class="s2">] = </span><span class="s3">true</span><span class="s2">;</span>
            <span class="s1">main</span><span class="s2">.</span><span class="s1">apply</span><span class="s2">(</span><span class="s1">undef</span><span class="s2">, </span><span class="s1">args</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(!</span><span class="s1">hasProp</span><span class="s2">(</span><span class="s1">defined</span><span class="s2">, </span><span class="s1">name</span><span class="s2">) &amp;&amp; !</span><span class="s1">hasProp</span><span class="s2">(</span><span class="s1">defining</span><span class="s2">, </span><span class="s1">name</span><span class="s2">)) {</span>
            <span class="s3">throw new </span><span class="s1">Error</span><span class="s2">(</span><span class="s4">'No ' </span><span class="s2">+ </span><span class="s1">name</span><span class="s2">);</span>
        <span class="s2">}</span>
        <span class="s3">return </span><span class="s1">defined</span><span class="s2">[</span><span class="s1">name</span><span class="s2">];</span>
    <span class="s2">}</span>

    <span class="s0">//Turns a plugin!resource to [plugin, resource]</span>
    <span class="s0">//with the plugin being undefined if the name</span>
    <span class="s0">//did not have a plugin prefix.</span>
    <span class="s3">function </span><span class="s1">splitPrefix</span><span class="s2">(</span><span class="s1">name</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">prefix</span><span class="s2">,</span>
            <span class="s1">index </span><span class="s2">= </span><span class="s1">name </span><span class="s2">? </span><span class="s1">name</span><span class="s2">.</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s4">'!'</span><span class="s2">) : -</span><span class="s8">1</span><span class="s2">;</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">index </span><span class="s2">&gt; -</span><span class="s8">1</span><span class="s2">) {</span>
            <span class="s1">prefix </span><span class="s2">= </span><span class="s1">name</span><span class="s2">.</span><span class="s1">substring</span><span class="s2">(</span><span class="s8">0</span><span class="s2">, </span><span class="s1">index</span><span class="s2">);</span>
            <span class="s1">name </span><span class="s2">= </span><span class="s1">name</span><span class="s2">.</span><span class="s1">substring</span><span class="s2">(</span><span class="s1">index </span><span class="s2">+ </span><span class="s8">1</span><span class="s2">, </span><span class="s1">name</span><span class="s2">.</span><span class="s1">length</span><span class="s2">);</span>
        <span class="s2">}</span>
        <span class="s3">return </span><span class="s2">[</span><span class="s1">prefix</span><span class="s2">, </span><span class="s1">name</span><span class="s2">];</span>
    <span class="s2">}</span>

    <span class="s0">//Creates a parts array for a relName where first part is plugin ID,</span>
    <span class="s0">//second part is resource ID. Assumes relName has already been normalized.</span>
    <span class="s3">function </span><span class="s1">makeRelParts</span><span class="s2">(</span><span class="s1">relName</span><span class="s2">) {</span>
        <span class="s3">return </span><span class="s1">relName </span><span class="s2">? </span><span class="s1">splitPrefix</span><span class="s2">(</span><span class="s1">relName</span><span class="s2">) : [];</span>
    <span class="s2">}</span>

    <span class="s5">/**</span>
     <span class="s5">* Makes a name map, normalizing the name, and using a plugin</span>
     <span class="s5">* for normalization if necessary. Grabs a ref to plugin</span>
     <span class="s5">* too, as an optimization.</span>
     <span class="s5">*/</span>
    <span class="s1">makeMap </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">name</span><span class="s2">, </span><span class="s1">relParts</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">plugin</span><span class="s2">,</span>
            <span class="s1">parts </span><span class="s2">= </span><span class="s1">splitPrefix</span><span class="s2">(</span><span class="s1">name</span><span class="s2">),</span>
            <span class="s1">prefix </span><span class="s2">= </span><span class="s1">parts</span><span class="s2">[</span><span class="s8">0</span><span class="s2">],</span>
            <span class="s1">relResourceName </span><span class="s2">= </span><span class="s1">relParts</span><span class="s2">[</span><span class="s8">1</span><span class="s2">];</span>

        <span class="s1">name </span><span class="s2">= </span><span class="s1">parts</span><span class="s2">[</span><span class="s8">1</span><span class="s2">];</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">prefix</span><span class="s2">) {</span>
            <span class="s1">prefix </span><span class="s2">= </span><span class="s1">normalize</span><span class="s2">(</span><span class="s1">prefix</span><span class="s2">, </span><span class="s1">relResourceName</span><span class="s2">);</span>
            <span class="s1">plugin </span><span class="s2">= </span><span class="s1">callDep</span><span class="s2">(</span><span class="s1">prefix</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s0">//Normalize according</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">prefix</span><span class="s2">) {</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">plugin </span><span class="s2">&amp;&amp; </span><span class="s1">plugin</span><span class="s2">.</span><span class="s1">normalize</span><span class="s2">) {</span>
                <span class="s1">name </span><span class="s2">= </span><span class="s1">plugin</span><span class="s2">.</span><span class="s1">normalize</span><span class="s2">(</span><span class="s1">name</span><span class="s2">, </span><span class="s1">makeNormalize</span><span class="s2">(</span><span class="s1">relResourceName</span><span class="s2">));</span>
            <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                <span class="s1">name </span><span class="s2">= </span><span class="s1">normalize</span><span class="s2">(</span><span class="s1">name</span><span class="s2">, </span><span class="s1">relResourceName</span><span class="s2">);</span>
            <span class="s2">}</span>
        <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
            <span class="s1">name </span><span class="s2">= </span><span class="s1">normalize</span><span class="s2">(</span><span class="s1">name</span><span class="s2">, </span><span class="s1">relResourceName</span><span class="s2">);</span>
            <span class="s1">parts </span><span class="s2">= </span><span class="s1">splitPrefix</span><span class="s2">(</span><span class="s1">name</span><span class="s2">);</span>
            <span class="s1">prefix </span><span class="s2">= </span><span class="s1">parts</span><span class="s2">[</span><span class="s8">0</span><span class="s2">];</span>
            <span class="s1">name </span><span class="s2">= </span><span class="s1">parts</span><span class="s2">[</span><span class="s8">1</span><span class="s2">];</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">prefix</span><span class="s2">) {</span>
                <span class="s1">plugin </span><span class="s2">= </span><span class="s1">callDep</span><span class="s2">(</span><span class="s1">prefix</span><span class="s2">);</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s0">//Using ridiculous property names for space reasons</span>
        <span class="s3">return </span><span class="s2">{</span>
            <span class="s1">f</span><span class="s2">: </span><span class="s1">prefix </span><span class="s2">? </span><span class="s1">prefix </span><span class="s2">+ </span><span class="s4">'!' </span><span class="s2">+ </span><span class="s1">name </span><span class="s2">: </span><span class="s1">name</span><span class="s2">, </span><span class="s0">//fullName</span>
            <span class="s1">n</span><span class="s2">: </span><span class="s1">name</span><span class="s2">,</span>
            <span class="s1">pr</span><span class="s2">: </span><span class="s1">prefix</span><span class="s2">,</span>
            <span class="s1">p</span><span class="s2">: </span><span class="s1">plugin</span>
        <span class="s2">};</span>
    <span class="s2">};</span>

    <span class="s3">function </span><span class="s1">makeConfig</span><span class="s2">(</span><span class="s1">name</span><span class="s2">) {</span>
        <span class="s3">return function </span><span class="s2">() {</span>
            <span class="s3">return </span><span class="s2">(</span><span class="s1">config </span><span class="s2">&amp;&amp; </span><span class="s1">config</span><span class="s2">.</span><span class="s1">config </span><span class="s2">&amp;&amp; </span><span class="s1">config</span><span class="s2">.</span><span class="s1">config</span><span class="s2">[</span><span class="s1">name</span><span class="s2">]) || {};</span>
        <span class="s2">};</span>
    <span class="s2">}</span>

    <span class="s1">handlers </span><span class="s2">= {</span>
        <span class="s1">require</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">name</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s1">makeRequire</span><span class="s2">(</span><span class="s1">name</span><span class="s2">);</span>
        <span class="s2">},</span>
        <span class="s1">exports</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">name</span><span class="s2">) {</span>
            <span class="s3">var </span><span class="s1">e </span><span class="s2">= </span><span class="s1">defined</span><span class="s2">[</span><span class="s1">name</span><span class="s2">];</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">e </span><span class="s2">!== </span><span class="s4">'undefined'</span><span class="s2">) {</span>
                <span class="s3">return </span><span class="s1">e</span><span class="s2">;</span>
            <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                <span class="s3">return </span><span class="s2">(</span><span class="s1">defined</span><span class="s2">[</span><span class="s1">name</span><span class="s2">] = {});</span>
            <span class="s2">}</span>
        <span class="s2">},</span>
        <span class="s1">module</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">name</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">id</span><span class="s2">: </span><span class="s1">name</span><span class="s2">,</span>
                <span class="s1">uri</span><span class="s2">: </span><span class="s4">''</span><span class="s2">,</span>
                <span class="s1">exports</span><span class="s2">: </span><span class="s1">defined</span><span class="s2">[</span><span class="s1">name</span><span class="s2">],</span>
                <span class="s1">config</span><span class="s2">: </span><span class="s1">makeConfig</span><span class="s2">(</span><span class="s1">name</span><span class="s2">)</span>
            <span class="s2">};</span>
        <span class="s2">}</span>
    <span class="s2">};</span>

    <span class="s1">main </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">name</span><span class="s2">, </span><span class="s1">deps</span><span class="s2">, </span><span class="s1">callback</span><span class="s2">, </span><span class="s1">relName</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">cjsModule</span><span class="s2">, </span><span class="s1">depName</span><span class="s2">, </span><span class="s1">ret</span><span class="s2">, </span><span class="s1">map</span><span class="s2">, </span><span class="s1">i</span><span class="s2">, </span><span class="s1">relParts</span><span class="s2">,</span>
            <span class="s1">args </span><span class="s2">= [],</span>
            <span class="s1">callbackType </span><span class="s2">= </span><span class="s3">typeof </span><span class="s1">callback</span><span class="s2">,</span>
            <span class="s1">usingExports</span><span class="s2">;</span>

        <span class="s0">//Use name if no relName</span>
        <span class="s1">relName </span><span class="s2">= </span><span class="s1">relName </span><span class="s2">|| </span><span class="s1">name</span><span class="s2">;</span>
        <span class="s1">relParts </span><span class="s2">= </span><span class="s1">makeRelParts</span><span class="s2">(</span><span class="s1">relName</span><span class="s2">);</span>

        <span class="s0">//Call the callback to define the module, if necessary.</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">callbackType </span><span class="s2">=== </span><span class="s4">'undefined' </span><span class="s2">|| </span><span class="s1">callbackType </span><span class="s2">=== </span><span class="s4">'function'</span><span class="s2">) {</span>
            <span class="s0">//Pull out the defined dependencies and pass the ordered</span>
            <span class="s0">//values to the callback.</span>
            <span class="s0">//Default to [require, exports, module] if no deps</span>
            <span class="s1">deps </span><span class="s2">= !</span><span class="s1">deps</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&amp;&amp; </span><span class="s1">callback</span><span class="s2">.</span><span class="s1">length </span><span class="s2">? [</span><span class="s4">'require'</span><span class="s2">, </span><span class="s4">'exports'</span><span class="s2">, </span><span class="s4">'module'</span><span class="s2">] : </span><span class="s1">deps</span><span class="s2">;</span>
            <span class="s3">for </span><span class="s2">(</span><span class="s1">i </span><span class="s2">= </span><span class="s8">0</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">deps</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">i </span><span class="s2">+= </span><span class="s8">1</span><span class="s2">) {</span>
                <span class="s1">map </span><span class="s2">= </span><span class="s1">makeMap</span><span class="s2">(</span><span class="s1">deps</span><span class="s2">[</span><span class="s1">i</span><span class="s2">], </span><span class="s1">relParts</span><span class="s2">);</span>
                <span class="s1">depName </span><span class="s2">= </span><span class="s1">map</span><span class="s2">.</span><span class="s1">f</span><span class="s2">;</span>

                <span class="s0">//Fast path CommonJS standard dependencies.</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">depName </span><span class="s2">=== </span><span class="s4">&quot;require&quot;</span><span class="s2">) {</span>
                    <span class="s1">args</span><span class="s2">[</span><span class="s1">i</span><span class="s2">] = </span><span class="s1">handlers</span><span class="s2">.</span><span class="s1">require</span><span class="s2">(</span><span class="s1">name</span><span class="s2">);</span>
                <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">depName </span><span class="s2">=== </span><span class="s4">&quot;exports&quot;</span><span class="s2">) {</span>
                    <span class="s0">//CommonJS module spec 1.1</span>
                    <span class="s1">args</span><span class="s2">[</span><span class="s1">i</span><span class="s2">] = </span><span class="s1">handlers</span><span class="s2">.</span><span class="s1">exports</span><span class="s2">(</span><span class="s1">name</span><span class="s2">);</span>
                    <span class="s1">usingExports </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
                <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">depName </span><span class="s2">=== </span><span class="s4">&quot;module&quot;</span><span class="s2">) {</span>
                    <span class="s0">//CommonJS module spec 1.1</span>
                    <span class="s1">cjsModule </span><span class="s2">= </span><span class="s1">args</span><span class="s2">[</span><span class="s1">i</span><span class="s2">] = </span><span class="s1">handlers</span><span class="s2">.</span><span class="s1">module</span><span class="s2">(</span><span class="s1">name</span><span class="s2">);</span>
                <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">hasProp</span><span class="s2">(</span><span class="s1">defined</span><span class="s2">, </span><span class="s1">depName</span><span class="s2">) ||</span>
                           <span class="s1">hasProp</span><span class="s2">(</span><span class="s1">waiting</span><span class="s2">, </span><span class="s1">depName</span><span class="s2">) ||</span>
                           <span class="s1">hasProp</span><span class="s2">(</span><span class="s1">defining</span><span class="s2">, </span><span class="s1">depName</span><span class="s2">)) {</span>
                    <span class="s1">args</span><span class="s2">[</span><span class="s1">i</span><span class="s2">] = </span><span class="s1">callDep</span><span class="s2">(</span><span class="s1">depName</span><span class="s2">);</span>
                <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">map</span><span class="s2">.</span><span class="s1">p</span><span class="s2">) {</span>
                    <span class="s1">map</span><span class="s2">.</span><span class="s1">p</span><span class="s2">.</span><span class="s1">load</span><span class="s2">(</span><span class="s1">map</span><span class="s2">.</span><span class="s1">n</span><span class="s2">, </span><span class="s1">makeRequire</span><span class="s2">(</span><span class="s1">relName</span><span class="s2">, </span><span class="s3">true</span><span class="s2">), </span><span class="s1">makeLoad</span><span class="s2">(</span><span class="s1">depName</span><span class="s2">), {});</span>
                    <span class="s1">args</span><span class="s2">[</span><span class="s1">i</span><span class="s2">] = </span><span class="s1">defined</span><span class="s2">[</span><span class="s1">depName</span><span class="s2">];</span>
                <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                    <span class="s3">throw new </span><span class="s1">Error</span><span class="s2">(</span><span class="s1">name </span><span class="s2">+ </span><span class="s4">' missing ' </span><span class="s2">+ </span><span class="s1">depName</span><span class="s2">);</span>
                <span class="s2">}</span>
            <span class="s2">}</span>

            <span class="s1">ret </span><span class="s2">= </span><span class="s1">callback </span><span class="s2">? </span><span class="s1">callback</span><span class="s2">.</span><span class="s1">apply</span><span class="s2">(</span><span class="s1">defined</span><span class="s2">[</span><span class="s1">name</span><span class="s2">], </span><span class="s1">args</span><span class="s2">) : </span><span class="s1">undefined</span><span class="s2">;</span>

            <span class="s3">if </span><span class="s2">(</span><span class="s1">name</span><span class="s2">) {</span>
                <span class="s0">//If setting exports via &quot;module&quot; is in play,</span>
                <span class="s0">//favor that over return value and exports. After that,</span>
                <span class="s0">//favor a non-undefined return value over exports use.</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">cjsModule </span><span class="s2">&amp;&amp; </span><span class="s1">cjsModule</span><span class="s2">.</span><span class="s1">exports </span><span class="s2">!== </span><span class="s1">undef </span><span class="s2">&amp;&amp;</span>
                        <span class="s1">cjsModule</span><span class="s2">.</span><span class="s1">exports </span><span class="s2">!== </span><span class="s1">defined</span><span class="s2">[</span><span class="s1">name</span><span class="s2">]) {</span>
                    <span class="s1">defined</span><span class="s2">[</span><span class="s1">name</span><span class="s2">] = </span><span class="s1">cjsModule</span><span class="s2">.</span><span class="s1">exports</span><span class="s2">;</span>
                <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">ret </span><span class="s2">!== </span><span class="s1">undef </span><span class="s2">|| !</span><span class="s1">usingExports</span><span class="s2">) {</span>
                    <span class="s0">//Use the return value from the function.</span>
                    <span class="s1">defined</span><span class="s2">[</span><span class="s1">name</span><span class="s2">] = </span><span class="s1">ret</span><span class="s2">;</span>
                <span class="s2">}</span>
            <span class="s2">}</span>
        <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">name</span><span class="s2">) {</span>
            <span class="s0">//May just be an object definition for the module. Only</span>
            <span class="s0">//worry about defining if have a module name.</span>
            <span class="s1">defined</span><span class="s2">[</span><span class="s1">name</span><span class="s2">] = </span><span class="s1">callback</span><span class="s2">;</span>
        <span class="s2">}</span>
    <span class="s2">};</span>

    <span class="s1">requirejs </span><span class="s2">= </span><span class="s1">require </span><span class="s2">= </span><span class="s1">req </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">deps</span><span class="s2">, </span><span class="s1">callback</span><span class="s2">, </span><span class="s1">relName</span><span class="s2">, </span><span class="s1">forceSync</span><span class="s2">, </span><span class="s1">alt</span><span class="s2">) {</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">deps </span><span class="s2">=== </span><span class="s4">&quot;string&quot;</span><span class="s2">) {</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">handlers</span><span class="s2">[</span><span class="s1">deps</span><span class="s2">]) {</span>
                <span class="s0">//callback in this case is really relName</span>
                <span class="s3">return </span><span class="s1">handlers</span><span class="s2">[</span><span class="s1">deps</span><span class="s2">](</span><span class="s1">callback</span><span class="s2">);</span>
            <span class="s2">}</span>
            <span class="s0">//Just return the module wanted. In this scenario, the</span>
            <span class="s0">//deps arg is the module name, and second arg (if passed)</span>
            <span class="s0">//is just the relName.</span>
            <span class="s0">//Normalize module name, if it contains . or ..</span>
            <span class="s3">return </span><span class="s1">callDep</span><span class="s2">(</span><span class="s1">makeMap</span><span class="s2">(</span><span class="s1">deps</span><span class="s2">, </span><span class="s1">makeRelParts</span><span class="s2">(</span><span class="s1">callback</span><span class="s2">)).</span><span class="s1">f</span><span class="s2">);</span>
        <span class="s2">} </span><span class="s3">else if </span><span class="s2">(!</span><span class="s1">deps</span><span class="s2">.</span><span class="s1">splice</span><span class="s2">) {</span>
            <span class="s0">//deps is a config object, not an array.</span>
            <span class="s1">config </span><span class="s2">= </span><span class="s1">deps</span><span class="s2">;</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">config</span><span class="s2">.</span><span class="s1">deps</span><span class="s2">) {</span>
                <span class="s1">req</span><span class="s2">(</span><span class="s1">config</span><span class="s2">.</span><span class="s1">deps</span><span class="s2">, </span><span class="s1">config</span><span class="s2">.</span><span class="s1">callback</span><span class="s2">);</span>
            <span class="s2">}</span>
            <span class="s3">if </span><span class="s2">(!</span><span class="s1">callback</span><span class="s2">) {</span>
                <span class="s3">return</span><span class="s2">;</span>
            <span class="s2">}</span>

            <span class="s3">if </span><span class="s2">(</span><span class="s1">callback</span><span class="s2">.</span><span class="s1">splice</span><span class="s2">) {</span>
                <span class="s0">//callback is an array, which means it is a dependency list.</span>
                <span class="s0">//Adjust args if there are dependencies</span>
                <span class="s1">deps </span><span class="s2">= </span><span class="s1">callback</span><span class="s2">;</span>
                <span class="s1">callback </span><span class="s2">= </span><span class="s1">relName</span><span class="s2">;</span>
                <span class="s1">relName </span><span class="s2">= </span><span class="s3">null</span><span class="s2">;</span>
            <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                <span class="s1">deps </span><span class="s2">= </span><span class="s1">undef</span><span class="s2">;</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s0">//Support require(['a'])</span>
        <span class="s1">callback </span><span class="s2">= </span><span class="s1">callback </span><span class="s2">|| </span><span class="s3">function </span><span class="s2">() {};</span>

        <span class="s0">//If relName is a function, it is an errback handler,</span>
        <span class="s0">//so remove it.</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">relName </span><span class="s2">=== </span><span class="s4">'function'</span><span class="s2">) {</span>
            <span class="s1">relName </span><span class="s2">= </span><span class="s1">forceSync</span><span class="s2">;</span>
            <span class="s1">forceSync </span><span class="s2">= </span><span class="s1">alt</span><span class="s2">;</span>
        <span class="s2">}</span>

        <span class="s0">//Simulate async callback;</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">forceSync</span><span class="s2">) {</span>
            <span class="s1">main</span><span class="s2">(</span><span class="s1">undef</span><span class="s2">, </span><span class="s1">deps</span><span class="s2">, </span><span class="s1">callback</span><span class="s2">, </span><span class="s1">relName</span><span class="s2">);</span>
        <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
            <span class="s0">//Using a non-zero value because of concern for what old browsers</span>
            <span class="s0">//do, and latest browsers &quot;upgrade&quot; to 4 if lower value is used:</span>
            <span class="s0">//http://www.whatwg.org/specs/web-apps/current-work/multipage/timers.html#dom-windowtimers-settimeout:</span>
            <span class="s0">//If want a value immediately, use require('id') instead -- something</span>
            <span class="s0">//that works in almond on the global level, but not guaranteed and</span>
            <span class="s0">//unlikely to work in other AMD implementations.</span>
            <span class="s1">setTimeout</span><span class="s2">(</span><span class="s3">function </span><span class="s2">() {</span>
                <span class="s1">main</span><span class="s2">(</span><span class="s1">undef</span><span class="s2">, </span><span class="s1">deps</span><span class="s2">, </span><span class="s1">callback</span><span class="s2">, </span><span class="s1">relName</span><span class="s2">);</span>
            <span class="s2">}, </span><span class="s8">4</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">req</span><span class="s2">;</span>
    <span class="s2">};</span>

    <span class="s5">/**</span>
     <span class="s5">* Just drops the config on the floor, but returns req in case</span>
     <span class="s5">* the config return value is used.</span>
     <span class="s5">*/</span>
    <span class="s1">req</span><span class="s2">.</span><span class="s1">config </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">cfg</span><span class="s2">) {</span>
        <span class="s3">return </span><span class="s1">req</span><span class="s2">(</span><span class="s1">cfg</span><span class="s2">);</span>
    <span class="s2">};</span>

    <span class="s5">/**</span>
     <span class="s5">* Expose module registry for debugging and tooling</span>
     <span class="s5">*/</span>
    <span class="s1">requirejs</span><span class="s2">.</span><span class="s1">_defined </span><span class="s2">= </span><span class="s1">defined</span><span class="s2">;</span>

    <span class="s1">define </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">name</span><span class="s2">, </span><span class="s1">deps</span><span class="s2">, </span><span class="s1">callback</span><span class="s2">) {</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">name </span><span class="s2">!== </span><span class="s4">'string'</span><span class="s2">) {</span>
            <span class="s3">throw new </span><span class="s1">Error</span><span class="s2">(</span><span class="s4">'See almond README: incorrect module build, no module name'</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s0">//This module may not have dependencies</span>
        <span class="s3">if </span><span class="s2">(!</span><span class="s1">deps</span><span class="s2">.</span><span class="s1">splice</span><span class="s2">) {</span>
            <span class="s0">//deps is not an array, so probably means</span>
            <span class="s0">//an object literal or factory function for</span>
            <span class="s0">//the value. Adjust args.</span>
            <span class="s1">callback </span><span class="s2">= </span><span class="s1">deps</span><span class="s2">;</span>
            <span class="s1">deps </span><span class="s2">= [];</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(!</span><span class="s1">hasProp</span><span class="s2">(</span><span class="s1">defined</span><span class="s2">, </span><span class="s1">name</span><span class="s2">) &amp;&amp; !</span><span class="s1">hasProp</span><span class="s2">(</span><span class="s1">waiting</span><span class="s2">, </span><span class="s1">name</span><span class="s2">)) {</span>
            <span class="s1">waiting</span><span class="s2">[</span><span class="s1">name</span><span class="s2">] = [</span><span class="s1">name</span><span class="s2">, </span><span class="s1">deps</span><span class="s2">, </span><span class="s1">callback</span><span class="s2">];</span>
        <span class="s2">}</span>
    <span class="s2">};</span>

    <span class="s1">define</span><span class="s2">.</span><span class="s1">amd </span><span class="s2">= {</span>
        <span class="s1">jQuery</span><span class="s2">: </span><span class="s3">true</span>
    <span class="s2">};</span>
<span class="s2">}());</span>

<span class="s1">S2</span><span class="s2">.</span><span class="s1">requirejs </span><span class="s2">= </span><span class="s1">requirejs</span><span class="s2">;</span><span class="s1">S2</span><span class="s2">.</span><span class="s1">require </span><span class="s2">= </span><span class="s1">require</span><span class="s2">;</span><span class="s1">S2</span><span class="s2">.</span><span class="s1">define </span><span class="s2">= </span><span class="s1">define</span><span class="s2">;</span>
<span class="s2">}</span>
<span class="s2">}());</span>
<span class="s1">S2</span><span class="s2">.</span><span class="s1">define</span><span class="s2">(</span><span class="s4">&quot;almond&quot;</span><span class="s2">, </span><span class="s3">function</span><span class="s2">(){});</span>

<span class="s0">/* global jQuery:false, $:false */</span>
<span class="s1">S2</span><span class="s2">.</span><span class="s1">define</span><span class="s2">(</span><span class="s4">'jquery'</span><span class="s2">,[],</span><span class="s3">function </span><span class="s2">() {</span>
  <span class="s3">var </span><span class="s1">_$ </span><span class="s2">= </span><span class="s1">jQuery </span><span class="s2">|| </span><span class="s1">$</span><span class="s2">;</span>

  <span class="s3">if </span><span class="s2">(</span><span class="s1">_$ </span><span class="s2">== </span><span class="s3">null </span><span class="s2">&amp;&amp; </span><span class="s1">console </span><span class="s2">&amp;&amp; </span><span class="s1">console</span><span class="s2">.</span><span class="s1">error</span><span class="s2">) {</span>
    <span class="s1">console</span><span class="s2">.</span><span class="s1">error</span><span class="s2">(</span>
      <span class="s4">'Select2: An instance of jQuery or a jQuery-compatible library was not ' </span><span class="s2">+</span>
      <span class="s4">'found. Make sure that you are including jQuery before Select2 on your ' </span><span class="s2">+</span>
      <span class="s4">'web page.'</span>
    <span class="s2">);</span>
  <span class="s2">}</span>

  <span class="s3">return </span><span class="s1">_$</span><span class="s2">;</span>
<span class="s2">});</span>

<span class="s1">S2</span><span class="s2">.</span><span class="s1">define</span><span class="s2">(</span><span class="s4">'select2/utils'</span><span class="s2">,[</span>
  <span class="s4">'jquery'</span>
<span class="s2">], </span><span class="s3">function </span><span class="s2">(</span><span class="s1">$</span><span class="s2">) {</span>
  <span class="s3">var </span><span class="s1">Utils </span><span class="s2">= {};</span>

  <span class="s1">Utils</span><span class="s2">.</span><span class="s1">Extend </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">ChildClass</span><span class="s2">, </span><span class="s1">SuperClass</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">__hasProp </span><span class="s2">= {}.</span><span class="s1">hasOwnProperty</span><span class="s2">;</span>

    <span class="s3">function </span><span class="s1">BaseConstructor </span><span class="s2">() {</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">constructor </span><span class="s2">= </span><span class="s1">ChildClass</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">key </span><span class="s3">in </span><span class="s1">SuperClass</span><span class="s2">) {</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">__hasProp</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">SuperClass</span><span class="s2">, </span><span class="s1">key</span><span class="s2">)) {</span>
        <span class="s1">ChildClass</span><span class="s2">[</span><span class="s1">key</span><span class="s2">] = </span><span class="s1">SuperClass</span><span class="s2">[</span><span class="s1">key</span><span class="s2">];</span>
      <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s1">BaseConstructor</span><span class="s2">.</span><span class="s1">prototype </span><span class="s2">= </span><span class="s1">SuperClass</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">;</span>
    <span class="s1">ChildClass</span><span class="s2">.</span><span class="s1">prototype </span><span class="s2">= </span><span class="s3">new </span><span class="s1">BaseConstructor</span><span class="s2">();</span>
    <span class="s1">ChildClass</span><span class="s2">.</span><span class="s1">__super__ </span><span class="s2">= </span><span class="s1">SuperClass</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">;</span>

    <span class="s3">return </span><span class="s1">ChildClass</span><span class="s2">;</span>
  <span class="s2">};</span>

  <span class="s3">function </span><span class="s1">getMethods </span><span class="s2">(</span><span class="s1">theClass</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">proto </span><span class="s2">= </span><span class="s1">theClass</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">;</span>

    <span class="s3">var </span><span class="s1">methods </span><span class="s2">= [];</span>

    <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">methodName </span><span class="s3">in </span><span class="s1">proto</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">m </span><span class="s2">= </span><span class="s1">proto</span><span class="s2">[</span><span class="s1">methodName</span><span class="s2">];</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">m </span><span class="s2">!== </span><span class="s4">'function'</span><span class="s2">) {</span>
        <span class="s3">continue</span><span class="s2">;</span>
      <span class="s2">}</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">methodName </span><span class="s2">=== </span><span class="s4">'constructor'</span><span class="s2">) {</span>
        <span class="s3">continue</span><span class="s2">;</span>
      <span class="s2">}</span>

      <span class="s1">methods</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">methodName</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">return </span><span class="s1">methods</span><span class="s2">;</span>
  <span class="s2">}</span>

  <span class="s1">Utils</span><span class="s2">.</span><span class="s1">Decorate </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">SuperClass</span><span class="s2">, </span><span class="s1">DecoratorClass</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">decoratedMethods </span><span class="s2">= </span><span class="s1">getMethods</span><span class="s2">(</span><span class="s1">DecoratorClass</span><span class="s2">);</span>
    <span class="s3">var </span><span class="s1">superMethods </span><span class="s2">= </span><span class="s1">getMethods</span><span class="s2">(</span><span class="s1">SuperClass</span><span class="s2">);</span>

    <span class="s3">function </span><span class="s1">DecoratedClass </span><span class="s2">() {</span>
      <span class="s3">var </span><span class="s1">unshift </span><span class="s2">= </span><span class="s1">Array</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">unshift</span><span class="s2">;</span>

      <span class="s3">var </span><span class="s1">argCount </span><span class="s2">= </span><span class="s1">DecoratorClass</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">constructor</span><span class="s2">.</span><span class="s1">length</span><span class="s2">;</span>

      <span class="s3">var </span><span class="s1">calledConstructor </span><span class="s2">= </span><span class="s1">SuperClass</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">constructor</span><span class="s2">;</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">argCount </span><span class="s2">&gt; </span><span class="s8">0</span><span class="s2">) {</span>
        <span class="s1">unshift</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">arguments</span><span class="s2">, </span><span class="s1">SuperClass</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">constructor</span><span class="s2">);</span>

        <span class="s1">calledConstructor </span><span class="s2">= </span><span class="s1">DecoratorClass</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">constructor</span><span class="s2">;</span>
      <span class="s2">}</span>

      <span class="s1">calledConstructor</span><span class="s2">.</span><span class="s1">apply</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">arguments</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s1">DecoratorClass</span><span class="s2">.</span><span class="s1">displayName </span><span class="s2">= </span><span class="s1">SuperClass</span><span class="s2">.</span><span class="s1">displayName</span><span class="s2">;</span>

    <span class="s3">function </span><span class="s1">ctr </span><span class="s2">() {</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">constructor </span><span class="s2">= </span><span class="s1">DecoratedClass</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s1">DecoratedClass</span><span class="s2">.</span><span class="s1">prototype </span><span class="s2">= </span><span class="s3">new </span><span class="s1">ctr</span><span class="s2">();</span>

    <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">m </span><span class="s2">= </span><span class="s8">0</span><span class="s2">; </span><span class="s1">m </span><span class="s2">&lt; </span><span class="s1">superMethods</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">m</span><span class="s2">++) {</span>
      <span class="s3">var </span><span class="s1">superMethod </span><span class="s2">= </span><span class="s1">superMethods</span><span class="s2">[</span><span class="s1">m</span><span class="s2">];</span>

      <span class="s1">DecoratedClass</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">[</span><span class="s1">superMethod</span><span class="s2">] =</span>
        <span class="s1">SuperClass</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">[</span><span class="s1">superMethod</span><span class="s2">];</span>
    <span class="s2">}</span>

    <span class="s3">var </span><span class="s1">calledMethod </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">methodName</span><span class="s2">) {</span>
      <span class="s0">// Stub out the original method if it's not decorating an actual method</span>
      <span class="s3">var </span><span class="s1">originalMethod </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {};</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">methodName </span><span class="s3">in </span><span class="s1">DecoratedClass</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">) {</span>
        <span class="s1">originalMethod </span><span class="s2">= </span><span class="s1">DecoratedClass</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">[</span><span class="s1">methodName</span><span class="s2">];</span>
      <span class="s2">}</span>

      <span class="s3">var </span><span class="s1">decoratedMethod </span><span class="s2">= </span><span class="s1">DecoratorClass</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">[</span><span class="s1">methodName</span><span class="s2">];</span>

      <span class="s3">return function </span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">unshift </span><span class="s2">= </span><span class="s1">Array</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">unshift</span><span class="s2">;</span>

        <span class="s1">unshift</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">arguments</span><span class="s2">, </span><span class="s1">originalMethod</span><span class="s2">);</span>

        <span class="s3">return </span><span class="s1">decoratedMethod</span><span class="s2">.</span><span class="s1">apply</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">arguments</span><span class="s2">);</span>
      <span class="s2">};</span>
    <span class="s2">};</span>

    <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">d </span><span class="s2">= </span><span class="s8">0</span><span class="s2">; </span><span class="s1">d </span><span class="s2">&lt; </span><span class="s1">decoratedMethods</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">d</span><span class="s2">++) {</span>
      <span class="s3">var </span><span class="s1">decoratedMethod </span><span class="s2">= </span><span class="s1">decoratedMethods</span><span class="s2">[</span><span class="s1">d</span><span class="s2">];</span>

      <span class="s1">DecoratedClass</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">[</span><span class="s1">decoratedMethod</span><span class="s2">] = </span><span class="s1">calledMethod</span><span class="s2">(</span><span class="s1">decoratedMethod</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">return </span><span class="s1">DecoratedClass</span><span class="s2">;</span>
  <span class="s2">};</span>

  <span class="s3">var </span><span class="s1">Observable </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">listeners </span><span class="s2">= {};</span>
  <span class="s2">};</span>

  <span class="s1">Observable</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">on </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">event</span><span class="s2">, </span><span class="s1">callback</span><span class="s2">) {</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">listeners </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">listeners </span><span class="s2">|| {};</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">event </span><span class="s3">in this</span><span class="s2">.</span><span class="s1">listeners</span><span class="s2">) {</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">listeners</span><span class="s2">[</span><span class="s1">event</span><span class="s2">].</span><span class="s1">push</span><span class="s2">(</span><span class="s1">callback</span><span class="s2">);</span>
    <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">listeners</span><span class="s2">[</span><span class="s1">event</span><span class="s2">] = [</span><span class="s1">callback</span><span class="s2">];</span>
    <span class="s2">}</span>
  <span class="s2">};</span>

  <span class="s1">Observable</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">trigger </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">event</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">slice </span><span class="s2">= </span><span class="s1">Array</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">;</span>
    <span class="s3">var </span><span class="s1">params </span><span class="s2">= </span><span class="s1">slice</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">arguments</span><span class="s2">, </span><span class="s8">1</span><span class="s2">);</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">listeners </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">listeners </span><span class="s2">|| {};</span>

    <span class="s0">// Params should always come in as an array</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">params </span><span class="s2">== </span><span class="s3">null</span><span class="s2">) {</span>
      <span class="s1">params </span><span class="s2">= [];</span>
    <span class="s2">}</span>

    <span class="s0">// If there are no arguments to the event, use a temporary object</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">params</span><span class="s2">.</span><span class="s1">length </span><span class="s2">=== </span><span class="s8">0</span><span class="s2">) {</span>
      <span class="s1">params</span><span class="s2">.</span><span class="s1">push</span><span class="s2">({});</span>
    <span class="s2">}</span>

    <span class="s0">// Set the `_type` of the first object to the event</span>
    <span class="s1">params</span><span class="s2">[</span><span class="s8">0</span><span class="s2">].</span><span class="s1">_type </span><span class="s2">= </span><span class="s1">event</span><span class="s2">;</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">event </span><span class="s3">in this</span><span class="s2">.</span><span class="s1">listeners</span><span class="s2">) {</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">invoke</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">listeners</span><span class="s2">[</span><span class="s1">event</span><span class="s2">], </span><span class="s1">slice</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">arguments</span><span class="s2">, </span><span class="s8">1</span><span class="s2">));</span>
    <span class="s2">}</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s4">'*' </span><span class="s3">in this</span><span class="s2">.</span><span class="s1">listeners</span><span class="s2">) {</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">invoke</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">listeners</span><span class="s2">[</span><span class="s4">'*'</span><span class="s2">], </span><span class="s1">arguments</span><span class="s2">);</span>
    <span class="s2">}</span>
  <span class="s2">};</span>

  <span class="s1">Observable</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">invoke </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">listeners</span><span class="s2">, </span><span class="s1">params</span><span class="s2">) {</span>
    <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">i </span><span class="s2">= </span><span class="s8">0</span><span class="s2">, </span><span class="s1">len </span><span class="s2">= </span><span class="s1">listeners</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">len</span><span class="s2">; </span><span class="s1">i</span><span class="s2">++) {</span>
      <span class="s1">listeners</span><span class="s2">[</span><span class="s1">i</span><span class="s2">].</span><span class="s1">apply</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">params</span><span class="s2">);</span>
    <span class="s2">}</span>
  <span class="s2">};</span>

  <span class="s1">Utils</span><span class="s2">.</span><span class="s1">Observable </span><span class="s2">= </span><span class="s1">Observable</span><span class="s2">;</span>

  <span class="s1">Utils</span><span class="s2">.</span><span class="s1">generateChars </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">length</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">chars </span><span class="s2">= </span><span class="s4">''</span><span class="s2">;</span>

    <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">i </span><span class="s2">= </span><span class="s8">0</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">length</span><span class="s2">; </span><span class="s1">i</span><span class="s2">++) {</span>
      <span class="s3">var </span><span class="s1">randomChar </span><span class="s2">= </span><span class="s1">Math</span><span class="s2">.</span><span class="s1">floor</span><span class="s2">(</span><span class="s1">Math</span><span class="s2">.</span><span class="s1">random</span><span class="s2">() * </span><span class="s8">36</span><span class="s2">);</span>
      <span class="s1">chars </span><span class="s2">+= </span><span class="s1">randomChar</span><span class="s2">.</span><span class="s1">toString</span><span class="s2">(</span><span class="s8">36</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">return </span><span class="s1">chars</span><span class="s2">;</span>
  <span class="s2">};</span>

  <span class="s1">Utils</span><span class="s2">.</span><span class="s1">bind </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">func</span><span class="s2">, </span><span class="s1">context</span><span class="s2">) {</span>
    <span class="s3">return function </span><span class="s2">() {</span>
      <span class="s1">func</span><span class="s2">.</span><span class="s1">apply</span><span class="s2">(</span><span class="s1">context</span><span class="s2">, </span><span class="s1">arguments</span><span class="s2">);</span>
    <span class="s2">};</span>
  <span class="s2">};</span>

  <span class="s1">Utils</span><span class="s2">.</span><span class="s1">_convertData </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">data</span><span class="s2">) {</span>
    <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">originalKey </span><span class="s3">in </span><span class="s1">data</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">keys </span><span class="s2">= </span><span class="s1">originalKey</span><span class="s2">.</span><span class="s1">split</span><span class="s2">(</span><span class="s4">'-'</span><span class="s2">);</span>

      <span class="s3">var </span><span class="s1">dataLevel </span><span class="s2">= </span><span class="s1">data</span><span class="s2">;</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">keys</span><span class="s2">.</span><span class="s1">length </span><span class="s2">=== </span><span class="s8">1</span><span class="s2">) {</span>
        <span class="s3">continue</span><span class="s2">;</span>
      <span class="s2">}</span>

      <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">k </span><span class="s2">= </span><span class="s8">0</span><span class="s2">; </span><span class="s1">k </span><span class="s2">&lt; </span><span class="s1">keys</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">k</span><span class="s2">++) {</span>
        <span class="s3">var </span><span class="s1">key </span><span class="s2">= </span><span class="s1">keys</span><span class="s2">[</span><span class="s1">k</span><span class="s2">];</span>

        <span class="s0">// Lowercase the first letter</span>
        <span class="s0">// By default, dash-separated becomes camelCase</span>
        <span class="s1">key </span><span class="s2">= </span><span class="s1">key</span><span class="s2">.</span><span class="s1">substring</span><span class="s2">(</span><span class="s8">0</span><span class="s2">, </span><span class="s8">1</span><span class="s2">).</span><span class="s1">toLowerCase</span><span class="s2">() + </span><span class="s1">key</span><span class="s2">.</span><span class="s1">substring</span><span class="s2">(</span><span class="s8">1</span><span class="s2">);</span>

        <span class="s3">if </span><span class="s2">(!(</span><span class="s1">key </span><span class="s3">in </span><span class="s1">dataLevel</span><span class="s2">)) {</span>
          <span class="s1">dataLevel</span><span class="s2">[</span><span class="s1">key</span><span class="s2">] = {};</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">k </span><span class="s2">== </span><span class="s1">keys</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s8">1</span><span class="s2">) {</span>
          <span class="s1">dataLevel</span><span class="s2">[</span><span class="s1">key</span><span class="s2">] = </span><span class="s1">data</span><span class="s2">[</span><span class="s1">originalKey</span><span class="s2">];</span>
        <span class="s2">}</span>

        <span class="s1">dataLevel </span><span class="s2">= </span><span class="s1">dataLevel</span><span class="s2">[</span><span class="s1">key</span><span class="s2">];</span>
      <span class="s2">}</span>

      <span class="s3">delete </span><span class="s1">data</span><span class="s2">[</span><span class="s1">originalKey</span><span class="s2">];</span>
    <span class="s2">}</span>

    <span class="s3">return </span><span class="s1">data</span><span class="s2">;</span>
  <span class="s2">};</span>

  <span class="s1">Utils</span><span class="s2">.</span><span class="s1">hasScroll </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">index</span><span class="s2">, </span><span class="s1">el</span><span class="s2">) {</span>
    <span class="s0">// Adapted from the function created by @ShadowScripter</span>
    <span class="s0">// and adapted by @BillBarry on the Stack Exchange Code Review website.</span>
    <span class="s0">// The original code can be found at</span>
    <span class="s0">// http://codereview.stackexchange.com/q/13338</span>
    <span class="s0">// and was designed to be used with the Sizzle selector engine.</span>

    <span class="s3">var </span><span class="s1">$el </span><span class="s2">= </span><span class="s1">$</span><span class="s2">(</span><span class="s1">el</span><span class="s2">);</span>
    <span class="s3">var </span><span class="s1">overflowX </span><span class="s2">= </span><span class="s1">el</span><span class="s2">.</span><span class="s1">style</span><span class="s2">.</span><span class="s1">overflowX</span><span class="s2">;</span>
    <span class="s3">var </span><span class="s1">overflowY </span><span class="s2">= </span><span class="s1">el</span><span class="s2">.</span><span class="s1">style</span><span class="s2">.</span><span class="s1">overflowY</span><span class="s2">;</span>

    <span class="s0">//Check both x and y declarations</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">overflowX </span><span class="s2">=== </span><span class="s1">overflowY </span><span class="s2">&amp;&amp;</span>
        <span class="s2">(</span><span class="s1">overflowY </span><span class="s2">=== </span><span class="s4">'hidden' </span><span class="s2">|| </span><span class="s1">overflowY </span><span class="s2">=== </span><span class="s4">'visible'</span><span class="s2">)) {</span>
      <span class="s3">return false</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">overflowX </span><span class="s2">=== </span><span class="s4">'scroll' </span><span class="s2">|| </span><span class="s1">overflowY </span><span class="s2">=== </span><span class="s4">'scroll'</span><span class="s2">) {</span>
      <span class="s3">return true</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">return </span><span class="s2">(</span><span class="s1">$el</span><span class="s2">.</span><span class="s1">innerHeight</span><span class="s2">() &lt; </span><span class="s1">el</span><span class="s2">.</span><span class="s1">scrollHeight </span><span class="s2">||</span>
      <span class="s1">$el</span><span class="s2">.</span><span class="s1">innerWidth</span><span class="s2">() &lt; </span><span class="s1">el</span><span class="s2">.</span><span class="s1">scrollWidth</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s1">Utils</span><span class="s2">.</span><span class="s1">escapeMarkup </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">markup</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">replaceMap </span><span class="s2">= {</span>
      <span class="s4">'</span><span class="s3">\\</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'&amp;#92;'</span><span class="s2">,</span>
      <span class="s4">'&amp;'</span><span class="s2">: </span><span class="s4">'&amp;amp;'</span><span class="s2">,</span>
      <span class="s4">'&lt;'</span><span class="s2">: </span><span class="s4">'&amp;lt;'</span><span class="s2">,</span>
      <span class="s4">'&gt;'</span><span class="s2">: </span><span class="s4">'&amp;gt;'</span><span class="s2">,</span>
      <span class="s4">'&quot;'</span><span class="s2">: </span><span class="s4">'&amp;quot;'</span><span class="s2">,</span>
      <span class="s4">'</span><span class="s3">\'</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'&amp;#39;'</span><span class="s2">,</span>
      <span class="s4">'/'</span><span class="s2">: </span><span class="s4">'&amp;#47;'</span>
    <span class="s2">};</span>

    <span class="s0">// Do not try to escape the markup if it's not a string</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">markup </span><span class="s2">!== </span><span class="s4">'string'</span><span class="s2">) {</span>
      <span class="s3">return </span><span class="s1">markup</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">return </span><span class="s1">String</span><span class="s2">(</span><span class="s1">markup</span><span class="s2">).</span><span class="s1">replace</span><span class="s2">(</span><span class="s7">/[&amp;&lt;&gt;&quot;'\/\\]/g</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">match</span><span class="s2">) {</span>
      <span class="s3">return </span><span class="s1">replaceMap</span><span class="s2">[</span><span class="s1">match</span><span class="s2">];</span>
    <span class="s2">});</span>
  <span class="s2">};</span>

  <span class="s0">// Append an array of jQuery nodes to a given element.</span>
  <span class="s1">Utils</span><span class="s2">.</span><span class="s1">appendMany </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">$element</span><span class="s2">, </span><span class="s1">$nodes</span><span class="s2">) {</span>
    <span class="s0">// jQuery 1.7.x does not support $.fn.append() with an array</span>
    <span class="s0">// Fall back to a jQuery object collection using $.fn.add()</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">$</span><span class="s2">.</span><span class="s1">fn</span><span class="s2">.</span><span class="s1">jquery</span><span class="s2">.</span><span class="s1">substr</span><span class="s2">(</span><span class="s8">0</span><span class="s2">, </span><span class="s8">3</span><span class="s2">) === </span><span class="s4">'1.7'</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">$jqNodes </span><span class="s2">= </span><span class="s1">$</span><span class="s2">();</span>

      <span class="s1">$</span><span class="s2">.</span><span class="s1">map</span><span class="s2">(</span><span class="s1">$nodes</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">node</span><span class="s2">) {</span>
        <span class="s1">$jqNodes </span><span class="s2">= </span><span class="s1">$jqNodes</span><span class="s2">.</span><span class="s1">add</span><span class="s2">(</span><span class="s1">node</span><span class="s2">);</span>
      <span class="s2">});</span>

      <span class="s1">$nodes </span><span class="s2">= </span><span class="s1">$jqNodes</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s1">$element</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">$nodes</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s0">// Cache objects in Utils.__cache instead of $.data (see #4346)</span>
  <span class="s1">Utils</span><span class="s2">.</span><span class="s1">__cache </span><span class="s2">= {};</span>

  <span class="s3">var </span><span class="s1">id </span><span class="s2">= </span><span class="s8">0</span><span class="s2">;</span>
  <span class="s1">Utils</span><span class="s2">.</span><span class="s1">GetUniqueElementId </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">element</span><span class="s2">) {</span>
    <span class="s0">// Get a unique element Id. If element has no id,</span>
    <span class="s0">// creates a new unique number, stores it in the id</span>
    <span class="s0">// attribute and returns the new id.</span>
    <span class="s0">// If an id already exists, it simply returns it.</span>

    <span class="s3">var </span><span class="s1">select2Id </span><span class="s2">= </span><span class="s1">element</span><span class="s2">.</span><span class="s1">getAttribute</span><span class="s2">(</span><span class="s4">'data-select2-id'</span><span class="s2">);</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">select2Id </span><span class="s2">== </span><span class="s3">null</span><span class="s2">) {</span>
      <span class="s0">// If element has id, use it.</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">element</span><span class="s2">.</span><span class="s1">id</span><span class="s2">) {</span>
        <span class="s1">select2Id </span><span class="s2">= </span><span class="s1">element</span><span class="s2">.</span><span class="s1">id</span><span class="s2">;</span>
        <span class="s1">element</span><span class="s2">.</span><span class="s1">setAttribute</span><span class="s2">(</span><span class="s4">'data-select2-id'</span><span class="s2">, </span><span class="s1">select2Id</span><span class="s2">);</span>
      <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
        <span class="s1">element</span><span class="s2">.</span><span class="s1">setAttribute</span><span class="s2">(</span><span class="s4">'data-select2-id'</span><span class="s2">, ++</span><span class="s1">id</span><span class="s2">);</span>
        <span class="s1">select2Id </span><span class="s2">= </span><span class="s1">id</span><span class="s2">.</span><span class="s1">toString</span><span class="s2">();</span>
      <span class="s2">}</span>
    <span class="s2">}</span>
    <span class="s3">return </span><span class="s1">select2Id</span><span class="s2">;</span>
  <span class="s2">};</span>

  <span class="s1">Utils</span><span class="s2">.</span><span class="s1">StoreData </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">element</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">value</span><span class="s2">) {</span>
    <span class="s0">// Stores an item in the cache for a specified element.</span>
    <span class="s0">// name is the cache key.</span>
    <span class="s3">var </span><span class="s1">id </span><span class="s2">= </span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">GetUniqueElementId</span><span class="s2">(</span><span class="s1">element</span><span class="s2">);</span>
    <span class="s3">if </span><span class="s2">(!</span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">__cache</span><span class="s2">[</span><span class="s1">id</span><span class="s2">]) {</span>
      <span class="s1">Utils</span><span class="s2">.</span><span class="s1">__cache</span><span class="s2">[</span><span class="s1">id</span><span class="s2">] = {};</span>
    <span class="s2">}</span>

    <span class="s1">Utils</span><span class="s2">.</span><span class="s1">__cache</span><span class="s2">[</span><span class="s1">id</span><span class="s2">][</span><span class="s1">name</span><span class="s2">] = </span><span class="s1">value</span><span class="s2">;</span>
  <span class="s2">};</span>

  <span class="s1">Utils</span><span class="s2">.</span><span class="s1">GetData </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">element</span><span class="s2">, </span><span class="s1">name</span><span class="s2">) {</span>
    <span class="s0">// Retrieves a value from the cache by its key (name)</span>
    <span class="s0">// name is optional. If no name specified, return</span>
    <span class="s0">// all cache items for the specified element.</span>
    <span class="s0">// and for a specified element.</span>
    <span class="s3">var </span><span class="s1">id </span><span class="s2">= </span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">GetUniqueElementId</span><span class="s2">(</span><span class="s1">element</span><span class="s2">);</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">name</span><span class="s2">) {</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">__cache</span><span class="s2">[</span><span class="s1">id</span><span class="s2">]) {</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">__cache</span><span class="s2">[</span><span class="s1">id</span><span class="s2">][</span><span class="s1">name</span><span class="s2">] != </span><span class="s3">null</span><span class="s2">) {</span>
          <span class="s3">return </span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">__cache</span><span class="s2">[</span><span class="s1">id</span><span class="s2">][</span><span class="s1">name</span><span class="s2">];</span>
        <span class="s2">}</span>
        <span class="s3">return </span><span class="s1">$</span><span class="s2">(</span><span class="s1">element</span><span class="s2">).</span><span class="s1">data</span><span class="s2">(</span><span class="s1">name</span><span class="s2">); </span><span class="s0">// Fallback to HTML5 data attribs.</span>
      <span class="s2">}</span>
      <span class="s3">return </span><span class="s1">$</span><span class="s2">(</span><span class="s1">element</span><span class="s2">).</span><span class="s1">data</span><span class="s2">(</span><span class="s1">name</span><span class="s2">); </span><span class="s0">// Fallback to HTML5 data attribs.</span>
    <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
      <span class="s3">return </span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">__cache</span><span class="s2">[</span><span class="s1">id</span><span class="s2">];</span>
    <span class="s2">}</span>
  <span class="s2">};</span>

  <span class="s1">Utils</span><span class="s2">.</span><span class="s1">RemoveData </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">element</span><span class="s2">) {</span>
    <span class="s0">// Removes all cached items for a specified element.</span>
    <span class="s3">var </span><span class="s1">id </span><span class="s2">= </span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">GetUniqueElementId</span><span class="s2">(</span><span class="s1">element</span><span class="s2">);</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">__cache</span><span class="s2">[</span><span class="s1">id</span><span class="s2">] != </span><span class="s3">null</span><span class="s2">) {</span>
      <span class="s3">delete </span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">__cache</span><span class="s2">[</span><span class="s1">id</span><span class="s2">];</span>
    <span class="s2">}</span>

    <span class="s1">element</span><span class="s2">.</span><span class="s1">removeAttribute</span><span class="s2">(</span><span class="s4">'data-select2-id'</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s3">return </span><span class="s1">Utils</span><span class="s2">;</span>
<span class="s2">});</span>

<span class="s1">S2</span><span class="s2">.</span><span class="s1">define</span><span class="s2">(</span><span class="s4">'select2/results'</span><span class="s2">,[</span>
  <span class="s4">'jquery'</span><span class="s2">,</span>
  <span class="s4">'./utils'</span>
<span class="s2">], </span><span class="s3">function </span><span class="s2">(</span><span class="s1">$</span><span class="s2">, </span><span class="s1">Utils</span><span class="s2">) {</span>
  <span class="s3">function </span><span class="s1">Results </span><span class="s2">(</span><span class="s1">$element</span><span class="s2">, </span><span class="s1">options</span><span class="s2">, </span><span class="s1">dataAdapter</span><span class="s2">) {</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">$element </span><span class="s2">= </span><span class="s1">$element</span><span class="s2">;</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">data </span><span class="s2">= </span><span class="s1">dataAdapter</span><span class="s2">;</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">options </span><span class="s2">= </span><span class="s1">options</span><span class="s2">;</span>

    <span class="s1">Results</span><span class="s2">.</span><span class="s1">__super__</span><span class="s2">.</span><span class="s1">constructor</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">);</span>
  <span class="s2">}</span>

  <span class="s1">Utils</span><span class="s2">.</span><span class="s1">Extend</span><span class="s2">(</span><span class="s1">Results</span><span class="s2">, </span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">Observable</span><span class="s2">);</span>

  <span class="s1">Results</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">render </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {</span>
    <span class="s3">var </span><span class="s1">$results </span><span class="s2">= </span><span class="s1">$</span><span class="s2">(</span>
      <span class="s4">'&lt;ul class=&quot;select2-results__options&quot; role=&quot;listbox&quot;&gt;&lt;/ul&gt;'</span>
    <span class="s2">);</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'multiple'</span><span class="s2">)) {</span>
      <span class="s1">$results</span><span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'aria-multiselectable'</span><span class="s2">, </span><span class="s4">'true'</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">$results </span><span class="s2">= </span><span class="s1">$results</span><span class="s2">;</span>

    <span class="s3">return </span><span class="s1">$results</span><span class="s2">;</span>
  <span class="s2">};</span>

  <span class="s1">Results</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">clear </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">$results</span><span class="s2">.</span><span class="s1">empty</span><span class="s2">();</span>
  <span class="s2">};</span>

  <span class="s1">Results</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">displayMessage </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">params</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">escapeMarkup </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'escapeMarkup'</span><span class="s2">);</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">clear</span><span class="s2">();</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">hideLoading</span><span class="s2">();</span>

    <span class="s3">var </span><span class="s1">$message </span><span class="s2">= </span><span class="s1">$</span><span class="s2">(</span>
      <span class="s4">'&lt;li role=&quot;alert&quot; aria-live=&quot;assertive&quot;' </span><span class="s2">+</span>
      <span class="s4">' class=&quot;select2-results__option&quot;&gt;&lt;/li&gt;'</span>
    <span class="s2">);</span>

    <span class="s3">var </span><span class="s1">message </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'translations'</span><span class="s2">).</span><span class="s1">get</span><span class="s2">(</span><span class="s1">params</span><span class="s2">.</span><span class="s1">message</span><span class="s2">);</span>

    <span class="s1">$message</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span>
      <span class="s1">escapeMarkup</span><span class="s2">(</span>
        <span class="s1">message</span><span class="s2">(</span><span class="s1">params</span><span class="s2">.</span><span class="s1">args</span><span class="s2">)</span>
      <span class="s2">)</span>
    <span class="s2">);</span>

    <span class="s1">$message</span><span class="s2">[</span><span class="s8">0</span><span class="s2">].</span><span class="s1">className </span><span class="s2">+= </span><span class="s4">' select2-results__message'</span><span class="s2">;</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">$results</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">$message</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s1">Results</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">hideMessages </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">$results</span><span class="s2">.</span><span class="s1">find</span><span class="s2">(</span><span class="s4">'.select2-results__message'</span><span class="s2">).</span><span class="s1">remove</span><span class="s2">();</span>
  <span class="s2">};</span>

  <span class="s1">Results</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">append </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">data</span><span class="s2">) {</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">hideLoading</span><span class="s2">();</span>

    <span class="s3">var </span><span class="s1">$options </span><span class="s2">= [];</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">data</span><span class="s2">.</span><span class="s1">results </span><span class="s2">== </span><span class="s3">null </span><span class="s2">|| </span><span class="s1">data</span><span class="s2">.</span><span class="s1">results</span><span class="s2">.</span><span class="s1">length </span><span class="s2">=== </span><span class="s8">0</span><span class="s2">) {</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">$results</span><span class="s2">.</span><span class="s1">children</span><span class="s2">().</span><span class="s1">length </span><span class="s2">=== </span><span class="s8">0</span><span class="s2">) {</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'results:message'</span><span class="s2">, {</span>
          <span class="s1">message</span><span class="s2">: </span><span class="s4">'noResults'</span>
        <span class="s2">});</span>
      <span class="s2">}</span>

      <span class="s3">return</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s1">data</span><span class="s2">.</span><span class="s1">results </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">sort</span><span class="s2">(</span><span class="s1">data</span><span class="s2">.</span><span class="s1">results</span><span class="s2">);</span>

    <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">d </span><span class="s2">= </span><span class="s8">0</span><span class="s2">; </span><span class="s1">d </span><span class="s2">&lt; </span><span class="s1">data</span><span class="s2">.</span><span class="s1">results</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">d</span><span class="s2">++) {</span>
      <span class="s3">var </span><span class="s1">item </span><span class="s2">= </span><span class="s1">data</span><span class="s2">.</span><span class="s1">results</span><span class="s2">[</span><span class="s1">d</span><span class="s2">];</span>

      <span class="s3">var </span><span class="s1">$option </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">option</span><span class="s2">(</span><span class="s1">item</span><span class="s2">);</span>

      <span class="s1">$options</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">$option</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">$results</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">$options</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s1">Results</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">position </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">$results</span><span class="s2">, </span><span class="s1">$dropdown</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">$resultsContainer </span><span class="s2">= </span><span class="s1">$dropdown</span><span class="s2">.</span><span class="s1">find</span><span class="s2">(</span><span class="s4">'.select2-results'</span><span class="s2">);</span>
    <span class="s1">$resultsContainer</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">$results</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s1">Results</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">sort </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">data</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">sorter </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'sorter'</span><span class="s2">);</span>

    <span class="s3">return </span><span class="s1">sorter</span><span class="s2">(</span><span class="s1">data</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s1">Results</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">highlightFirstItem </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {</span>
    <span class="s3">var </span><span class="s1">$options </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">$results</span>
      <span class="s2">.</span><span class="s1">find</span><span class="s2">(</span><span class="s4">'.select2-results__option[aria-selected]'</span><span class="s2">);</span>

    <span class="s3">var </span><span class="s1">$selected </span><span class="s2">= </span><span class="s1">$options</span><span class="s2">.</span><span class="s1">filter</span><span class="s2">(</span><span class="s4">'[aria-selected=true]'</span><span class="s2">);</span>

    <span class="s0">// Check if there are any selected options</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">$selected</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt; </span><span class="s8">0</span><span class="s2">) {</span>
      <span class="s0">// If there are selected options, highlight the first</span>
      <span class="s1">$selected</span><span class="s2">.</span><span class="s1">first</span><span class="s2">().</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'mouseenter'</span><span class="s2">);</span>
    <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
      <span class="s0">// If there are no selected options, highlight the first option</span>
      <span class="s0">// in the dropdown</span>
      <span class="s1">$options</span><span class="s2">.</span><span class="s1">first</span><span class="s2">().</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'mouseenter'</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">ensureHighlightVisible</span><span class="s2">();</span>
  <span class="s2">};</span>

  <span class="s1">Results</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">setClasses </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {</span>
    <span class="s3">var </span><span class="s1">self </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">data</span><span class="s2">.</span><span class="s1">current</span><span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">selected</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">selectedIds </span><span class="s2">= </span><span class="s1">$</span><span class="s2">.</span><span class="s1">map</span><span class="s2">(</span><span class="s1">selected</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">s</span><span class="s2">) {</span>
        <span class="s3">return </span><span class="s1">s</span><span class="s2">.</span><span class="s1">id</span><span class="s2">.</span><span class="s1">toString</span><span class="s2">();</span>
      <span class="s2">});</span>

      <span class="s3">var </span><span class="s1">$options </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">$results</span>
        <span class="s2">.</span><span class="s1">find</span><span class="s2">(</span><span class="s4">'.select2-results__option[aria-selected]'</span><span class="s2">);</span>

      <span class="s1">$options</span><span class="s2">.</span><span class="s1">each</span><span class="s2">(</span><span class="s3">function </span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">$option </span><span class="s2">= </span><span class="s1">$</span><span class="s2">(</span><span class="s3">this</span><span class="s2">);</span>

        <span class="s3">var </span><span class="s1">item </span><span class="s2">= </span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">GetData</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s4">'data'</span><span class="s2">);</span>

        <span class="s0">// id needs to be converted to a string when comparing</span>
        <span class="s3">var </span><span class="s1">id </span><span class="s2">= </span><span class="s4">'' </span><span class="s2">+ </span><span class="s1">item</span><span class="s2">.</span><span class="s1">id</span><span class="s2">;</span>

        <span class="s3">if </span><span class="s2">((</span><span class="s1">item</span><span class="s2">.</span><span class="s1">element </span><span class="s2">!= </span><span class="s3">null </span><span class="s2">&amp;&amp; </span><span class="s1">item</span><span class="s2">.</span><span class="s1">element</span><span class="s2">.</span><span class="s1">selected</span><span class="s2">) ||</span>
            <span class="s2">(</span><span class="s1">item</span><span class="s2">.</span><span class="s1">element </span><span class="s2">== </span><span class="s3">null </span><span class="s2">&amp;&amp; </span><span class="s1">$</span><span class="s2">.</span><span class="s1">inArray</span><span class="s2">(</span><span class="s1">id</span><span class="s2">, </span><span class="s1">selectedIds</span><span class="s2">) &gt; -</span><span class="s8">1</span><span class="s2">)) {</span>
          <span class="s1">$option</span><span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'aria-selected'</span><span class="s2">, </span><span class="s4">'true'</span><span class="s2">);</span>
        <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
          <span class="s1">$option</span><span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'aria-selected'</span><span class="s2">, </span><span class="s4">'false'</span><span class="s2">);</span>
        <span class="s2">}</span>
      <span class="s2">});</span>

    <span class="s2">});</span>
  <span class="s2">};</span>

  <span class="s1">Results</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">showLoading </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">params</span><span class="s2">) {</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">hideLoading</span><span class="s2">();</span>

    <span class="s3">var </span><span class="s1">loadingMore </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'translations'</span><span class="s2">).</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'searching'</span><span class="s2">);</span>

    <span class="s3">var </span><span class="s1">loading </span><span class="s2">= {</span>
      <span class="s1">disabled</span><span class="s2">: </span><span class="s3">true</span><span class="s2">,</span>
      <span class="s1">loading</span><span class="s2">: </span><span class="s3">true</span><span class="s2">,</span>
      <span class="s1">text</span><span class="s2">: </span><span class="s1">loadingMore</span><span class="s2">(</span><span class="s1">params</span><span class="s2">)</span>
    <span class="s2">};</span>
    <span class="s3">var </span><span class="s1">$loading </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">option</span><span class="s2">(</span><span class="s1">loading</span><span class="s2">);</span>
    <span class="s1">$loading</span><span class="s2">.</span><span class="s1">className </span><span class="s2">+= </span><span class="s4">' loading-results'</span><span class="s2">;</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">$results</span><span class="s2">.</span><span class="s1">prepend</span><span class="s2">(</span><span class="s1">$loading</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s1">Results</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">hideLoading </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">$results</span><span class="s2">.</span><span class="s1">find</span><span class="s2">(</span><span class="s4">'.loading-results'</span><span class="s2">).</span><span class="s1">remove</span><span class="s2">();</span>
  <span class="s2">};</span>

  <span class="s1">Results</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">option </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">data</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">option </span><span class="s2">= </span><span class="s1">document</span><span class="s2">.</span><span class="s1">createElement</span><span class="s2">(</span><span class="s4">'li'</span><span class="s2">);</span>
    <span class="s1">option</span><span class="s2">.</span><span class="s1">className </span><span class="s2">= </span><span class="s4">'select2-results__option'</span><span class="s2">;</span>

    <span class="s3">var </span><span class="s1">attrs </span><span class="s2">= {</span>
      <span class="s4">'role'</span><span class="s2">: </span><span class="s4">'option'</span><span class="s2">,</span>
      <span class="s4">'aria-selected'</span><span class="s2">: </span><span class="s4">'false'</span>
    <span class="s2">};</span>

    <span class="s3">var </span><span class="s1">matches </span><span class="s2">= </span><span class="s1">window</span><span class="s2">.</span><span class="s1">Element</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">matches </span><span class="s2">||</span>
      <span class="s1">window</span><span class="s2">.</span><span class="s1">Element</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">msMatchesSelector </span><span class="s2">||</span>
      <span class="s1">window</span><span class="s2">.</span><span class="s1">Element</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">webkitMatchesSelector</span><span class="s2">;</span>

    <span class="s3">if </span><span class="s2">((</span><span class="s1">data</span><span class="s2">.</span><span class="s1">element </span><span class="s2">!= </span><span class="s3">null </span><span class="s2">&amp;&amp; </span><span class="s1">matches</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">data</span><span class="s2">.</span><span class="s1">element</span><span class="s2">, </span><span class="s4">':disabled'</span><span class="s2">)) ||</span>
        <span class="s2">(</span><span class="s1">data</span><span class="s2">.</span><span class="s1">element </span><span class="s2">== </span><span class="s3">null </span><span class="s2">&amp;&amp; </span><span class="s1">data</span><span class="s2">.</span><span class="s1">disabled</span><span class="s2">)) {</span>
      <span class="s3">delete </span><span class="s1">attrs</span><span class="s2">[</span><span class="s4">'aria-selected'</span><span class="s2">];</span>
      <span class="s1">attrs</span><span class="s2">[</span><span class="s4">'aria-disabled'</span><span class="s2">] = </span><span class="s4">'true'</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">data</span><span class="s2">.</span><span class="s1">id </span><span class="s2">== </span><span class="s3">null</span><span class="s2">) {</span>
      <span class="s3">delete </span><span class="s1">attrs</span><span class="s2">[</span><span class="s4">'aria-selected'</span><span class="s2">];</span>
    <span class="s2">}</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">data</span><span class="s2">.</span><span class="s1">_resultId </span><span class="s2">!= </span><span class="s3">null</span><span class="s2">) {</span>
      <span class="s1">option</span><span class="s2">.</span><span class="s1">id </span><span class="s2">= </span><span class="s1">data</span><span class="s2">.</span><span class="s1">_resultId</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">data</span><span class="s2">.</span><span class="s1">title</span><span class="s2">) {</span>
      <span class="s1">option</span><span class="s2">.</span><span class="s1">title </span><span class="s2">= </span><span class="s1">data</span><span class="s2">.</span><span class="s1">title</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">data</span><span class="s2">.</span><span class="s1">children</span><span class="s2">) {</span>
      <span class="s1">attrs</span><span class="s2">.</span><span class="s1">role </span><span class="s2">= </span><span class="s4">'group'</span><span class="s2">;</span>
      <span class="s1">attrs</span><span class="s2">[</span><span class="s4">'aria-label'</span><span class="s2">] = </span><span class="s1">data</span><span class="s2">.</span><span class="s1">text</span><span class="s2">;</span>
      <span class="s3">delete </span><span class="s1">attrs</span><span class="s2">[</span><span class="s4">'aria-selected'</span><span class="s2">];</span>
    <span class="s2">}</span>

    <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">attr </span><span class="s3">in </span><span class="s1">attrs</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">val </span><span class="s2">= </span><span class="s1">attrs</span><span class="s2">[</span><span class="s1">attr</span><span class="s2">];</span>

      <span class="s1">option</span><span class="s2">.</span><span class="s1">setAttribute</span><span class="s2">(</span><span class="s1">attr</span><span class="s2">, </span><span class="s1">val</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">data</span><span class="s2">.</span><span class="s1">children</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">$option </span><span class="s2">= </span><span class="s1">$</span><span class="s2">(</span><span class="s1">option</span><span class="s2">);</span>

      <span class="s3">var </span><span class="s1">label </span><span class="s2">= </span><span class="s1">document</span><span class="s2">.</span><span class="s1">createElement</span><span class="s2">(</span><span class="s4">'strong'</span><span class="s2">);</span>
      <span class="s1">label</span><span class="s2">.</span><span class="s1">className </span><span class="s2">= </span><span class="s4">'select2-results__group'</span><span class="s2">;</span>

      <span class="s3">var </span><span class="s1">$label </span><span class="s2">= </span><span class="s1">$</span><span class="s2">(</span><span class="s1">label</span><span class="s2">);</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">template</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">label</span><span class="s2">);</span>

      <span class="s3">var </span><span class="s1">$children </span><span class="s2">= [];</span>

      <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">c </span><span class="s2">= </span><span class="s8">0</span><span class="s2">; </span><span class="s1">c </span><span class="s2">&lt; </span><span class="s1">data</span><span class="s2">.</span><span class="s1">children</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">c</span><span class="s2">++) {</span>
        <span class="s3">var </span><span class="s1">child </span><span class="s2">= </span><span class="s1">data</span><span class="s2">.</span><span class="s1">children</span><span class="s2">[</span><span class="s1">c</span><span class="s2">];</span>

        <span class="s3">var </span><span class="s1">$child </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">option</span><span class="s2">(</span><span class="s1">child</span><span class="s2">);</span>

        <span class="s1">$children</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">$child</span><span class="s2">);</span>
      <span class="s2">}</span>

      <span class="s3">var </span><span class="s1">$childrenContainer </span><span class="s2">= </span><span class="s1">$</span><span class="s2">(</span><span class="s4">'&lt;ul&gt;&lt;/ul&gt;'</span><span class="s2">, {</span>
        <span class="s4">'class'</span><span class="s2">: </span><span class="s4">'select2-results__options select2-results__options--nested'</span>
      <span class="s2">});</span>

      <span class="s1">$childrenContainer</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">$children</span><span class="s2">);</span>

      <span class="s1">$option</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">label</span><span class="s2">);</span>
      <span class="s1">$option</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">$childrenContainer</span><span class="s2">);</span>
    <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">template</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">option</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s1">Utils</span><span class="s2">.</span><span class="s1">StoreData</span><span class="s2">(</span><span class="s1">option</span><span class="s2">, </span><span class="s4">'data'</span><span class="s2">, </span><span class="s1">data</span><span class="s2">);</span>

    <span class="s3">return </span><span class="s1">option</span><span class="s2">;</span>
  <span class="s2">};</span>

  <span class="s1">Results</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">bind </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">container</span><span class="s2">, </span><span class="s1">$container</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">self </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>

    <span class="s3">var </span><span class="s1">id </span><span class="s2">= </span><span class="s1">container</span><span class="s2">.</span><span class="s1">id </span><span class="s2">+ </span><span class="s4">'-results'</span><span class="s2">;</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">$results</span><span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'id'</span><span class="s2">, </span><span class="s1">id</span><span class="s2">);</span>

    <span class="s1">container</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'results:all'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">params</span><span class="s2">) {</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">clear</span><span class="s2">();</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">params</span><span class="s2">.</span><span class="s1">data</span><span class="s2">);</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">container</span><span class="s2">.</span><span class="s1">isOpen</span><span class="s2">()) {</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">setClasses</span><span class="s2">();</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">highlightFirstItem</span><span class="s2">();</span>
      <span class="s2">}</span>
    <span class="s2">});</span>

    <span class="s1">container</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'results:append'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">params</span><span class="s2">) {</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">params</span><span class="s2">.</span><span class="s1">data</span><span class="s2">);</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">container</span><span class="s2">.</span><span class="s1">isOpen</span><span class="s2">()) {</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">setClasses</span><span class="s2">();</span>
      <span class="s2">}</span>
    <span class="s2">});</span>

    <span class="s1">container</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'query'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">params</span><span class="s2">) {</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">hideMessages</span><span class="s2">();</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">showLoading</span><span class="s2">(</span><span class="s1">params</span><span class="s2">);</span>
    <span class="s2">});</span>

    <span class="s1">container</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'select'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">() {</span>
      <span class="s3">if </span><span class="s2">(!</span><span class="s1">container</span><span class="s2">.</span><span class="s1">isOpen</span><span class="s2">()) {</span>
        <span class="s3">return</span><span class="s2">;</span>
      <span class="s2">}</span>

      <span class="s1">self</span><span class="s2">.</span><span class="s1">setClasses</span><span class="s2">();</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'scrollAfterSelect'</span><span class="s2">)) {</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">highlightFirstItem</span><span class="s2">();</span>
      <span class="s2">}</span>
    <span class="s2">});</span>

    <span class="s1">container</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'unselect'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">() {</span>
      <span class="s3">if </span><span class="s2">(!</span><span class="s1">container</span><span class="s2">.</span><span class="s1">isOpen</span><span class="s2">()) {</span>
        <span class="s3">return</span><span class="s2">;</span>
      <span class="s2">}</span>

      <span class="s1">self</span><span class="s2">.</span><span class="s1">setClasses</span><span class="s2">();</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'scrollAfterSelect'</span><span class="s2">)) {</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">highlightFirstItem</span><span class="s2">();</span>
      <span class="s2">}</span>
    <span class="s2">});</span>

    <span class="s1">container</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'open'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">() {</span>
      <span class="s0">// When the dropdown is open, aria-expended=&quot;true&quot;</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">$results</span><span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'aria-expanded'</span><span class="s2">, </span><span class="s4">'true'</span><span class="s2">);</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">$results</span><span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'aria-hidden'</span><span class="s2">, </span><span class="s4">'false'</span><span class="s2">);</span>

      <span class="s1">self</span><span class="s2">.</span><span class="s1">setClasses</span><span class="s2">();</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">ensureHighlightVisible</span><span class="s2">();</span>
    <span class="s2">});</span>

    <span class="s1">container</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'close'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">() {</span>
      <span class="s0">// When the dropdown is closed, aria-expended=&quot;false&quot;</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">$results</span><span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'aria-expanded'</span><span class="s2">, </span><span class="s4">'false'</span><span class="s2">);</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">$results</span><span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'aria-hidden'</span><span class="s2">, </span><span class="s4">'true'</span><span class="s2">);</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">$results</span><span class="s2">.</span><span class="s1">removeAttr</span><span class="s2">(</span><span class="s4">'aria-activedescendant'</span><span class="s2">);</span>
    <span class="s2">});</span>

    <span class="s1">container</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'results:toggle'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">() {</span>
      <span class="s3">var </span><span class="s1">$highlighted </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">getHighlightedResults</span><span class="s2">();</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">$highlighted</span><span class="s2">.</span><span class="s1">length </span><span class="s2">=== </span><span class="s8">0</span><span class="s2">) {</span>
        <span class="s3">return</span><span class="s2">;</span>
      <span class="s2">}</span>

      <span class="s1">$highlighted</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'mouseup'</span><span class="s2">);</span>
    <span class="s2">});</span>

    <span class="s1">container</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'results:select'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">() {</span>
      <span class="s3">var </span><span class="s1">$highlighted </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">getHighlightedResults</span><span class="s2">();</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">$highlighted</span><span class="s2">.</span><span class="s1">length </span><span class="s2">=== </span><span class="s8">0</span><span class="s2">) {</span>
        <span class="s3">return</span><span class="s2">;</span>
      <span class="s2">}</span>

      <span class="s3">var </span><span class="s1">data </span><span class="s2">= </span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">GetData</span><span class="s2">(</span><span class="s1">$highlighted</span><span class="s2">[</span><span class="s8">0</span><span class="s2">], </span><span class="s4">'data'</span><span class="s2">);</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">$highlighted</span><span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'aria-selected'</span><span class="s2">) == </span><span class="s4">'true'</span><span class="s2">) {</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'close'</span><span class="s2">, {});</span>
      <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'select'</span><span class="s2">, {</span>
          <span class="s1">data</span><span class="s2">: </span><span class="s1">data</span>
        <span class="s2">});</span>
      <span class="s2">}</span>
    <span class="s2">});</span>

    <span class="s1">container</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'results:previous'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">() {</span>
      <span class="s3">var </span><span class="s1">$highlighted </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">getHighlightedResults</span><span class="s2">();</span>

      <span class="s3">var </span><span class="s1">$options </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">$results</span><span class="s2">.</span><span class="s1">find</span><span class="s2">(</span><span class="s4">'[aria-selected]'</span><span class="s2">);</span>

      <span class="s3">var </span><span class="s1">currentIndex </span><span class="s2">= </span><span class="s1">$options</span><span class="s2">.</span><span class="s1">index</span><span class="s2">(</span><span class="s1">$highlighted</span><span class="s2">);</span>

      <span class="s0">// If we are already at the top, don't move further</span>
      <span class="s0">// If no options, currentIndex will be -1</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">currentIndex </span><span class="s2">&lt;= </span><span class="s8">0</span><span class="s2">) {</span>
        <span class="s3">return</span><span class="s2">;</span>
      <span class="s2">}</span>

      <span class="s3">var </span><span class="s1">nextIndex </span><span class="s2">= </span><span class="s1">currentIndex </span><span class="s2">- </span><span class="s8">1</span><span class="s2">;</span>

      <span class="s0">// If none are highlighted, highlight the first</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">$highlighted</span><span class="s2">.</span><span class="s1">length </span><span class="s2">=== </span><span class="s8">0</span><span class="s2">) {</span>
        <span class="s1">nextIndex </span><span class="s2">= </span><span class="s8">0</span><span class="s2">;</span>
      <span class="s2">}</span>

      <span class="s3">var </span><span class="s1">$next </span><span class="s2">= </span><span class="s1">$options</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">nextIndex</span><span class="s2">);</span>

      <span class="s1">$next</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'mouseenter'</span><span class="s2">);</span>

      <span class="s3">var </span><span class="s1">currentOffset </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">$results</span><span class="s2">.</span><span class="s1">offset</span><span class="s2">().</span><span class="s1">top</span><span class="s2">;</span>
      <span class="s3">var </span><span class="s1">nextTop </span><span class="s2">= </span><span class="s1">$next</span><span class="s2">.</span><span class="s1">offset</span><span class="s2">().</span><span class="s1">top</span><span class="s2">;</span>
      <span class="s3">var </span><span class="s1">nextOffset </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">$results</span><span class="s2">.</span><span class="s1">scrollTop</span><span class="s2">() + (</span><span class="s1">nextTop </span><span class="s2">- </span><span class="s1">currentOffset</span><span class="s2">);</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">nextIndex </span><span class="s2">=== </span><span class="s8">0</span><span class="s2">) {</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">$results</span><span class="s2">.</span><span class="s1">scrollTop</span><span class="s2">(</span><span class="s8">0</span><span class="s2">);</span>
      <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">nextTop </span><span class="s2">- </span><span class="s1">currentOffset </span><span class="s2">&lt; </span><span class="s8">0</span><span class="s2">) {</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">$results</span><span class="s2">.</span><span class="s1">scrollTop</span><span class="s2">(</span><span class="s1">nextOffset</span><span class="s2">);</span>
      <span class="s2">}</span>
    <span class="s2">});</span>

    <span class="s1">container</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'results:next'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">() {</span>
      <span class="s3">var </span><span class="s1">$highlighted </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">getHighlightedResults</span><span class="s2">();</span>

      <span class="s3">var </span><span class="s1">$options </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">$results</span><span class="s2">.</span><span class="s1">find</span><span class="s2">(</span><span class="s4">'[aria-selected]'</span><span class="s2">);</span>

      <span class="s3">var </span><span class="s1">currentIndex </span><span class="s2">= </span><span class="s1">$options</span><span class="s2">.</span><span class="s1">index</span><span class="s2">(</span><span class="s1">$highlighted</span><span class="s2">);</span>

      <span class="s3">var </span><span class="s1">nextIndex </span><span class="s2">= </span><span class="s1">currentIndex </span><span class="s2">+ </span><span class="s8">1</span><span class="s2">;</span>

      <span class="s0">// If we are at the last option, stay there</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">nextIndex </span><span class="s2">&gt;= </span><span class="s1">$options</span><span class="s2">.</span><span class="s1">length</span><span class="s2">) {</span>
        <span class="s3">return</span><span class="s2">;</span>
      <span class="s2">}</span>

      <span class="s3">var </span><span class="s1">$next </span><span class="s2">= </span><span class="s1">$options</span><span class="s2">.</span><span class="s1">eq</span><span class="s2">(</span><span class="s1">nextIndex</span><span class="s2">);</span>

      <span class="s1">$next</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'mouseenter'</span><span class="s2">);</span>

      <span class="s3">var </span><span class="s1">currentOffset </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">$results</span><span class="s2">.</span><span class="s1">offset</span><span class="s2">().</span><span class="s1">top </span><span class="s2">+</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">$results</span><span class="s2">.</span><span class="s1">outerHeight</span><span class="s2">(</span><span class="s3">false</span><span class="s2">);</span>
      <span class="s3">var </span><span class="s1">nextBottom </span><span class="s2">= </span><span class="s1">$next</span><span class="s2">.</span><span class="s1">offset</span><span class="s2">().</span><span class="s1">top </span><span class="s2">+ </span><span class="s1">$next</span><span class="s2">.</span><span class="s1">outerHeight</span><span class="s2">(</span><span class="s3">false</span><span class="s2">);</span>
      <span class="s3">var </span><span class="s1">nextOffset </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">$results</span><span class="s2">.</span><span class="s1">scrollTop</span><span class="s2">() + </span><span class="s1">nextBottom </span><span class="s2">- </span><span class="s1">currentOffset</span><span class="s2">;</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">nextIndex </span><span class="s2">=== </span><span class="s8">0</span><span class="s2">) {</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">$results</span><span class="s2">.</span><span class="s1">scrollTop</span><span class="s2">(</span><span class="s8">0</span><span class="s2">);</span>
      <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">nextBottom </span><span class="s2">&gt; </span><span class="s1">currentOffset</span><span class="s2">) {</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">$results</span><span class="s2">.</span><span class="s1">scrollTop</span><span class="s2">(</span><span class="s1">nextOffset</span><span class="s2">);</span>
      <span class="s2">}</span>
    <span class="s2">});</span>

    <span class="s1">container</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'results:focus'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">params</span><span class="s2">) {</span>
      <span class="s1">params</span><span class="s2">.</span><span class="s1">element</span><span class="s2">.</span><span class="s1">addClass</span><span class="s2">(</span><span class="s4">'select2-results__option--highlighted'</span><span class="s2">);</span>
    <span class="s2">});</span>

    <span class="s1">container</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'results:message'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">params</span><span class="s2">) {</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">displayMessage</span><span class="s2">(</span><span class="s1">params</span><span class="s2">);</span>
    <span class="s2">});</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">$</span><span class="s2">.</span><span class="s1">fn</span><span class="s2">.</span><span class="s1">mousewheel</span><span class="s2">) {</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">$results</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'mousewheel'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">e</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">top </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">$results</span><span class="s2">.</span><span class="s1">scrollTop</span><span class="s2">();</span>

        <span class="s3">var </span><span class="s1">bottom </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">$results</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s8">0</span><span class="s2">).</span><span class="s1">scrollHeight </span><span class="s2">- </span><span class="s1">top </span><span class="s2">+ </span><span class="s1">e</span><span class="s2">.</span><span class="s1">deltaY</span><span class="s2">;</span>

        <span class="s3">var </span><span class="s1">isAtTop </span><span class="s2">= </span><span class="s1">e</span><span class="s2">.</span><span class="s1">deltaY </span><span class="s2">&gt; </span><span class="s8">0 </span><span class="s2">&amp;&amp; </span><span class="s1">top </span><span class="s2">- </span><span class="s1">e</span><span class="s2">.</span><span class="s1">deltaY </span><span class="s2">&lt;= </span><span class="s8">0</span><span class="s2">;</span>
        <span class="s3">var </span><span class="s1">isAtBottom </span><span class="s2">= </span><span class="s1">e</span><span class="s2">.</span><span class="s1">deltaY </span><span class="s2">&lt; </span><span class="s8">0 </span><span class="s2">&amp;&amp; </span><span class="s1">bottom </span><span class="s2">&lt;= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">$results</span><span class="s2">.</span><span class="s1">height</span><span class="s2">();</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">isAtTop</span><span class="s2">) {</span>
          <span class="s1">self</span><span class="s2">.</span><span class="s1">$results</span><span class="s2">.</span><span class="s1">scrollTop</span><span class="s2">(</span><span class="s8">0</span><span class="s2">);</span>

          <span class="s1">e</span><span class="s2">.</span><span class="s1">preventDefault</span><span class="s2">();</span>
          <span class="s1">e</span><span class="s2">.</span><span class="s1">stopPropagation</span><span class="s2">();</span>
        <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">isAtBottom</span><span class="s2">) {</span>
          <span class="s1">self</span><span class="s2">.</span><span class="s1">$results</span><span class="s2">.</span><span class="s1">scrollTop</span><span class="s2">(</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">$results</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s8">0</span><span class="s2">).</span><span class="s1">scrollHeight </span><span class="s2">- </span><span class="s1">self</span><span class="s2">.</span><span class="s1">$results</span><span class="s2">.</span><span class="s1">height</span><span class="s2">()</span>
          <span class="s2">);</span>

          <span class="s1">e</span><span class="s2">.</span><span class="s1">preventDefault</span><span class="s2">();</span>
          <span class="s1">e</span><span class="s2">.</span><span class="s1">stopPropagation</span><span class="s2">();</span>
        <span class="s2">}</span>
      <span class="s2">});</span>
    <span class="s2">}</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">$results</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'mouseup'</span><span class="s2">, </span><span class="s4">'.select2-results__option[aria-selected]'</span><span class="s2">,</span>
      <span class="s3">function </span><span class="s2">(</span><span class="s1">evt</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">$this </span><span class="s2">= </span><span class="s1">$</span><span class="s2">(</span><span class="s3">this</span><span class="s2">);</span>

      <span class="s3">var </span><span class="s1">data </span><span class="s2">= </span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">GetData</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s4">'data'</span><span class="s2">);</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">$this</span><span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'aria-selected'</span><span class="s2">) === </span><span class="s4">'true'</span><span class="s2">) {</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'multiple'</span><span class="s2">)) {</span>
          <span class="s1">self</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'unselect'</span><span class="s2">, {</span>
            <span class="s1">originalEvent</span><span class="s2">: </span><span class="s1">evt</span><span class="s2">,</span>
            <span class="s1">data</span><span class="s2">: </span><span class="s1">data</span>
          <span class="s2">});</span>
        <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
          <span class="s1">self</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'close'</span><span class="s2">, {});</span>
        <span class="s2">}</span>

        <span class="s3">return</span><span class="s2">;</span>
      <span class="s2">}</span>

      <span class="s1">self</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'select'</span><span class="s2">, {</span>
        <span class="s1">originalEvent</span><span class="s2">: </span><span class="s1">evt</span><span class="s2">,</span>
        <span class="s1">data</span><span class="s2">: </span><span class="s1">data</span>
      <span class="s2">});</span>
    <span class="s2">});</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">$results</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'mouseenter'</span><span class="s2">, </span><span class="s4">'.select2-results__option[aria-selected]'</span><span class="s2">,</span>
      <span class="s3">function </span><span class="s2">(</span><span class="s1">evt</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">data </span><span class="s2">= </span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">GetData</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s4">'data'</span><span class="s2">);</span>

      <span class="s1">self</span><span class="s2">.</span><span class="s1">getHighlightedResults</span><span class="s2">()</span>
          <span class="s2">.</span><span class="s1">removeClass</span><span class="s2">(</span><span class="s4">'select2-results__option--highlighted'</span><span class="s2">);</span>

      <span class="s1">self</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'results:focus'</span><span class="s2">, {</span>
        <span class="s1">data</span><span class="s2">: </span><span class="s1">data</span><span class="s2">,</span>
        <span class="s1">element</span><span class="s2">: </span><span class="s1">$</span><span class="s2">(</span><span class="s3">this</span><span class="s2">)</span>
      <span class="s2">});</span>
    <span class="s2">});</span>
  <span class="s2">};</span>

  <span class="s1">Results</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">getHighlightedResults </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {</span>
    <span class="s3">var </span><span class="s1">$highlighted </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">$results</span>
    <span class="s2">.</span><span class="s1">find</span><span class="s2">(</span><span class="s4">'.select2-results__option--highlighted'</span><span class="s2">);</span>

    <span class="s3">return </span><span class="s1">$highlighted</span><span class="s2">;</span>
  <span class="s2">};</span>

  <span class="s1">Results</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">destroy </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">$results</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">();</span>
  <span class="s2">};</span>

  <span class="s1">Results</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">ensureHighlightVisible </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {</span>
    <span class="s3">var </span><span class="s1">$highlighted </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">getHighlightedResults</span><span class="s2">();</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">$highlighted</span><span class="s2">.</span><span class="s1">length </span><span class="s2">=== </span><span class="s8">0</span><span class="s2">) {</span>
      <span class="s3">return</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">var </span><span class="s1">$options </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">$results</span><span class="s2">.</span><span class="s1">find</span><span class="s2">(</span><span class="s4">'[aria-selected]'</span><span class="s2">);</span>

    <span class="s3">var </span><span class="s1">currentIndex </span><span class="s2">= </span><span class="s1">$options</span><span class="s2">.</span><span class="s1">index</span><span class="s2">(</span><span class="s1">$highlighted</span><span class="s2">);</span>

    <span class="s3">var </span><span class="s1">currentOffset </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">$results</span><span class="s2">.</span><span class="s1">offset</span><span class="s2">().</span><span class="s1">top</span><span class="s2">;</span>
    <span class="s3">var </span><span class="s1">nextTop </span><span class="s2">= </span><span class="s1">$highlighted</span><span class="s2">.</span><span class="s1">offset</span><span class="s2">().</span><span class="s1">top</span><span class="s2">;</span>
    <span class="s3">var </span><span class="s1">nextOffset </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">$results</span><span class="s2">.</span><span class="s1">scrollTop</span><span class="s2">() + (</span><span class="s1">nextTop </span><span class="s2">- </span><span class="s1">currentOffset</span><span class="s2">);</span>

    <span class="s3">var </span><span class="s1">offsetDelta </span><span class="s2">= </span><span class="s1">nextTop </span><span class="s2">- </span><span class="s1">currentOffset</span><span class="s2">;</span>
    <span class="s1">nextOffset </span><span class="s2">-= </span><span class="s1">$highlighted</span><span class="s2">.</span><span class="s1">outerHeight</span><span class="s2">(</span><span class="s3">false</span><span class="s2">) * </span><span class="s8">2</span><span class="s2">;</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">currentIndex </span><span class="s2">&lt;= </span><span class="s8">2</span><span class="s2">) {</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">$results</span><span class="s2">.</span><span class="s1">scrollTop</span><span class="s2">(</span><span class="s8">0</span><span class="s2">);</span>
    <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">offsetDelta </span><span class="s2">&gt; </span><span class="s3">this</span><span class="s2">.</span><span class="s1">$results</span><span class="s2">.</span><span class="s1">outerHeight</span><span class="s2">() || </span><span class="s1">offsetDelta </span><span class="s2">&lt; </span><span class="s8">0</span><span class="s2">) {</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">$results</span><span class="s2">.</span><span class="s1">scrollTop</span><span class="s2">(</span><span class="s1">nextOffset</span><span class="s2">);</span>
    <span class="s2">}</span>
  <span class="s2">};</span>

  <span class="s1">Results</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">template </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">container</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">template </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'templateResult'</span><span class="s2">);</span>
    <span class="s3">var </span><span class="s1">escapeMarkup </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'escapeMarkup'</span><span class="s2">);</span>

    <span class="s3">var </span><span class="s1">content </span><span class="s2">= </span><span class="s1">template</span><span class="s2">(</span><span class="s1">result</span><span class="s2">, </span><span class="s1">container</span><span class="s2">);</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">content </span><span class="s2">== </span><span class="s3">null</span><span class="s2">) {</span>
      <span class="s1">container</span><span class="s2">.</span><span class="s1">style</span><span class="s2">.</span><span class="s1">display </span><span class="s2">= </span><span class="s4">'none'</span><span class="s2">;</span>
    <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">content </span><span class="s2">=== </span><span class="s4">'string'</span><span class="s2">) {</span>
      <span class="s1">container</span><span class="s2">.</span><span class="s1">innerHTML </span><span class="s2">= </span><span class="s1">escapeMarkup</span><span class="s2">(</span><span class="s1">content</span><span class="s2">);</span>
    <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
      <span class="s1">$</span><span class="s2">(</span><span class="s1">container</span><span class="s2">).</span><span class="s1">append</span><span class="s2">(</span><span class="s1">content</span><span class="s2">);</span>
    <span class="s2">}</span>
  <span class="s2">};</span>

  <span class="s3">return </span><span class="s1">Results</span><span class="s2">;</span>
<span class="s2">});</span>

<span class="s1">S2</span><span class="s2">.</span><span class="s1">define</span><span class="s2">(</span><span class="s4">'select2/keys'</span><span class="s2">,[</span>

<span class="s2">], </span><span class="s3">function </span><span class="s2">() {</span>
  <span class="s3">var </span><span class="s1">KEYS </span><span class="s2">= {</span>
    <span class="s1">BACKSPACE</span><span class="s2">: </span><span class="s8">8</span><span class="s2">,</span>
    <span class="s1">TAB</span><span class="s2">: </span><span class="s8">9</span><span class="s2">,</span>
    <span class="s1">ENTER</span><span class="s2">: </span><span class="s8">13</span><span class="s2">,</span>
    <span class="s1">SHIFT</span><span class="s2">: </span><span class="s8">16</span><span class="s2">,</span>
    <span class="s1">CTRL</span><span class="s2">: </span><span class="s8">17</span><span class="s2">,</span>
    <span class="s1">ALT</span><span class="s2">: </span><span class="s8">18</span><span class="s2">,</span>
    <span class="s1">ESC</span><span class="s2">: </span><span class="s8">27</span><span class="s2">,</span>
    <span class="s1">SPACE</span><span class="s2">: </span><span class="s8">32</span><span class="s2">,</span>
    <span class="s1">PAGE_UP</span><span class="s2">: </span><span class="s8">33</span><span class="s2">,</span>
    <span class="s1">PAGE_DOWN</span><span class="s2">: </span><span class="s8">34</span><span class="s2">,</span>
    <span class="s1">END</span><span class="s2">: </span><span class="s8">35</span><span class="s2">,</span>
    <span class="s1">HOME</span><span class="s2">: </span><span class="s8">36</span><span class="s2">,</span>
    <span class="s1">LEFT</span><span class="s2">: </span><span class="s8">37</span><span class="s2">,</span>
    <span class="s1">UP</span><span class="s2">: </span><span class="s8">38</span><span class="s2">,</span>
    <span class="s1">RIGHT</span><span class="s2">: </span><span class="s8">39</span><span class="s2">,</span>
    <span class="s1">DOWN</span><span class="s2">: </span><span class="s8">40</span><span class="s2">,</span>
    <span class="s1">DELETE</span><span class="s2">: </span><span class="s8">46</span>
  <span class="s2">};</span>

  <span class="s3">return </span><span class="s1">KEYS</span><span class="s2">;</span>
<span class="s2">});</span>

<span class="s1">S2</span><span class="s2">.</span><span class="s1">define</span><span class="s2">(</span><span class="s4">'select2/selection/base'</span><span class="s2">,[</span>
  <span class="s4">'jquery'</span><span class="s2">,</span>
  <span class="s4">'../utils'</span><span class="s2">,</span>
  <span class="s4">'../keys'</span>
<span class="s2">], </span><span class="s3">function </span><span class="s2">(</span><span class="s1">$</span><span class="s2">, </span><span class="s1">Utils</span><span class="s2">, </span><span class="s1">KEYS</span><span class="s2">) {</span>
  <span class="s3">function </span><span class="s1">BaseSelection </span><span class="s2">(</span><span class="s1">$element</span><span class="s2">, </span><span class="s1">options</span><span class="s2">) {</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">$element </span><span class="s2">= </span><span class="s1">$element</span><span class="s2">;</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">options </span><span class="s2">= </span><span class="s1">options</span><span class="s2">;</span>

    <span class="s1">BaseSelection</span><span class="s2">.</span><span class="s1">__super__</span><span class="s2">.</span><span class="s1">constructor</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">);</span>
  <span class="s2">}</span>

  <span class="s1">Utils</span><span class="s2">.</span><span class="s1">Extend</span><span class="s2">(</span><span class="s1">BaseSelection</span><span class="s2">, </span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">Observable</span><span class="s2">);</span>

  <span class="s1">BaseSelection</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">render </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {</span>
    <span class="s3">var </span><span class="s1">$selection </span><span class="s2">= </span><span class="s1">$</span><span class="s2">(</span>
      <span class="s4">'&lt;span class=&quot;select2-selection&quot; role=&quot;combobox&quot; ' </span><span class="s2">+</span>
      <span class="s4">' aria-haspopup=&quot;true&quot; aria-expanded=&quot;false&quot;&gt;' </span><span class="s2">+</span>
      <span class="s4">'&lt;/span&gt;'</span>
    <span class="s2">);</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">_tabindex </span><span class="s2">= </span><span class="s8">0</span><span class="s2">;</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">GetData</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">[</span><span class="s8">0</span><span class="s2">], </span><span class="s4">'old-tabindex'</span><span class="s2">) != </span><span class="s3">null</span><span class="s2">) {</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">_tabindex </span><span class="s2">= </span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">GetData</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">[</span><span class="s8">0</span><span class="s2">], </span><span class="s4">'old-tabindex'</span><span class="s2">);</span>
    <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'tabindex'</span><span class="s2">) != </span><span class="s3">null</span><span class="s2">) {</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">_tabindex </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'tabindex'</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s1">$selection</span><span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'title'</span><span class="s2">, </span><span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'title'</span><span class="s2">));</span>
    <span class="s1">$selection</span><span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'tabindex'</span><span class="s2">, </span><span class="s3">this</span><span class="s2">.</span><span class="s1">_tabindex</span><span class="s2">);</span>
    <span class="s1">$selection</span><span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'aria-disabled'</span><span class="s2">, </span><span class="s4">'false'</span><span class="s2">);</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">$selection </span><span class="s2">= </span><span class="s1">$selection</span><span class="s2">;</span>

    <span class="s3">return </span><span class="s1">$selection</span><span class="s2">;</span>
  <span class="s2">};</span>

  <span class="s1">BaseSelection</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">bind </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">container</span><span class="s2">, </span><span class="s1">$container</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">self </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>

    <span class="s3">var </span><span class="s1">resultsId </span><span class="s2">= </span><span class="s1">container</span><span class="s2">.</span><span class="s1">id </span><span class="s2">+ </span><span class="s4">'-results'</span><span class="s2">;</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">container </span><span class="s2">= </span><span class="s1">container</span><span class="s2">;</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">$selection</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'focus'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">evt</span><span class="s2">) {</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'focus'</span><span class="s2">, </span><span class="s1">evt</span><span class="s2">);</span>
    <span class="s2">});</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">$selection</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'blur'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">evt</span><span class="s2">) {</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">_handleBlur</span><span class="s2">(</span><span class="s1">evt</span><span class="s2">);</span>
    <span class="s2">});</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">$selection</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'keydown'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">evt</span><span class="s2">) {</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'keypress'</span><span class="s2">, </span><span class="s1">evt</span><span class="s2">);</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">evt</span><span class="s2">.</span><span class="s1">which </span><span class="s2">=== </span><span class="s1">KEYS</span><span class="s2">.</span><span class="s1">SPACE</span><span class="s2">) {</span>
        <span class="s1">evt</span><span class="s2">.</span><span class="s1">preventDefault</span><span class="s2">();</span>
      <span class="s2">}</span>
    <span class="s2">});</span>

    <span class="s1">container</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'results:focus'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">params</span><span class="s2">) {</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">$selection</span><span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'aria-activedescendant'</span><span class="s2">, </span><span class="s1">params</span><span class="s2">.</span><span class="s1">data</span><span class="s2">.</span><span class="s1">_resultId</span><span class="s2">);</span>
    <span class="s2">});</span>

    <span class="s1">container</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'selection:update'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">params</span><span class="s2">) {</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">update</span><span class="s2">(</span><span class="s1">params</span><span class="s2">.</span><span class="s1">data</span><span class="s2">);</span>
    <span class="s2">});</span>

    <span class="s1">container</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'open'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">() {</span>
      <span class="s0">// When the dropdown is open, aria-expanded=&quot;true&quot;</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">$selection</span><span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'aria-expanded'</span><span class="s2">, </span><span class="s4">'true'</span><span class="s2">);</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">$selection</span><span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'aria-owns'</span><span class="s2">, </span><span class="s1">resultsId</span><span class="s2">);</span>

      <span class="s1">self</span><span class="s2">.</span><span class="s1">_attachCloseHandler</span><span class="s2">(</span><span class="s1">container</span><span class="s2">);</span>
    <span class="s2">});</span>

    <span class="s1">container</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'close'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">() {</span>
      <span class="s0">// When the dropdown is closed, aria-expanded=&quot;false&quot;</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">$selection</span><span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'aria-expanded'</span><span class="s2">, </span><span class="s4">'false'</span><span class="s2">);</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">$selection</span><span class="s2">.</span><span class="s1">removeAttr</span><span class="s2">(</span><span class="s4">'aria-activedescendant'</span><span class="s2">);</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">$selection</span><span class="s2">.</span><span class="s1">removeAttr</span><span class="s2">(</span><span class="s4">'aria-owns'</span><span class="s2">);</span>

      <span class="s1">self</span><span class="s2">.</span><span class="s1">$selection</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'focus'</span><span class="s2">);</span>

      <span class="s1">self</span><span class="s2">.</span><span class="s1">_detachCloseHandler</span><span class="s2">(</span><span class="s1">container</span><span class="s2">);</span>
    <span class="s2">});</span>

    <span class="s1">container</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'enable'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">() {</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">$selection</span><span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'tabindex'</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_tabindex</span><span class="s2">);</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">$selection</span><span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'aria-disabled'</span><span class="s2">, </span><span class="s4">'false'</span><span class="s2">);</span>
    <span class="s2">});</span>

    <span class="s1">container</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'disable'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">() {</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">$selection</span><span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'tabindex'</span><span class="s2">, </span><span class="s4">'-1'</span><span class="s2">);</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">$selection</span><span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'aria-disabled'</span><span class="s2">, </span><span class="s4">'true'</span><span class="s2">);</span>
    <span class="s2">});</span>
  <span class="s2">};</span>

  <span class="s1">BaseSelection</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">_handleBlur </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">evt</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">self </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>

    <span class="s0">// This needs to be delayed as the active element is the body when the tab</span>
    <span class="s0">// key is pressed, possibly along with others.</span>
    <span class="s1">window</span><span class="s2">.</span><span class="s1">setTimeout</span><span class="s2">(</span><span class="s3">function </span><span class="s2">() {</span>
      <span class="s0">// Don't trigger `blur` if the focus is still in the selection</span>
      <span class="s3">if </span><span class="s2">(</span>
        <span class="s2">(</span><span class="s1">document</span><span class="s2">.</span><span class="s1">activeElement </span><span class="s2">== </span><span class="s1">self</span><span class="s2">.</span><span class="s1">$selection</span><span class="s2">[</span><span class="s8">0</span><span class="s2">]) ||</span>
        <span class="s2">(</span><span class="s1">$</span><span class="s2">.</span><span class="s1">contains</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">$selection</span><span class="s2">[</span><span class="s8">0</span><span class="s2">], </span><span class="s1">document</span><span class="s2">.</span><span class="s1">activeElement</span><span class="s2">))</span>
      <span class="s2">) {</span>
        <span class="s3">return</span><span class="s2">;</span>
      <span class="s2">}</span>

      <span class="s1">self</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'blur'</span><span class="s2">, </span><span class="s1">evt</span><span class="s2">);</span>
    <span class="s2">}, </span><span class="s8">1</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s1">BaseSelection</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">_attachCloseHandler </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">container</span><span class="s2">) {</span>

    <span class="s1">$</span><span class="s2">(</span><span class="s1">document</span><span class="s2">.</span><span class="s1">body</span><span class="s2">).</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'mousedown.select2.' </span><span class="s2">+ </span><span class="s1">container</span><span class="s2">.</span><span class="s1">id</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">e</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">$target </span><span class="s2">= </span><span class="s1">$</span><span class="s2">(</span><span class="s1">e</span><span class="s2">.</span><span class="s1">target</span><span class="s2">);</span>

      <span class="s3">var </span><span class="s1">$select </span><span class="s2">= </span><span class="s1">$target</span><span class="s2">.</span><span class="s1">closest</span><span class="s2">(</span><span class="s4">'.select2'</span><span class="s2">);</span>

      <span class="s3">var </span><span class="s1">$all </span><span class="s2">= </span><span class="s1">$</span><span class="s2">(</span><span class="s4">'.select2.select2-container--open'</span><span class="s2">);</span>

      <span class="s1">$all</span><span class="s2">.</span><span class="s1">each</span><span class="s2">(</span><span class="s3">function </span><span class="s2">() {</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s3">this </span><span class="s2">== </span><span class="s1">$select</span><span class="s2">[</span><span class="s8">0</span><span class="s2">]) {</span>
          <span class="s3">return</span><span class="s2">;</span>
        <span class="s2">}</span>

        <span class="s3">var </span><span class="s1">$element </span><span class="s2">= </span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">GetData</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s4">'element'</span><span class="s2">);</span>

        <span class="s1">$element</span><span class="s2">.</span><span class="s1">select2</span><span class="s2">(</span><span class="s4">'close'</span><span class="s2">);</span>
      <span class="s2">});</span>
    <span class="s2">});</span>
  <span class="s2">};</span>

  <span class="s1">BaseSelection</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">_detachCloseHandler </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">container</span><span class="s2">) {</span>
    <span class="s1">$</span><span class="s2">(</span><span class="s1">document</span><span class="s2">.</span><span class="s1">body</span><span class="s2">).</span><span class="s1">off</span><span class="s2">(</span><span class="s4">'mousedown.select2.' </span><span class="s2">+ </span><span class="s1">container</span><span class="s2">.</span><span class="s1">id</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s1">BaseSelection</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">position </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">$selection</span><span class="s2">, </span><span class="s1">$container</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">$selectionContainer </span><span class="s2">= </span><span class="s1">$container</span><span class="s2">.</span><span class="s1">find</span><span class="s2">(</span><span class="s4">'.selection'</span><span class="s2">);</span>
    <span class="s1">$selectionContainer</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">$selection</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s1">BaseSelection</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">destroy </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">_detachCloseHandler</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">container</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s1">BaseSelection</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">update </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">data</span><span class="s2">) {</span>
    <span class="s3">throw new </span><span class="s1">Error</span><span class="s2">(</span><span class="s4">'The `update` method must be defined in child classes.'</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s5">/**</span>
   <span class="s5">* Helper method to abstract the &quot;enabled&quot; (not &quot;disabled&quot;) state of this</span>
   <span class="s5">* object.</span>
   <span class="s5">*</span>
   <span class="s5">* </span><span class="s6">@return </span><span class="s5">{true} if the instance is not disabled.</span>
   <span class="s5">* </span><span class="s6">@return </span><span class="s5">{false} if the instance is disabled.</span>
   <span class="s5">*/</span>
  <span class="s1">BaseSelection</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">isEnabled </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {</span>
    <span class="s3">return </span><span class="s2">!</span><span class="s3">this</span><span class="s2">.</span><span class="s1">isDisabled</span><span class="s2">();</span>
  <span class="s2">};</span>

  <span class="s5">/**</span>
   <span class="s5">* Helper method to abstract the &quot;disabled&quot; state of this object.</span>
   <span class="s5">*</span>
   <span class="s5">* </span><span class="s6">@return </span><span class="s5">{true} if the disabled option is true.</span>
   <span class="s5">* </span><span class="s6">@return </span><span class="s5">{false} if the disabled option is false.</span>
   <span class="s5">*/</span>
  <span class="s1">BaseSelection</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">isDisabled </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {</span>
    <span class="s3">return this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'disabled'</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s3">return </span><span class="s1">BaseSelection</span><span class="s2">;</span>
<span class="s2">});</span>

<span class="s1">S2</span><span class="s2">.</span><span class="s1">define</span><span class="s2">(</span><span class="s4">'select2/selection/single'</span><span class="s2">,[</span>
  <span class="s4">'jquery'</span><span class="s2">,</span>
  <span class="s4">'./base'</span><span class="s2">,</span>
  <span class="s4">'../utils'</span><span class="s2">,</span>
  <span class="s4">'../keys'</span>
<span class="s2">], </span><span class="s3">function </span><span class="s2">(</span><span class="s1">$</span><span class="s2">, </span><span class="s1">BaseSelection</span><span class="s2">, </span><span class="s1">Utils</span><span class="s2">, </span><span class="s1">KEYS</span><span class="s2">) {</span>
  <span class="s3">function </span><span class="s1">SingleSelection </span><span class="s2">() {</span>
    <span class="s1">SingleSelection</span><span class="s2">.</span><span class="s1">__super__</span><span class="s2">.</span><span class="s1">constructor</span><span class="s2">.</span><span class="s1">apply</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">arguments</span><span class="s2">);</span>
  <span class="s2">}</span>

  <span class="s1">Utils</span><span class="s2">.</span><span class="s1">Extend</span><span class="s2">(</span><span class="s1">SingleSelection</span><span class="s2">, </span><span class="s1">BaseSelection</span><span class="s2">);</span>

  <span class="s1">SingleSelection</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">render </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {</span>
    <span class="s3">var </span><span class="s1">$selection </span><span class="s2">= </span><span class="s1">SingleSelection</span><span class="s2">.</span><span class="s1">__super__</span><span class="s2">.</span><span class="s1">render</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">);</span>

    <span class="s1">$selection</span><span class="s2">.</span><span class="s1">addClass</span><span class="s2">(</span><span class="s4">'select2-selection--single'</span><span class="s2">);</span>

    <span class="s1">$selection</span><span class="s2">.</span><span class="s1">html</span><span class="s2">(</span>
      <span class="s4">'&lt;span class=&quot;select2-selection__rendered&quot;&gt;&lt;/span&gt;' </span><span class="s2">+</span>
      <span class="s4">'&lt;span class=&quot;select2-selection__arrow&quot; role=&quot;presentation&quot;&gt;' </span><span class="s2">+</span>
        <span class="s4">'&lt;b role=&quot;presentation&quot;&gt;&lt;/b&gt;' </span><span class="s2">+</span>
      <span class="s4">'&lt;/span&gt;'</span>
    <span class="s2">);</span>

    <span class="s3">return </span><span class="s1">$selection</span><span class="s2">;</span>
  <span class="s2">};</span>

  <span class="s1">SingleSelection</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">bind </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">container</span><span class="s2">, </span><span class="s1">$container</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">self </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>

    <span class="s1">SingleSelection</span><span class="s2">.</span><span class="s1">__super__</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">.</span><span class="s1">apply</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">arguments</span><span class="s2">);</span>

    <span class="s3">var </span><span class="s1">id </span><span class="s2">= </span><span class="s1">container</span><span class="s2">.</span><span class="s1">id </span><span class="s2">+ </span><span class="s4">'-container'</span><span class="s2">;</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">$selection</span><span class="s2">.</span><span class="s1">find</span><span class="s2">(</span><span class="s4">'.select2-selection__rendered'</span><span class="s2">)</span>
      <span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'id'</span><span class="s2">, </span><span class="s1">id</span><span class="s2">)</span>
      <span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'role'</span><span class="s2">, </span><span class="s4">'textbox'</span><span class="s2">)</span>
      <span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'aria-readonly'</span><span class="s2">, </span><span class="s4">'true'</span><span class="s2">);</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">$selection</span><span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'aria-labelledby'</span><span class="s2">, </span><span class="s1">id</span><span class="s2">);</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">$selection</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'mousedown'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">evt</span><span class="s2">) {</span>
      <span class="s0">// Only respond to left clicks</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">evt</span><span class="s2">.</span><span class="s1">which </span><span class="s2">!== </span><span class="s8">1</span><span class="s2">) {</span>
        <span class="s3">return</span><span class="s2">;</span>
      <span class="s2">}</span>

      <span class="s1">self</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'toggle'</span><span class="s2">, {</span>
        <span class="s1">originalEvent</span><span class="s2">: </span><span class="s1">evt</span>
      <span class="s2">});</span>
    <span class="s2">});</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">$selection</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'focus'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">evt</span><span class="s2">) {</span>
      <span class="s0">// User focuses on the container</span>
    <span class="s2">});</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">$selection</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'blur'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">evt</span><span class="s2">) {</span>
      <span class="s0">// User exits the container</span>
    <span class="s2">});</span>

    <span class="s1">container</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'focus'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">evt</span><span class="s2">) {</span>
      <span class="s3">if </span><span class="s2">(!</span><span class="s1">container</span><span class="s2">.</span><span class="s1">isOpen</span><span class="s2">()) {</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">$selection</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'focus'</span><span class="s2">);</span>
      <span class="s2">}</span>
    <span class="s2">});</span>
  <span class="s2">};</span>

  <span class="s1">SingleSelection</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">clear </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {</span>
    <span class="s3">var </span><span class="s1">$rendered </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">$selection</span><span class="s2">.</span><span class="s1">find</span><span class="s2">(</span><span class="s4">'.select2-selection__rendered'</span><span class="s2">);</span>
    <span class="s1">$rendered</span><span class="s2">.</span><span class="s1">empty</span><span class="s2">();</span>
    <span class="s1">$rendered</span><span class="s2">.</span><span class="s1">removeAttr</span><span class="s2">(</span><span class="s4">'title'</span><span class="s2">); </span><span class="s0">// clear tooltip on empty</span>
  <span class="s2">};</span>

  <span class="s1">SingleSelection</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">display </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">container</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">template </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'templateSelection'</span><span class="s2">);</span>
    <span class="s3">var </span><span class="s1">escapeMarkup </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'escapeMarkup'</span><span class="s2">);</span>

    <span class="s3">return </span><span class="s1">escapeMarkup</span><span class="s2">(</span><span class="s1">template</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">container</span><span class="s2">));</span>
  <span class="s2">};</span>

  <span class="s1">SingleSelection</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">selectionContainer </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {</span>
    <span class="s3">return </span><span class="s1">$</span><span class="s2">(</span><span class="s4">'&lt;span&gt;&lt;/span&gt;'</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s1">SingleSelection</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">update </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">data</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">data</span><span class="s2">.</span><span class="s1">length </span><span class="s2">=== </span><span class="s8">0</span><span class="s2">) {</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">clear</span><span class="s2">();</span>
      <span class="s3">return</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">var </span><span class="s1">selection </span><span class="s2">= </span><span class="s1">data</span><span class="s2">[</span><span class="s8">0</span><span class="s2">];</span>

    <span class="s3">var </span><span class="s1">$rendered </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">$selection</span><span class="s2">.</span><span class="s1">find</span><span class="s2">(</span><span class="s4">'.select2-selection__rendered'</span><span class="s2">);</span>
    <span class="s3">var </span><span class="s1">formatted </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">display</span><span class="s2">(</span><span class="s1">selection</span><span class="s2">, </span><span class="s1">$rendered</span><span class="s2">);</span>

    <span class="s1">$rendered</span><span class="s2">.</span><span class="s1">empty</span><span class="s2">().</span><span class="s1">append</span><span class="s2">(</span><span class="s1">formatted</span><span class="s2">);</span>

    <span class="s3">var </span><span class="s1">title </span><span class="s2">= </span><span class="s1">selection</span><span class="s2">.</span><span class="s1">title </span><span class="s2">|| </span><span class="s1">selection</span><span class="s2">.</span><span class="s1">text</span><span class="s2">;</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">title</span><span class="s2">) {</span>
      <span class="s1">$rendered</span><span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'title'</span><span class="s2">, </span><span class="s1">title</span><span class="s2">);</span>
    <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
      <span class="s1">$rendered</span><span class="s2">.</span><span class="s1">removeAttr</span><span class="s2">(</span><span class="s4">'title'</span><span class="s2">);</span>
    <span class="s2">}</span>
  <span class="s2">};</span>

  <span class="s3">return </span><span class="s1">SingleSelection</span><span class="s2">;</span>
<span class="s2">});</span>

<span class="s1">S2</span><span class="s2">.</span><span class="s1">define</span><span class="s2">(</span><span class="s4">'select2/selection/multiple'</span><span class="s2">,[</span>
  <span class="s4">'jquery'</span><span class="s2">,</span>
  <span class="s4">'./base'</span><span class="s2">,</span>
  <span class="s4">'../utils'</span>
<span class="s2">], </span><span class="s3">function </span><span class="s2">(</span><span class="s1">$</span><span class="s2">, </span><span class="s1">BaseSelection</span><span class="s2">, </span><span class="s1">Utils</span><span class="s2">) {</span>
  <span class="s3">function </span><span class="s1">MultipleSelection </span><span class="s2">(</span><span class="s1">$element</span><span class="s2">, </span><span class="s1">options</span><span class="s2">) {</span>
    <span class="s1">MultipleSelection</span><span class="s2">.</span><span class="s1">__super__</span><span class="s2">.</span><span class="s1">constructor</span><span class="s2">.</span><span class="s1">apply</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">arguments</span><span class="s2">);</span>
  <span class="s2">}</span>

  <span class="s1">Utils</span><span class="s2">.</span><span class="s1">Extend</span><span class="s2">(</span><span class="s1">MultipleSelection</span><span class="s2">, </span><span class="s1">BaseSelection</span><span class="s2">);</span>

  <span class="s1">MultipleSelection</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">render </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {</span>
    <span class="s3">var </span><span class="s1">$selection </span><span class="s2">= </span><span class="s1">MultipleSelection</span><span class="s2">.</span><span class="s1">__super__</span><span class="s2">.</span><span class="s1">render</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">);</span>

    <span class="s1">$selection</span><span class="s2">.</span><span class="s1">addClass</span><span class="s2">(</span><span class="s4">'select2-selection--multiple'</span><span class="s2">);</span>

    <span class="s1">$selection</span><span class="s2">.</span><span class="s1">html</span><span class="s2">(</span>
      <span class="s4">'&lt;ul class=&quot;select2-selection__rendered&quot;&gt;&lt;/ul&gt;'</span>
    <span class="s2">);</span>

    <span class="s3">return </span><span class="s1">$selection</span><span class="s2">;</span>
  <span class="s2">};</span>

  <span class="s1">MultipleSelection</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">bind </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">container</span><span class="s2">, </span><span class="s1">$container</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">self </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>

    <span class="s1">MultipleSelection</span><span class="s2">.</span><span class="s1">__super__</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">.</span><span class="s1">apply</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">arguments</span><span class="s2">);</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">$selection</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'click'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">evt</span><span class="s2">) {</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'toggle'</span><span class="s2">, {</span>
        <span class="s1">originalEvent</span><span class="s2">: </span><span class="s1">evt</span>
      <span class="s2">});</span>
    <span class="s2">});</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">$selection</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span>
      <span class="s4">'click'</span><span class="s2">,</span>
      <span class="s4">'.select2-selection__choice__remove'</span><span class="s2">,</span>
      <span class="s3">function </span><span class="s2">(</span><span class="s1">evt</span><span class="s2">) {</span>
        <span class="s0">// Ignore the event if it is disabled</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">isDisabled</span><span class="s2">()) {</span>
          <span class="s3">return</span><span class="s2">;</span>
        <span class="s2">}</span>

        <span class="s3">var </span><span class="s1">$remove </span><span class="s2">= </span><span class="s1">$</span><span class="s2">(</span><span class="s3">this</span><span class="s2">);</span>
        <span class="s3">var </span><span class="s1">$selection </span><span class="s2">= </span><span class="s1">$remove</span><span class="s2">.</span><span class="s1">parent</span><span class="s2">();</span>

        <span class="s3">var </span><span class="s1">data </span><span class="s2">= </span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">GetData</span><span class="s2">(</span><span class="s1">$selection</span><span class="s2">[</span><span class="s8">0</span><span class="s2">], </span><span class="s4">'data'</span><span class="s2">);</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'unselect'</span><span class="s2">, {</span>
          <span class="s1">originalEvent</span><span class="s2">: </span><span class="s1">evt</span><span class="s2">,</span>
          <span class="s1">data</span><span class="s2">: </span><span class="s1">data</span>
        <span class="s2">});</span>
      <span class="s2">}</span>
    <span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s1">MultipleSelection</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">clear </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {</span>
    <span class="s3">var </span><span class="s1">$rendered </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">$selection</span><span class="s2">.</span><span class="s1">find</span><span class="s2">(</span><span class="s4">'.select2-selection__rendered'</span><span class="s2">);</span>
    <span class="s1">$rendered</span><span class="s2">.</span><span class="s1">empty</span><span class="s2">();</span>
    <span class="s1">$rendered</span><span class="s2">.</span><span class="s1">removeAttr</span><span class="s2">(</span><span class="s4">'title'</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s1">MultipleSelection</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">display </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">container</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">template </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'templateSelection'</span><span class="s2">);</span>
    <span class="s3">var </span><span class="s1">escapeMarkup </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'escapeMarkup'</span><span class="s2">);</span>

    <span class="s3">return </span><span class="s1">escapeMarkup</span><span class="s2">(</span><span class="s1">template</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">container</span><span class="s2">));</span>
  <span class="s2">};</span>

  <span class="s1">MultipleSelection</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">selectionContainer </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {</span>
    <span class="s3">var </span><span class="s1">$container </span><span class="s2">= </span><span class="s1">$</span><span class="s2">(</span>
      <span class="s4">'&lt;li class=&quot;select2-selection__choice&quot;&gt;' </span><span class="s2">+</span>
        <span class="s4">'&lt;span class=&quot;select2-selection__choice__remove&quot; role=&quot;presentation&quot;&gt;' </span><span class="s2">+</span>
          <span class="s4">'&amp;times;' </span><span class="s2">+</span>
        <span class="s4">'&lt;/span&gt;' </span><span class="s2">+</span>
      <span class="s4">'&lt;/li&gt;'</span>
    <span class="s2">);</span>

    <span class="s3">return </span><span class="s1">$container</span><span class="s2">;</span>
  <span class="s2">};</span>

  <span class="s1">MultipleSelection</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">update </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">data</span><span class="s2">) {</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">clear</span><span class="s2">();</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">data</span><span class="s2">.</span><span class="s1">length </span><span class="s2">=== </span><span class="s8">0</span><span class="s2">) {</span>
      <span class="s3">return</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">var </span><span class="s1">$selections </span><span class="s2">= [];</span>

    <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">d </span><span class="s2">= </span><span class="s8">0</span><span class="s2">; </span><span class="s1">d </span><span class="s2">&lt; </span><span class="s1">data</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">d</span><span class="s2">++) {</span>
      <span class="s3">var </span><span class="s1">selection </span><span class="s2">= </span><span class="s1">data</span><span class="s2">[</span><span class="s1">d</span><span class="s2">];</span>

      <span class="s3">var </span><span class="s1">$selection </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">selectionContainer</span><span class="s2">();</span>
      <span class="s3">var </span><span class="s1">formatted </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">display</span><span class="s2">(</span><span class="s1">selection</span><span class="s2">, </span><span class="s1">$selection</span><span class="s2">);</span>

      <span class="s1">$selection</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">formatted</span><span class="s2">);</span>

      <span class="s3">var </span><span class="s1">title </span><span class="s2">= </span><span class="s1">selection</span><span class="s2">.</span><span class="s1">title </span><span class="s2">|| </span><span class="s1">selection</span><span class="s2">.</span><span class="s1">text</span><span class="s2">;</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">title</span><span class="s2">) {</span>
        <span class="s1">$selection</span><span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'title'</span><span class="s2">, </span><span class="s1">title</span><span class="s2">);</span>
      <span class="s2">}</span>

      <span class="s1">Utils</span><span class="s2">.</span><span class="s1">StoreData</span><span class="s2">(</span><span class="s1">$selection</span><span class="s2">[</span><span class="s8">0</span><span class="s2">], </span><span class="s4">'data'</span><span class="s2">, </span><span class="s1">selection</span><span class="s2">);</span>

      <span class="s1">$selections</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">$selection</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">var </span><span class="s1">$rendered </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">$selection</span><span class="s2">.</span><span class="s1">find</span><span class="s2">(</span><span class="s4">'.select2-selection__rendered'</span><span class="s2">);</span>

    <span class="s1">Utils</span><span class="s2">.</span><span class="s1">appendMany</span><span class="s2">(</span><span class="s1">$rendered</span><span class="s2">, </span><span class="s1">$selections</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s3">return </span><span class="s1">MultipleSelection</span><span class="s2">;</span>
<span class="s2">});</span>

<span class="s1">S2</span><span class="s2">.</span><span class="s1">define</span><span class="s2">(</span><span class="s4">'select2/selection/placeholder'</span><span class="s2">,[</span>
  <span class="s4">'../utils'</span>
<span class="s2">], </span><span class="s3">function </span><span class="s2">(</span><span class="s1">Utils</span><span class="s2">) {</span>
  <span class="s3">function </span><span class="s1">Placeholder </span><span class="s2">(</span><span class="s1">decorated</span><span class="s2">, </span><span class="s1">$element</span><span class="s2">, </span><span class="s1">options</span><span class="s2">) {</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">placeholder </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">normalizePlaceholder</span><span class="s2">(</span><span class="s1">options</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'placeholder'</span><span class="s2">));</span>

    <span class="s1">decorated</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">$element</span><span class="s2">, </span><span class="s1">options</span><span class="s2">);</span>
  <span class="s2">}</span>

  <span class="s1">Placeholder</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">normalizePlaceholder </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">_</span><span class="s2">, </span><span class="s1">placeholder</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">placeholder </span><span class="s2">=== </span><span class="s4">'string'</span><span class="s2">) {</span>
      <span class="s1">placeholder </span><span class="s2">= {</span>
        <span class="s1">id</span><span class="s2">: </span><span class="s4">''</span><span class="s2">,</span>
        <span class="s1">text</span><span class="s2">: </span><span class="s1">placeholder</span>
      <span class="s2">};</span>
    <span class="s2">}</span>

    <span class="s3">return </span><span class="s1">placeholder</span><span class="s2">;</span>
  <span class="s2">};</span>

  <span class="s1">Placeholder</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">createPlaceholder </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">decorated</span><span class="s2">, </span><span class="s1">placeholder</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">$placeholder </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">selectionContainer</span><span class="s2">();</span>

    <span class="s1">$placeholder</span><span class="s2">.</span><span class="s1">html</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">display</span><span class="s2">(</span><span class="s1">placeholder</span><span class="s2">));</span>
    <span class="s1">$placeholder</span><span class="s2">.</span><span class="s1">addClass</span><span class="s2">(</span><span class="s4">'select2-selection__placeholder'</span><span class="s2">)</span>
                <span class="s2">.</span><span class="s1">removeClass</span><span class="s2">(</span><span class="s4">'select2-selection__choice'</span><span class="s2">);</span>

    <span class="s3">return </span><span class="s1">$placeholder</span><span class="s2">;</span>
  <span class="s2">};</span>

  <span class="s1">Placeholder</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">update </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">decorated</span><span class="s2">, </span><span class="s1">data</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">singlePlaceholder </span><span class="s2">= (</span>
      <span class="s1">data</span><span class="s2">.</span><span class="s1">length </span><span class="s2">== </span><span class="s8">1 </span><span class="s2">&amp;&amp; </span><span class="s1">data</span><span class="s2">[</span><span class="s8">0</span><span class="s2">].</span><span class="s1">id </span><span class="s2">!= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">placeholder</span><span class="s2">.</span><span class="s1">id</span>
    <span class="s2">);</span>
    <span class="s3">var </span><span class="s1">multipleSelections </span><span class="s2">= </span><span class="s1">data</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt; </span><span class="s8">1</span><span class="s2">;</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">multipleSelections </span><span class="s2">|| </span><span class="s1">singlePlaceholder</span><span class="s2">) {</span>
      <span class="s3">return </span><span class="s1">decorated</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">data</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">clear</span><span class="s2">();</span>

    <span class="s3">var </span><span class="s1">$placeholder </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">createPlaceholder</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">placeholder</span><span class="s2">);</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">$selection</span><span class="s2">.</span><span class="s1">find</span><span class="s2">(</span><span class="s4">'.select2-selection__rendered'</span><span class="s2">).</span><span class="s1">append</span><span class="s2">(</span><span class="s1">$placeholder</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s3">return </span><span class="s1">Placeholder</span><span class="s2">;</span>
<span class="s2">});</span>

<span class="s1">S2</span><span class="s2">.</span><span class="s1">define</span><span class="s2">(</span><span class="s4">'select2/selection/allowClear'</span><span class="s2">,[</span>
  <span class="s4">'jquery'</span><span class="s2">,</span>
  <span class="s4">'../keys'</span><span class="s2">,</span>
  <span class="s4">'../utils'</span>
<span class="s2">], </span><span class="s3">function </span><span class="s2">(</span><span class="s1">$</span><span class="s2">, </span><span class="s1">KEYS</span><span class="s2">, </span><span class="s1">Utils</span><span class="s2">) {</span>
  <span class="s3">function </span><span class="s1">AllowClear </span><span class="s2">() { }</span>

  <span class="s1">AllowClear</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">bind </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">decorated</span><span class="s2">, </span><span class="s1">container</span><span class="s2">, </span><span class="s1">$container</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">self </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>

    <span class="s1">decorated</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">container</span><span class="s2">, </span><span class="s1">$container</span><span class="s2">);</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">placeholder </span><span class="s2">== </span><span class="s3">null</span><span class="s2">) {</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'debug'</span><span class="s2">) &amp;&amp; </span><span class="s1">window</span><span class="s2">.</span><span class="s1">console </span><span class="s2">&amp;&amp; </span><span class="s1">console</span><span class="s2">.</span><span class="s1">error</span><span class="s2">) {</span>
        <span class="s1">console</span><span class="s2">.</span><span class="s1">error</span><span class="s2">(</span>
          <span class="s4">'Select2: The `allowClear` option should be used in combination ' </span><span class="s2">+</span>
          <span class="s4">'with the `placeholder` option.'</span>
        <span class="s2">);</span>
      <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">$selection</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'mousedown'</span><span class="s2">, </span><span class="s4">'.select2-selection__clear'</span><span class="s2">,</span>
      <span class="s3">function </span><span class="s2">(</span><span class="s1">evt</span><span class="s2">) {</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_handleClear</span><span class="s2">(</span><span class="s1">evt</span><span class="s2">);</span>
    <span class="s2">});</span>

    <span class="s1">container</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'keypress'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">evt</span><span class="s2">) {</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">_handleKeyboardClear</span><span class="s2">(</span><span class="s1">evt</span><span class="s2">, </span><span class="s1">container</span><span class="s2">);</span>
    <span class="s2">});</span>
  <span class="s2">};</span>

  <span class="s1">AllowClear</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">_handleClear </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">_</span><span class="s2">, </span><span class="s1">evt</span><span class="s2">) {</span>
    <span class="s0">// Ignore the event if it is disabled</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">isDisabled</span><span class="s2">()) {</span>
      <span class="s3">return</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">var </span><span class="s1">$clear </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">$selection</span><span class="s2">.</span><span class="s1">find</span><span class="s2">(</span><span class="s4">'.select2-selection__clear'</span><span class="s2">);</span>

    <span class="s0">// Ignore the event if nothing has been selected</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">$clear</span><span class="s2">.</span><span class="s1">length </span><span class="s2">=== </span><span class="s8">0</span><span class="s2">) {</span>
      <span class="s3">return</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s1">evt</span><span class="s2">.</span><span class="s1">stopPropagation</span><span class="s2">();</span>

    <span class="s3">var </span><span class="s1">data </span><span class="s2">= </span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">GetData</span><span class="s2">(</span><span class="s1">$clear</span><span class="s2">[</span><span class="s8">0</span><span class="s2">], </span><span class="s4">'data'</span><span class="s2">);</span>

    <span class="s3">var </span><span class="s1">previousVal </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">.</span><span class="s1">val</span><span class="s2">();</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">.</span><span class="s1">val</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">placeholder</span><span class="s2">.</span><span class="s1">id</span><span class="s2">);</span>

    <span class="s3">var </span><span class="s1">unselectData </span><span class="s2">= {</span>
      <span class="s1">data</span><span class="s2">: </span><span class="s1">data</span>
    <span class="s2">};</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'clear'</span><span class="s2">, </span><span class="s1">unselectData</span><span class="s2">);</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">unselectData</span><span class="s2">.</span><span class="s1">prevented</span><span class="s2">) {</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">.</span><span class="s1">val</span><span class="s2">(</span><span class="s1">previousVal</span><span class="s2">);</span>
      <span class="s3">return</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">d </span><span class="s2">= </span><span class="s8">0</span><span class="s2">; </span><span class="s1">d </span><span class="s2">&lt; </span><span class="s1">data</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">d</span><span class="s2">++) {</span>
      <span class="s1">unselectData </span><span class="s2">= {</span>
        <span class="s1">data</span><span class="s2">: </span><span class="s1">data</span><span class="s2">[</span><span class="s1">d</span><span class="s2">]</span>
      <span class="s2">};</span>

      <span class="s0">// Trigger the `unselect` event, so people can prevent it from being</span>
      <span class="s0">// cleared.</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'unselect'</span><span class="s2">, </span><span class="s1">unselectData</span><span class="s2">);</span>

      <span class="s0">// If the event was prevented, don't clear it out.</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">unselectData</span><span class="s2">.</span><span class="s1">prevented</span><span class="s2">) {</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">.</span><span class="s1">val</span><span class="s2">(</span><span class="s1">previousVal</span><span class="s2">);</span>
        <span class="s3">return</span><span class="s2">;</span>
      <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'input'</span><span class="s2">).</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'change'</span><span class="s2">);</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'toggle'</span><span class="s2">, {});</span>
  <span class="s2">};</span>

  <span class="s1">AllowClear</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">_handleKeyboardClear </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">_</span><span class="s2">, </span><span class="s1">evt</span><span class="s2">, </span><span class="s1">container</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">container</span><span class="s2">.</span><span class="s1">isOpen</span><span class="s2">()) {</span>
      <span class="s3">return</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">evt</span><span class="s2">.</span><span class="s1">which </span><span class="s2">== </span><span class="s1">KEYS</span><span class="s2">.</span><span class="s1">DELETE </span><span class="s2">|| </span><span class="s1">evt</span><span class="s2">.</span><span class="s1">which </span><span class="s2">== </span><span class="s1">KEYS</span><span class="s2">.</span><span class="s1">BACKSPACE</span><span class="s2">) {</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">_handleClear</span><span class="s2">(</span><span class="s1">evt</span><span class="s2">);</span>
    <span class="s2">}</span>
  <span class="s2">};</span>

  <span class="s1">AllowClear</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">update </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">decorated</span><span class="s2">, </span><span class="s1">data</span><span class="s2">) {</span>
    <span class="s1">decorated</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">data</span><span class="s2">);</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">$selection</span><span class="s2">.</span><span class="s1">find</span><span class="s2">(</span><span class="s4">'.select2-selection__placeholder'</span><span class="s2">).</span><span class="s1">length </span><span class="s2">&gt; </span><span class="s8">0 </span><span class="s2">||</span>
        <span class="s1">data</span><span class="s2">.</span><span class="s1">length </span><span class="s2">=== </span><span class="s8">0</span><span class="s2">) {</span>
      <span class="s3">return</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">var </span><span class="s1">removeAll </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'translations'</span><span class="s2">).</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'removeAllItems'</span><span class="s2">);</span>

    <span class="s3">var </span><span class="s1">$remove </span><span class="s2">= </span><span class="s1">$</span><span class="s2">(</span>
      <span class="s4">'&lt;span class=&quot;select2-selection__clear&quot; title=&quot;' </span><span class="s2">+ </span><span class="s1">removeAll</span><span class="s2">() +</span><span class="s4">'&quot;&gt;' </span><span class="s2">+</span>
        <span class="s4">'&amp;times;' </span><span class="s2">+</span>
      <span class="s4">'&lt;/span&gt;'</span>
    <span class="s2">);</span>
    <span class="s1">Utils</span><span class="s2">.</span><span class="s1">StoreData</span><span class="s2">(</span><span class="s1">$remove</span><span class="s2">[</span><span class="s8">0</span><span class="s2">], </span><span class="s4">'data'</span><span class="s2">, </span><span class="s1">data</span><span class="s2">);</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">$selection</span><span class="s2">.</span><span class="s1">find</span><span class="s2">(</span><span class="s4">'.select2-selection__rendered'</span><span class="s2">).</span><span class="s1">prepend</span><span class="s2">(</span><span class="s1">$remove</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s3">return </span><span class="s1">AllowClear</span><span class="s2">;</span>
<span class="s2">});</span>

<span class="s1">S2</span><span class="s2">.</span><span class="s1">define</span><span class="s2">(</span><span class="s4">'select2/selection/search'</span><span class="s2">,[</span>
  <span class="s4">'jquery'</span><span class="s2">,</span>
  <span class="s4">'../utils'</span><span class="s2">,</span>
  <span class="s4">'../keys'</span>
<span class="s2">], </span><span class="s3">function </span><span class="s2">(</span><span class="s1">$</span><span class="s2">, </span><span class="s1">Utils</span><span class="s2">, </span><span class="s1">KEYS</span><span class="s2">) {</span>
  <span class="s3">function </span><span class="s1">Search </span><span class="s2">(</span><span class="s1">decorated</span><span class="s2">, </span><span class="s1">$element</span><span class="s2">, </span><span class="s1">options</span><span class="s2">) {</span>
    <span class="s1">decorated</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">$element</span><span class="s2">, </span><span class="s1">options</span><span class="s2">);</span>
  <span class="s2">}</span>

  <span class="s1">Search</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">render </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">decorated</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">$search </span><span class="s2">= </span><span class="s1">$</span><span class="s2">(</span>
      <span class="s4">'&lt;li class=&quot;select2-search select2-search--inline&quot;&gt;' </span><span class="s2">+</span>
        <span class="s4">'&lt;input class=&quot;select2-search__field&quot; type=&quot;search&quot; tabindex=&quot;-1&quot;' </span><span class="s2">+</span>
        <span class="s4">' autocomplete=&quot;off&quot; autocorrect=&quot;off&quot; autocapitalize=&quot;none&quot;' </span><span class="s2">+</span>
        <span class="s4">' spellcheck=&quot;false&quot; role=&quot;searchbox&quot; aria-autocomplete=&quot;list&quot; /&gt;' </span><span class="s2">+</span>
      <span class="s4">'&lt;/li&gt;'</span>
    <span class="s2">);</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">$searchContainer </span><span class="s2">= </span><span class="s1">$search</span><span class="s2">;</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">$search </span><span class="s2">= </span><span class="s1">$search</span><span class="s2">.</span><span class="s1">find</span><span class="s2">(</span><span class="s4">'input'</span><span class="s2">);</span>

    <span class="s3">var </span><span class="s1">$rendered </span><span class="s2">= </span><span class="s1">decorated</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">);</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">_transferTabIndex</span><span class="s2">();</span>

    <span class="s3">return </span><span class="s1">$rendered</span><span class="s2">;</span>
  <span class="s2">};</span>

  <span class="s1">Search</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">bind </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">decorated</span><span class="s2">, </span><span class="s1">container</span><span class="s2">, </span><span class="s1">$container</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">self </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>

    <span class="s3">var </span><span class="s1">resultsId </span><span class="s2">= </span><span class="s1">container</span><span class="s2">.</span><span class="s1">id </span><span class="s2">+ </span><span class="s4">'-results'</span><span class="s2">;</span>

    <span class="s1">decorated</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">container</span><span class="s2">, </span><span class="s1">$container</span><span class="s2">);</span>

    <span class="s1">container</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'open'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">() {</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">$search</span><span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'aria-controls'</span><span class="s2">, </span><span class="s1">resultsId</span><span class="s2">);</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">$search</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'focus'</span><span class="s2">);</span>
    <span class="s2">});</span>

    <span class="s1">container</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'close'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">() {</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">$search</span><span class="s2">.</span><span class="s1">val</span><span class="s2">(</span><span class="s4">''</span><span class="s2">);</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">$search</span><span class="s2">.</span><span class="s1">removeAttr</span><span class="s2">(</span><span class="s4">'aria-controls'</span><span class="s2">);</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">$search</span><span class="s2">.</span><span class="s1">removeAttr</span><span class="s2">(</span><span class="s4">'aria-activedescendant'</span><span class="s2">);</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">$search</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'focus'</span><span class="s2">);</span>
    <span class="s2">});</span>

    <span class="s1">container</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'enable'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">() {</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">$search</span><span class="s2">.</span><span class="s1">prop</span><span class="s2">(</span><span class="s4">'disabled'</span><span class="s2">, </span><span class="s3">false</span><span class="s2">);</span>

      <span class="s1">self</span><span class="s2">.</span><span class="s1">_transferTabIndex</span><span class="s2">();</span>
    <span class="s2">});</span>

    <span class="s1">container</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'disable'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">() {</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">$search</span><span class="s2">.</span><span class="s1">prop</span><span class="s2">(</span><span class="s4">'disabled'</span><span class="s2">, </span><span class="s3">true</span><span class="s2">);</span>
    <span class="s2">});</span>

    <span class="s1">container</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'focus'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">evt</span><span class="s2">) {</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">$search</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'focus'</span><span class="s2">);</span>
    <span class="s2">});</span>

    <span class="s1">container</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'results:focus'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">params</span><span class="s2">) {</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">params</span><span class="s2">.</span><span class="s1">data</span><span class="s2">.</span><span class="s1">_resultId</span><span class="s2">) {</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">$search</span><span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'aria-activedescendant'</span><span class="s2">, </span><span class="s1">params</span><span class="s2">.</span><span class="s1">data</span><span class="s2">.</span><span class="s1">_resultId</span><span class="s2">);</span>
      <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">$search</span><span class="s2">.</span><span class="s1">removeAttr</span><span class="s2">(</span><span class="s4">'aria-activedescendant'</span><span class="s2">);</span>
      <span class="s2">}</span>
    <span class="s2">});</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">$selection</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'focusin'</span><span class="s2">, </span><span class="s4">'.select2-search--inline'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">evt</span><span class="s2">) {</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'focus'</span><span class="s2">, </span><span class="s1">evt</span><span class="s2">);</span>
    <span class="s2">});</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">$selection</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'focusout'</span><span class="s2">, </span><span class="s4">'.select2-search--inline'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">evt</span><span class="s2">) {</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">_handleBlur</span><span class="s2">(</span><span class="s1">evt</span><span class="s2">);</span>
    <span class="s2">});</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">$selection</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'keydown'</span><span class="s2">, </span><span class="s4">'.select2-search--inline'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">evt</span><span class="s2">) {</span>
      <span class="s1">evt</span><span class="s2">.</span><span class="s1">stopPropagation</span><span class="s2">();</span>

      <span class="s1">self</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'keypress'</span><span class="s2">, </span><span class="s1">evt</span><span class="s2">);</span>

      <span class="s1">self</span><span class="s2">.</span><span class="s1">_keyUpPrevented </span><span class="s2">= </span><span class="s1">evt</span><span class="s2">.</span><span class="s1">isDefaultPrevented</span><span class="s2">();</span>

      <span class="s3">var </span><span class="s1">key </span><span class="s2">= </span><span class="s1">evt</span><span class="s2">.</span><span class="s1">which</span><span class="s2">;</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">key </span><span class="s2">=== </span><span class="s1">KEYS</span><span class="s2">.</span><span class="s1">BACKSPACE </span><span class="s2">&amp;&amp; </span><span class="s1">self</span><span class="s2">.</span><span class="s1">$search</span><span class="s2">.</span><span class="s1">val</span><span class="s2">() === </span><span class="s4">''</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">$previousChoice </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">$searchContainer</span>
          <span class="s2">.</span><span class="s1">prev</span><span class="s2">(</span><span class="s4">'.select2-selection__choice'</span><span class="s2">);</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">$previousChoice</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt; </span><span class="s8">0</span><span class="s2">) {</span>
          <span class="s3">var </span><span class="s1">item </span><span class="s2">= </span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">GetData</span><span class="s2">(</span><span class="s1">$previousChoice</span><span class="s2">[</span><span class="s8">0</span><span class="s2">], </span><span class="s4">'data'</span><span class="s2">);</span>

          <span class="s1">self</span><span class="s2">.</span><span class="s1">searchRemoveChoice</span><span class="s2">(</span><span class="s1">item</span><span class="s2">);</span>

          <span class="s1">evt</span><span class="s2">.</span><span class="s1">preventDefault</span><span class="s2">();</span>
        <span class="s2">}</span>
      <span class="s2">}</span>
    <span class="s2">});</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">$selection</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'click'</span><span class="s2">, </span><span class="s4">'.select2-search--inline'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">evt</span><span class="s2">) {</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">$search</span><span class="s2">.</span><span class="s1">val</span><span class="s2">()) {</span>
        <span class="s1">evt</span><span class="s2">.</span><span class="s1">stopPropagation</span><span class="s2">();</span>
      <span class="s2">}</span>
    <span class="s2">});</span>

    <span class="s0">// Try to detect the IE version should the `documentMode` property that</span>
    <span class="s0">// is stored on the document. This is only implemented in IE and is</span>
    <span class="s0">// slightly cleaner than doing a user agent check.</span>
    <span class="s0">// This property is not available in Edge, but Edge also doesn't have</span>
    <span class="s0">// this bug.</span>
    <span class="s3">var </span><span class="s1">msie </span><span class="s2">= </span><span class="s1">document</span><span class="s2">.</span><span class="s1">documentMode</span><span class="s2">;</span>
    <span class="s3">var </span><span class="s1">disableInputEvents </span><span class="s2">= </span><span class="s1">msie </span><span class="s2">&amp;&amp; </span><span class="s1">msie </span><span class="s2">&lt;= </span><span class="s8">11</span><span class="s2">;</span>

    <span class="s0">// Workaround for browsers which do not support the `input` event</span>
    <span class="s0">// This will prevent double-triggering of events for browsers which support</span>
    <span class="s0">// both the `keyup` and `input` events.</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">$selection</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span>
      <span class="s4">'input.searchcheck'</span><span class="s2">,</span>
      <span class="s4">'.select2-search--inline'</span><span class="s2">,</span>
      <span class="s3">function </span><span class="s2">(</span><span class="s1">evt</span><span class="s2">) {</span>
        <span class="s0">// IE will trigger the `input` event when a placeholder is used on a</span>
        <span class="s0">// search box. To get around this issue, we are forced to ignore all</span>
        <span class="s0">// `input` events in IE and keep using `keyup`.</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">disableInputEvents</span><span class="s2">) {</span>
          <span class="s1">self</span><span class="s2">.</span><span class="s1">$selection</span><span class="s2">.</span><span class="s1">off</span><span class="s2">(</span><span class="s4">'input.search input.searchcheck'</span><span class="s2">);</span>
          <span class="s3">return</span><span class="s2">;</span>
        <span class="s2">}</span>

        <span class="s0">// Unbind the duplicated `keyup` event</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">$selection</span><span class="s2">.</span><span class="s1">off</span><span class="s2">(</span><span class="s4">'keyup.search'</span><span class="s2">);</span>
      <span class="s2">}</span>
    <span class="s2">);</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">$selection</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span>
      <span class="s4">'keyup.search input.search'</span><span class="s2">,</span>
      <span class="s4">'.select2-search--inline'</span><span class="s2">,</span>
      <span class="s3">function </span><span class="s2">(</span><span class="s1">evt</span><span class="s2">) {</span>
        <span class="s0">// IE will trigger the `input` event when a placeholder is used on a</span>
        <span class="s0">// search box. To get around this issue, we are forced to ignore all</span>
        <span class="s0">// `input` events in IE and keep using `keyup`.</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">disableInputEvents </span><span class="s2">&amp;&amp; </span><span class="s1">evt</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s4">'input'</span><span class="s2">) {</span>
          <span class="s1">self</span><span class="s2">.</span><span class="s1">$selection</span><span class="s2">.</span><span class="s1">off</span><span class="s2">(</span><span class="s4">'input.search input.searchcheck'</span><span class="s2">);</span>
          <span class="s3">return</span><span class="s2">;</span>
        <span class="s2">}</span>

        <span class="s3">var </span><span class="s1">key </span><span class="s2">= </span><span class="s1">evt</span><span class="s2">.</span><span class="s1">which</span><span class="s2">;</span>

        <span class="s0">// We can freely ignore events from modifier keys</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">key </span><span class="s2">== </span><span class="s1">KEYS</span><span class="s2">.</span><span class="s1">SHIFT </span><span class="s2">|| </span><span class="s1">key </span><span class="s2">== </span><span class="s1">KEYS</span><span class="s2">.</span><span class="s1">CTRL </span><span class="s2">|| </span><span class="s1">key </span><span class="s2">== </span><span class="s1">KEYS</span><span class="s2">.</span><span class="s1">ALT</span><span class="s2">) {</span>
          <span class="s3">return</span><span class="s2">;</span>
        <span class="s2">}</span>

        <span class="s0">// Tabbing will be handled during the `keydown` phase</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">key </span><span class="s2">== </span><span class="s1">KEYS</span><span class="s2">.</span><span class="s1">TAB</span><span class="s2">) {</span>
          <span class="s3">return</span><span class="s2">;</span>
        <span class="s2">}</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">handleSearch</span><span class="s2">(</span><span class="s1">evt</span><span class="s2">);</span>
      <span class="s2">}</span>
    <span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s5">/**</span>
   <span class="s5">* This method will transfer the tabindex attribute from the rendered</span>
   <span class="s5">* selection to the search box. This allows for the search box to be used as</span>
   <span class="s5">* the primary focus instead of the selection container.</span>
   <span class="s5">*</span>
   <span class="s5">* </span><span class="s6">@private</span>
   <span class="s5">*/</span>
  <span class="s1">Search</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">_transferTabIndex </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">decorated</span><span class="s2">) {</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">$search</span><span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'tabindex'</span><span class="s2">, </span><span class="s3">this</span><span class="s2">.</span><span class="s1">$selection</span><span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'tabindex'</span><span class="s2">));</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">$selection</span><span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'tabindex'</span><span class="s2">, </span><span class="s4">'-1'</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s1">Search</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">createPlaceholder </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">decorated</span><span class="s2">, </span><span class="s1">placeholder</span><span class="s2">) {</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">$search</span><span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'placeholder'</span><span class="s2">, </span><span class="s1">placeholder</span><span class="s2">.</span><span class="s1">text</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s1">Search</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">update </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">decorated</span><span class="s2">, </span><span class="s1">data</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">searchHadFocus </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">$search</span><span class="s2">[</span><span class="s8">0</span><span class="s2">] == </span><span class="s1">document</span><span class="s2">.</span><span class="s1">activeElement</span><span class="s2">;</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">$search</span><span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'placeholder'</span><span class="s2">, </span><span class="s4">''</span><span class="s2">);</span>

    <span class="s1">decorated</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">data</span><span class="s2">);</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">$selection</span><span class="s2">.</span><span class="s1">find</span><span class="s2">(</span><span class="s4">'.select2-selection__rendered'</span><span class="s2">)</span>
                   <span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">$searchContainer</span><span class="s2">);</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">resizeSearch</span><span class="s2">();</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">searchHadFocus</span><span class="s2">) {</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">$search</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'focus'</span><span class="s2">);</span>
    <span class="s2">}</span>
  <span class="s2">};</span>

  <span class="s1">Search</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">handleSearch </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">resizeSearch</span><span class="s2">();</span>

    <span class="s3">if </span><span class="s2">(!</span><span class="s3">this</span><span class="s2">.</span><span class="s1">_keyUpPrevented</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">input </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">$search</span><span class="s2">.</span><span class="s1">val</span><span class="s2">();</span>

      <span class="s3">this</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'query'</span><span class="s2">, {</span>
        <span class="s1">term</span><span class="s2">: </span><span class="s1">input</span>
      <span class="s2">});</span>
    <span class="s2">}</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">_keyUpPrevented </span><span class="s2">= </span><span class="s3">false</span><span class="s2">;</span>
  <span class="s2">};</span>

  <span class="s1">Search</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">searchRemoveChoice </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">decorated</span><span class="s2">, </span><span class="s1">item</span><span class="s2">) {</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'unselect'</span><span class="s2">, {</span>
      <span class="s1">data</span><span class="s2">: </span><span class="s1">item</span>
    <span class="s2">});</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">$search</span><span class="s2">.</span><span class="s1">val</span><span class="s2">(</span><span class="s1">item</span><span class="s2">.</span><span class="s1">text</span><span class="s2">);</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">handleSearch</span><span class="s2">();</span>
  <span class="s2">};</span>

  <span class="s1">Search</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">resizeSearch </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">$search</span><span class="s2">.</span><span class="s1">css</span><span class="s2">(</span><span class="s4">'width'</span><span class="s2">, </span><span class="s4">'25px'</span><span class="s2">);</span>

    <span class="s3">var </span><span class="s1">width </span><span class="s2">= </span><span class="s4">''</span><span class="s2">;</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">$search</span><span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'placeholder'</span><span class="s2">) !== </span><span class="s4">''</span><span class="s2">) {</span>
      <span class="s1">width </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">$selection</span><span class="s2">.</span><span class="s1">find</span><span class="s2">(</span><span class="s4">'.select2-selection__rendered'</span><span class="s2">).</span><span class="s1">width</span><span class="s2">();</span>
    <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
      <span class="s3">var </span><span class="s1">minimumWidth </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">$search</span><span class="s2">.</span><span class="s1">val</span><span class="s2">().</span><span class="s1">length </span><span class="s2">+ </span><span class="s8">1</span><span class="s2">;</span>

      <span class="s1">width </span><span class="s2">= (</span><span class="s1">minimumWidth </span><span class="s2">* </span><span class="s8">0.75</span><span class="s2">) + </span><span class="s4">'em'</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">$search</span><span class="s2">.</span><span class="s1">css</span><span class="s2">(</span><span class="s4">'width'</span><span class="s2">, </span><span class="s1">width</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s3">return </span><span class="s1">Search</span><span class="s2">;</span>
<span class="s2">});</span>

<span class="s1">S2</span><span class="s2">.</span><span class="s1">define</span><span class="s2">(</span><span class="s4">'select2/selection/eventRelay'</span><span class="s2">,[</span>
  <span class="s4">'jquery'</span>
<span class="s2">], </span><span class="s3">function </span><span class="s2">(</span><span class="s1">$</span><span class="s2">) {</span>
  <span class="s3">function </span><span class="s1">EventRelay </span><span class="s2">() { }</span>

  <span class="s1">EventRelay</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">bind </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">decorated</span><span class="s2">, </span><span class="s1">container</span><span class="s2">, </span><span class="s1">$container</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">self </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>
    <span class="s3">var </span><span class="s1">relayEvents </span><span class="s2">= [</span>
      <span class="s4">'open'</span><span class="s2">, </span><span class="s4">'opening'</span><span class="s2">,</span>
      <span class="s4">'close'</span><span class="s2">, </span><span class="s4">'closing'</span><span class="s2">,</span>
      <span class="s4">'select'</span><span class="s2">, </span><span class="s4">'selecting'</span><span class="s2">,</span>
      <span class="s4">'unselect'</span><span class="s2">, </span><span class="s4">'unselecting'</span><span class="s2">,</span>
      <span class="s4">'clear'</span><span class="s2">, </span><span class="s4">'clearing'</span>
    <span class="s2">];</span>

    <span class="s3">var </span><span class="s1">preventableEvents </span><span class="s2">= [</span>
      <span class="s4">'opening'</span><span class="s2">, </span><span class="s4">'closing'</span><span class="s2">, </span><span class="s4">'selecting'</span><span class="s2">, </span><span class="s4">'unselecting'</span><span class="s2">, </span><span class="s4">'clearing'</span>
    <span class="s2">];</span>

    <span class="s1">decorated</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">container</span><span class="s2">, </span><span class="s1">$container</span><span class="s2">);</span>

    <span class="s1">container</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'*'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">name</span><span class="s2">, </span><span class="s1">params</span><span class="s2">) {</span>
      <span class="s0">// Ignore events that should not be relayed</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">$</span><span class="s2">.</span><span class="s1">inArray</span><span class="s2">(</span><span class="s1">name</span><span class="s2">, </span><span class="s1">relayEvents</span><span class="s2">) === -</span><span class="s8">1</span><span class="s2">) {</span>
        <span class="s3">return</span><span class="s2">;</span>
      <span class="s2">}</span>

      <span class="s0">// The parameters should always be an object</span>
      <span class="s1">params </span><span class="s2">= </span><span class="s1">params </span><span class="s2">|| {};</span>

      <span class="s0">// Generate the jQuery event for the Select2 event</span>
      <span class="s3">var </span><span class="s1">evt </span><span class="s2">= </span><span class="s1">$</span><span class="s2">.</span><span class="s1">Event</span><span class="s2">(</span><span class="s4">'select2:' </span><span class="s2">+ </span><span class="s1">name</span><span class="s2">, {</span>
        <span class="s1">params</span><span class="s2">: </span><span class="s1">params</span>
      <span class="s2">});</span>

      <span class="s1">self</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s1">evt</span><span class="s2">);</span>

      <span class="s0">// Only handle preventable events if it was one</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">$</span><span class="s2">.</span><span class="s1">inArray</span><span class="s2">(</span><span class="s1">name</span><span class="s2">, </span><span class="s1">preventableEvents</span><span class="s2">) === -</span><span class="s8">1</span><span class="s2">) {</span>
        <span class="s3">return</span><span class="s2">;</span>
      <span class="s2">}</span>

      <span class="s1">params</span><span class="s2">.</span><span class="s1">prevented </span><span class="s2">= </span><span class="s1">evt</span><span class="s2">.</span><span class="s1">isDefaultPrevented</span><span class="s2">();</span>
    <span class="s2">});</span>
  <span class="s2">};</span>

  <span class="s3">return </span><span class="s1">EventRelay</span><span class="s2">;</span>
<span class="s2">});</span>

<span class="s1">S2</span><span class="s2">.</span><span class="s1">define</span><span class="s2">(</span><span class="s4">'select2/translation'</span><span class="s2">,[</span>
  <span class="s4">'jquery'</span><span class="s2">,</span>
  <span class="s4">'require'</span>
<span class="s2">], </span><span class="s3">function </span><span class="s2">(</span><span class="s1">$</span><span class="s2">, </span><span class="s1">require</span><span class="s2">) {</span>
  <span class="s3">function </span><span class="s1">Translation </span><span class="s2">(</span><span class="s1">dict</span><span class="s2">) {</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">dict </span><span class="s2">= </span><span class="s1">dict </span><span class="s2">|| {};</span>
  <span class="s2">}</span>

  <span class="s1">Translation</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">all </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {</span>
    <span class="s3">return this</span><span class="s2">.</span><span class="s1">dict</span><span class="s2">;</span>
  <span class="s2">};</span>

  <span class="s1">Translation</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">get </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">key</span><span class="s2">) {</span>
    <span class="s3">return this</span><span class="s2">.</span><span class="s1">dict</span><span class="s2">[</span><span class="s1">key</span><span class="s2">];</span>
  <span class="s2">};</span>

  <span class="s1">Translation</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">extend </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">translation</span><span class="s2">) {</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">dict </span><span class="s2">= </span><span class="s1">$</span><span class="s2">.</span><span class="s1">extend</span><span class="s2">({}, </span><span class="s1">translation</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(), </span><span class="s3">this</span><span class="s2">.</span><span class="s1">dict</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s0">// Static functions</span>

  <span class="s1">Translation</span><span class="s2">.</span><span class="s1">_cache </span><span class="s2">= {};</span>

  <span class="s1">Translation</span><span class="s2">.</span><span class="s1">loadPath </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">path</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(!(</span><span class="s1">path </span><span class="s3">in </span><span class="s1">Translation</span><span class="s2">.</span><span class="s1">_cache</span><span class="s2">)) {</span>
      <span class="s3">var </span><span class="s1">translations </span><span class="s2">= </span><span class="s1">require</span><span class="s2">(</span><span class="s1">path</span><span class="s2">);</span>

      <span class="s1">Translation</span><span class="s2">.</span><span class="s1">_cache</span><span class="s2">[</span><span class="s1">path</span><span class="s2">] = </span><span class="s1">translations</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">return new </span><span class="s1">Translation</span><span class="s2">(</span><span class="s1">Translation</span><span class="s2">.</span><span class="s1">_cache</span><span class="s2">[</span><span class="s1">path</span><span class="s2">]);</span>
  <span class="s2">};</span>

  <span class="s3">return </span><span class="s1">Translation</span><span class="s2">;</span>
<span class="s2">});</span>

<span class="s1">S2</span><span class="s2">.</span><span class="s1">define</span><span class="s2">(</span><span class="s4">'select2/diacritics'</span><span class="s2">,[</span>

<span class="s2">], </span><span class="s3">function </span><span class="s2">() {</span>
  <span class="s3">var </span><span class="s1">diacritics </span><span class="s2">= {</span>
    <span class="s4">'</span><span class="s3">\u24B6</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'A'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uFF21</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'A'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u00C0</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'A'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u00C1</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'A'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u00C2</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'A'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EA6</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'A'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EA4</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'A'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EAA</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'A'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EA8</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'A'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u00C3</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'A'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0100</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'A'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0102</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'A'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EB0</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'A'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EAE</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'A'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EB4</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'A'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EB2</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'A'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0226</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'A'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01E0</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'A'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u00C4</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'A'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01DE</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'A'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EA2</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'A'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u00C5</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'A'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01FA</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'A'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01CD</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'A'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0200</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'A'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0202</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'A'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EA0</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'A'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EAC</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'A'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EB6</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'A'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E00</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'A'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0104</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'A'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u023A</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'A'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u2C6F</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'A'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA732</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'AA'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u00C6</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'AE'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01FC</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'AE'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01E2</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'AE'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA734</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'AO'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA736</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'AU'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA738</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'AV'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA73A</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'AV'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA73C</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'AY'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u24B7</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'B'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uFF22</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'B'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E02</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'B'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E04</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'B'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E06</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'B'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0243</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'B'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0182</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'B'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0181</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'B'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u24B8</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'C'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uFF23</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'C'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0106</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'C'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0108</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'C'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u010A</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'C'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u010C</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'C'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u00C7</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'C'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E08</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'C'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0187</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'C'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u023B</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'C'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA73E</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'C'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u24B9</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'D'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uFF24</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'D'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E0A</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'D'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u010E</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'D'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E0C</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'D'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E10</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'D'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E12</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'D'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E0E</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'D'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0110</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'D'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u018B</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'D'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u018A</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'D'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0189</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'D'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA779</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'D'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01F1</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'DZ'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01C4</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'DZ'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01F2</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'Dz'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01C5</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'Dz'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u24BA</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'E'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uFF25</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'E'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u00C8</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'E'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u00C9</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'E'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u00CA</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'E'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EC0</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'E'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EBE</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'E'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EC4</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'E'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EC2</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'E'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EBC</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'E'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0112</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'E'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E14</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'E'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E16</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'E'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0114</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'E'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0116</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'E'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u00CB</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'E'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EBA</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'E'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u011A</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'E'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0204</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'E'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0206</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'E'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EB8</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'E'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EC6</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'E'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0228</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'E'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E1C</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'E'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0118</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'E'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E18</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'E'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E1A</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'E'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0190</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'E'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u018E</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'E'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u24BB</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'F'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uFF26</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'F'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E1E</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'F'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0191</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'F'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA77B</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'F'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u24BC</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'G'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uFF27</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'G'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01F4</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'G'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u011C</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'G'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E20</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'G'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u011E</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'G'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0120</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'G'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01E6</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'G'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0122</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'G'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01E4</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'G'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0193</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'G'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA7A0</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'G'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA77D</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'G'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA77E</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'G'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u24BD</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'H'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uFF28</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'H'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0124</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'H'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E22</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'H'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E26</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'H'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u021E</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'H'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E24</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'H'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E28</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'H'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E2A</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'H'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0126</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'H'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u2C67</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'H'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u2C75</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'H'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA78D</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'H'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u24BE</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'I'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uFF29</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'I'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u00CC</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'I'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u00CD</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'I'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u00CE</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'I'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0128</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'I'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u012A</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'I'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u012C</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'I'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0130</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'I'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u00CF</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'I'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E2E</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'I'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EC8</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'I'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01CF</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'I'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0208</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'I'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u020A</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'I'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1ECA</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'I'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u012E</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'I'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E2C</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'I'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0197</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'I'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u24BF</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'J'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uFF2A</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'J'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0134</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'J'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0248</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'J'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u24C0</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'K'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uFF2B</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'K'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E30</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'K'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01E8</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'K'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E32</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'K'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0136</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'K'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E34</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'K'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0198</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'K'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u2C69</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'K'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA740</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'K'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA742</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'K'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA744</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'K'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA7A2</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'K'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u24C1</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'L'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uFF2C</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'L'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u013F</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'L'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0139</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'L'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u013D</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'L'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E36</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'L'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E38</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'L'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u013B</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'L'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E3C</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'L'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E3A</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'L'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0141</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'L'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u023D</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'L'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u2C62</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'L'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u2C60</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'L'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA748</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'L'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA746</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'L'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA780</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'L'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01C7</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'LJ'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01C8</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'Lj'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u24C2</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'M'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uFF2D</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'M'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E3E</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'M'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E40</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'M'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E42</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'M'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u2C6E</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'M'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u019C</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'M'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u24C3</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'N'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uFF2E</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'N'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01F8</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'N'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0143</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'N'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u00D1</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'N'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E44</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'N'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0147</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'N'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E46</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'N'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0145</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'N'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E4A</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'N'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E48</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'N'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0220</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'N'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u019D</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'N'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA790</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'N'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA7A4</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'N'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01CA</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'NJ'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01CB</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'Nj'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u24C4</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'O'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uFF2F</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'O'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u00D2</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'O'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u00D3</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'O'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u00D4</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'O'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1ED2</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'O'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1ED0</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'O'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1ED6</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'O'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1ED4</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'O'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u00D5</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'O'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E4C</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'O'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u022C</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'O'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E4E</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'O'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u014C</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'O'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E50</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'O'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E52</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'O'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u014E</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'O'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u022E</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'O'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0230</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'O'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u00D6</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'O'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u022A</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'O'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1ECE</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'O'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0150</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'O'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01D1</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'O'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u020C</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'O'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u020E</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'O'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01A0</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'O'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EDC</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'O'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EDA</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'O'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EE0</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'O'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EDE</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'O'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EE2</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'O'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1ECC</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'O'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1ED8</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'O'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01EA</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'O'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01EC</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'O'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u00D8</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'O'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01FE</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'O'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0186</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'O'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u019F</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'O'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA74A</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'O'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA74C</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'O'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0152</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'OE'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01A2</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'OI'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA74E</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'OO'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0222</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'OU'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u24C5</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'P'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uFF30</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'P'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E54</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'P'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E56</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'P'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01A4</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'P'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u2C63</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'P'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA750</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'P'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA752</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'P'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA754</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'P'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u24C6</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'Q'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uFF31</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'Q'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA756</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'Q'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA758</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'Q'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u024A</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'Q'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u24C7</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'R'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uFF32</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'R'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0154</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'R'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E58</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'R'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0158</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'R'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0210</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'R'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0212</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'R'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E5A</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'R'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E5C</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'R'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0156</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'R'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E5E</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'R'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u024C</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'R'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u2C64</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'R'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA75A</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'R'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA7A6</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'R'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA782</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'R'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u24C8</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'S'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uFF33</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'S'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E9E</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'S'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u015A</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'S'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E64</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'S'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u015C</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'S'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E60</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'S'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0160</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'S'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E66</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'S'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E62</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'S'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E68</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'S'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0218</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'S'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u015E</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'S'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u2C7E</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'S'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA7A8</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'S'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA784</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'S'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u24C9</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'T'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uFF34</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'T'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E6A</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'T'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0164</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'T'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E6C</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'T'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u021A</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'T'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0162</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'T'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E70</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'T'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E6E</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'T'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0166</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'T'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01AC</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'T'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01AE</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'T'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u023E</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'T'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA786</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'T'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA728</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'TZ'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u24CA</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'U'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uFF35</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'U'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u00D9</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'U'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u00DA</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'U'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u00DB</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'U'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0168</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'U'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E78</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'U'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u016A</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'U'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E7A</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'U'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u016C</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'U'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u00DC</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'U'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01DB</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'U'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01D7</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'U'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01D5</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'U'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01D9</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'U'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EE6</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'U'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u016E</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'U'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0170</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'U'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01D3</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'U'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0214</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'U'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0216</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'U'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01AF</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'U'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EEA</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'U'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EE8</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'U'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EEE</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'U'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EEC</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'U'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EF0</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'U'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EE4</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'U'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E72</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'U'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0172</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'U'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E76</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'U'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E74</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'U'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0244</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'U'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u24CB</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'V'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uFF36</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'V'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E7C</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'V'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E7E</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'V'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01B2</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'V'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA75E</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'V'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0245</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'V'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA760</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'VY'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u24CC</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'W'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uFF37</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'W'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E80</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'W'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E82</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'W'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0174</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'W'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E86</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'W'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E84</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'W'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E88</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'W'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u2C72</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'W'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u24CD</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'X'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uFF38</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'X'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E8A</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'X'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E8C</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'X'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u24CE</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'Y'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uFF39</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'Y'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EF2</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'Y'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u00DD</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'Y'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0176</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'Y'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EF8</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'Y'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0232</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'Y'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E8E</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'Y'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0178</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'Y'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EF6</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'Y'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EF4</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'Y'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01B3</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'Y'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u024E</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'Y'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EFE</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'Y'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u24CF</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'Z'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uFF3A</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'Z'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0179</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'Z'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E90</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'Z'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u017B</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'Z'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u017D</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'Z'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E92</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'Z'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E94</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'Z'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01B5</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'Z'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0224</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'Z'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u2C7F</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'Z'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u2C6B</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'Z'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA762</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'Z'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u24D0</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'a'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uFF41</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'a'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E9A</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'a'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u00E0</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'a'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u00E1</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'a'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u00E2</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'a'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EA7</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'a'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EA5</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'a'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EAB</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'a'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EA9</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'a'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u00E3</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'a'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0101</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'a'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0103</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'a'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EB1</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'a'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EAF</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'a'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EB5</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'a'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EB3</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'a'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0227</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'a'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01E1</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'a'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u00E4</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'a'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01DF</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'a'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EA3</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'a'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u00E5</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'a'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01FB</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'a'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01CE</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'a'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0201</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'a'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0203</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'a'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EA1</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'a'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EAD</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'a'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EB7</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'a'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E01</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'a'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0105</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'a'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u2C65</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'a'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0250</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'a'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA733</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'aa'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u00E6</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'ae'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01FD</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'ae'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01E3</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'ae'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA735</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'ao'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA737</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'au'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA739</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'av'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA73B</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'av'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA73D</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'ay'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u24D1</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'b'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uFF42</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'b'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E03</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'b'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E05</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'b'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E07</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'b'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0180</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'b'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0183</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'b'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0253</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'b'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u24D2</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'c'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uFF43</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'c'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0107</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'c'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0109</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'c'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u010B</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'c'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u010D</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'c'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u00E7</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'c'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E09</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'c'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0188</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'c'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u023C</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'c'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA73F</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'c'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u2184</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'c'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u24D3</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'d'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uFF44</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'d'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E0B</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'d'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u010F</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'d'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E0D</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'d'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E11</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'d'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E13</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'d'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E0F</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'d'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0111</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'d'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u018C</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'d'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0256</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'d'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0257</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'d'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA77A</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'d'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01F3</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'dz'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01C6</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'dz'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u24D4</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'e'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uFF45</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'e'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u00E8</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'e'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u00E9</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'e'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u00EA</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'e'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EC1</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'e'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EBF</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'e'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EC5</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'e'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EC3</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'e'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EBD</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'e'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0113</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'e'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E15</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'e'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E17</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'e'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0115</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'e'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0117</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'e'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u00EB</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'e'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EBB</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'e'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u011B</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'e'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0205</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'e'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0207</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'e'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EB9</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'e'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EC7</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'e'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0229</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'e'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E1D</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'e'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0119</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'e'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E19</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'e'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E1B</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'e'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0247</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'e'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u025B</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'e'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01DD</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'e'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u24D5</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'f'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uFF46</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'f'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E1F</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'f'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0192</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'f'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA77C</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'f'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u24D6</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'g'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uFF47</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'g'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01F5</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'g'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u011D</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'g'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E21</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'g'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u011F</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'g'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0121</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'g'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01E7</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'g'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0123</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'g'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01E5</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'g'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0260</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'g'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA7A1</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'g'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1D79</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'g'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA77F</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'g'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u24D7</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'h'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uFF48</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'h'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0125</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'h'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E23</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'h'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E27</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'h'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u021F</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'h'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E25</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'h'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E29</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'h'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E2B</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'h'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E96</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'h'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0127</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'h'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u2C68</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'h'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u2C76</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'h'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0265</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'h'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0195</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'hv'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u24D8</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'i'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uFF49</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'i'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u00EC</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'i'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u00ED</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'i'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u00EE</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'i'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0129</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'i'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u012B</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'i'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u012D</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'i'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u00EF</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'i'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E2F</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'i'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EC9</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'i'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01D0</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'i'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0209</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'i'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u020B</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'i'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1ECB</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'i'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u012F</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'i'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E2D</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'i'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0268</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'i'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0131</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'i'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u24D9</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'j'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uFF4A</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'j'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0135</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'j'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01F0</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'j'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0249</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'j'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u24DA</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'k'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uFF4B</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'k'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E31</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'k'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01E9</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'k'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E33</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'k'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0137</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'k'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E35</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'k'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0199</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'k'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u2C6A</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'k'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA741</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'k'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA743</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'k'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA745</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'k'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA7A3</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'k'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u24DB</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'l'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uFF4C</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'l'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0140</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'l'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u013A</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'l'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u013E</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'l'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E37</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'l'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E39</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'l'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u013C</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'l'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E3D</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'l'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E3B</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'l'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u017F</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'l'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0142</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'l'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u019A</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'l'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u026B</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'l'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u2C61</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'l'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA749</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'l'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA781</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'l'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA747</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'l'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01C9</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'lj'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u24DC</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'m'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uFF4D</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'m'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E3F</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'m'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E41</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'m'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E43</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'m'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0271</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'m'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u026F</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'m'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u24DD</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'n'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uFF4E</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'n'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01F9</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'n'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0144</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'n'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u00F1</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'n'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E45</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'n'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0148</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'n'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E47</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'n'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0146</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'n'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E4B</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'n'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E49</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'n'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u019E</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'n'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0272</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'n'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0149</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'n'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA791</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'n'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA7A5</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'n'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01CC</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'nj'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u24DE</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'o'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uFF4F</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'o'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u00F2</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'o'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u00F3</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'o'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u00F4</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'o'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1ED3</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'o'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1ED1</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'o'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1ED7</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'o'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1ED5</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'o'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u00F5</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'o'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E4D</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'o'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u022D</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'o'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E4F</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'o'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u014D</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'o'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E51</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'o'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E53</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'o'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u014F</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'o'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u022F</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'o'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0231</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'o'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u00F6</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'o'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u022B</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'o'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1ECF</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'o'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0151</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'o'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01D2</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'o'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u020D</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'o'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u020F</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'o'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01A1</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'o'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EDD</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'o'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EDB</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'o'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EE1</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'o'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EDF</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'o'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EE3</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'o'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1ECD</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'o'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1ED9</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'o'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01EB</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'o'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01ED</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'o'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u00F8</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'o'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01FF</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'o'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0254</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'o'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA74B</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'o'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA74D</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'o'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0275</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'o'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0153</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'oe'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01A3</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'oi'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0223</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'ou'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA74F</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'oo'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u24DF</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'p'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uFF50</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'p'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E55</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'p'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E57</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'p'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01A5</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'p'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1D7D</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'p'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA751</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'p'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA753</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'p'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA755</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'p'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u24E0</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'q'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uFF51</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'q'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u024B</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'q'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA757</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'q'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA759</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'q'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u24E1</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'r'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uFF52</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'r'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0155</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'r'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E59</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'r'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0159</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'r'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0211</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'r'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0213</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'r'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E5B</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'r'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E5D</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'r'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0157</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'r'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E5F</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'r'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u024D</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'r'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u027D</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'r'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA75B</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'r'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA7A7</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'r'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA783</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'r'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u24E2</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'s'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uFF53</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'s'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u00DF</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'s'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u015B</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'s'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E65</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'s'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u015D</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'s'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E61</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'s'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0161</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'s'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E67</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'s'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E63</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'s'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E69</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'s'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0219</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'s'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u015F</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'s'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u023F</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'s'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA7A9</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'s'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA785</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'s'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E9B</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'s'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u24E3</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'t'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uFF54</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'t'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E6B</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'t'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E97</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'t'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0165</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'t'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E6D</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'t'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u021B</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'t'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0163</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'t'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E71</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'t'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E6F</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'t'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0167</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'t'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01AD</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'t'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0288</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'t'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u2C66</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'t'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA787</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'t'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA729</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'tz'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u24E4</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'u'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uFF55</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'u'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u00F9</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'u'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u00FA</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'u'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u00FB</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'u'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0169</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'u'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E79</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'u'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u016B</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'u'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E7B</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'u'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u016D</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'u'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u00FC</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'u'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01DC</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'u'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01D8</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'u'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01D6</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'u'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01DA</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'u'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EE7</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'u'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u016F</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'u'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0171</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'u'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01D4</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'u'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0215</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'u'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0217</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'u'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01B0</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'u'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EEB</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'u'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EE9</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'u'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EEF</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'u'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EED</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'u'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EF1</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'u'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EE5</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'u'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E73</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'u'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0173</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'u'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E77</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'u'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E75</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'u'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0289</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'u'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u24E5</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'v'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uFF56</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'v'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E7D</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'v'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E7F</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'v'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u028B</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'v'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA75F</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'v'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u028C</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'v'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA761</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'vy'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u24E6</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'w'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uFF57</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'w'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E81</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'w'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E83</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'w'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0175</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'w'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E87</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'w'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E85</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'w'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E98</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'w'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E89</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'w'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u2C73</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'w'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u24E7</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'x'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uFF58</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'x'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E8B</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'x'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E8D</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'x'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u24E8</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'y'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uFF59</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'y'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EF3</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'y'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u00FD</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'y'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0177</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'y'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EF9</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'y'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0233</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'y'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E8F</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'y'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u00FF</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'y'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EF7</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'y'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E99</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'y'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EF5</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'y'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01B4</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'y'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u024F</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'y'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1EFF</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'y'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u24E9</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'z'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uFF5A</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'z'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u017A</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'z'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E91</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'z'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u017C</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'z'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u017E</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'z'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E93</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'z'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u1E95</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'z'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u01B6</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'z'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0225</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'z'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0240</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'z'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u2C6C</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'z'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\uA763</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'z'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0386</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'</span><span class="s3">\u0391</span><span class="s4">'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0388</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'</span><span class="s3">\u0395</span><span class="s4">'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0389</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'</span><span class="s3">\u0397</span><span class="s4">'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u038A</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'</span><span class="s3">\u0399</span><span class="s4">'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u03AA</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'</span><span class="s3">\u0399</span><span class="s4">'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u038C</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'</span><span class="s3">\u039F</span><span class="s4">'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u038E</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'</span><span class="s3">\u03A5</span><span class="s4">'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u03AB</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'</span><span class="s3">\u03A5</span><span class="s4">'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u038F</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'</span><span class="s3">\u03A9</span><span class="s4">'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u03AC</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'</span><span class="s3">\u03B1</span><span class="s4">'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u03AD</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'</span><span class="s3">\u03B5</span><span class="s4">'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u03AE</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'</span><span class="s3">\u03B7</span><span class="s4">'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u03AF</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'</span><span class="s3">\u03B9</span><span class="s4">'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u03CA</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'</span><span class="s3">\u03B9</span><span class="s4">'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u0390</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'</span><span class="s3">\u03B9</span><span class="s4">'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u03CC</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'</span><span class="s3">\u03BF</span><span class="s4">'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u03CD</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'</span><span class="s3">\u03C5</span><span class="s4">'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u03CB</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'</span><span class="s3">\u03C5</span><span class="s4">'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u03B0</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'</span><span class="s3">\u03C5</span><span class="s4">'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u03CE</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'</span><span class="s3">\u03C9</span><span class="s4">'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u03C2</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'</span><span class="s3">\u03C3</span><span class="s4">'</span><span class="s2">,</span>
    <span class="s4">'</span><span class="s3">\u2019</span><span class="s4">'</span><span class="s2">: </span><span class="s4">'</span><span class="s3">\'</span><span class="s4">'</span>
  <span class="s2">};</span>

  <span class="s3">return </span><span class="s1">diacritics</span><span class="s2">;</span>
<span class="s2">});</span>

<span class="s1">S2</span><span class="s2">.</span><span class="s1">define</span><span class="s2">(</span><span class="s4">'select2/data/base'</span><span class="s2">,[</span>
  <span class="s4">'../utils'</span>
<span class="s2">], </span><span class="s3">function </span><span class="s2">(</span><span class="s1">Utils</span><span class="s2">) {</span>
  <span class="s3">function </span><span class="s1">BaseAdapter </span><span class="s2">(</span><span class="s1">$element</span><span class="s2">, </span><span class="s1">options</span><span class="s2">) {</span>
    <span class="s1">BaseAdapter</span><span class="s2">.</span><span class="s1">__super__</span><span class="s2">.</span><span class="s1">constructor</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">);</span>
  <span class="s2">}</span>

  <span class="s1">Utils</span><span class="s2">.</span><span class="s1">Extend</span><span class="s2">(</span><span class="s1">BaseAdapter</span><span class="s2">, </span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">Observable</span><span class="s2">);</span>

  <span class="s1">BaseAdapter</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">current </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">callback</span><span class="s2">) {</span>
    <span class="s3">throw new </span><span class="s1">Error</span><span class="s2">(</span><span class="s4">'The `current` method must be defined in child classes.'</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s1">BaseAdapter</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">query </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">params</span><span class="s2">, </span><span class="s1">callback</span><span class="s2">) {</span>
    <span class="s3">throw new </span><span class="s1">Error</span><span class="s2">(</span><span class="s4">'The `query` method must be defined in child classes.'</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s1">BaseAdapter</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">bind </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">container</span><span class="s2">, </span><span class="s1">$container</span><span class="s2">) {</span>
    <span class="s0">// Can be implemented in subclasses</span>
  <span class="s2">};</span>

  <span class="s1">BaseAdapter</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">destroy </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {</span>
    <span class="s0">// Can be implemented in subclasses</span>
  <span class="s2">};</span>

  <span class="s1">BaseAdapter</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">generateResultId </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">container</span><span class="s2">, </span><span class="s1">data</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">id </span><span class="s2">= </span><span class="s1">container</span><span class="s2">.</span><span class="s1">id </span><span class="s2">+ </span><span class="s4">'-result-'</span><span class="s2">;</span>

    <span class="s1">id </span><span class="s2">+= </span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">generateChars</span><span class="s2">(</span><span class="s8">4</span><span class="s2">);</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">data</span><span class="s2">.</span><span class="s1">id </span><span class="s2">!= </span><span class="s3">null</span><span class="s2">) {</span>
      <span class="s1">id </span><span class="s2">+= </span><span class="s4">'-' </span><span class="s2">+ </span><span class="s1">data</span><span class="s2">.</span><span class="s1">id</span><span class="s2">.</span><span class="s1">toString</span><span class="s2">();</span>
    <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
      <span class="s1">id </span><span class="s2">+= </span><span class="s4">'-' </span><span class="s2">+ </span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">generateChars</span><span class="s2">(</span><span class="s8">4</span><span class="s2">);</span>
    <span class="s2">}</span>
    <span class="s3">return </span><span class="s1">id</span><span class="s2">;</span>
  <span class="s2">};</span>

  <span class="s3">return </span><span class="s1">BaseAdapter</span><span class="s2">;</span>
<span class="s2">});</span>

<span class="s1">S2</span><span class="s2">.</span><span class="s1">define</span><span class="s2">(</span><span class="s4">'select2/data/select'</span><span class="s2">,[</span>
  <span class="s4">'./base'</span><span class="s2">,</span>
  <span class="s4">'../utils'</span><span class="s2">,</span>
  <span class="s4">'jquery'</span>
<span class="s2">], </span><span class="s3">function </span><span class="s2">(</span><span class="s1">BaseAdapter</span><span class="s2">, </span><span class="s1">Utils</span><span class="s2">, </span><span class="s1">$</span><span class="s2">) {</span>
  <span class="s3">function </span><span class="s1">SelectAdapter </span><span class="s2">(</span><span class="s1">$element</span><span class="s2">, </span><span class="s1">options</span><span class="s2">) {</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">$element </span><span class="s2">= </span><span class="s1">$element</span><span class="s2">;</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">options </span><span class="s2">= </span><span class="s1">options</span><span class="s2">;</span>

    <span class="s1">SelectAdapter</span><span class="s2">.</span><span class="s1">__super__</span><span class="s2">.</span><span class="s1">constructor</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">);</span>
  <span class="s2">}</span>

  <span class="s1">Utils</span><span class="s2">.</span><span class="s1">Extend</span><span class="s2">(</span><span class="s1">SelectAdapter</span><span class="s2">, </span><span class="s1">BaseAdapter</span><span class="s2">);</span>

  <span class="s1">SelectAdapter</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">current </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">callback</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">data </span><span class="s2">= [];</span>
    <span class="s3">var </span><span class="s1">self </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">.</span><span class="s1">find</span><span class="s2">(</span><span class="s4">':selected'</span><span class="s2">).</span><span class="s1">each</span><span class="s2">(</span><span class="s3">function </span><span class="s2">() {</span>
      <span class="s3">var </span><span class="s1">$option </span><span class="s2">= </span><span class="s1">$</span><span class="s2">(</span><span class="s3">this</span><span class="s2">);</span>

      <span class="s3">var </span><span class="s1">option </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">item</span><span class="s2">(</span><span class="s1">$option</span><span class="s2">);</span>

      <span class="s1">data</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">option</span><span class="s2">);</span>
    <span class="s2">});</span>

    <span class="s1">callback</span><span class="s2">(</span><span class="s1">data</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s1">SelectAdapter</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">select </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">data</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">self </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>

    <span class="s1">data</span><span class="s2">.</span><span class="s1">selected </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>

    <span class="s0">// If data.element is a DOM node, use it instead</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">$</span><span class="s2">(</span><span class="s1">data</span><span class="s2">.</span><span class="s1">element</span><span class="s2">).</span><span class="s1">is</span><span class="s2">(</span><span class="s4">'option'</span><span class="s2">)) {</span>
      <span class="s1">data</span><span class="s2">.</span><span class="s1">element</span><span class="s2">.</span><span class="s1">selected </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>

      <span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'input'</span><span class="s2">).</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'change'</span><span class="s2">);</span>

      <span class="s3">return</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">.</span><span class="s1">prop</span><span class="s2">(</span><span class="s4">'multiple'</span><span class="s2">)) {</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">current</span><span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">currentData</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">val </span><span class="s2">= [];</span>

        <span class="s1">data </span><span class="s2">= [</span><span class="s1">data</span><span class="s2">];</span>
        <span class="s1">data</span><span class="s2">.</span><span class="s1">push</span><span class="s2">.</span><span class="s1">apply</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">currentData</span><span class="s2">);</span>

        <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">d </span><span class="s2">= </span><span class="s8">0</span><span class="s2">; </span><span class="s1">d </span><span class="s2">&lt; </span><span class="s1">data</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">d</span><span class="s2">++) {</span>
          <span class="s3">var </span><span class="s1">id </span><span class="s2">= </span><span class="s1">data</span><span class="s2">[</span><span class="s1">d</span><span class="s2">].</span><span class="s1">id</span><span class="s2">;</span>

          <span class="s3">if </span><span class="s2">(</span><span class="s1">$</span><span class="s2">.</span><span class="s1">inArray</span><span class="s2">(</span><span class="s1">id</span><span class="s2">, </span><span class="s1">val</span><span class="s2">) === -</span><span class="s8">1</span><span class="s2">) {</span>
            <span class="s1">val</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">id</span><span class="s2">);</span>
          <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">.</span><span class="s1">val</span><span class="s2">(</span><span class="s1">val</span><span class="s2">);</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'input'</span><span class="s2">).</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'change'</span><span class="s2">);</span>
      <span class="s2">});</span>
    <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
      <span class="s3">var </span><span class="s1">val </span><span class="s2">= </span><span class="s1">data</span><span class="s2">.</span><span class="s1">id</span><span class="s2">;</span>

      <span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">.</span><span class="s1">val</span><span class="s2">(</span><span class="s1">val</span><span class="s2">);</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'input'</span><span class="s2">).</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'change'</span><span class="s2">);</span>
    <span class="s2">}</span>
  <span class="s2">};</span>

  <span class="s1">SelectAdapter</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">unselect </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">data</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">self </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>

    <span class="s3">if </span><span class="s2">(!</span><span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">.</span><span class="s1">prop</span><span class="s2">(</span><span class="s4">'multiple'</span><span class="s2">)) {</span>
      <span class="s3">return</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s1">data</span><span class="s2">.</span><span class="s1">selected </span><span class="s2">= </span><span class="s3">false</span><span class="s2">;</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">$</span><span class="s2">(</span><span class="s1">data</span><span class="s2">.</span><span class="s1">element</span><span class="s2">).</span><span class="s1">is</span><span class="s2">(</span><span class="s4">'option'</span><span class="s2">)) {</span>
      <span class="s1">data</span><span class="s2">.</span><span class="s1">element</span><span class="s2">.</span><span class="s1">selected </span><span class="s2">= </span><span class="s3">false</span><span class="s2">;</span>

      <span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'input'</span><span class="s2">).</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'change'</span><span class="s2">);</span>

      <span class="s3">return</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">current</span><span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">currentData</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">val </span><span class="s2">= [];</span>

      <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">d </span><span class="s2">= </span><span class="s8">0</span><span class="s2">; </span><span class="s1">d </span><span class="s2">&lt; </span><span class="s1">currentData</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">d</span><span class="s2">++) {</span>
        <span class="s3">var </span><span class="s1">id </span><span class="s2">= </span><span class="s1">currentData</span><span class="s2">[</span><span class="s1">d</span><span class="s2">].</span><span class="s1">id</span><span class="s2">;</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">id </span><span class="s2">!== </span><span class="s1">data</span><span class="s2">.</span><span class="s1">id </span><span class="s2">&amp;&amp; </span><span class="s1">$</span><span class="s2">.</span><span class="s1">inArray</span><span class="s2">(</span><span class="s1">id</span><span class="s2">, </span><span class="s1">val</span><span class="s2">) === -</span><span class="s8">1</span><span class="s2">) {</span>
          <span class="s1">val</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">id</span><span class="s2">);</span>
        <span class="s2">}</span>
      <span class="s2">}</span>

      <span class="s1">self</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">.</span><span class="s1">val</span><span class="s2">(</span><span class="s1">val</span><span class="s2">);</span>

      <span class="s1">self</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'input'</span><span class="s2">).</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'change'</span><span class="s2">);</span>
    <span class="s2">});</span>
  <span class="s2">};</span>

  <span class="s1">SelectAdapter</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">bind </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">container</span><span class="s2">, </span><span class="s1">$container</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">self </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">container </span><span class="s2">= </span><span class="s1">container</span><span class="s2">;</span>

    <span class="s1">container</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'select'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">params</span><span class="s2">) {</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">select</span><span class="s2">(</span><span class="s1">params</span><span class="s2">.</span><span class="s1">data</span><span class="s2">);</span>
    <span class="s2">});</span>

    <span class="s1">container</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'unselect'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">params</span><span class="s2">) {</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">unselect</span><span class="s2">(</span><span class="s1">params</span><span class="s2">.</span><span class="s1">data</span><span class="s2">);</span>
    <span class="s2">});</span>
  <span class="s2">};</span>

  <span class="s1">SelectAdapter</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">destroy </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {</span>
    <span class="s0">// Remove anything added to child elements</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">.</span><span class="s1">find</span><span class="s2">(</span><span class="s4">'*'</span><span class="s2">).</span><span class="s1">each</span><span class="s2">(</span><span class="s3">function </span><span class="s2">() {</span>
      <span class="s0">// Remove any custom data set by Select2</span>
      <span class="s1">Utils</span><span class="s2">.</span><span class="s1">RemoveData</span><span class="s2">(</span><span class="s3">this</span><span class="s2">);</span>
    <span class="s2">});</span>
  <span class="s2">};</span>

  <span class="s1">SelectAdapter</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">query </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">params</span><span class="s2">, </span><span class="s1">callback</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">data </span><span class="s2">= [];</span>
    <span class="s3">var </span><span class="s1">self </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>

    <span class="s3">var </span><span class="s1">$options </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">.</span><span class="s1">children</span><span class="s2">();</span>

    <span class="s1">$options</span><span class="s2">.</span><span class="s1">each</span><span class="s2">(</span><span class="s3">function </span><span class="s2">() {</span>
      <span class="s3">var </span><span class="s1">$option </span><span class="s2">= </span><span class="s1">$</span><span class="s2">(</span><span class="s3">this</span><span class="s2">);</span>

      <span class="s3">if </span><span class="s2">(!</span><span class="s1">$option</span><span class="s2">.</span><span class="s1">is</span><span class="s2">(</span><span class="s4">'option'</span><span class="s2">) &amp;&amp; !</span><span class="s1">$option</span><span class="s2">.</span><span class="s1">is</span><span class="s2">(</span><span class="s4">'optgroup'</span><span class="s2">)) {</span>
        <span class="s3">return</span><span class="s2">;</span>
      <span class="s2">}</span>

      <span class="s3">var </span><span class="s1">option </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">item</span><span class="s2">(</span><span class="s1">$option</span><span class="s2">);</span>

      <span class="s3">var </span><span class="s1">matches </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">matches</span><span class="s2">(</span><span class="s1">params</span><span class="s2">, </span><span class="s1">option</span><span class="s2">);</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">matches </span><span class="s2">!== </span><span class="s3">null</span><span class="s2">) {</span>
        <span class="s1">data</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">matches</span><span class="s2">);</span>
      <span class="s2">}</span>
    <span class="s2">});</span>

    <span class="s1">callback</span><span class="s2">({</span>
      <span class="s1">results</span><span class="s2">: </span><span class="s1">data</span>
    <span class="s2">});</span>
  <span class="s2">};</span>

  <span class="s1">SelectAdapter</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">addOptions </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">$options</span><span class="s2">) {</span>
    <span class="s1">Utils</span><span class="s2">.</span><span class="s1">appendMany</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">, </span><span class="s1">$options</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s1">SelectAdapter</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">option </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">data</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">option</span><span class="s2">;</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">data</span><span class="s2">.</span><span class="s1">children</span><span class="s2">) {</span>
      <span class="s1">option </span><span class="s2">= </span><span class="s1">document</span><span class="s2">.</span><span class="s1">createElement</span><span class="s2">(</span><span class="s4">'optgroup'</span><span class="s2">);</span>
      <span class="s1">option</span><span class="s2">.</span><span class="s1">label </span><span class="s2">= </span><span class="s1">data</span><span class="s2">.</span><span class="s1">text</span><span class="s2">;</span>
    <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
      <span class="s1">option </span><span class="s2">= </span><span class="s1">document</span><span class="s2">.</span><span class="s1">createElement</span><span class="s2">(</span><span class="s4">'option'</span><span class="s2">);</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">option</span><span class="s2">.</span><span class="s1">textContent </span><span class="s2">!== </span><span class="s1">undefined</span><span class="s2">) {</span>
        <span class="s1">option</span><span class="s2">.</span><span class="s1">textContent </span><span class="s2">= </span><span class="s1">data</span><span class="s2">.</span><span class="s1">text</span><span class="s2">;</span>
      <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
        <span class="s1">option</span><span class="s2">.</span><span class="s1">innerText </span><span class="s2">= </span><span class="s1">data</span><span class="s2">.</span><span class="s1">text</span><span class="s2">;</span>
      <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">data</span><span class="s2">.</span><span class="s1">id </span><span class="s2">!== </span><span class="s1">undefined</span><span class="s2">) {</span>
      <span class="s1">option</span><span class="s2">.</span><span class="s1">value </span><span class="s2">= </span><span class="s1">data</span><span class="s2">.</span><span class="s1">id</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">data</span><span class="s2">.</span><span class="s1">disabled</span><span class="s2">) {</span>
      <span class="s1">option</span><span class="s2">.</span><span class="s1">disabled </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">data</span><span class="s2">.</span><span class="s1">selected</span><span class="s2">) {</span>
      <span class="s1">option</span><span class="s2">.</span><span class="s1">selected </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">data</span><span class="s2">.</span><span class="s1">title</span><span class="s2">) {</span>
      <span class="s1">option</span><span class="s2">.</span><span class="s1">title </span><span class="s2">= </span><span class="s1">data</span><span class="s2">.</span><span class="s1">title</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">var </span><span class="s1">$option </span><span class="s2">= </span><span class="s1">$</span><span class="s2">(</span><span class="s1">option</span><span class="s2">);</span>

    <span class="s3">var </span><span class="s1">normalizedData </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">_normalizeItem</span><span class="s2">(</span><span class="s1">data</span><span class="s2">);</span>
    <span class="s1">normalizedData</span><span class="s2">.</span><span class="s1">element </span><span class="s2">= </span><span class="s1">option</span><span class="s2">;</span>

    <span class="s0">// Override the option's data with the combined data</span>
    <span class="s1">Utils</span><span class="s2">.</span><span class="s1">StoreData</span><span class="s2">(</span><span class="s1">option</span><span class="s2">, </span><span class="s4">'data'</span><span class="s2">, </span><span class="s1">normalizedData</span><span class="s2">);</span>

    <span class="s3">return </span><span class="s1">$option</span><span class="s2">;</span>
  <span class="s2">};</span>

  <span class="s1">SelectAdapter</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">item </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">$option</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">data </span><span class="s2">= {};</span>

    <span class="s1">data </span><span class="s2">= </span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">GetData</span><span class="s2">(</span><span class="s1">$option</span><span class="s2">[</span><span class="s8">0</span><span class="s2">], </span><span class="s4">'data'</span><span class="s2">);</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">data </span><span class="s2">!= </span><span class="s3">null</span><span class="s2">) {</span>
      <span class="s3">return </span><span class="s1">data</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">$option</span><span class="s2">.</span><span class="s1">is</span><span class="s2">(</span><span class="s4">'option'</span><span class="s2">)) {</span>
      <span class="s1">data </span><span class="s2">= {</span>
        <span class="s1">id</span><span class="s2">: </span><span class="s1">$option</span><span class="s2">.</span><span class="s1">val</span><span class="s2">(),</span>
        <span class="s1">text</span><span class="s2">: </span><span class="s1">$option</span><span class="s2">.</span><span class="s1">text</span><span class="s2">(),</span>
        <span class="s1">disabled</span><span class="s2">: </span><span class="s1">$option</span><span class="s2">.</span><span class="s1">prop</span><span class="s2">(</span><span class="s4">'disabled'</span><span class="s2">),</span>
        <span class="s1">selected</span><span class="s2">: </span><span class="s1">$option</span><span class="s2">.</span><span class="s1">prop</span><span class="s2">(</span><span class="s4">'selected'</span><span class="s2">),</span>
        <span class="s1">title</span><span class="s2">: </span><span class="s1">$option</span><span class="s2">.</span><span class="s1">prop</span><span class="s2">(</span><span class="s4">'title'</span><span class="s2">)</span>
      <span class="s2">};</span>
    <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">$option</span><span class="s2">.</span><span class="s1">is</span><span class="s2">(</span><span class="s4">'optgroup'</span><span class="s2">)) {</span>
      <span class="s1">data </span><span class="s2">= {</span>
        <span class="s1">text</span><span class="s2">: </span><span class="s1">$option</span><span class="s2">.</span><span class="s1">prop</span><span class="s2">(</span><span class="s4">'label'</span><span class="s2">),</span>
        <span class="s1">children</span><span class="s2">: [],</span>
        <span class="s1">title</span><span class="s2">: </span><span class="s1">$option</span><span class="s2">.</span><span class="s1">prop</span><span class="s2">(</span><span class="s4">'title'</span><span class="s2">)</span>
      <span class="s2">};</span>

      <span class="s3">var </span><span class="s1">$children </span><span class="s2">= </span><span class="s1">$option</span><span class="s2">.</span><span class="s1">children</span><span class="s2">(</span><span class="s4">'option'</span><span class="s2">);</span>
      <span class="s3">var </span><span class="s1">children </span><span class="s2">= [];</span>

      <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">c </span><span class="s2">= </span><span class="s8">0</span><span class="s2">; </span><span class="s1">c </span><span class="s2">&lt; </span><span class="s1">$children</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">c</span><span class="s2">++) {</span>
        <span class="s3">var </span><span class="s1">$child </span><span class="s2">= </span><span class="s1">$</span><span class="s2">(</span><span class="s1">$children</span><span class="s2">[</span><span class="s1">c</span><span class="s2">]);</span>

        <span class="s3">var </span><span class="s1">child </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">item</span><span class="s2">(</span><span class="s1">$child</span><span class="s2">);</span>

        <span class="s1">children</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">child</span><span class="s2">);</span>
      <span class="s2">}</span>

      <span class="s1">data</span><span class="s2">.</span><span class="s1">children </span><span class="s2">= </span><span class="s1">children</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s1">data </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">_normalizeItem</span><span class="s2">(</span><span class="s1">data</span><span class="s2">);</span>
    <span class="s1">data</span><span class="s2">.</span><span class="s1">element </span><span class="s2">= </span><span class="s1">$option</span><span class="s2">[</span><span class="s8">0</span><span class="s2">];</span>

    <span class="s1">Utils</span><span class="s2">.</span><span class="s1">StoreData</span><span class="s2">(</span><span class="s1">$option</span><span class="s2">[</span><span class="s8">0</span><span class="s2">], </span><span class="s4">'data'</span><span class="s2">, </span><span class="s1">data</span><span class="s2">);</span>

    <span class="s3">return </span><span class="s1">data</span><span class="s2">;</span>
  <span class="s2">};</span>

  <span class="s1">SelectAdapter</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">_normalizeItem </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">item</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">item </span><span class="s2">!== </span><span class="s1">Object</span><span class="s2">(</span><span class="s1">item</span><span class="s2">)) {</span>
      <span class="s1">item </span><span class="s2">= {</span>
        <span class="s1">id</span><span class="s2">: </span><span class="s1">item</span><span class="s2">,</span>
        <span class="s1">text</span><span class="s2">: </span><span class="s1">item</span>
      <span class="s2">};</span>
    <span class="s2">}</span>

    <span class="s1">item </span><span class="s2">= </span><span class="s1">$</span><span class="s2">.</span><span class="s1">extend</span><span class="s2">({}, {</span>
      <span class="s1">text</span><span class="s2">: </span><span class="s4">''</span>
    <span class="s2">}, </span><span class="s1">item</span><span class="s2">);</span>

    <span class="s3">var </span><span class="s1">defaults </span><span class="s2">= {</span>
      <span class="s1">selected</span><span class="s2">: </span><span class="s3">false</span><span class="s2">,</span>
      <span class="s1">disabled</span><span class="s2">: </span><span class="s3">false</span>
    <span class="s2">};</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">item</span><span class="s2">.</span><span class="s1">id </span><span class="s2">!= </span><span class="s3">null</span><span class="s2">) {</span>
      <span class="s1">item</span><span class="s2">.</span><span class="s1">id </span><span class="s2">= </span><span class="s1">item</span><span class="s2">.</span><span class="s1">id</span><span class="s2">.</span><span class="s1">toString</span><span class="s2">();</span>
    <span class="s2">}</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">item</span><span class="s2">.</span><span class="s1">text </span><span class="s2">!= </span><span class="s3">null</span><span class="s2">) {</span>
      <span class="s1">item</span><span class="s2">.</span><span class="s1">text </span><span class="s2">= </span><span class="s1">item</span><span class="s2">.</span><span class="s1">text</span><span class="s2">.</span><span class="s1">toString</span><span class="s2">();</span>
    <span class="s2">}</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">item</span><span class="s2">.</span><span class="s1">_resultId </span><span class="s2">== </span><span class="s3">null </span><span class="s2">&amp;&amp; </span><span class="s1">item</span><span class="s2">.</span><span class="s1">id </span><span class="s2">&amp;&amp; </span><span class="s3">this</span><span class="s2">.</span><span class="s1">container </span><span class="s2">!= </span><span class="s3">null</span><span class="s2">) {</span>
      <span class="s1">item</span><span class="s2">.</span><span class="s1">_resultId </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">generateResultId</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">container</span><span class="s2">, </span><span class="s1">item</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">return </span><span class="s1">$</span><span class="s2">.</span><span class="s1">extend</span><span class="s2">({}, </span><span class="s1">defaults</span><span class="s2">, </span><span class="s1">item</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s1">SelectAdapter</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">matches </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">params</span><span class="s2">, </span><span class="s1">data</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">matcher </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'matcher'</span><span class="s2">);</span>

    <span class="s3">return </span><span class="s1">matcher</span><span class="s2">(</span><span class="s1">params</span><span class="s2">, </span><span class="s1">data</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s3">return </span><span class="s1">SelectAdapter</span><span class="s2">;</span>
<span class="s2">});</span>

<span class="s1">S2</span><span class="s2">.</span><span class="s1">define</span><span class="s2">(</span><span class="s4">'select2/data/array'</span><span class="s2">,[</span>
  <span class="s4">'./select'</span><span class="s2">,</span>
  <span class="s4">'../utils'</span><span class="s2">,</span>
  <span class="s4">'jquery'</span>
<span class="s2">], </span><span class="s3">function </span><span class="s2">(</span><span class="s1">SelectAdapter</span><span class="s2">, </span><span class="s1">Utils</span><span class="s2">, </span><span class="s1">$</span><span class="s2">) {</span>
  <span class="s3">function </span><span class="s1">ArrayAdapter </span><span class="s2">(</span><span class="s1">$element</span><span class="s2">, </span><span class="s1">options</span><span class="s2">) {</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">_dataToConvert </span><span class="s2">= </span><span class="s1">options</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'data'</span><span class="s2">) || [];</span>

    <span class="s1">ArrayAdapter</span><span class="s2">.</span><span class="s1">__super__</span><span class="s2">.</span><span class="s1">constructor</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">$element</span><span class="s2">, </span><span class="s1">options</span><span class="s2">);</span>
  <span class="s2">}</span>

  <span class="s1">Utils</span><span class="s2">.</span><span class="s1">Extend</span><span class="s2">(</span><span class="s1">ArrayAdapter</span><span class="s2">, </span><span class="s1">SelectAdapter</span><span class="s2">);</span>

  <span class="s1">ArrayAdapter</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">bind </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">container</span><span class="s2">, </span><span class="s1">$container</span><span class="s2">) {</span>
    <span class="s1">ArrayAdapter</span><span class="s2">.</span><span class="s1">__super__</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">container</span><span class="s2">, </span><span class="s1">$container</span><span class="s2">);</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">addOptions</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">convertToOptions</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">_dataToConvert</span><span class="s2">));</span>
  <span class="s2">};</span>

  <span class="s1">ArrayAdapter</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">select </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">data</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">$option </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">.</span><span class="s1">find</span><span class="s2">(</span><span class="s4">'option'</span><span class="s2">).</span><span class="s1">filter</span><span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">i</span><span class="s2">, </span><span class="s1">elm</span><span class="s2">) {</span>
      <span class="s3">return </span><span class="s1">elm</span><span class="s2">.</span><span class="s1">value </span><span class="s2">== </span><span class="s1">data</span><span class="s2">.</span><span class="s1">id</span><span class="s2">.</span><span class="s1">toString</span><span class="s2">();</span>
    <span class="s2">});</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">$option</span><span class="s2">.</span><span class="s1">length </span><span class="s2">=== </span><span class="s8">0</span><span class="s2">) {</span>
      <span class="s1">$option </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">option</span><span class="s2">(</span><span class="s1">data</span><span class="s2">);</span>

      <span class="s3">this</span><span class="s2">.</span><span class="s1">addOptions</span><span class="s2">(</span><span class="s1">$option</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s1">ArrayAdapter</span><span class="s2">.</span><span class="s1">__super__</span><span class="s2">.</span><span class="s1">select</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">data</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s1">ArrayAdapter</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">convertToOptions </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">data</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">self </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>

    <span class="s3">var </span><span class="s1">$existing </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">.</span><span class="s1">find</span><span class="s2">(</span><span class="s4">'option'</span><span class="s2">);</span>
    <span class="s3">var </span><span class="s1">existingIds </span><span class="s2">= </span><span class="s1">$existing</span><span class="s2">.</span><span class="s1">map</span><span class="s2">(</span><span class="s3">function </span><span class="s2">() {</span>
      <span class="s3">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">item</span><span class="s2">(</span><span class="s1">$</span><span class="s2">(</span><span class="s3">this</span><span class="s2">)).</span><span class="s1">id</span><span class="s2">;</span>
    <span class="s2">}).</span><span class="s1">get</span><span class="s2">();</span>

    <span class="s3">var </span><span class="s1">$options </span><span class="s2">= [];</span>

    <span class="s0">// Filter out all items except for the one passed in the argument</span>
    <span class="s3">function </span><span class="s1">onlyItem </span><span class="s2">(</span><span class="s1">item</span><span class="s2">) {</span>
      <span class="s3">return function </span><span class="s2">() {</span>
        <span class="s3">return </span><span class="s1">$</span><span class="s2">(</span><span class="s3">this</span><span class="s2">).</span><span class="s1">val</span><span class="s2">() == </span><span class="s1">item</span><span class="s2">.</span><span class="s1">id</span><span class="s2">;</span>
      <span class="s2">};</span>
    <span class="s2">}</span>

    <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">d </span><span class="s2">= </span><span class="s8">0</span><span class="s2">; </span><span class="s1">d </span><span class="s2">&lt; </span><span class="s1">data</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">d</span><span class="s2">++) {</span>
      <span class="s3">var </span><span class="s1">item </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">_normalizeItem</span><span class="s2">(</span><span class="s1">data</span><span class="s2">[</span><span class="s1">d</span><span class="s2">]);</span>

      <span class="s0">// Skip items which were pre-loaded, only merge the data</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">$</span><span class="s2">.</span><span class="s1">inArray</span><span class="s2">(</span><span class="s1">item</span><span class="s2">.</span><span class="s1">id</span><span class="s2">, </span><span class="s1">existingIds</span><span class="s2">) &gt;= </span><span class="s8">0</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">$existingOption </span><span class="s2">= </span><span class="s1">$existing</span><span class="s2">.</span><span class="s1">filter</span><span class="s2">(</span><span class="s1">onlyItem</span><span class="s2">(</span><span class="s1">item</span><span class="s2">));</span>

        <span class="s3">var </span><span class="s1">existingData </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">item</span><span class="s2">(</span><span class="s1">$existingOption</span><span class="s2">);</span>
        <span class="s3">var </span><span class="s1">newData </span><span class="s2">= </span><span class="s1">$</span><span class="s2">.</span><span class="s1">extend</span><span class="s2">(</span><span class="s3">true</span><span class="s2">, {}, </span><span class="s1">item</span><span class="s2">, </span><span class="s1">existingData</span><span class="s2">);</span>

        <span class="s3">var </span><span class="s1">$newOption </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">option</span><span class="s2">(</span><span class="s1">newData</span><span class="s2">);</span>

        <span class="s1">$existingOption</span><span class="s2">.</span><span class="s1">replaceWith</span><span class="s2">(</span><span class="s1">$newOption</span><span class="s2">);</span>

        <span class="s3">continue</span><span class="s2">;</span>
      <span class="s2">}</span>

      <span class="s3">var </span><span class="s1">$option </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">option</span><span class="s2">(</span><span class="s1">item</span><span class="s2">);</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">item</span><span class="s2">.</span><span class="s1">children</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">$children </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">convertToOptions</span><span class="s2">(</span><span class="s1">item</span><span class="s2">.</span><span class="s1">children</span><span class="s2">);</span>

        <span class="s1">Utils</span><span class="s2">.</span><span class="s1">appendMany</span><span class="s2">(</span><span class="s1">$option</span><span class="s2">, </span><span class="s1">$children</span><span class="s2">);</span>
      <span class="s2">}</span>

      <span class="s1">$options</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">$option</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">return </span><span class="s1">$options</span><span class="s2">;</span>
  <span class="s2">};</span>

  <span class="s3">return </span><span class="s1">ArrayAdapter</span><span class="s2">;</span>
<span class="s2">});</span>

<span class="s1">S2</span><span class="s2">.</span><span class="s1">define</span><span class="s2">(</span><span class="s4">'select2/data/ajax'</span><span class="s2">,[</span>
  <span class="s4">'./array'</span><span class="s2">,</span>
  <span class="s4">'../utils'</span><span class="s2">,</span>
  <span class="s4">'jquery'</span>
<span class="s2">], </span><span class="s3">function </span><span class="s2">(</span><span class="s1">ArrayAdapter</span><span class="s2">, </span><span class="s1">Utils</span><span class="s2">, </span><span class="s1">$</span><span class="s2">) {</span>
  <span class="s3">function </span><span class="s1">AjaxAdapter </span><span class="s2">(</span><span class="s1">$element</span><span class="s2">, </span><span class="s1">options</span><span class="s2">) {</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">ajaxOptions </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">_applyDefaults</span><span class="s2">(</span><span class="s1">options</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'ajax'</span><span class="s2">));</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">ajaxOptions</span><span class="s2">.</span><span class="s1">processResults </span><span class="s2">!= </span><span class="s3">null</span><span class="s2">) {</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">processResults </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">ajaxOptions</span><span class="s2">.</span><span class="s1">processResults</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s1">AjaxAdapter</span><span class="s2">.</span><span class="s1">__super__</span><span class="s2">.</span><span class="s1">constructor</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">$element</span><span class="s2">, </span><span class="s1">options</span><span class="s2">);</span>
  <span class="s2">}</span>

  <span class="s1">Utils</span><span class="s2">.</span><span class="s1">Extend</span><span class="s2">(</span><span class="s1">AjaxAdapter</span><span class="s2">, </span><span class="s1">ArrayAdapter</span><span class="s2">);</span>

  <span class="s1">AjaxAdapter</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">_applyDefaults </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">options</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">defaults </span><span class="s2">= {</span>
      <span class="s1">data</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">params</span><span class="s2">) {</span>
        <span class="s3">return </span><span class="s1">$</span><span class="s2">.</span><span class="s1">extend</span><span class="s2">({}, </span><span class="s1">params</span><span class="s2">, {</span>
          <span class="s1">q</span><span class="s2">: </span><span class="s1">params</span><span class="s2">.</span><span class="s1">term</span>
        <span class="s2">});</span>
      <span class="s2">},</span>
      <span class="s1">transport</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">params</span><span class="s2">, </span><span class="s1">success</span><span class="s2">, </span><span class="s1">failure</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">$request </span><span class="s2">= </span><span class="s1">$</span><span class="s2">.</span><span class="s1">ajax</span><span class="s2">(</span><span class="s1">params</span><span class="s2">);</span>

        <span class="s1">$request</span><span class="s2">.</span><span class="s1">then</span><span class="s2">(</span><span class="s1">success</span><span class="s2">);</span>
        <span class="s1">$request</span><span class="s2">.</span><span class="s1">fail</span><span class="s2">(</span><span class="s1">failure</span><span class="s2">);</span>

        <span class="s3">return </span><span class="s1">$request</span><span class="s2">;</span>
      <span class="s2">}</span>
    <span class="s2">};</span>

    <span class="s3">return </span><span class="s1">$</span><span class="s2">.</span><span class="s1">extend</span><span class="s2">({}, </span><span class="s1">defaults</span><span class="s2">, </span><span class="s1">options</span><span class="s2">, </span><span class="s3">true</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s1">AjaxAdapter</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">processResults </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">results</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">results</span><span class="s2">;</span>
  <span class="s2">};</span>

  <span class="s1">AjaxAdapter</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">query </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">params</span><span class="s2">, </span><span class="s1">callback</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">matches </span><span class="s2">= [];</span>
    <span class="s3">var </span><span class="s1">self </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">_request </span><span class="s2">!= </span><span class="s3">null</span><span class="s2">) {</span>
      <span class="s0">// JSONP requests cannot always be aborted</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">$</span><span class="s2">.</span><span class="s1">isFunction</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">_request</span><span class="s2">.</span><span class="s1">abort</span><span class="s2">)) {</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">_request</span><span class="s2">.</span><span class="s1">abort</span><span class="s2">();</span>
      <span class="s2">}</span>

      <span class="s3">this</span><span class="s2">.</span><span class="s1">_request </span><span class="s2">= </span><span class="s3">null</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">var </span><span class="s1">options </span><span class="s2">= </span><span class="s1">$</span><span class="s2">.</span><span class="s1">extend</span><span class="s2">({</span>
      <span class="s1">type</span><span class="s2">: </span><span class="s4">'GET'</span>
    <span class="s2">}, </span><span class="s3">this</span><span class="s2">.</span><span class="s1">ajaxOptions</span><span class="s2">);</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">options</span><span class="s2">.</span><span class="s1">url </span><span class="s2">=== </span><span class="s4">'function'</span><span class="s2">) {</span>
      <span class="s1">options</span><span class="s2">.</span><span class="s1">url </span><span class="s2">= </span><span class="s1">options</span><span class="s2">.</span><span class="s1">url</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">, </span><span class="s1">params</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">options</span><span class="s2">.</span><span class="s1">data </span><span class="s2">=== </span><span class="s4">'function'</span><span class="s2">) {</span>
      <span class="s1">options</span><span class="s2">.</span><span class="s1">data </span><span class="s2">= </span><span class="s1">options</span><span class="s2">.</span><span class="s1">data</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">, </span><span class="s1">params</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">request </span><span class="s2">() {</span>
      <span class="s3">var </span><span class="s1">$request </span><span class="s2">= </span><span class="s1">options</span><span class="s2">.</span><span class="s1">transport</span><span class="s2">(</span><span class="s1">options</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">data</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">results </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">processResults</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">params</span><span class="s2">);</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'debug'</span><span class="s2">) &amp;&amp; </span><span class="s1">window</span><span class="s2">.</span><span class="s1">console </span><span class="s2">&amp;&amp; </span><span class="s1">console</span><span class="s2">.</span><span class="s1">error</span><span class="s2">) {</span>
          <span class="s0">// Check to make sure that the response included a `results` key.</span>
          <span class="s3">if </span><span class="s2">(!</span><span class="s1">results </span><span class="s2">|| !</span><span class="s1">results</span><span class="s2">.</span><span class="s1">results </span><span class="s2">|| !</span><span class="s1">$</span><span class="s2">.</span><span class="s1">isArray</span><span class="s2">(</span><span class="s1">results</span><span class="s2">.</span><span class="s1">results</span><span class="s2">)) {</span>
            <span class="s1">console</span><span class="s2">.</span><span class="s1">error</span><span class="s2">(</span>
              <span class="s4">'Select2: The AJAX results did not return an array in the ' </span><span class="s2">+</span>
              <span class="s4">'`results` key of the response.'</span>
            <span class="s2">);</span>
          <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s1">callback</span><span class="s2">(</span><span class="s1">results</span><span class="s2">);</span>
      <span class="s2">}, </span><span class="s3">function </span><span class="s2">() {</span>
        <span class="s0">// Attempt to detect if a request was aborted</span>
        <span class="s0">// Only works if the transport exposes a status property</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s4">'status' </span><span class="s3">in </span><span class="s1">$request </span><span class="s2">&amp;&amp;</span>
            <span class="s2">(</span><span class="s1">$request</span><span class="s2">.</span><span class="s1">status </span><span class="s2">=== </span><span class="s8">0 </span><span class="s2">|| </span><span class="s1">$request</span><span class="s2">.</span><span class="s1">status </span><span class="s2">=== </span><span class="s4">'0'</span><span class="s2">)) {</span>
          <span class="s3">return</span><span class="s2">;</span>
        <span class="s2">}</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'results:message'</span><span class="s2">, {</span>
          <span class="s1">message</span><span class="s2">: </span><span class="s4">'errorLoading'</span>
        <span class="s2">});</span>
      <span class="s2">});</span>

      <span class="s1">self</span><span class="s2">.</span><span class="s1">_request </span><span class="s2">= </span><span class="s1">$request</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">ajaxOptions</span><span class="s2">.</span><span class="s1">delay </span><span class="s2">&amp;&amp; </span><span class="s1">params</span><span class="s2">.</span><span class="s1">term </span><span class="s2">!= </span><span class="s3">null</span><span class="s2">) {</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">_queryTimeout</span><span class="s2">) {</span>
        <span class="s1">window</span><span class="s2">.</span><span class="s1">clearTimeout</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">_queryTimeout</span><span class="s2">);</span>
      <span class="s2">}</span>

      <span class="s3">this</span><span class="s2">.</span><span class="s1">_queryTimeout </span><span class="s2">= </span><span class="s1">window</span><span class="s2">.</span><span class="s1">setTimeout</span><span class="s2">(</span><span class="s1">request</span><span class="s2">, </span><span class="s3">this</span><span class="s2">.</span><span class="s1">ajaxOptions</span><span class="s2">.</span><span class="s1">delay</span><span class="s2">);</span>
    <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
      <span class="s1">request</span><span class="s2">();</span>
    <span class="s2">}</span>
  <span class="s2">};</span>

  <span class="s3">return </span><span class="s1">AjaxAdapter</span><span class="s2">;</span>
<span class="s2">});</span>

<span class="s1">S2</span><span class="s2">.</span><span class="s1">define</span><span class="s2">(</span><span class="s4">'select2/data/tags'</span><span class="s2">,[</span>
  <span class="s4">'jquery'</span>
<span class="s2">], </span><span class="s3">function </span><span class="s2">(</span><span class="s1">$</span><span class="s2">) {</span>
  <span class="s3">function </span><span class="s1">Tags </span><span class="s2">(</span><span class="s1">decorated</span><span class="s2">, </span><span class="s1">$element</span><span class="s2">, </span><span class="s1">options</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">tags </span><span class="s2">= </span><span class="s1">options</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'tags'</span><span class="s2">);</span>

    <span class="s3">var </span><span class="s1">createTag </span><span class="s2">= </span><span class="s1">options</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'createTag'</span><span class="s2">);</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">createTag </span><span class="s2">!== </span><span class="s1">undefined</span><span class="s2">) {</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">createTag </span><span class="s2">= </span><span class="s1">createTag</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">var </span><span class="s1">insertTag </span><span class="s2">= </span><span class="s1">options</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'insertTag'</span><span class="s2">);</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">insertTag </span><span class="s2">!== </span><span class="s1">undefined</span><span class="s2">) {</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">insertTag </span><span class="s2">= </span><span class="s1">insertTag</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s1">decorated</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">$element</span><span class="s2">, </span><span class="s1">options</span><span class="s2">);</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">$</span><span class="s2">.</span><span class="s1">isArray</span><span class="s2">(</span><span class="s1">tags</span><span class="s2">)) {</span>
      <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">t </span><span class="s2">= </span><span class="s8">0</span><span class="s2">; </span><span class="s1">t </span><span class="s2">&lt; </span><span class="s1">tags</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">t</span><span class="s2">++) {</span>
        <span class="s3">var </span><span class="s1">tag </span><span class="s2">= </span><span class="s1">tags</span><span class="s2">[</span><span class="s1">t</span><span class="s2">];</span>
        <span class="s3">var </span><span class="s1">item </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">_normalizeItem</span><span class="s2">(</span><span class="s1">tag</span><span class="s2">);</span>

        <span class="s3">var </span><span class="s1">$option </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">option</span><span class="s2">(</span><span class="s1">item</span><span class="s2">);</span>

        <span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">$option</span><span class="s2">);</span>
      <span class="s2">}</span>
    <span class="s2">}</span>
  <span class="s2">}</span>

  <span class="s1">Tags</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">query </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">decorated</span><span class="s2">, </span><span class="s1">params</span><span class="s2">, </span><span class="s1">callback</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">self </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">_removeOldTags</span><span class="s2">();</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">params</span><span class="s2">.</span><span class="s1">term </span><span class="s2">== </span><span class="s3">null </span><span class="s2">|| </span><span class="s1">params</span><span class="s2">.</span><span class="s1">page </span><span class="s2">!= </span><span class="s3">null</span><span class="s2">) {</span>
      <span class="s1">decorated</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">params</span><span class="s2">, </span><span class="s1">callback</span><span class="s2">);</span>
      <span class="s3">return</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">wrapper </span><span class="s2">(</span><span class="s1">obj</span><span class="s2">, </span><span class="s1">child</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">data </span><span class="s2">= </span><span class="s1">obj</span><span class="s2">.</span><span class="s1">results</span><span class="s2">;</span>

      <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">i </span><span class="s2">= </span><span class="s8">0</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">data</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">i</span><span class="s2">++) {</span>
        <span class="s3">var </span><span class="s1">option </span><span class="s2">= </span><span class="s1">data</span><span class="s2">[</span><span class="s1">i</span><span class="s2">];</span>

        <span class="s3">var </span><span class="s1">checkChildren </span><span class="s2">= (</span>
          <span class="s1">option</span><span class="s2">.</span><span class="s1">children </span><span class="s2">!= </span><span class="s3">null </span><span class="s2">&amp;&amp;</span>
          <span class="s2">!</span><span class="s1">wrapper</span><span class="s2">({</span>
            <span class="s1">results</span><span class="s2">: </span><span class="s1">option</span><span class="s2">.</span><span class="s1">children</span>
          <span class="s2">}, </span><span class="s3">true</span><span class="s2">)</span>
        <span class="s2">);</span>

        <span class="s3">var </span><span class="s1">optionText </span><span class="s2">= (</span><span class="s1">option</span><span class="s2">.</span><span class="s1">text </span><span class="s2">|| </span><span class="s4">''</span><span class="s2">).</span><span class="s1">toUpperCase</span><span class="s2">();</span>
        <span class="s3">var </span><span class="s1">paramsTerm </span><span class="s2">= (</span><span class="s1">params</span><span class="s2">.</span><span class="s1">term </span><span class="s2">|| </span><span class="s4">''</span><span class="s2">).</span><span class="s1">toUpperCase</span><span class="s2">();</span>

        <span class="s3">var </span><span class="s1">checkText </span><span class="s2">= </span><span class="s1">optionText </span><span class="s2">=== </span><span class="s1">paramsTerm</span><span class="s2">;</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">checkText </span><span class="s2">|| </span><span class="s1">checkChildren</span><span class="s2">) {</span>
          <span class="s3">if </span><span class="s2">(</span><span class="s1">child</span><span class="s2">) {</span>
            <span class="s3">return false</span><span class="s2">;</span>
          <span class="s2">}</span>

          <span class="s1">obj</span><span class="s2">.</span><span class="s1">data </span><span class="s2">= </span><span class="s1">data</span><span class="s2">;</span>
          <span class="s1">callback</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">);</span>

          <span class="s3">return</span><span class="s2">;</span>
        <span class="s2">}</span>
      <span class="s2">}</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">child</span><span class="s2">) {</span>
        <span class="s3">return true</span><span class="s2">;</span>
      <span class="s2">}</span>

      <span class="s3">var </span><span class="s1">tag </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">createTag</span><span class="s2">(</span><span class="s1">params</span><span class="s2">);</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">tag </span><span class="s2">!= </span><span class="s3">null</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">$option </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">option</span><span class="s2">(</span><span class="s1">tag</span><span class="s2">);</span>
        <span class="s1">$option</span><span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'data-select2-tag'</span><span class="s2">, </span><span class="s3">true</span><span class="s2">);</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">addOptions</span><span class="s2">([</span><span class="s1">$option</span><span class="s2">]);</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">insertTag</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">tag</span><span class="s2">);</span>
      <span class="s2">}</span>

      <span class="s1">obj</span><span class="s2">.</span><span class="s1">results </span><span class="s2">= </span><span class="s1">data</span><span class="s2">;</span>

      <span class="s1">callback</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s1">decorated</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">params</span><span class="s2">, </span><span class="s1">wrapper</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s1">Tags</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">createTag </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">decorated</span><span class="s2">, </span><span class="s1">params</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">term </span><span class="s2">= </span><span class="s1">$</span><span class="s2">.</span><span class="s1">trim</span><span class="s2">(</span><span class="s1">params</span><span class="s2">.</span><span class="s1">term</span><span class="s2">);</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">term </span><span class="s2">=== </span><span class="s4">''</span><span class="s2">) {</span>
      <span class="s3">return null</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">return </span><span class="s2">{</span>
      <span class="s1">id</span><span class="s2">: </span><span class="s1">term</span><span class="s2">,</span>
      <span class="s1">text</span><span class="s2">: </span><span class="s1">term</span>
    <span class="s2">};</span>
  <span class="s2">};</span>

  <span class="s1">Tags</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">insertTag </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">_</span><span class="s2">, </span><span class="s1">data</span><span class="s2">, </span><span class="s1">tag</span><span class="s2">) {</span>
    <span class="s1">data</span><span class="s2">.</span><span class="s1">unshift</span><span class="s2">(</span><span class="s1">tag</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s1">Tags</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">_removeOldTags </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">_</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">$options </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">.</span><span class="s1">find</span><span class="s2">(</span><span class="s4">'option[data-select2-tag]'</span><span class="s2">);</span>

    <span class="s1">$options</span><span class="s2">.</span><span class="s1">each</span><span class="s2">(</span><span class="s3">function </span><span class="s2">() {</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">selected</span><span class="s2">) {</span>
        <span class="s3">return</span><span class="s2">;</span>
      <span class="s2">}</span>

      <span class="s1">$</span><span class="s2">(</span><span class="s3">this</span><span class="s2">).</span><span class="s1">remove</span><span class="s2">();</span>
    <span class="s2">});</span>
  <span class="s2">};</span>

  <span class="s3">return </span><span class="s1">Tags</span><span class="s2">;</span>
<span class="s2">});</span>

<span class="s1">S2</span><span class="s2">.</span><span class="s1">define</span><span class="s2">(</span><span class="s4">'select2/data/tokenizer'</span><span class="s2">,[</span>
  <span class="s4">'jquery'</span>
<span class="s2">], </span><span class="s3">function </span><span class="s2">(</span><span class="s1">$</span><span class="s2">) {</span>
  <span class="s3">function </span><span class="s1">Tokenizer </span><span class="s2">(</span><span class="s1">decorated</span><span class="s2">, </span><span class="s1">$element</span><span class="s2">, </span><span class="s1">options</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">tokenizer </span><span class="s2">= </span><span class="s1">options</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'tokenizer'</span><span class="s2">);</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">tokenizer </span><span class="s2">!== </span><span class="s1">undefined</span><span class="s2">) {</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">tokenizer </span><span class="s2">= </span><span class="s1">tokenizer</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s1">decorated</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">$element</span><span class="s2">, </span><span class="s1">options</span><span class="s2">);</span>
  <span class="s2">}</span>

  <span class="s1">Tokenizer</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">bind </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">decorated</span><span class="s2">, </span><span class="s1">container</span><span class="s2">, </span><span class="s1">$container</span><span class="s2">) {</span>
    <span class="s1">decorated</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">container</span><span class="s2">, </span><span class="s1">$container</span><span class="s2">);</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">$search </span><span class="s2">=  </span><span class="s1">container</span><span class="s2">.</span><span class="s1">dropdown</span><span class="s2">.</span><span class="s1">$search </span><span class="s2">|| </span><span class="s1">container</span><span class="s2">.</span><span class="s1">selection</span><span class="s2">.</span><span class="s1">$search </span><span class="s2">||</span>
      <span class="s1">$container</span><span class="s2">.</span><span class="s1">find</span><span class="s2">(</span><span class="s4">'.select2-search__field'</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s1">Tokenizer</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">query </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">decorated</span><span class="s2">, </span><span class="s1">params</span><span class="s2">, </span><span class="s1">callback</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">self </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>

    <span class="s3">function </span><span class="s1">createAndSelect </span><span class="s2">(</span><span class="s1">data</span><span class="s2">) {</span>
      <span class="s0">// Normalize the data object so we can use it for checks</span>
      <span class="s3">var </span><span class="s1">item </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_normalizeItem</span><span class="s2">(</span><span class="s1">data</span><span class="s2">);</span>

      <span class="s0">// Check if the data object already exists as a tag</span>
      <span class="s0">// Select it if it doesn't</span>
      <span class="s3">var </span><span class="s1">$existingOptions </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">.</span><span class="s1">find</span><span class="s2">(</span><span class="s4">'option'</span><span class="s2">).</span><span class="s1">filter</span><span class="s2">(</span><span class="s3">function </span><span class="s2">() {</span>
        <span class="s3">return </span><span class="s1">$</span><span class="s2">(</span><span class="s3">this</span><span class="s2">).</span><span class="s1">val</span><span class="s2">() === </span><span class="s1">item</span><span class="s2">.</span><span class="s1">id</span><span class="s2">;</span>
      <span class="s2">});</span>

      <span class="s0">// If an existing option wasn't found for it, create the option</span>
      <span class="s3">if </span><span class="s2">(!</span><span class="s1">$existingOptions</span><span class="s2">.</span><span class="s1">length</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">$option </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">option</span><span class="s2">(</span><span class="s1">item</span><span class="s2">);</span>
        <span class="s1">$option</span><span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'data-select2-tag'</span><span class="s2">, </span><span class="s3">true</span><span class="s2">);</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">_removeOldTags</span><span class="s2">();</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">addOptions</span><span class="s2">([</span><span class="s1">$option</span><span class="s2">]);</span>
      <span class="s2">}</span>

      <span class="s0">// Select the item, now that we know there is an option for it</span>
      <span class="s1">select</span><span class="s2">(</span><span class="s1">item</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">select </span><span class="s2">(</span><span class="s1">data</span><span class="s2">) {</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'select'</span><span class="s2">, {</span>
        <span class="s1">data</span><span class="s2">: </span><span class="s1">data</span>
      <span class="s2">});</span>
    <span class="s2">}</span>

    <span class="s1">params</span><span class="s2">.</span><span class="s1">term </span><span class="s2">= </span><span class="s1">params</span><span class="s2">.</span><span class="s1">term </span><span class="s2">|| </span><span class="s4">''</span><span class="s2">;</span>

    <span class="s3">var </span><span class="s1">tokenData </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">tokenizer</span><span class="s2">(</span><span class="s1">params</span><span class="s2">, </span><span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">, </span><span class="s1">createAndSelect</span><span class="s2">);</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">tokenData</span><span class="s2">.</span><span class="s1">term </span><span class="s2">!== </span><span class="s1">params</span><span class="s2">.</span><span class="s1">term</span><span class="s2">) {</span>
      <span class="s0">// Replace the search term if we have the search box</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">$search</span><span class="s2">.</span><span class="s1">length</span><span class="s2">) {</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">$search</span><span class="s2">.</span><span class="s1">val</span><span class="s2">(</span><span class="s1">tokenData</span><span class="s2">.</span><span class="s1">term</span><span class="s2">);</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">$search</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'focus'</span><span class="s2">);</span>
      <span class="s2">}</span>

      <span class="s1">params</span><span class="s2">.</span><span class="s1">term </span><span class="s2">= </span><span class="s1">tokenData</span><span class="s2">.</span><span class="s1">term</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s1">decorated</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">params</span><span class="s2">, </span><span class="s1">callback</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s1">Tokenizer</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">tokenizer </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">_</span><span class="s2">, </span><span class="s1">params</span><span class="s2">, </span><span class="s1">options</span><span class="s2">, </span><span class="s1">callback</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">separators </span><span class="s2">= </span><span class="s1">options</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'tokenSeparators'</span><span class="s2">) || [];</span>
    <span class="s3">var </span><span class="s1">term </span><span class="s2">= </span><span class="s1">params</span><span class="s2">.</span><span class="s1">term</span><span class="s2">;</span>
    <span class="s3">var </span><span class="s1">i </span><span class="s2">= </span><span class="s8">0</span><span class="s2">;</span>

    <span class="s3">var </span><span class="s1">createTag </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">createTag </span><span class="s2">|| </span><span class="s3">function </span><span class="s2">(</span><span class="s1">params</span><span class="s2">) {</span>
      <span class="s3">return </span><span class="s2">{</span>
        <span class="s1">id</span><span class="s2">: </span><span class="s1">params</span><span class="s2">.</span><span class="s1">term</span><span class="s2">,</span>
        <span class="s1">text</span><span class="s2">: </span><span class="s1">params</span><span class="s2">.</span><span class="s1">term</span>
      <span class="s2">};</span>
    <span class="s2">};</span>

    <span class="s3">while </span><span class="s2">(</span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">term</span><span class="s2">.</span><span class="s1">length</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">termChar </span><span class="s2">= </span><span class="s1">term</span><span class="s2">[</span><span class="s1">i</span><span class="s2">];</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">$</span><span class="s2">.</span><span class="s1">inArray</span><span class="s2">(</span><span class="s1">termChar</span><span class="s2">, </span><span class="s1">separators</span><span class="s2">) === -</span><span class="s8">1</span><span class="s2">) {</span>
        <span class="s1">i</span><span class="s2">++;</span>

        <span class="s3">continue</span><span class="s2">;</span>
      <span class="s2">}</span>

      <span class="s3">var </span><span class="s1">part </span><span class="s2">= </span><span class="s1">term</span><span class="s2">.</span><span class="s1">substr</span><span class="s2">(</span><span class="s8">0</span><span class="s2">, </span><span class="s1">i</span><span class="s2">);</span>
      <span class="s3">var </span><span class="s1">partParams </span><span class="s2">= </span><span class="s1">$</span><span class="s2">.</span><span class="s1">extend</span><span class="s2">({}, </span><span class="s1">params</span><span class="s2">, {</span>
        <span class="s1">term</span><span class="s2">: </span><span class="s1">part</span>
      <span class="s2">});</span>

      <span class="s3">var </span><span class="s1">data </span><span class="s2">= </span><span class="s1">createTag</span><span class="s2">(</span><span class="s1">partParams</span><span class="s2">);</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">data </span><span class="s2">== </span><span class="s3">null</span><span class="s2">) {</span>
        <span class="s1">i</span><span class="s2">++;</span>
        <span class="s3">continue</span><span class="s2">;</span>
      <span class="s2">}</span>

      <span class="s1">callback</span><span class="s2">(</span><span class="s1">data</span><span class="s2">);</span>

      <span class="s0">// Reset the term to not include the tokenized portion</span>
      <span class="s1">term </span><span class="s2">= </span><span class="s1">term</span><span class="s2">.</span><span class="s1">substr</span><span class="s2">(</span><span class="s1">i </span><span class="s2">+ </span><span class="s8">1</span><span class="s2">) || </span><span class="s4">''</span><span class="s2">;</span>
      <span class="s1">i </span><span class="s2">= </span><span class="s8">0</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">return </span><span class="s2">{</span>
      <span class="s1">term</span><span class="s2">: </span><span class="s1">term</span>
    <span class="s2">};</span>
  <span class="s2">};</span>

  <span class="s3">return </span><span class="s1">Tokenizer</span><span class="s2">;</span>
<span class="s2">});</span>

<span class="s1">S2</span><span class="s2">.</span><span class="s1">define</span><span class="s2">(</span><span class="s4">'select2/data/minimumInputLength'</span><span class="s2">,[</span>

<span class="s2">], </span><span class="s3">function </span><span class="s2">() {</span>
  <span class="s3">function </span><span class="s1">MinimumInputLength </span><span class="s2">(</span><span class="s1">decorated</span><span class="s2">, </span><span class="s1">$e</span><span class="s2">, </span><span class="s1">options</span><span class="s2">) {</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">minimumInputLength </span><span class="s2">= </span><span class="s1">options</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'minimumInputLength'</span><span class="s2">);</span>

    <span class="s1">decorated</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">$e</span><span class="s2">, </span><span class="s1">options</span><span class="s2">);</span>
  <span class="s2">}</span>

  <span class="s1">MinimumInputLength</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">query </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">decorated</span><span class="s2">, </span><span class="s1">params</span><span class="s2">, </span><span class="s1">callback</span><span class="s2">) {</span>
    <span class="s1">params</span><span class="s2">.</span><span class="s1">term </span><span class="s2">= </span><span class="s1">params</span><span class="s2">.</span><span class="s1">term </span><span class="s2">|| </span><span class="s4">''</span><span class="s2">;</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">params</span><span class="s2">.</span><span class="s1">term</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&lt; </span><span class="s3">this</span><span class="s2">.</span><span class="s1">minimumInputLength</span><span class="s2">) {</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'results:message'</span><span class="s2">, {</span>
        <span class="s1">message</span><span class="s2">: </span><span class="s4">'inputTooShort'</span><span class="s2">,</span>
        <span class="s1">args</span><span class="s2">: {</span>
          <span class="s1">minimum</span><span class="s2">: </span><span class="s3">this</span><span class="s2">.</span><span class="s1">minimumInputLength</span><span class="s2">,</span>
          <span class="s1">input</span><span class="s2">: </span><span class="s1">params</span><span class="s2">.</span><span class="s1">term</span><span class="s2">,</span>
          <span class="s1">params</span><span class="s2">: </span><span class="s1">params</span>
        <span class="s2">}</span>
      <span class="s2">});</span>

      <span class="s3">return</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s1">decorated</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">params</span><span class="s2">, </span><span class="s1">callback</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s3">return </span><span class="s1">MinimumInputLength</span><span class="s2">;</span>
<span class="s2">});</span>

<span class="s1">S2</span><span class="s2">.</span><span class="s1">define</span><span class="s2">(</span><span class="s4">'select2/data/maximumInputLength'</span><span class="s2">,[</span>

<span class="s2">], </span><span class="s3">function </span><span class="s2">() {</span>
  <span class="s3">function </span><span class="s1">MaximumInputLength </span><span class="s2">(</span><span class="s1">decorated</span><span class="s2">, </span><span class="s1">$e</span><span class="s2">, </span><span class="s1">options</span><span class="s2">) {</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">maximumInputLength </span><span class="s2">= </span><span class="s1">options</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'maximumInputLength'</span><span class="s2">);</span>

    <span class="s1">decorated</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">$e</span><span class="s2">, </span><span class="s1">options</span><span class="s2">);</span>
  <span class="s2">}</span>

  <span class="s1">MaximumInputLength</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">query </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">decorated</span><span class="s2">, </span><span class="s1">params</span><span class="s2">, </span><span class="s1">callback</span><span class="s2">) {</span>
    <span class="s1">params</span><span class="s2">.</span><span class="s1">term </span><span class="s2">= </span><span class="s1">params</span><span class="s2">.</span><span class="s1">term </span><span class="s2">|| </span><span class="s4">''</span><span class="s2">;</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">maximumInputLength </span><span class="s2">&gt; </span><span class="s8">0 </span><span class="s2">&amp;&amp;</span>
        <span class="s1">params</span><span class="s2">.</span><span class="s1">term</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt; </span><span class="s3">this</span><span class="s2">.</span><span class="s1">maximumInputLength</span><span class="s2">) {</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'results:message'</span><span class="s2">, {</span>
        <span class="s1">message</span><span class="s2">: </span><span class="s4">'inputTooLong'</span><span class="s2">,</span>
        <span class="s1">args</span><span class="s2">: {</span>
          <span class="s1">maximum</span><span class="s2">: </span><span class="s3">this</span><span class="s2">.</span><span class="s1">maximumInputLength</span><span class="s2">,</span>
          <span class="s1">input</span><span class="s2">: </span><span class="s1">params</span><span class="s2">.</span><span class="s1">term</span><span class="s2">,</span>
          <span class="s1">params</span><span class="s2">: </span><span class="s1">params</span>
        <span class="s2">}</span>
      <span class="s2">});</span>

      <span class="s3">return</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s1">decorated</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">params</span><span class="s2">, </span><span class="s1">callback</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s3">return </span><span class="s1">MaximumInputLength</span><span class="s2">;</span>
<span class="s2">});</span>

<span class="s1">S2</span><span class="s2">.</span><span class="s1">define</span><span class="s2">(</span><span class="s4">'select2/data/maximumSelectionLength'</span><span class="s2">,[</span>

<span class="s2">], </span><span class="s3">function </span><span class="s2">(){</span>
  <span class="s3">function </span><span class="s1">MaximumSelectionLength </span><span class="s2">(</span><span class="s1">decorated</span><span class="s2">, </span><span class="s1">$e</span><span class="s2">, </span><span class="s1">options</span><span class="s2">) {</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">maximumSelectionLength </span><span class="s2">= </span><span class="s1">options</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'maximumSelectionLength'</span><span class="s2">);</span>

    <span class="s1">decorated</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">$e</span><span class="s2">, </span><span class="s1">options</span><span class="s2">);</span>
  <span class="s2">}</span>

  <span class="s1">MaximumSelectionLength</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">bind </span><span class="s2">=</span>
    <span class="s3">function </span><span class="s2">(</span><span class="s1">decorated</span><span class="s2">, </span><span class="s1">container</span><span class="s2">, </span><span class="s1">$container</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">self </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>

      <span class="s1">decorated</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">container</span><span class="s2">, </span><span class="s1">$container</span><span class="s2">);</span>

      <span class="s1">container</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'select'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">() {</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_checkIfMaximumSelected</span><span class="s2">();</span>
      <span class="s2">});</span>
  <span class="s2">};</span>

  <span class="s1">MaximumSelectionLength</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">query </span><span class="s2">=</span>
    <span class="s3">function </span><span class="s2">(</span><span class="s1">decorated</span><span class="s2">, </span><span class="s1">params</span><span class="s2">, </span><span class="s1">callback</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">self </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>

      <span class="s3">this</span><span class="s2">.</span><span class="s1">_checkIfMaximumSelected</span><span class="s2">(</span><span class="s3">function </span><span class="s2">() {</span>
        <span class="s1">decorated</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">params</span><span class="s2">, </span><span class="s1">callback</span><span class="s2">);</span>
      <span class="s2">});</span>
  <span class="s2">};</span>

  <span class="s1">MaximumSelectionLength</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">_checkIfMaximumSelected </span><span class="s2">=</span>
    <span class="s3">function </span><span class="s2">(</span><span class="s1">_</span><span class="s2">, </span><span class="s1">successCallback</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">self </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>

      <span class="s3">this</span><span class="s2">.</span><span class="s1">current</span><span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">currentData</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">count </span><span class="s2">= </span><span class="s1">currentData </span><span class="s2">!= </span><span class="s3">null </span><span class="s2">? </span><span class="s1">currentData</span><span class="s2">.</span><span class="s1">length </span><span class="s2">: </span><span class="s8">0</span><span class="s2">;</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">maximumSelectionLength </span><span class="s2">&gt; </span><span class="s8">0 </span><span class="s2">&amp;&amp;</span>
          <span class="s1">count </span><span class="s2">&gt;= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">maximumSelectionLength</span><span class="s2">) {</span>
          <span class="s1">self</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'results:message'</span><span class="s2">, {</span>
            <span class="s1">message</span><span class="s2">: </span><span class="s4">'maximumSelected'</span><span class="s2">,</span>
            <span class="s1">args</span><span class="s2">: {</span>
              <span class="s1">maximum</span><span class="s2">: </span><span class="s1">self</span><span class="s2">.</span><span class="s1">maximumSelectionLength</span>
            <span class="s2">}</span>
          <span class="s2">});</span>
          <span class="s3">return</span><span class="s2">;</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">successCallback</span><span class="s2">) {</span>
          <span class="s1">successCallback</span><span class="s2">();</span>
        <span class="s2">}</span>
      <span class="s2">});</span>
  <span class="s2">};</span>

  <span class="s3">return </span><span class="s1">MaximumSelectionLength</span><span class="s2">;</span>
<span class="s2">});</span>

<span class="s1">S2</span><span class="s2">.</span><span class="s1">define</span><span class="s2">(</span><span class="s4">'select2/dropdown'</span><span class="s2">,[</span>
  <span class="s4">'jquery'</span><span class="s2">,</span>
  <span class="s4">'./utils'</span>
<span class="s2">], </span><span class="s3">function </span><span class="s2">(</span><span class="s1">$</span><span class="s2">, </span><span class="s1">Utils</span><span class="s2">) {</span>
  <span class="s3">function </span><span class="s1">Dropdown </span><span class="s2">(</span><span class="s1">$element</span><span class="s2">, </span><span class="s1">options</span><span class="s2">) {</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">$element </span><span class="s2">= </span><span class="s1">$element</span><span class="s2">;</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">options </span><span class="s2">= </span><span class="s1">options</span><span class="s2">;</span>

    <span class="s1">Dropdown</span><span class="s2">.</span><span class="s1">__super__</span><span class="s2">.</span><span class="s1">constructor</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">);</span>
  <span class="s2">}</span>

  <span class="s1">Utils</span><span class="s2">.</span><span class="s1">Extend</span><span class="s2">(</span><span class="s1">Dropdown</span><span class="s2">, </span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">Observable</span><span class="s2">);</span>

  <span class="s1">Dropdown</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">render </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {</span>
    <span class="s3">var </span><span class="s1">$dropdown </span><span class="s2">= </span><span class="s1">$</span><span class="s2">(</span>
      <span class="s4">'&lt;span class=&quot;select2-dropdown&quot;&gt;' </span><span class="s2">+</span>
        <span class="s4">'&lt;span class=&quot;select2-results&quot;&gt;&lt;/span&gt;' </span><span class="s2">+</span>
      <span class="s4">'&lt;/span&gt;'</span>
    <span class="s2">);</span>

    <span class="s1">$dropdown</span><span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'dir'</span><span class="s2">, </span><span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'dir'</span><span class="s2">));</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">$dropdown </span><span class="s2">= </span><span class="s1">$dropdown</span><span class="s2">;</span>

    <span class="s3">return </span><span class="s1">$dropdown</span><span class="s2">;</span>
  <span class="s2">};</span>

  <span class="s1">Dropdown</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">bind </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {</span>
    <span class="s0">// Should be implemented in subclasses</span>
  <span class="s2">};</span>

  <span class="s1">Dropdown</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">position </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">$dropdown</span><span class="s2">, </span><span class="s1">$container</span><span class="s2">) {</span>
    <span class="s0">// Should be implemented in subclasses</span>
  <span class="s2">};</span>

  <span class="s1">Dropdown</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">destroy </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {</span>
    <span class="s0">// Remove the dropdown from the DOM</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">$dropdown</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">();</span>
  <span class="s2">};</span>

  <span class="s3">return </span><span class="s1">Dropdown</span><span class="s2">;</span>
<span class="s2">});</span>

<span class="s1">S2</span><span class="s2">.</span><span class="s1">define</span><span class="s2">(</span><span class="s4">'select2/dropdown/search'</span><span class="s2">,[</span>
  <span class="s4">'jquery'</span><span class="s2">,</span>
  <span class="s4">'../utils'</span>
<span class="s2">], </span><span class="s3">function </span><span class="s2">(</span><span class="s1">$</span><span class="s2">, </span><span class="s1">Utils</span><span class="s2">) {</span>
  <span class="s3">function </span><span class="s1">Search </span><span class="s2">() { }</span>

  <span class="s1">Search</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">render </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">decorated</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">$rendered </span><span class="s2">= </span><span class="s1">decorated</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">);</span>

    <span class="s3">var </span><span class="s1">$search </span><span class="s2">= </span><span class="s1">$</span><span class="s2">(</span>
      <span class="s4">'&lt;span class=&quot;select2-search select2-search--dropdown&quot;&gt;' </span><span class="s2">+</span>
        <span class="s4">'&lt;input class=&quot;select2-search__field&quot; type=&quot;search&quot; tabindex=&quot;-1&quot;' </span><span class="s2">+</span>
        <span class="s4">' autocomplete=&quot;off&quot; autocorrect=&quot;off&quot; autocapitalize=&quot;none&quot;' </span><span class="s2">+</span>
        <span class="s4">' spellcheck=&quot;false&quot; role=&quot;searchbox&quot; aria-autocomplete=&quot;list&quot; /&gt;' </span><span class="s2">+</span>
      <span class="s4">'&lt;/span&gt;'</span>
    <span class="s2">);</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">$searchContainer </span><span class="s2">= </span><span class="s1">$search</span><span class="s2">;</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">$search </span><span class="s2">= </span><span class="s1">$search</span><span class="s2">.</span><span class="s1">find</span><span class="s2">(</span><span class="s4">'input'</span><span class="s2">);</span>

    <span class="s1">$rendered</span><span class="s2">.</span><span class="s1">prepend</span><span class="s2">(</span><span class="s1">$search</span><span class="s2">);</span>

    <span class="s3">return </span><span class="s1">$rendered</span><span class="s2">;</span>
  <span class="s2">};</span>

  <span class="s1">Search</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">bind </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">decorated</span><span class="s2">, </span><span class="s1">container</span><span class="s2">, </span><span class="s1">$container</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">self </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>

    <span class="s3">var </span><span class="s1">resultsId </span><span class="s2">= </span><span class="s1">container</span><span class="s2">.</span><span class="s1">id </span><span class="s2">+ </span><span class="s4">'-results'</span><span class="s2">;</span>

    <span class="s1">decorated</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">container</span><span class="s2">, </span><span class="s1">$container</span><span class="s2">);</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">$search</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'keydown'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">evt</span><span class="s2">) {</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'keypress'</span><span class="s2">, </span><span class="s1">evt</span><span class="s2">);</span>

      <span class="s1">self</span><span class="s2">.</span><span class="s1">_keyUpPrevented </span><span class="s2">= </span><span class="s1">evt</span><span class="s2">.</span><span class="s1">isDefaultPrevented</span><span class="s2">();</span>
    <span class="s2">});</span>

    <span class="s0">// Workaround for browsers which do not support the `input` event</span>
    <span class="s0">// This will prevent double-triggering of events for browsers which support</span>
    <span class="s0">// both the `keyup` and `input` events.</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">$search</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'input'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">evt</span><span class="s2">) {</span>
      <span class="s0">// Unbind the duplicated `keyup` event</span>
      <span class="s1">$</span><span class="s2">(</span><span class="s3">this</span><span class="s2">).</span><span class="s1">off</span><span class="s2">(</span><span class="s4">'keyup'</span><span class="s2">);</span>
    <span class="s2">});</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">$search</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'keyup input'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">evt</span><span class="s2">) {</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">handleSearch</span><span class="s2">(</span><span class="s1">evt</span><span class="s2">);</span>
    <span class="s2">});</span>

    <span class="s1">container</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'open'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">() {</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">$search</span><span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'tabindex'</span><span class="s2">, </span><span class="s8">0</span><span class="s2">);</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">$search</span><span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'aria-controls'</span><span class="s2">, </span><span class="s1">resultsId</span><span class="s2">);</span>

      <span class="s1">self</span><span class="s2">.</span><span class="s1">$search</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'focus'</span><span class="s2">);</span>

      <span class="s1">window</span><span class="s2">.</span><span class="s1">setTimeout</span><span class="s2">(</span><span class="s3">function </span><span class="s2">() {</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">$search</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'focus'</span><span class="s2">);</span>
      <span class="s2">}, </span><span class="s8">0</span><span class="s2">);</span>
    <span class="s2">});</span>

    <span class="s1">container</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'close'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">() {</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">$search</span><span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'tabindex'</span><span class="s2">, -</span><span class="s8">1</span><span class="s2">);</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">$search</span><span class="s2">.</span><span class="s1">removeAttr</span><span class="s2">(</span><span class="s4">'aria-controls'</span><span class="s2">);</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">$search</span><span class="s2">.</span><span class="s1">removeAttr</span><span class="s2">(</span><span class="s4">'aria-activedescendant'</span><span class="s2">);</span>

      <span class="s1">self</span><span class="s2">.</span><span class="s1">$search</span><span class="s2">.</span><span class="s1">val</span><span class="s2">(</span><span class="s4">''</span><span class="s2">);</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">$search</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'blur'</span><span class="s2">);</span>
    <span class="s2">});</span>

    <span class="s1">container</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'focus'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">() {</span>
      <span class="s3">if </span><span class="s2">(!</span><span class="s1">container</span><span class="s2">.</span><span class="s1">isOpen</span><span class="s2">()) {</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">$search</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'focus'</span><span class="s2">);</span>
      <span class="s2">}</span>
    <span class="s2">});</span>

    <span class="s1">container</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'results:all'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">params</span><span class="s2">) {</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">params</span><span class="s2">.</span><span class="s1">query</span><span class="s2">.</span><span class="s1">term </span><span class="s2">== </span><span class="s3">null </span><span class="s2">|| </span><span class="s1">params</span><span class="s2">.</span><span class="s1">query</span><span class="s2">.</span><span class="s1">term </span><span class="s2">=== </span><span class="s4">''</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">showSearch </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">showSearch</span><span class="s2">(</span><span class="s1">params</span><span class="s2">);</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">showSearch</span><span class="s2">) {</span>
          <span class="s1">self</span><span class="s2">.</span><span class="s1">$searchContainer</span><span class="s2">.</span><span class="s1">removeClass</span><span class="s2">(</span><span class="s4">'select2-search--hide'</span><span class="s2">);</span>
        <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
          <span class="s1">self</span><span class="s2">.</span><span class="s1">$searchContainer</span><span class="s2">.</span><span class="s1">addClass</span><span class="s2">(</span><span class="s4">'select2-search--hide'</span><span class="s2">);</span>
        <span class="s2">}</span>
      <span class="s2">}</span>
    <span class="s2">});</span>

    <span class="s1">container</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'results:focus'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">params</span><span class="s2">) {</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">params</span><span class="s2">.</span><span class="s1">data</span><span class="s2">.</span><span class="s1">_resultId</span><span class="s2">) {</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">$search</span><span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'aria-activedescendant'</span><span class="s2">, </span><span class="s1">params</span><span class="s2">.</span><span class="s1">data</span><span class="s2">.</span><span class="s1">_resultId</span><span class="s2">);</span>
      <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">$search</span><span class="s2">.</span><span class="s1">removeAttr</span><span class="s2">(</span><span class="s4">'aria-activedescendant'</span><span class="s2">);</span>
      <span class="s2">}</span>
    <span class="s2">});</span>
  <span class="s2">};</span>

  <span class="s1">Search</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">handleSearch </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">evt</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(!</span><span class="s3">this</span><span class="s2">.</span><span class="s1">_keyUpPrevented</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">input </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">$search</span><span class="s2">.</span><span class="s1">val</span><span class="s2">();</span>

      <span class="s3">this</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'query'</span><span class="s2">, {</span>
        <span class="s1">term</span><span class="s2">: </span><span class="s1">input</span>
      <span class="s2">});</span>
    <span class="s2">}</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">_keyUpPrevented </span><span class="s2">= </span><span class="s3">false</span><span class="s2">;</span>
  <span class="s2">};</span>

  <span class="s1">Search</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">showSearch </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">_</span><span class="s2">, </span><span class="s1">params</span><span class="s2">) {</span>
    <span class="s3">return true</span><span class="s2">;</span>
  <span class="s2">};</span>

  <span class="s3">return </span><span class="s1">Search</span><span class="s2">;</span>
<span class="s2">});</span>

<span class="s1">S2</span><span class="s2">.</span><span class="s1">define</span><span class="s2">(</span><span class="s4">'select2/dropdown/hidePlaceholder'</span><span class="s2">,[</span>

<span class="s2">], </span><span class="s3">function </span><span class="s2">() {</span>
  <span class="s3">function </span><span class="s1">HidePlaceholder </span><span class="s2">(</span><span class="s1">decorated</span><span class="s2">, </span><span class="s1">$element</span><span class="s2">, </span><span class="s1">options</span><span class="s2">, </span><span class="s1">dataAdapter</span><span class="s2">) {</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">placeholder </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">normalizePlaceholder</span><span class="s2">(</span><span class="s1">options</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'placeholder'</span><span class="s2">));</span>

    <span class="s1">decorated</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">$element</span><span class="s2">, </span><span class="s1">options</span><span class="s2">, </span><span class="s1">dataAdapter</span><span class="s2">);</span>
  <span class="s2">}</span>

  <span class="s1">HidePlaceholder</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">append </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">decorated</span><span class="s2">, </span><span class="s1">data</span><span class="s2">) {</span>
    <span class="s1">data</span><span class="s2">.</span><span class="s1">results </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">removePlaceholder</span><span class="s2">(</span><span class="s1">data</span><span class="s2">.</span><span class="s1">results</span><span class="s2">);</span>

    <span class="s1">decorated</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">data</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s1">HidePlaceholder</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">normalizePlaceholder </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">_</span><span class="s2">, </span><span class="s1">placeholder</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">placeholder </span><span class="s2">=== </span><span class="s4">'string'</span><span class="s2">) {</span>
      <span class="s1">placeholder </span><span class="s2">= {</span>
        <span class="s1">id</span><span class="s2">: </span><span class="s4">''</span><span class="s2">,</span>
        <span class="s1">text</span><span class="s2">: </span><span class="s1">placeholder</span>
      <span class="s2">};</span>
    <span class="s2">}</span>

    <span class="s3">return </span><span class="s1">placeholder</span><span class="s2">;</span>
  <span class="s2">};</span>

  <span class="s1">HidePlaceholder</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">removePlaceholder </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">_</span><span class="s2">, </span><span class="s1">data</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">modifiedData </span><span class="s2">= </span><span class="s1">data</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s8">0</span><span class="s2">);</span>

    <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">d </span><span class="s2">= </span><span class="s1">data</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s8">1</span><span class="s2">; </span><span class="s1">d </span><span class="s2">&gt;= </span><span class="s8">0</span><span class="s2">; </span><span class="s1">d</span><span class="s2">--) {</span>
      <span class="s3">var </span><span class="s1">item </span><span class="s2">= </span><span class="s1">data</span><span class="s2">[</span><span class="s1">d</span><span class="s2">];</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">placeholder</span><span class="s2">.</span><span class="s1">id </span><span class="s2">=== </span><span class="s1">item</span><span class="s2">.</span><span class="s1">id</span><span class="s2">) {</span>
        <span class="s1">modifiedData</span><span class="s2">.</span><span class="s1">splice</span><span class="s2">(</span><span class="s1">d</span><span class="s2">, </span><span class="s8">1</span><span class="s2">);</span>
      <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s3">return </span><span class="s1">modifiedData</span><span class="s2">;</span>
  <span class="s2">};</span>

  <span class="s3">return </span><span class="s1">HidePlaceholder</span><span class="s2">;</span>
<span class="s2">});</span>

<span class="s1">S2</span><span class="s2">.</span><span class="s1">define</span><span class="s2">(</span><span class="s4">'select2/dropdown/infiniteScroll'</span><span class="s2">,[</span>
  <span class="s4">'jquery'</span>
<span class="s2">], </span><span class="s3">function </span><span class="s2">(</span><span class="s1">$</span><span class="s2">) {</span>
  <span class="s3">function </span><span class="s1">InfiniteScroll </span><span class="s2">(</span><span class="s1">decorated</span><span class="s2">, </span><span class="s1">$element</span><span class="s2">, </span><span class="s1">options</span><span class="s2">, </span><span class="s1">dataAdapter</span><span class="s2">) {</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">lastParams </span><span class="s2">= {};</span>

    <span class="s1">decorated</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">$element</span><span class="s2">, </span><span class="s1">options</span><span class="s2">, </span><span class="s1">dataAdapter</span><span class="s2">);</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">$loadingMore </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">createLoadingMore</span><span class="s2">();</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">loading </span><span class="s2">= </span><span class="s3">false</span><span class="s2">;</span>
  <span class="s2">}</span>

  <span class="s1">InfiniteScroll</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">append </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">decorated</span><span class="s2">, </span><span class="s1">data</span><span class="s2">) {</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">$loadingMore</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">();</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">loading </span><span class="s2">= </span><span class="s3">false</span><span class="s2">;</span>

    <span class="s1">decorated</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">data</span><span class="s2">);</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">showLoadingMore</span><span class="s2">(</span><span class="s1">data</span><span class="s2">)) {</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">$results</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">$loadingMore</span><span class="s2">);</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">loadMoreIfNeeded</span><span class="s2">();</span>
    <span class="s2">}</span>
  <span class="s2">};</span>

  <span class="s1">InfiniteScroll</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">bind </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">decorated</span><span class="s2">, </span><span class="s1">container</span><span class="s2">, </span><span class="s1">$container</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">self </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>

    <span class="s1">decorated</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">container</span><span class="s2">, </span><span class="s1">$container</span><span class="s2">);</span>

    <span class="s1">container</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'query'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">params</span><span class="s2">) {</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">lastParams </span><span class="s2">= </span><span class="s1">params</span><span class="s2">;</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">loading </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
    <span class="s2">});</span>

    <span class="s1">container</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'query:append'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">params</span><span class="s2">) {</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">lastParams </span><span class="s2">= </span><span class="s1">params</span><span class="s2">;</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">loading </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
    <span class="s2">});</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">$results</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'scroll'</span><span class="s2">, </span><span class="s3">this</span><span class="s2">.</span><span class="s1">loadMoreIfNeeded</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s3">this</span><span class="s2">));</span>
  <span class="s2">};</span>

  <span class="s1">InfiniteScroll</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">loadMoreIfNeeded </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {</span>
    <span class="s3">var </span><span class="s1">isLoadMoreVisible </span><span class="s2">= </span><span class="s1">$</span><span class="s2">.</span><span class="s1">contains</span><span class="s2">(</span>
      <span class="s1">document</span><span class="s2">.</span><span class="s1">documentElement</span><span class="s2">,</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">$loadingMore</span><span class="s2">[</span><span class="s8">0</span><span class="s2">]</span>
    <span class="s2">);</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">loading </span><span class="s2">|| !</span><span class="s1">isLoadMoreVisible</span><span class="s2">) {</span>
      <span class="s3">return</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">var </span><span class="s1">currentOffset </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">$results</span><span class="s2">.</span><span class="s1">offset</span><span class="s2">().</span><span class="s1">top </span><span class="s2">+</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">$results</span><span class="s2">.</span><span class="s1">outerHeight</span><span class="s2">(</span><span class="s3">false</span><span class="s2">);</span>
    <span class="s3">var </span><span class="s1">loadingMoreOffset </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">$loadingMore</span><span class="s2">.</span><span class="s1">offset</span><span class="s2">().</span><span class="s1">top </span><span class="s2">+</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">$loadingMore</span><span class="s2">.</span><span class="s1">outerHeight</span><span class="s2">(</span><span class="s3">false</span><span class="s2">);</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">currentOffset </span><span class="s2">+ </span><span class="s8">50 </span><span class="s2">&gt;= </span><span class="s1">loadingMoreOffset</span><span class="s2">) {</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">loadMore</span><span class="s2">();</span>
    <span class="s2">}</span>
  <span class="s2">};</span>

  <span class="s1">InfiniteScroll</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">loadMore </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">loading </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>

    <span class="s3">var </span><span class="s1">params </span><span class="s2">= </span><span class="s1">$</span><span class="s2">.</span><span class="s1">extend</span><span class="s2">({}, {</span><span class="s1">page</span><span class="s2">: </span><span class="s8">1</span><span class="s2">}, </span><span class="s3">this</span><span class="s2">.</span><span class="s1">lastParams</span><span class="s2">);</span>

    <span class="s1">params</span><span class="s2">.</span><span class="s1">page</span><span class="s2">++;</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'query:append'</span><span class="s2">, </span><span class="s1">params</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s1">InfiniteScroll</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">showLoadingMore </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">_</span><span class="s2">, </span><span class="s1">data</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">data</span><span class="s2">.</span><span class="s1">pagination </span><span class="s2">&amp;&amp; </span><span class="s1">data</span><span class="s2">.</span><span class="s1">pagination</span><span class="s2">.</span><span class="s1">more</span><span class="s2">;</span>
  <span class="s2">};</span>

  <span class="s1">InfiniteScroll</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">createLoadingMore </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {</span>
    <span class="s3">var </span><span class="s1">$option </span><span class="s2">= </span><span class="s1">$</span><span class="s2">(</span>
      <span class="s4">'&lt;li ' </span><span class="s2">+</span>
      <span class="s4">'class=&quot;select2-results__option select2-results__option--load-more&quot;' </span><span class="s2">+</span>
      <span class="s4">'role=&quot;option&quot; aria-disabled=&quot;true&quot;&gt;&lt;/li&gt;'</span>
    <span class="s2">);</span>

    <span class="s3">var </span><span class="s1">message </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'translations'</span><span class="s2">).</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'loadingMore'</span><span class="s2">);</span>

    <span class="s1">$option</span><span class="s2">.</span><span class="s1">html</span><span class="s2">(</span><span class="s1">message</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">lastParams</span><span class="s2">));</span>

    <span class="s3">return </span><span class="s1">$option</span><span class="s2">;</span>
  <span class="s2">};</span>

  <span class="s3">return </span><span class="s1">InfiniteScroll</span><span class="s2">;</span>
<span class="s2">});</span>

<span class="s1">S2</span><span class="s2">.</span><span class="s1">define</span><span class="s2">(</span><span class="s4">'select2/dropdown/attachBody'</span><span class="s2">,[</span>
  <span class="s4">'jquery'</span><span class="s2">,</span>
  <span class="s4">'../utils'</span>
<span class="s2">], </span><span class="s3">function </span><span class="s2">(</span><span class="s1">$</span><span class="s2">, </span><span class="s1">Utils</span><span class="s2">) {</span>
  <span class="s3">function </span><span class="s1">AttachBody </span><span class="s2">(</span><span class="s1">decorated</span><span class="s2">, </span><span class="s1">$element</span><span class="s2">, </span><span class="s1">options</span><span class="s2">) {</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">$dropdownParent </span><span class="s2">= </span><span class="s1">$</span><span class="s2">(</span><span class="s1">options</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'dropdownParent'</span><span class="s2">) || </span><span class="s1">document</span><span class="s2">.</span><span class="s1">body</span><span class="s2">);</span>

    <span class="s1">decorated</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">$element</span><span class="s2">, </span><span class="s1">options</span><span class="s2">);</span>
  <span class="s2">}</span>

  <span class="s1">AttachBody</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">bind </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">decorated</span><span class="s2">, </span><span class="s1">container</span><span class="s2">, </span><span class="s1">$container</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">self </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>

    <span class="s1">decorated</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">container</span><span class="s2">, </span><span class="s1">$container</span><span class="s2">);</span>

    <span class="s1">container</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'open'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">() {</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">_showDropdown</span><span class="s2">();</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">_attachPositioningHandler</span><span class="s2">(</span><span class="s1">container</span><span class="s2">);</span>

      <span class="s0">// Must bind after the results handlers to ensure correct sizing</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">_bindContainerResultHandlers</span><span class="s2">(</span><span class="s1">container</span><span class="s2">);</span>
    <span class="s2">});</span>

    <span class="s1">container</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'close'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">() {</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">_hideDropdown</span><span class="s2">();</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">_detachPositioningHandler</span><span class="s2">(</span><span class="s1">container</span><span class="s2">);</span>
    <span class="s2">});</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">$dropdownContainer</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'mousedown'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">evt</span><span class="s2">) {</span>
      <span class="s1">evt</span><span class="s2">.</span><span class="s1">stopPropagation</span><span class="s2">();</span>
    <span class="s2">});</span>
  <span class="s2">};</span>

  <span class="s1">AttachBody</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">destroy </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">decorated</span><span class="s2">) {</span>
    <span class="s1">decorated</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">);</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">$dropdownContainer</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">();</span>
  <span class="s2">};</span>

  <span class="s1">AttachBody</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">position </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">decorated</span><span class="s2">, </span><span class="s1">$dropdown</span><span class="s2">, </span><span class="s1">$container</span><span class="s2">) {</span>
    <span class="s0">// Clone all of the container classes</span>
    <span class="s1">$dropdown</span><span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'class'</span><span class="s2">, </span><span class="s1">$container</span><span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'class'</span><span class="s2">));</span>

    <span class="s1">$dropdown</span><span class="s2">.</span><span class="s1">removeClass</span><span class="s2">(</span><span class="s4">'select2'</span><span class="s2">);</span>
    <span class="s1">$dropdown</span><span class="s2">.</span><span class="s1">addClass</span><span class="s2">(</span><span class="s4">'select2-container--open'</span><span class="s2">);</span>

    <span class="s1">$dropdown</span><span class="s2">.</span><span class="s1">css</span><span class="s2">({</span>
      <span class="s1">position</span><span class="s2">: </span><span class="s4">'absolute'</span><span class="s2">,</span>
      <span class="s1">top</span><span class="s2">: -</span><span class="s8">999999</span>
    <span class="s2">});</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">$container </span><span class="s2">= </span><span class="s1">$container</span><span class="s2">;</span>
  <span class="s2">};</span>

  <span class="s1">AttachBody</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">render </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">decorated</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">$container </span><span class="s2">= </span><span class="s1">$</span><span class="s2">(</span><span class="s4">'&lt;span&gt;&lt;/span&gt;'</span><span class="s2">);</span>

    <span class="s3">var </span><span class="s1">$dropdown </span><span class="s2">= </span><span class="s1">decorated</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">);</span>
    <span class="s1">$container</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">$dropdown</span><span class="s2">);</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">$dropdownContainer </span><span class="s2">= </span><span class="s1">$container</span><span class="s2">;</span>

    <span class="s3">return </span><span class="s1">$container</span><span class="s2">;</span>
  <span class="s2">};</span>

  <span class="s1">AttachBody</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">_hideDropdown </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">decorated</span><span class="s2">) {</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">$dropdownContainer</span><span class="s2">.</span><span class="s1">detach</span><span class="s2">();</span>
  <span class="s2">};</span>

  <span class="s1">AttachBody</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">_bindContainerResultHandlers </span><span class="s2">=</span>
      <span class="s3">function </span><span class="s2">(</span><span class="s1">decorated</span><span class="s2">, </span><span class="s1">container</span><span class="s2">) {</span>

    <span class="s0">// These should only be bound once</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">_containerResultsHandlersBound</span><span class="s2">) {</span>
      <span class="s3">return</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">var </span><span class="s1">self </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>

    <span class="s1">container</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'results:all'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">() {</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">_positionDropdown</span><span class="s2">();</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">_resizeDropdown</span><span class="s2">();</span>
    <span class="s2">});</span>

    <span class="s1">container</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'results:append'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">() {</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">_positionDropdown</span><span class="s2">();</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">_resizeDropdown</span><span class="s2">();</span>
    <span class="s2">});</span>

    <span class="s1">container</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'results:message'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">() {</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">_positionDropdown</span><span class="s2">();</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">_resizeDropdown</span><span class="s2">();</span>
    <span class="s2">});</span>

    <span class="s1">container</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'select'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">() {</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">_positionDropdown</span><span class="s2">();</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">_resizeDropdown</span><span class="s2">();</span>
    <span class="s2">});</span>

    <span class="s1">container</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'unselect'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">() {</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">_positionDropdown</span><span class="s2">();</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">_resizeDropdown</span><span class="s2">();</span>
    <span class="s2">});</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">_containerResultsHandlersBound </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
  <span class="s2">};</span>

  <span class="s1">AttachBody</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">_attachPositioningHandler </span><span class="s2">=</span>
      <span class="s3">function </span><span class="s2">(</span><span class="s1">decorated</span><span class="s2">, </span><span class="s1">container</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">self </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>

    <span class="s3">var </span><span class="s1">scrollEvent </span><span class="s2">= </span><span class="s4">'scroll.select2.' </span><span class="s2">+ </span><span class="s1">container</span><span class="s2">.</span><span class="s1">id</span><span class="s2">;</span>
    <span class="s3">var </span><span class="s1">resizeEvent </span><span class="s2">= </span><span class="s4">'resize.select2.' </span><span class="s2">+ </span><span class="s1">container</span><span class="s2">.</span><span class="s1">id</span><span class="s2">;</span>
    <span class="s3">var </span><span class="s1">orientationEvent </span><span class="s2">= </span><span class="s4">'orientationchange.select2.' </span><span class="s2">+ </span><span class="s1">container</span><span class="s2">.</span><span class="s1">id</span><span class="s2">;</span>

    <span class="s3">var </span><span class="s1">$watchers </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">$container</span><span class="s2">.</span><span class="s1">parents</span><span class="s2">().</span><span class="s1">filter</span><span class="s2">(</span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">hasScroll</span><span class="s2">);</span>
    <span class="s1">$watchers</span><span class="s2">.</span><span class="s1">each</span><span class="s2">(</span><span class="s3">function </span><span class="s2">() {</span>
      <span class="s1">Utils</span><span class="s2">.</span><span class="s1">StoreData</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s4">'select2-scroll-position'</span><span class="s2">, {</span>
        <span class="s1">x</span><span class="s2">: </span><span class="s1">$</span><span class="s2">(</span><span class="s3">this</span><span class="s2">).</span><span class="s1">scrollLeft</span><span class="s2">(),</span>
        <span class="s1">y</span><span class="s2">: </span><span class="s1">$</span><span class="s2">(</span><span class="s3">this</span><span class="s2">).</span><span class="s1">scrollTop</span><span class="s2">()</span>
      <span class="s2">});</span>
    <span class="s2">});</span>

    <span class="s1">$watchers</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s1">scrollEvent</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">ev</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">position </span><span class="s2">= </span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">GetData</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s4">'select2-scroll-position'</span><span class="s2">);</span>
      <span class="s1">$</span><span class="s2">(</span><span class="s3">this</span><span class="s2">).</span><span class="s1">scrollTop</span><span class="s2">(</span><span class="s1">position</span><span class="s2">.</span><span class="s1">y</span><span class="s2">);</span>
    <span class="s2">});</span>

    <span class="s1">$</span><span class="s2">(</span><span class="s1">window</span><span class="s2">).</span><span class="s1">on</span><span class="s2">(</span><span class="s1">scrollEvent </span><span class="s2">+ </span><span class="s4">' ' </span><span class="s2">+ </span><span class="s1">resizeEvent </span><span class="s2">+ </span><span class="s4">' ' </span><span class="s2">+ </span><span class="s1">orientationEvent</span><span class="s2">,</span>
      <span class="s3">function </span><span class="s2">(</span><span class="s1">e</span><span class="s2">) {</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">_positionDropdown</span><span class="s2">();</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">_resizeDropdown</span><span class="s2">();</span>
    <span class="s2">});</span>
  <span class="s2">};</span>

  <span class="s1">AttachBody</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">_detachPositioningHandler </span><span class="s2">=</span>
      <span class="s3">function </span><span class="s2">(</span><span class="s1">decorated</span><span class="s2">, </span><span class="s1">container</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">scrollEvent </span><span class="s2">= </span><span class="s4">'scroll.select2.' </span><span class="s2">+ </span><span class="s1">container</span><span class="s2">.</span><span class="s1">id</span><span class="s2">;</span>
    <span class="s3">var </span><span class="s1">resizeEvent </span><span class="s2">= </span><span class="s4">'resize.select2.' </span><span class="s2">+ </span><span class="s1">container</span><span class="s2">.</span><span class="s1">id</span><span class="s2">;</span>
    <span class="s3">var </span><span class="s1">orientationEvent </span><span class="s2">= </span><span class="s4">'orientationchange.select2.' </span><span class="s2">+ </span><span class="s1">container</span><span class="s2">.</span><span class="s1">id</span><span class="s2">;</span>

    <span class="s3">var </span><span class="s1">$watchers </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">$container</span><span class="s2">.</span><span class="s1">parents</span><span class="s2">().</span><span class="s1">filter</span><span class="s2">(</span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">hasScroll</span><span class="s2">);</span>
    <span class="s1">$watchers</span><span class="s2">.</span><span class="s1">off</span><span class="s2">(</span><span class="s1">scrollEvent</span><span class="s2">);</span>

    <span class="s1">$</span><span class="s2">(</span><span class="s1">window</span><span class="s2">).</span><span class="s1">off</span><span class="s2">(</span><span class="s1">scrollEvent </span><span class="s2">+ </span><span class="s4">' ' </span><span class="s2">+ </span><span class="s1">resizeEvent </span><span class="s2">+ </span><span class="s4">' ' </span><span class="s2">+ </span><span class="s1">orientationEvent</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s1">AttachBody</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">_positionDropdown </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {</span>
    <span class="s3">var </span><span class="s1">$window </span><span class="s2">= </span><span class="s1">$</span><span class="s2">(</span><span class="s1">window</span><span class="s2">);</span>

    <span class="s3">var </span><span class="s1">isCurrentlyAbove </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">$dropdown</span><span class="s2">.</span><span class="s1">hasClass</span><span class="s2">(</span><span class="s4">'select2-dropdown--above'</span><span class="s2">);</span>
    <span class="s3">var </span><span class="s1">isCurrentlyBelow </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">$dropdown</span><span class="s2">.</span><span class="s1">hasClass</span><span class="s2">(</span><span class="s4">'select2-dropdown--below'</span><span class="s2">);</span>

    <span class="s3">var </span><span class="s1">newDirection </span><span class="s2">= </span><span class="s3">null</span><span class="s2">;</span>

    <span class="s3">var </span><span class="s1">offset </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">$container</span><span class="s2">.</span><span class="s1">offset</span><span class="s2">();</span>

    <span class="s1">offset</span><span class="s2">.</span><span class="s1">bottom </span><span class="s2">= </span><span class="s1">offset</span><span class="s2">.</span><span class="s1">top </span><span class="s2">+ </span><span class="s3">this</span><span class="s2">.</span><span class="s1">$container</span><span class="s2">.</span><span class="s1">outerHeight</span><span class="s2">(</span><span class="s3">false</span><span class="s2">);</span>

    <span class="s3">var </span><span class="s1">container </span><span class="s2">= {</span>
      <span class="s1">height</span><span class="s2">: </span><span class="s3">this</span><span class="s2">.</span><span class="s1">$container</span><span class="s2">.</span><span class="s1">outerHeight</span><span class="s2">(</span><span class="s3">false</span><span class="s2">)</span>
    <span class="s2">};</span>

    <span class="s1">container</span><span class="s2">.</span><span class="s1">top </span><span class="s2">= </span><span class="s1">offset</span><span class="s2">.</span><span class="s1">top</span><span class="s2">;</span>
    <span class="s1">container</span><span class="s2">.</span><span class="s1">bottom </span><span class="s2">= </span><span class="s1">offset</span><span class="s2">.</span><span class="s1">top </span><span class="s2">+ </span><span class="s1">container</span><span class="s2">.</span><span class="s1">height</span><span class="s2">;</span>

    <span class="s3">var </span><span class="s1">dropdown </span><span class="s2">= {</span>
      <span class="s1">height</span><span class="s2">: </span><span class="s3">this</span><span class="s2">.</span><span class="s1">$dropdown</span><span class="s2">.</span><span class="s1">outerHeight</span><span class="s2">(</span><span class="s3">false</span><span class="s2">)</span>
    <span class="s2">};</span>

    <span class="s3">var </span><span class="s1">viewport </span><span class="s2">= {</span>
      <span class="s1">top</span><span class="s2">: </span><span class="s1">$window</span><span class="s2">.</span><span class="s1">scrollTop</span><span class="s2">(),</span>
      <span class="s1">bottom</span><span class="s2">: </span><span class="s1">$window</span><span class="s2">.</span><span class="s1">scrollTop</span><span class="s2">() + </span><span class="s1">$window</span><span class="s2">.</span><span class="s1">height</span><span class="s2">()</span>
    <span class="s2">};</span>

    <span class="s3">var </span><span class="s1">enoughRoomAbove </span><span class="s2">= </span><span class="s1">viewport</span><span class="s2">.</span><span class="s1">top </span><span class="s2">&lt; (</span><span class="s1">offset</span><span class="s2">.</span><span class="s1">top </span><span class="s2">- </span><span class="s1">dropdown</span><span class="s2">.</span><span class="s1">height</span><span class="s2">);</span>
    <span class="s3">var </span><span class="s1">enoughRoomBelow </span><span class="s2">= </span><span class="s1">viewport</span><span class="s2">.</span><span class="s1">bottom </span><span class="s2">&gt; (</span><span class="s1">offset</span><span class="s2">.</span><span class="s1">bottom </span><span class="s2">+ </span><span class="s1">dropdown</span><span class="s2">.</span><span class="s1">height</span><span class="s2">);</span>

    <span class="s3">var </span><span class="s1">css </span><span class="s2">= {</span>
      <span class="s1">left</span><span class="s2">: </span><span class="s1">offset</span><span class="s2">.</span><span class="s1">left</span><span class="s2">,</span>
      <span class="s1">top</span><span class="s2">: </span><span class="s1">container</span><span class="s2">.</span><span class="s1">bottom</span>
    <span class="s2">};</span>

    <span class="s0">// Determine what the parent element is to use for calculating the offset</span>
    <span class="s3">var </span><span class="s1">$offsetParent </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">$dropdownParent</span><span class="s2">;</span>

    <span class="s0">// For statically positioned elements, we need to get the element</span>
    <span class="s0">// that is determining the offset</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">$offsetParent</span><span class="s2">.</span><span class="s1">css</span><span class="s2">(</span><span class="s4">'position'</span><span class="s2">) === </span><span class="s4">'static'</span><span class="s2">) {</span>
      <span class="s1">$offsetParent </span><span class="s2">= </span><span class="s1">$offsetParent</span><span class="s2">.</span><span class="s1">offsetParent</span><span class="s2">();</span>
    <span class="s2">}</span>

    <span class="s3">var </span><span class="s1">parentOffset </span><span class="s2">= {</span>
      <span class="s1">top</span><span class="s2">: </span><span class="s8">0</span><span class="s2">,</span>
      <span class="s1">left</span><span class="s2">: </span><span class="s8">0</span>
    <span class="s2">};</span>

    <span class="s3">if </span><span class="s2">(</span>
      <span class="s1">$</span><span class="s2">.</span><span class="s1">contains</span><span class="s2">(</span><span class="s1">document</span><span class="s2">.</span><span class="s1">body</span><span class="s2">, </span><span class="s1">$offsetParent</span><span class="s2">[</span><span class="s8">0</span><span class="s2">]) ||</span>
      <span class="s1">$offsetParent</span><span class="s2">[</span><span class="s8">0</span><span class="s2">].</span><span class="s1">isConnected</span>
      <span class="s2">) {</span>
      <span class="s1">parentOffset </span><span class="s2">= </span><span class="s1">$offsetParent</span><span class="s2">.</span><span class="s1">offset</span><span class="s2">();</span>
    <span class="s2">}</span>

    <span class="s1">css</span><span class="s2">.</span><span class="s1">top </span><span class="s2">-= </span><span class="s1">parentOffset</span><span class="s2">.</span><span class="s1">top</span><span class="s2">;</span>
    <span class="s1">css</span><span class="s2">.</span><span class="s1">left </span><span class="s2">-= </span><span class="s1">parentOffset</span><span class="s2">.</span><span class="s1">left</span><span class="s2">;</span>

    <span class="s3">if </span><span class="s2">(!</span><span class="s1">isCurrentlyAbove </span><span class="s2">&amp;&amp; !</span><span class="s1">isCurrentlyBelow</span><span class="s2">) {</span>
      <span class="s1">newDirection </span><span class="s2">= </span><span class="s4">'below'</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">if </span><span class="s2">(!</span><span class="s1">enoughRoomBelow </span><span class="s2">&amp;&amp; </span><span class="s1">enoughRoomAbove </span><span class="s2">&amp;&amp; !</span><span class="s1">isCurrentlyAbove</span><span class="s2">) {</span>
      <span class="s1">newDirection </span><span class="s2">= </span><span class="s4">'above'</span><span class="s2">;</span>
    <span class="s2">} </span><span class="s3">else if </span><span class="s2">(!</span><span class="s1">enoughRoomAbove </span><span class="s2">&amp;&amp; </span><span class="s1">enoughRoomBelow </span><span class="s2">&amp;&amp; </span><span class="s1">isCurrentlyAbove</span><span class="s2">) {</span>
      <span class="s1">newDirection </span><span class="s2">= </span><span class="s4">'below'</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">newDirection </span><span class="s2">== </span><span class="s4">'above' </span><span class="s2">||</span>
      <span class="s2">(</span><span class="s1">isCurrentlyAbove </span><span class="s2">&amp;&amp; </span><span class="s1">newDirection </span><span class="s2">!== </span><span class="s4">'below'</span><span class="s2">)) {</span>
      <span class="s1">css</span><span class="s2">.</span><span class="s1">top </span><span class="s2">= </span><span class="s1">container</span><span class="s2">.</span><span class="s1">top </span><span class="s2">- </span><span class="s1">parentOffset</span><span class="s2">.</span><span class="s1">top </span><span class="s2">- </span><span class="s1">dropdown</span><span class="s2">.</span><span class="s1">height</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">newDirection </span><span class="s2">!= </span><span class="s3">null</span><span class="s2">) {</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">$dropdown</span>
        <span class="s2">.</span><span class="s1">removeClass</span><span class="s2">(</span><span class="s4">'select2-dropdown--below select2-dropdown--above'</span><span class="s2">)</span>
        <span class="s2">.</span><span class="s1">addClass</span><span class="s2">(</span><span class="s4">'select2-dropdown--' </span><span class="s2">+ </span><span class="s1">newDirection</span><span class="s2">);</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">$container</span>
        <span class="s2">.</span><span class="s1">removeClass</span><span class="s2">(</span><span class="s4">'select2-container--below select2-container--above'</span><span class="s2">)</span>
        <span class="s2">.</span><span class="s1">addClass</span><span class="s2">(</span><span class="s4">'select2-container--' </span><span class="s2">+ </span><span class="s1">newDirection</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">$dropdownContainer</span><span class="s2">.</span><span class="s1">css</span><span class="s2">(</span><span class="s1">css</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s1">AttachBody</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">_resizeDropdown </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {</span>
    <span class="s3">var </span><span class="s1">css </span><span class="s2">= {</span>
      <span class="s1">width</span><span class="s2">: </span><span class="s3">this</span><span class="s2">.</span><span class="s1">$container</span><span class="s2">.</span><span class="s1">outerWidth</span><span class="s2">(</span><span class="s3">false</span><span class="s2">) + </span><span class="s4">'px'</span>
    <span class="s2">};</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'dropdownAutoWidth'</span><span class="s2">)) {</span>
      <span class="s1">css</span><span class="s2">.</span><span class="s1">minWidth </span><span class="s2">= </span><span class="s1">css</span><span class="s2">.</span><span class="s1">width</span><span class="s2">;</span>
      <span class="s1">css</span><span class="s2">.</span><span class="s1">position </span><span class="s2">= </span><span class="s4">'relative'</span><span class="s2">;</span>
      <span class="s1">css</span><span class="s2">.</span><span class="s1">width </span><span class="s2">= </span><span class="s4">'auto'</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">$dropdown</span><span class="s2">.</span><span class="s1">css</span><span class="s2">(</span><span class="s1">css</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s1">AttachBody</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">_showDropdown </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">decorated</span><span class="s2">) {</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">$dropdownContainer</span><span class="s2">.</span><span class="s1">appendTo</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">$dropdownParent</span><span class="s2">);</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">_positionDropdown</span><span class="s2">();</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">_resizeDropdown</span><span class="s2">();</span>
  <span class="s2">};</span>

  <span class="s3">return </span><span class="s1">AttachBody</span><span class="s2">;</span>
<span class="s2">});</span>

<span class="s1">S2</span><span class="s2">.</span><span class="s1">define</span><span class="s2">(</span><span class="s4">'select2/dropdown/minimumResultsForSearch'</span><span class="s2">,[</span>

<span class="s2">], </span><span class="s3">function </span><span class="s2">() {</span>
  <span class="s3">function </span><span class="s1">countResults </span><span class="s2">(</span><span class="s1">data</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">count </span><span class="s2">= </span><span class="s8">0</span><span class="s2">;</span>

    <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">d </span><span class="s2">= </span><span class="s8">0</span><span class="s2">; </span><span class="s1">d </span><span class="s2">&lt; </span><span class="s1">data</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">d</span><span class="s2">++) {</span>
      <span class="s3">var </span><span class="s1">item </span><span class="s2">= </span><span class="s1">data</span><span class="s2">[</span><span class="s1">d</span><span class="s2">];</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">item</span><span class="s2">.</span><span class="s1">children</span><span class="s2">) {</span>
        <span class="s1">count </span><span class="s2">+= </span><span class="s1">countResults</span><span class="s2">(</span><span class="s1">item</span><span class="s2">.</span><span class="s1">children</span><span class="s2">);</span>
      <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
        <span class="s1">count</span><span class="s2">++;</span>
      <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s3">return </span><span class="s1">count</span><span class="s2">;</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">MinimumResultsForSearch </span><span class="s2">(</span><span class="s1">decorated</span><span class="s2">, </span><span class="s1">$element</span><span class="s2">, </span><span class="s1">options</span><span class="s2">, </span><span class="s1">dataAdapter</span><span class="s2">) {</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">minimumResultsForSearch </span><span class="s2">= </span><span class="s1">options</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'minimumResultsForSearch'</span><span class="s2">);</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">minimumResultsForSearch </span><span class="s2">&lt; </span><span class="s8">0</span><span class="s2">) {</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">minimumResultsForSearch </span><span class="s2">= </span><span class="s1">Infinity</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s1">decorated</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">$element</span><span class="s2">, </span><span class="s1">options</span><span class="s2">, </span><span class="s1">dataAdapter</span><span class="s2">);</span>
  <span class="s2">}</span>

  <span class="s1">MinimumResultsForSearch</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">showSearch </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">decorated</span><span class="s2">, </span><span class="s1">params</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">countResults</span><span class="s2">(</span><span class="s1">params</span><span class="s2">.</span><span class="s1">data</span><span class="s2">.</span><span class="s1">results</span><span class="s2">) &lt; </span><span class="s3">this</span><span class="s2">.</span><span class="s1">minimumResultsForSearch</span><span class="s2">) {</span>
      <span class="s3">return false</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">return </span><span class="s1">decorated</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">params</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s3">return </span><span class="s1">MinimumResultsForSearch</span><span class="s2">;</span>
<span class="s2">});</span>

<span class="s1">S2</span><span class="s2">.</span><span class="s1">define</span><span class="s2">(</span><span class="s4">'select2/dropdown/selectOnClose'</span><span class="s2">,[</span>
  <span class="s4">'../utils'</span>
<span class="s2">], </span><span class="s3">function </span><span class="s2">(</span><span class="s1">Utils</span><span class="s2">) {</span>
  <span class="s3">function </span><span class="s1">SelectOnClose </span><span class="s2">() { }</span>

  <span class="s1">SelectOnClose</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">bind </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">decorated</span><span class="s2">, </span><span class="s1">container</span><span class="s2">, </span><span class="s1">$container</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">self </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>

    <span class="s1">decorated</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">container</span><span class="s2">, </span><span class="s1">$container</span><span class="s2">);</span>

    <span class="s1">container</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'close'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">params</span><span class="s2">) {</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">_handleSelectOnClose</span><span class="s2">(</span><span class="s1">params</span><span class="s2">);</span>
    <span class="s2">});</span>
  <span class="s2">};</span>

  <span class="s1">SelectOnClose</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">_handleSelectOnClose </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">_</span><span class="s2">, </span><span class="s1">params</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">params </span><span class="s2">&amp;&amp; </span><span class="s1">params</span><span class="s2">.</span><span class="s1">originalSelect2Event </span><span class="s2">!= </span><span class="s3">null</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">event </span><span class="s2">= </span><span class="s1">params</span><span class="s2">.</span><span class="s1">originalSelect2Event</span><span class="s2">;</span>

      <span class="s0">// Don't select an item if the close event was triggered from a select or</span>
      <span class="s0">// unselect event</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">event</span><span class="s2">.</span><span class="s1">_type </span><span class="s2">=== </span><span class="s4">'select' </span><span class="s2">|| </span><span class="s1">event</span><span class="s2">.</span><span class="s1">_type </span><span class="s2">=== </span><span class="s4">'unselect'</span><span class="s2">) {</span>
        <span class="s3">return</span><span class="s2">;</span>
      <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s3">var </span><span class="s1">$highlightedResults </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">getHighlightedResults</span><span class="s2">();</span>

    <span class="s0">// Only select highlighted results</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">$highlightedResults</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&lt; </span><span class="s8">1</span><span class="s2">) {</span>
      <span class="s3">return</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">var </span><span class="s1">data </span><span class="s2">= </span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">GetData</span><span class="s2">(</span><span class="s1">$highlightedResults</span><span class="s2">[</span><span class="s8">0</span><span class="s2">], </span><span class="s4">'data'</span><span class="s2">);</span>

    <span class="s0">// Don't re-select already selected resulte</span>
    <span class="s3">if </span><span class="s2">(</span>
      <span class="s2">(</span><span class="s1">data</span><span class="s2">.</span><span class="s1">element </span><span class="s2">!= </span><span class="s3">null </span><span class="s2">&amp;&amp; </span><span class="s1">data</span><span class="s2">.</span><span class="s1">element</span><span class="s2">.</span><span class="s1">selected</span><span class="s2">) ||</span>
      <span class="s2">(</span><span class="s1">data</span><span class="s2">.</span><span class="s1">element </span><span class="s2">== </span><span class="s3">null </span><span class="s2">&amp;&amp; </span><span class="s1">data</span><span class="s2">.</span><span class="s1">selected</span><span class="s2">)</span>
    <span class="s2">) {</span>
      <span class="s3">return</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'select'</span><span class="s2">, {</span>
        <span class="s1">data</span><span class="s2">: </span><span class="s1">data</span>
    <span class="s2">});</span>
  <span class="s2">};</span>

  <span class="s3">return </span><span class="s1">SelectOnClose</span><span class="s2">;</span>
<span class="s2">});</span>

<span class="s1">S2</span><span class="s2">.</span><span class="s1">define</span><span class="s2">(</span><span class="s4">'select2/dropdown/closeOnSelect'</span><span class="s2">,[</span>

<span class="s2">], </span><span class="s3">function </span><span class="s2">() {</span>
  <span class="s3">function </span><span class="s1">CloseOnSelect </span><span class="s2">() { }</span>

  <span class="s1">CloseOnSelect</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">bind </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">decorated</span><span class="s2">, </span><span class="s1">container</span><span class="s2">, </span><span class="s1">$container</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">self </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>

    <span class="s1">decorated</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">container</span><span class="s2">, </span><span class="s1">$container</span><span class="s2">);</span>

    <span class="s1">container</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'select'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">evt</span><span class="s2">) {</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">_selectTriggered</span><span class="s2">(</span><span class="s1">evt</span><span class="s2">);</span>
    <span class="s2">});</span>

    <span class="s1">container</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'unselect'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">evt</span><span class="s2">) {</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">_selectTriggered</span><span class="s2">(</span><span class="s1">evt</span><span class="s2">);</span>
    <span class="s2">});</span>
  <span class="s2">};</span>

  <span class="s1">CloseOnSelect</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">_selectTriggered </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">_</span><span class="s2">, </span><span class="s1">evt</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">originalEvent </span><span class="s2">= </span><span class="s1">evt</span><span class="s2">.</span><span class="s1">originalEvent</span><span class="s2">;</span>

    <span class="s0">// Don't close if the control key is being held</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">originalEvent </span><span class="s2">&amp;&amp; (</span><span class="s1">originalEvent</span><span class="s2">.</span><span class="s1">ctrlKey </span><span class="s2">|| </span><span class="s1">originalEvent</span><span class="s2">.</span><span class="s1">metaKey</span><span class="s2">)) {</span>
      <span class="s3">return</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'close'</span><span class="s2">, {</span>
      <span class="s1">originalEvent</span><span class="s2">: </span><span class="s1">originalEvent</span><span class="s2">,</span>
      <span class="s1">originalSelect2Event</span><span class="s2">: </span><span class="s1">evt</span>
    <span class="s2">});</span>
  <span class="s2">};</span>

  <span class="s3">return </span><span class="s1">CloseOnSelect</span><span class="s2">;</span>
<span class="s2">});</span>

<span class="s1">S2</span><span class="s2">.</span><span class="s1">define</span><span class="s2">(</span><span class="s4">'select2/i18n/en'</span><span class="s2">,[],</span><span class="s3">function </span><span class="s2">() {</span>
  <span class="s0">// English</span>
  <span class="s3">return </span><span class="s2">{</span>
    <span class="s1">errorLoading</span><span class="s2">: </span><span class="s3">function </span><span class="s2">() {</span>
      <span class="s3">return </span><span class="s4">'The results could not be loaded.'</span><span class="s2">;</span>
    <span class="s2">},</span>
    <span class="s1">inputTooLong</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">args</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">overChars </span><span class="s2">= </span><span class="s1">args</span><span class="s2">.</span><span class="s1">input</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s1">args</span><span class="s2">.</span><span class="s1">maximum</span><span class="s2">;</span>

      <span class="s3">var </span><span class="s1">message </span><span class="s2">= </span><span class="s4">'Please delete ' </span><span class="s2">+ </span><span class="s1">overChars </span><span class="s2">+ </span><span class="s4">' character'</span><span class="s2">;</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">overChars </span><span class="s2">!= </span><span class="s8">1</span><span class="s2">) {</span>
        <span class="s1">message </span><span class="s2">+= </span><span class="s4">'s'</span><span class="s2">;</span>
      <span class="s2">}</span>

      <span class="s3">return </span><span class="s1">message</span><span class="s2">;</span>
    <span class="s2">},</span>
    <span class="s1">inputTooShort</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">args</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">remainingChars </span><span class="s2">= </span><span class="s1">args</span><span class="s2">.</span><span class="s1">minimum </span><span class="s2">- </span><span class="s1">args</span><span class="s2">.</span><span class="s1">input</span><span class="s2">.</span><span class="s1">length</span><span class="s2">;</span>

      <span class="s3">var </span><span class="s1">message </span><span class="s2">= </span><span class="s4">'Please enter ' </span><span class="s2">+ </span><span class="s1">remainingChars </span><span class="s2">+ </span><span class="s4">' or more characters'</span><span class="s2">;</span>

      <span class="s3">return </span><span class="s1">message</span><span class="s2">;</span>
    <span class="s2">},</span>
    <span class="s1">loadingMore</span><span class="s2">: </span><span class="s3">function </span><span class="s2">() {</span>
      <span class="s3">return </span><span class="s4">'Loading more results'</span><span class="s2">;</span>
    <span class="s2">},</span>
    <span class="s1">maximumSelected</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">args</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">message </span><span class="s2">= </span><span class="s4">'You can only select ' </span><span class="s2">+ </span><span class="s1">args</span><span class="s2">.</span><span class="s1">maximum </span><span class="s2">+ </span><span class="s4">' item'</span><span class="s2">;</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">args</span><span class="s2">.</span><span class="s1">maximum </span><span class="s2">!= </span><span class="s8">1</span><span class="s2">) {</span>
        <span class="s1">message </span><span class="s2">+= </span><span class="s4">'s'</span><span class="s2">;</span>
      <span class="s2">}</span>

      <span class="s3">return </span><span class="s1">message</span><span class="s2">;</span>
    <span class="s2">},</span>
    <span class="s1">noResults</span><span class="s2">: </span><span class="s3">function </span><span class="s2">() {</span>
      <span class="s3">return </span><span class="s4">'No results found'</span><span class="s2">;</span>
    <span class="s2">},</span>
    <span class="s1">searching</span><span class="s2">: </span><span class="s3">function </span><span class="s2">() {</span>
      <span class="s3">return </span><span class="s4">'Searching'</span><span class="s2">;</span>
    <span class="s2">},</span>
    <span class="s1">removeAllItems</span><span class="s2">: </span><span class="s3">function </span><span class="s2">() {</span>
      <span class="s3">return </span><span class="s4">'Remove all items'</span><span class="s2">;</span>
    <span class="s2">}</span>
  <span class="s2">};</span>
<span class="s2">});</span>

<span class="s1">S2</span><span class="s2">.</span><span class="s1">define</span><span class="s2">(</span><span class="s4">'select2/defaults'</span><span class="s2">,[</span>
  <span class="s4">'jquery'</span><span class="s2">,</span>
  <span class="s4">'require'</span><span class="s2">,</span>

  <span class="s4">'./results'</span><span class="s2">,</span>

  <span class="s4">'./selection/single'</span><span class="s2">,</span>
  <span class="s4">'./selection/multiple'</span><span class="s2">,</span>
  <span class="s4">'./selection/placeholder'</span><span class="s2">,</span>
  <span class="s4">'./selection/allowClear'</span><span class="s2">,</span>
  <span class="s4">'./selection/search'</span><span class="s2">,</span>
  <span class="s4">'./selection/eventRelay'</span><span class="s2">,</span>

  <span class="s4">'./utils'</span><span class="s2">,</span>
  <span class="s4">'./translation'</span><span class="s2">,</span>
  <span class="s4">'./diacritics'</span><span class="s2">,</span>

  <span class="s4">'./data/select'</span><span class="s2">,</span>
  <span class="s4">'./data/array'</span><span class="s2">,</span>
  <span class="s4">'./data/ajax'</span><span class="s2">,</span>
  <span class="s4">'./data/tags'</span><span class="s2">,</span>
  <span class="s4">'./data/tokenizer'</span><span class="s2">,</span>
  <span class="s4">'./data/minimumInputLength'</span><span class="s2">,</span>
  <span class="s4">'./data/maximumInputLength'</span><span class="s2">,</span>
  <span class="s4">'./data/maximumSelectionLength'</span><span class="s2">,</span>

  <span class="s4">'./dropdown'</span><span class="s2">,</span>
  <span class="s4">'./dropdown/search'</span><span class="s2">,</span>
  <span class="s4">'./dropdown/hidePlaceholder'</span><span class="s2">,</span>
  <span class="s4">'./dropdown/infiniteScroll'</span><span class="s2">,</span>
  <span class="s4">'./dropdown/attachBody'</span><span class="s2">,</span>
  <span class="s4">'./dropdown/minimumResultsForSearch'</span><span class="s2">,</span>
  <span class="s4">'./dropdown/selectOnClose'</span><span class="s2">,</span>
  <span class="s4">'./dropdown/closeOnSelect'</span><span class="s2">,</span>

  <span class="s4">'./i18n/en'</span>
<span class="s2">], </span><span class="s3">function </span><span class="s2">(</span><span class="s1">$</span><span class="s2">, </span><span class="s1">require</span><span class="s2">,</span>

             <span class="s1">ResultsList</span><span class="s2">,</span>

             <span class="s1">SingleSelection</span><span class="s2">, </span><span class="s1">MultipleSelection</span><span class="s2">, </span><span class="s1">Placeholder</span><span class="s2">, </span><span class="s1">AllowClear</span><span class="s2">,</span>
             <span class="s1">SelectionSearch</span><span class="s2">, </span><span class="s1">EventRelay</span><span class="s2">,</span>

             <span class="s1">Utils</span><span class="s2">, </span><span class="s1">Translation</span><span class="s2">, </span><span class="s1">DIACRITICS</span><span class="s2">,</span>

             <span class="s1">SelectData</span><span class="s2">, </span><span class="s1">ArrayData</span><span class="s2">, </span><span class="s1">AjaxData</span><span class="s2">, </span><span class="s1">Tags</span><span class="s2">, </span><span class="s1">Tokenizer</span><span class="s2">,</span>
             <span class="s1">MinimumInputLength</span><span class="s2">, </span><span class="s1">MaximumInputLength</span><span class="s2">, </span><span class="s1">MaximumSelectionLength</span><span class="s2">,</span>

             <span class="s1">Dropdown</span><span class="s2">, </span><span class="s1">DropdownSearch</span><span class="s2">, </span><span class="s1">HidePlaceholder</span><span class="s2">, </span><span class="s1">InfiniteScroll</span><span class="s2">,</span>
             <span class="s1">AttachBody</span><span class="s2">, </span><span class="s1">MinimumResultsForSearch</span><span class="s2">, </span><span class="s1">SelectOnClose</span><span class="s2">, </span><span class="s1">CloseOnSelect</span><span class="s2">,</span>

             <span class="s1">EnglishTranslation</span><span class="s2">) {</span>
  <span class="s3">function </span><span class="s1">Defaults </span><span class="s2">() {</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">reset</span><span class="s2">();</span>
  <span class="s2">}</span>

  <span class="s1">Defaults</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">apply </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">options</span><span class="s2">) {</span>
    <span class="s1">options </span><span class="s2">= </span><span class="s1">$</span><span class="s2">.</span><span class="s1">extend</span><span class="s2">(</span><span class="s3">true</span><span class="s2">, {}, </span><span class="s3">this</span><span class="s2">.</span><span class="s1">defaults</span><span class="s2">, </span><span class="s1">options</span><span class="s2">);</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">options</span><span class="s2">.</span><span class="s1">dataAdapter </span><span class="s2">== </span><span class="s3">null</span><span class="s2">) {</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">options</span><span class="s2">.</span><span class="s1">ajax </span><span class="s2">!= </span><span class="s3">null</span><span class="s2">) {</span>
        <span class="s1">options</span><span class="s2">.</span><span class="s1">dataAdapter </span><span class="s2">= </span><span class="s1">AjaxData</span><span class="s2">;</span>
      <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">options</span><span class="s2">.</span><span class="s1">data </span><span class="s2">!= </span><span class="s3">null</span><span class="s2">) {</span>
        <span class="s1">options</span><span class="s2">.</span><span class="s1">dataAdapter </span><span class="s2">= </span><span class="s1">ArrayData</span><span class="s2">;</span>
      <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
        <span class="s1">options</span><span class="s2">.</span><span class="s1">dataAdapter </span><span class="s2">= </span><span class="s1">SelectData</span><span class="s2">;</span>
      <span class="s2">}</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">options</span><span class="s2">.</span><span class="s1">minimumInputLength </span><span class="s2">&gt; </span><span class="s8">0</span><span class="s2">) {</span>
        <span class="s1">options</span><span class="s2">.</span><span class="s1">dataAdapter </span><span class="s2">= </span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">Decorate</span><span class="s2">(</span>
          <span class="s1">options</span><span class="s2">.</span><span class="s1">dataAdapter</span><span class="s2">,</span>
          <span class="s1">MinimumInputLength</span>
        <span class="s2">);</span>
      <span class="s2">}</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">options</span><span class="s2">.</span><span class="s1">maximumInputLength </span><span class="s2">&gt; </span><span class="s8">0</span><span class="s2">) {</span>
        <span class="s1">options</span><span class="s2">.</span><span class="s1">dataAdapter </span><span class="s2">= </span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">Decorate</span><span class="s2">(</span>
          <span class="s1">options</span><span class="s2">.</span><span class="s1">dataAdapter</span><span class="s2">,</span>
          <span class="s1">MaximumInputLength</span>
        <span class="s2">);</span>
      <span class="s2">}</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">options</span><span class="s2">.</span><span class="s1">maximumSelectionLength </span><span class="s2">&gt; </span><span class="s8">0</span><span class="s2">) {</span>
        <span class="s1">options</span><span class="s2">.</span><span class="s1">dataAdapter </span><span class="s2">= </span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">Decorate</span><span class="s2">(</span>
          <span class="s1">options</span><span class="s2">.</span><span class="s1">dataAdapter</span><span class="s2">,</span>
          <span class="s1">MaximumSelectionLength</span>
        <span class="s2">);</span>
      <span class="s2">}</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">options</span><span class="s2">.</span><span class="s1">tags</span><span class="s2">) {</span>
        <span class="s1">options</span><span class="s2">.</span><span class="s1">dataAdapter </span><span class="s2">= </span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">Decorate</span><span class="s2">(</span><span class="s1">options</span><span class="s2">.</span><span class="s1">dataAdapter</span><span class="s2">, </span><span class="s1">Tags</span><span class="s2">);</span>
      <span class="s2">}</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">options</span><span class="s2">.</span><span class="s1">tokenSeparators </span><span class="s2">!= </span><span class="s3">null </span><span class="s2">|| </span><span class="s1">options</span><span class="s2">.</span><span class="s1">tokenizer </span><span class="s2">!= </span><span class="s3">null</span><span class="s2">) {</span>
        <span class="s1">options</span><span class="s2">.</span><span class="s1">dataAdapter </span><span class="s2">= </span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">Decorate</span><span class="s2">(</span>
          <span class="s1">options</span><span class="s2">.</span><span class="s1">dataAdapter</span><span class="s2">,</span>
          <span class="s1">Tokenizer</span>
        <span class="s2">);</span>
      <span class="s2">}</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">options</span><span class="s2">.</span><span class="s1">query </span><span class="s2">!= </span><span class="s3">null</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">Query </span><span class="s2">= </span><span class="s1">require</span><span class="s2">(</span><span class="s1">options</span><span class="s2">.</span><span class="s1">amdBase </span><span class="s2">+ </span><span class="s4">'compat/query'</span><span class="s2">);</span>

        <span class="s1">options</span><span class="s2">.</span><span class="s1">dataAdapter </span><span class="s2">= </span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">Decorate</span><span class="s2">(</span>
          <span class="s1">options</span><span class="s2">.</span><span class="s1">dataAdapter</span><span class="s2">,</span>
          <span class="s1">Query</span>
        <span class="s2">);</span>
      <span class="s2">}</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">options</span><span class="s2">.</span><span class="s1">initSelection </span><span class="s2">!= </span><span class="s3">null</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">InitSelection </span><span class="s2">= </span><span class="s1">require</span><span class="s2">(</span><span class="s1">options</span><span class="s2">.</span><span class="s1">amdBase </span><span class="s2">+ </span><span class="s4">'compat/initSelection'</span><span class="s2">);</span>

        <span class="s1">options</span><span class="s2">.</span><span class="s1">dataAdapter </span><span class="s2">= </span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">Decorate</span><span class="s2">(</span>
          <span class="s1">options</span><span class="s2">.</span><span class="s1">dataAdapter</span><span class="s2">,</span>
          <span class="s1">InitSelection</span>
        <span class="s2">);</span>
      <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">options</span><span class="s2">.</span><span class="s1">resultsAdapter </span><span class="s2">== </span><span class="s3">null</span><span class="s2">) {</span>
      <span class="s1">options</span><span class="s2">.</span><span class="s1">resultsAdapter </span><span class="s2">= </span><span class="s1">ResultsList</span><span class="s2">;</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">options</span><span class="s2">.</span><span class="s1">ajax </span><span class="s2">!= </span><span class="s3">null</span><span class="s2">) {</span>
        <span class="s1">options</span><span class="s2">.</span><span class="s1">resultsAdapter </span><span class="s2">= </span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">Decorate</span><span class="s2">(</span>
          <span class="s1">options</span><span class="s2">.</span><span class="s1">resultsAdapter</span><span class="s2">,</span>
          <span class="s1">InfiniteScroll</span>
        <span class="s2">);</span>
      <span class="s2">}</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">options</span><span class="s2">.</span><span class="s1">placeholder </span><span class="s2">!= </span><span class="s3">null</span><span class="s2">) {</span>
        <span class="s1">options</span><span class="s2">.</span><span class="s1">resultsAdapter </span><span class="s2">= </span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">Decorate</span><span class="s2">(</span>
          <span class="s1">options</span><span class="s2">.</span><span class="s1">resultsAdapter</span><span class="s2">,</span>
          <span class="s1">HidePlaceholder</span>
        <span class="s2">);</span>
      <span class="s2">}</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">options</span><span class="s2">.</span><span class="s1">selectOnClose</span><span class="s2">) {</span>
        <span class="s1">options</span><span class="s2">.</span><span class="s1">resultsAdapter </span><span class="s2">= </span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">Decorate</span><span class="s2">(</span>
          <span class="s1">options</span><span class="s2">.</span><span class="s1">resultsAdapter</span><span class="s2">,</span>
          <span class="s1">SelectOnClose</span>
        <span class="s2">);</span>
      <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">options</span><span class="s2">.</span><span class="s1">dropdownAdapter </span><span class="s2">== </span><span class="s3">null</span><span class="s2">) {</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">options</span><span class="s2">.</span><span class="s1">multiple</span><span class="s2">) {</span>
        <span class="s1">options</span><span class="s2">.</span><span class="s1">dropdownAdapter </span><span class="s2">= </span><span class="s1">Dropdown</span><span class="s2">;</span>
      <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
        <span class="s3">var </span><span class="s1">SearchableDropdown </span><span class="s2">= </span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">Decorate</span><span class="s2">(</span><span class="s1">Dropdown</span><span class="s2">, </span><span class="s1">DropdownSearch</span><span class="s2">);</span>

        <span class="s1">options</span><span class="s2">.</span><span class="s1">dropdownAdapter </span><span class="s2">= </span><span class="s1">SearchableDropdown</span><span class="s2">;</span>
      <span class="s2">}</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">options</span><span class="s2">.</span><span class="s1">minimumResultsForSearch </span><span class="s2">!== </span><span class="s8">0</span><span class="s2">) {</span>
        <span class="s1">options</span><span class="s2">.</span><span class="s1">dropdownAdapter </span><span class="s2">= </span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">Decorate</span><span class="s2">(</span>
          <span class="s1">options</span><span class="s2">.</span><span class="s1">dropdownAdapter</span><span class="s2">,</span>
          <span class="s1">MinimumResultsForSearch</span>
        <span class="s2">);</span>
      <span class="s2">}</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">options</span><span class="s2">.</span><span class="s1">closeOnSelect</span><span class="s2">) {</span>
        <span class="s1">options</span><span class="s2">.</span><span class="s1">dropdownAdapter </span><span class="s2">= </span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">Decorate</span><span class="s2">(</span>
          <span class="s1">options</span><span class="s2">.</span><span class="s1">dropdownAdapter</span><span class="s2">,</span>
          <span class="s1">CloseOnSelect</span>
        <span class="s2">);</span>
      <span class="s2">}</span>

      <span class="s3">if </span><span class="s2">(</span>
        <span class="s1">options</span><span class="s2">.</span><span class="s1">dropdownCssClass </span><span class="s2">!= </span><span class="s3">null </span><span class="s2">||</span>
        <span class="s1">options</span><span class="s2">.</span><span class="s1">dropdownCss </span><span class="s2">!= </span><span class="s3">null </span><span class="s2">||</span>
        <span class="s1">options</span><span class="s2">.</span><span class="s1">adaptDropdownCssClass </span><span class="s2">!= </span><span class="s3">null</span>
      <span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">DropdownCSS </span><span class="s2">= </span><span class="s1">require</span><span class="s2">(</span><span class="s1">options</span><span class="s2">.</span><span class="s1">amdBase </span><span class="s2">+ </span><span class="s4">'compat/dropdownCss'</span><span class="s2">);</span>

        <span class="s1">options</span><span class="s2">.</span><span class="s1">dropdownAdapter </span><span class="s2">= </span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">Decorate</span><span class="s2">(</span>
          <span class="s1">options</span><span class="s2">.</span><span class="s1">dropdownAdapter</span><span class="s2">,</span>
          <span class="s1">DropdownCSS</span>
        <span class="s2">);</span>
      <span class="s2">}</span>

      <span class="s1">options</span><span class="s2">.</span><span class="s1">dropdownAdapter </span><span class="s2">= </span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">Decorate</span><span class="s2">(</span>
        <span class="s1">options</span><span class="s2">.</span><span class="s1">dropdownAdapter</span><span class="s2">,</span>
        <span class="s1">AttachBody</span>
      <span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">options</span><span class="s2">.</span><span class="s1">selectionAdapter </span><span class="s2">== </span><span class="s3">null</span><span class="s2">) {</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">options</span><span class="s2">.</span><span class="s1">multiple</span><span class="s2">) {</span>
        <span class="s1">options</span><span class="s2">.</span><span class="s1">selectionAdapter </span><span class="s2">= </span><span class="s1">MultipleSelection</span><span class="s2">;</span>
      <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
        <span class="s1">options</span><span class="s2">.</span><span class="s1">selectionAdapter </span><span class="s2">= </span><span class="s1">SingleSelection</span><span class="s2">;</span>
      <span class="s2">}</span>

      <span class="s0">// Add the placeholder mixin if a placeholder was specified</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">options</span><span class="s2">.</span><span class="s1">placeholder </span><span class="s2">!= </span><span class="s3">null</span><span class="s2">) {</span>
        <span class="s1">options</span><span class="s2">.</span><span class="s1">selectionAdapter </span><span class="s2">= </span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">Decorate</span><span class="s2">(</span>
          <span class="s1">options</span><span class="s2">.</span><span class="s1">selectionAdapter</span><span class="s2">,</span>
          <span class="s1">Placeholder</span>
        <span class="s2">);</span>
      <span class="s2">}</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">options</span><span class="s2">.</span><span class="s1">allowClear</span><span class="s2">) {</span>
        <span class="s1">options</span><span class="s2">.</span><span class="s1">selectionAdapter </span><span class="s2">= </span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">Decorate</span><span class="s2">(</span>
          <span class="s1">options</span><span class="s2">.</span><span class="s1">selectionAdapter</span><span class="s2">,</span>
          <span class="s1">AllowClear</span>
        <span class="s2">);</span>
      <span class="s2">}</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">options</span><span class="s2">.</span><span class="s1">multiple</span><span class="s2">) {</span>
        <span class="s1">options</span><span class="s2">.</span><span class="s1">selectionAdapter </span><span class="s2">= </span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">Decorate</span><span class="s2">(</span>
          <span class="s1">options</span><span class="s2">.</span><span class="s1">selectionAdapter</span><span class="s2">,</span>
          <span class="s1">SelectionSearch</span>
        <span class="s2">);</span>
      <span class="s2">}</span>

      <span class="s3">if </span><span class="s2">(</span>
        <span class="s1">options</span><span class="s2">.</span><span class="s1">containerCssClass </span><span class="s2">!= </span><span class="s3">null </span><span class="s2">||</span>
        <span class="s1">options</span><span class="s2">.</span><span class="s1">containerCss </span><span class="s2">!= </span><span class="s3">null </span><span class="s2">||</span>
        <span class="s1">options</span><span class="s2">.</span><span class="s1">adaptContainerCssClass </span><span class="s2">!= </span><span class="s3">null</span>
      <span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">ContainerCSS </span><span class="s2">= </span><span class="s1">require</span><span class="s2">(</span><span class="s1">options</span><span class="s2">.</span><span class="s1">amdBase </span><span class="s2">+ </span><span class="s4">'compat/containerCss'</span><span class="s2">);</span>

        <span class="s1">options</span><span class="s2">.</span><span class="s1">selectionAdapter </span><span class="s2">= </span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">Decorate</span><span class="s2">(</span>
          <span class="s1">options</span><span class="s2">.</span><span class="s1">selectionAdapter</span><span class="s2">,</span>
          <span class="s1">ContainerCSS</span>
        <span class="s2">);</span>
      <span class="s2">}</span>

      <span class="s1">options</span><span class="s2">.</span><span class="s1">selectionAdapter </span><span class="s2">= </span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">Decorate</span><span class="s2">(</span>
        <span class="s1">options</span><span class="s2">.</span><span class="s1">selectionAdapter</span><span class="s2">,</span>
        <span class="s1">EventRelay</span>
      <span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s0">// If the defaults were not previously applied from an element, it is</span>
    <span class="s0">// possible for the language option to have not been resolved</span>
    <span class="s1">options</span><span class="s2">.</span><span class="s1">language </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">_resolveLanguage</span><span class="s2">(</span><span class="s1">options</span><span class="s2">.</span><span class="s1">language</span><span class="s2">);</span>

    <span class="s0">// Always fall back to English since it will always be complete</span>
    <span class="s1">options</span><span class="s2">.</span><span class="s1">language</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s4">'en'</span><span class="s2">);</span>

    <span class="s3">var </span><span class="s1">uniqueLanguages </span><span class="s2">= [];</span>

    <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">l </span><span class="s2">= </span><span class="s8">0</span><span class="s2">; </span><span class="s1">l </span><span class="s2">&lt; </span><span class="s1">options</span><span class="s2">.</span><span class="s1">language</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">l</span><span class="s2">++) {</span>
      <span class="s3">var </span><span class="s1">language </span><span class="s2">= </span><span class="s1">options</span><span class="s2">.</span><span class="s1">language</span><span class="s2">[</span><span class="s1">l</span><span class="s2">];</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">uniqueLanguages</span><span class="s2">.</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s1">language</span><span class="s2">) === -</span><span class="s8">1</span><span class="s2">) {</span>
        <span class="s1">uniqueLanguages</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">language</span><span class="s2">);</span>
      <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s1">options</span><span class="s2">.</span><span class="s1">language </span><span class="s2">= </span><span class="s1">uniqueLanguages</span><span class="s2">;</span>

    <span class="s1">options</span><span class="s2">.</span><span class="s1">translations </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">_processTranslations</span><span class="s2">(</span>
      <span class="s1">options</span><span class="s2">.</span><span class="s1">language</span><span class="s2">,</span>
      <span class="s1">options</span><span class="s2">.</span><span class="s1">debug</span>
    <span class="s2">);</span>

    <span class="s3">return </span><span class="s1">options</span><span class="s2">;</span>
  <span class="s2">};</span>

  <span class="s1">Defaults</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">reset </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {</span>
    <span class="s3">function </span><span class="s1">stripDiacritics </span><span class="s2">(</span><span class="s1">text</span><span class="s2">) {</span>
      <span class="s0">// Used 'uni range + named function' from http://jsperf.com/diacritics/18</span>
      <span class="s3">function </span><span class="s1">match</span><span class="s2">(</span><span class="s1">a</span><span class="s2">) {</span>
        <span class="s3">return </span><span class="s1">DIACRITICS</span><span class="s2">[</span><span class="s1">a</span><span class="s2">] || </span><span class="s1">a</span><span class="s2">;</span>
      <span class="s2">}</span>

      <span class="s3">return </span><span class="s1">text</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s7">/[^\u0000-\u007E]/g</span><span class="s2">, </span><span class="s1">match</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">matcher </span><span class="s2">(</span><span class="s1">params</span><span class="s2">, </span><span class="s1">data</span><span class="s2">) {</span>
      <span class="s0">// Always return the object if there is nothing to compare</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">$</span><span class="s2">.</span><span class="s1">trim</span><span class="s2">(</span><span class="s1">params</span><span class="s2">.</span><span class="s1">term</span><span class="s2">) === </span><span class="s4">''</span><span class="s2">) {</span>
        <span class="s3">return </span><span class="s1">data</span><span class="s2">;</span>
      <span class="s2">}</span>

      <span class="s0">// Do a recursive check for options with children</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">data</span><span class="s2">.</span><span class="s1">children </span><span class="s2">&amp;&amp; </span><span class="s1">data</span><span class="s2">.</span><span class="s1">children</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt; </span><span class="s8">0</span><span class="s2">) {</span>
        <span class="s0">// Clone the data object if there are children</span>
        <span class="s0">// This is required as we modify the object to remove any non-matches</span>
        <span class="s3">var </span><span class="s1">match </span><span class="s2">= </span><span class="s1">$</span><span class="s2">.</span><span class="s1">extend</span><span class="s2">(</span><span class="s3">true</span><span class="s2">, {}, </span><span class="s1">data</span><span class="s2">);</span>

        <span class="s0">// Check each child of the option</span>
        <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">c </span><span class="s2">= </span><span class="s1">data</span><span class="s2">.</span><span class="s1">children</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s8">1</span><span class="s2">; </span><span class="s1">c </span><span class="s2">&gt;= </span><span class="s8">0</span><span class="s2">; </span><span class="s1">c</span><span class="s2">--) {</span>
          <span class="s3">var </span><span class="s1">child </span><span class="s2">= </span><span class="s1">data</span><span class="s2">.</span><span class="s1">children</span><span class="s2">[</span><span class="s1">c</span><span class="s2">];</span>

          <span class="s3">var </span><span class="s1">matches </span><span class="s2">= </span><span class="s1">matcher</span><span class="s2">(</span><span class="s1">params</span><span class="s2">, </span><span class="s1">child</span><span class="s2">);</span>

          <span class="s0">// If there wasn't a match, remove the object in the array</span>
          <span class="s3">if </span><span class="s2">(</span><span class="s1">matches </span><span class="s2">== </span><span class="s3">null</span><span class="s2">) {</span>
            <span class="s1">match</span><span class="s2">.</span><span class="s1">children</span><span class="s2">.</span><span class="s1">splice</span><span class="s2">(</span><span class="s1">c</span><span class="s2">, </span><span class="s8">1</span><span class="s2">);</span>
          <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s0">// If any children matched, return the new object</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">match</span><span class="s2">.</span><span class="s1">children</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt; </span><span class="s8">0</span><span class="s2">) {</span>
          <span class="s3">return </span><span class="s1">match</span><span class="s2">;</span>
        <span class="s2">}</span>

        <span class="s0">// If there were no matching children, check just the plain object</span>
        <span class="s3">return </span><span class="s1">matcher</span><span class="s2">(</span><span class="s1">params</span><span class="s2">, </span><span class="s1">match</span><span class="s2">);</span>
      <span class="s2">}</span>

      <span class="s3">var </span><span class="s1">original </span><span class="s2">= </span><span class="s1">stripDiacritics</span><span class="s2">(</span><span class="s1">data</span><span class="s2">.</span><span class="s1">text</span><span class="s2">).</span><span class="s1">toUpperCase</span><span class="s2">();</span>
      <span class="s3">var </span><span class="s1">term </span><span class="s2">= </span><span class="s1">stripDiacritics</span><span class="s2">(</span><span class="s1">params</span><span class="s2">.</span><span class="s1">term</span><span class="s2">).</span><span class="s1">toUpperCase</span><span class="s2">();</span>

      <span class="s0">// Check if the text contains the term</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">original</span><span class="s2">.</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s1">term</span><span class="s2">) &gt; -</span><span class="s8">1</span><span class="s2">) {</span>
        <span class="s3">return </span><span class="s1">data</span><span class="s2">;</span>
      <span class="s2">}</span>

      <span class="s0">// If it doesn't contain the term, don't return anything</span>
      <span class="s3">return null</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">defaults </span><span class="s2">= {</span>
      <span class="s1">amdBase</span><span class="s2">: </span><span class="s4">'./'</span><span class="s2">,</span>
      <span class="s1">amdLanguageBase</span><span class="s2">: </span><span class="s4">'./i18n/'</span><span class="s2">,</span>
      <span class="s1">closeOnSelect</span><span class="s2">: </span><span class="s3">true</span><span class="s2">,</span>
      <span class="s1">debug</span><span class="s2">: </span><span class="s3">false</span><span class="s2">,</span>
      <span class="s1">dropdownAutoWidth</span><span class="s2">: </span><span class="s3">false</span><span class="s2">,</span>
      <span class="s1">escapeMarkup</span><span class="s2">: </span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">escapeMarkup</span><span class="s2">,</span>
      <span class="s1">language</span><span class="s2">: {},</span>
      <span class="s1">matcher</span><span class="s2">: </span><span class="s1">matcher</span><span class="s2">,</span>
      <span class="s1">minimumInputLength</span><span class="s2">: </span><span class="s8">0</span><span class="s2">,</span>
      <span class="s1">maximumInputLength</span><span class="s2">: </span><span class="s8">0</span><span class="s2">,</span>
      <span class="s1">maximumSelectionLength</span><span class="s2">: </span><span class="s8">0</span><span class="s2">,</span>
      <span class="s1">minimumResultsForSearch</span><span class="s2">: </span><span class="s8">0</span><span class="s2">,</span>
      <span class="s1">selectOnClose</span><span class="s2">: </span><span class="s3">false</span><span class="s2">,</span>
      <span class="s1">scrollAfterSelect</span><span class="s2">: </span><span class="s3">false</span><span class="s2">,</span>
      <span class="s1">sorter</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">data</span><span class="s2">) {</span>
        <span class="s3">return </span><span class="s1">data</span><span class="s2">;</span>
      <span class="s2">},</span>
      <span class="s1">templateResult</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">result</span><span class="s2">) {</span>
        <span class="s3">return </span><span class="s1">result</span><span class="s2">.</span><span class="s1">text</span><span class="s2">;</span>
      <span class="s2">},</span>
      <span class="s1">templateSelection</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">selection</span><span class="s2">) {</span>
        <span class="s3">return </span><span class="s1">selection</span><span class="s2">.</span><span class="s1">text</span><span class="s2">;</span>
      <span class="s2">},</span>
      <span class="s1">theme</span><span class="s2">: </span><span class="s4">'default'</span><span class="s2">,</span>
      <span class="s1">width</span><span class="s2">: </span><span class="s4">'resolve'</span>
    <span class="s2">};</span>
  <span class="s2">};</span>

  <span class="s1">Defaults</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">applyFromElement </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">options</span><span class="s2">, </span><span class="s1">$element</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">optionLanguage </span><span class="s2">= </span><span class="s1">options</span><span class="s2">.</span><span class="s1">language</span><span class="s2">;</span>
    <span class="s3">var </span><span class="s1">defaultLanguage </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">defaults</span><span class="s2">.</span><span class="s1">language</span><span class="s2">;</span>
    <span class="s3">var </span><span class="s1">elementLanguage </span><span class="s2">= </span><span class="s1">$element</span><span class="s2">.</span><span class="s1">prop</span><span class="s2">(</span><span class="s4">'lang'</span><span class="s2">);</span>
    <span class="s3">var </span><span class="s1">parentLanguage </span><span class="s2">= </span><span class="s1">$element</span><span class="s2">.</span><span class="s1">closest</span><span class="s2">(</span><span class="s4">'[lang]'</span><span class="s2">).</span><span class="s1">prop</span><span class="s2">(</span><span class="s4">'lang'</span><span class="s2">);</span>

    <span class="s3">var </span><span class="s1">languages </span><span class="s2">= </span><span class="s1">Array</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">concat</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">_resolveLanguage</span><span class="s2">(</span><span class="s1">elementLanguage</span><span class="s2">),</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">_resolveLanguage</span><span class="s2">(</span><span class="s1">optionLanguage</span><span class="s2">),</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">_resolveLanguage</span><span class="s2">(</span><span class="s1">defaultLanguage</span><span class="s2">),</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">_resolveLanguage</span><span class="s2">(</span><span class="s1">parentLanguage</span><span class="s2">)</span>
    <span class="s2">);</span>

    <span class="s1">options</span><span class="s2">.</span><span class="s1">language </span><span class="s2">= </span><span class="s1">languages</span><span class="s2">;</span>

    <span class="s3">return </span><span class="s1">options</span><span class="s2">;</span>
  <span class="s2">};</span>

  <span class="s1">Defaults</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">_resolveLanguage </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">language</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(!</span><span class="s1">language</span><span class="s2">) {</span>
      <span class="s3">return </span><span class="s2">[];</span>
    <span class="s2">}</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">$</span><span class="s2">.</span><span class="s1">isEmptyObject</span><span class="s2">(</span><span class="s1">language</span><span class="s2">)) {</span>
      <span class="s3">return </span><span class="s2">[];</span>
    <span class="s2">}</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">$</span><span class="s2">.</span><span class="s1">isPlainObject</span><span class="s2">(</span><span class="s1">language</span><span class="s2">)) {</span>
      <span class="s3">return </span><span class="s2">[</span><span class="s1">language</span><span class="s2">];</span>
    <span class="s2">}</span>

    <span class="s3">var </span><span class="s1">languages</span><span class="s2">;</span>

    <span class="s3">if </span><span class="s2">(!</span><span class="s1">$</span><span class="s2">.</span><span class="s1">isArray</span><span class="s2">(</span><span class="s1">language</span><span class="s2">)) {</span>
      <span class="s1">languages </span><span class="s2">= [</span><span class="s1">language</span><span class="s2">];</span>
    <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
      <span class="s1">languages </span><span class="s2">= </span><span class="s1">language</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">var </span><span class="s1">resolvedLanguages </span><span class="s2">= [];</span>

    <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">l </span><span class="s2">= </span><span class="s8">0</span><span class="s2">; </span><span class="s1">l </span><span class="s2">&lt; </span><span class="s1">languages</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">l</span><span class="s2">++) {</span>
      <span class="s1">resolvedLanguages</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">languages</span><span class="s2">[</span><span class="s1">l</span><span class="s2">]);</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">languages</span><span class="s2">[</span><span class="s1">l</span><span class="s2">] === </span><span class="s4">'string' </span><span class="s2">&amp;&amp; </span><span class="s1">languages</span><span class="s2">[</span><span class="s1">l</span><span class="s2">].</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s4">'-'</span><span class="s2">) &gt; </span><span class="s8">0</span><span class="s2">) {</span>
        <span class="s0">// Extract the region information if it is included</span>
        <span class="s3">var </span><span class="s1">languageParts </span><span class="s2">= </span><span class="s1">languages</span><span class="s2">[</span><span class="s1">l</span><span class="s2">].</span><span class="s1">split</span><span class="s2">(</span><span class="s4">'-'</span><span class="s2">);</span>
        <span class="s3">var </span><span class="s1">baseLanguage </span><span class="s2">= </span><span class="s1">languageParts</span><span class="s2">[</span><span class="s8">0</span><span class="s2">];</span>

        <span class="s1">resolvedLanguages</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">baseLanguage</span><span class="s2">);</span>
      <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s3">return </span><span class="s1">resolvedLanguages</span><span class="s2">;</span>
  <span class="s2">};</span>

  <span class="s1">Defaults</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">_processTranslations </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">languages</span><span class="s2">, </span><span class="s1">debug</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">translations </span><span class="s2">= </span><span class="s3">new </span><span class="s1">Translation</span><span class="s2">();</span>

    <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">l </span><span class="s2">= </span><span class="s8">0</span><span class="s2">; </span><span class="s1">l </span><span class="s2">&lt; </span><span class="s1">languages</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">l</span><span class="s2">++) {</span>
      <span class="s3">var </span><span class="s1">languageData </span><span class="s2">= </span><span class="s3">new </span><span class="s1">Translation</span><span class="s2">();</span>

      <span class="s3">var </span><span class="s1">language </span><span class="s2">= </span><span class="s1">languages</span><span class="s2">[</span><span class="s1">l</span><span class="s2">];</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">language </span><span class="s2">=== </span><span class="s4">'string'</span><span class="s2">) {</span>
        <span class="s3">try </span><span class="s2">{</span>
          <span class="s0">// Try to load it with the original name</span>
          <span class="s1">languageData </span><span class="s2">= </span><span class="s1">Translation</span><span class="s2">.</span><span class="s1">loadPath</span><span class="s2">(</span><span class="s1">language</span><span class="s2">);</span>
        <span class="s2">} </span><span class="s3">catch </span><span class="s2">(</span><span class="s1">e</span><span class="s2">) {</span>
          <span class="s3">try </span><span class="s2">{</span>
            <span class="s0">// If we couldn't load it, check if it wasn't the full path</span>
            <span class="s1">language </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">defaults</span><span class="s2">.</span><span class="s1">amdLanguageBase </span><span class="s2">+ </span><span class="s1">language</span><span class="s2">;</span>
            <span class="s1">languageData </span><span class="s2">= </span><span class="s1">Translation</span><span class="s2">.</span><span class="s1">loadPath</span><span class="s2">(</span><span class="s1">language</span><span class="s2">);</span>
          <span class="s2">} </span><span class="s3">catch </span><span class="s2">(</span><span class="s1">ex</span><span class="s2">) {</span>
            <span class="s0">// The translation could not be loaded at all. Sometimes this is</span>
            <span class="s0">// because of a configuration problem, other times this can be</span>
            <span class="s0">// because of how Select2 helps load all possible translation files</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">debug </span><span class="s2">&amp;&amp; </span><span class="s1">window</span><span class="s2">.</span><span class="s1">console </span><span class="s2">&amp;&amp; </span><span class="s1">console</span><span class="s2">.</span><span class="s1">warn</span><span class="s2">) {</span>
              <span class="s1">console</span><span class="s2">.</span><span class="s1">warn</span><span class="s2">(</span>
                <span class="s4">'Select2: The language file for &quot;' </span><span class="s2">+ </span><span class="s1">language </span><span class="s2">+ </span><span class="s4">'&quot; could ' </span><span class="s2">+</span>
                <span class="s4">'not be automatically loaded. A fallback will be used instead.'</span>
              <span class="s2">);</span>
            <span class="s2">}</span>
          <span class="s2">}</span>
        <span class="s2">}</span>
      <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">$</span><span class="s2">.</span><span class="s1">isPlainObject</span><span class="s2">(</span><span class="s1">language</span><span class="s2">)) {</span>
        <span class="s1">languageData </span><span class="s2">= </span><span class="s3">new </span><span class="s1">Translation</span><span class="s2">(</span><span class="s1">language</span><span class="s2">);</span>
      <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
        <span class="s1">languageData </span><span class="s2">= </span><span class="s1">language</span><span class="s2">;</span>
      <span class="s2">}</span>

      <span class="s1">translations</span><span class="s2">.</span><span class="s1">extend</span><span class="s2">(</span><span class="s1">languageData</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">return </span><span class="s1">translations</span><span class="s2">;</span>
  <span class="s2">};</span>

  <span class="s1">Defaults</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">set </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">key</span><span class="s2">, </span><span class="s1">value</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">camelKey </span><span class="s2">= </span><span class="s1">$</span><span class="s2">.</span><span class="s1">camelCase</span><span class="s2">(</span><span class="s1">key</span><span class="s2">);</span>

    <span class="s3">var </span><span class="s1">data </span><span class="s2">= {};</span>
    <span class="s1">data</span><span class="s2">[</span><span class="s1">camelKey</span><span class="s2">] = </span><span class="s1">value</span><span class="s2">;</span>

    <span class="s3">var </span><span class="s1">convertedData </span><span class="s2">= </span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">_convertData</span><span class="s2">(</span><span class="s1">data</span><span class="s2">);</span>

    <span class="s1">$</span><span class="s2">.</span><span class="s1">extend</span><span class="s2">(</span><span class="s3">true</span><span class="s2">, </span><span class="s3">this</span><span class="s2">.</span><span class="s1">defaults</span><span class="s2">, </span><span class="s1">convertedData</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s3">var </span><span class="s1">defaults </span><span class="s2">= </span><span class="s3">new </span><span class="s1">Defaults</span><span class="s2">();</span>

  <span class="s3">return </span><span class="s1">defaults</span><span class="s2">;</span>
<span class="s2">});</span>

<span class="s1">S2</span><span class="s2">.</span><span class="s1">define</span><span class="s2">(</span><span class="s4">'select2/options'</span><span class="s2">,[</span>
  <span class="s4">'require'</span><span class="s2">,</span>
  <span class="s4">'jquery'</span><span class="s2">,</span>
  <span class="s4">'./defaults'</span><span class="s2">,</span>
  <span class="s4">'./utils'</span>
<span class="s2">], </span><span class="s3">function </span><span class="s2">(</span><span class="s1">require</span><span class="s2">, </span><span class="s1">$</span><span class="s2">, </span><span class="s1">Defaults</span><span class="s2">, </span><span class="s1">Utils</span><span class="s2">) {</span>
  <span class="s3">function </span><span class="s1">Options </span><span class="s2">(</span><span class="s1">options</span><span class="s2">, </span><span class="s1">$element</span><span class="s2">) {</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">options </span><span class="s2">= </span><span class="s1">options</span><span class="s2">;</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">$element </span><span class="s2">!= </span><span class="s3">null</span><span class="s2">) {</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">fromElement</span><span class="s2">(</span><span class="s1">$element</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">$element </span><span class="s2">!= </span><span class="s3">null</span><span class="s2">) {</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">options </span><span class="s2">= </span><span class="s1">Defaults</span><span class="s2">.</span><span class="s1">applyFromElement</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">, </span><span class="s1">$element</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">options </span><span class="s2">= </span><span class="s1">Defaults</span><span class="s2">.</span><span class="s1">apply</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">);</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">$element </span><span class="s2">&amp;&amp; </span><span class="s1">$element</span><span class="s2">.</span><span class="s1">is</span><span class="s2">(</span><span class="s4">'input'</span><span class="s2">)) {</span>
      <span class="s3">var </span><span class="s1">InputCompat </span><span class="s2">= </span><span class="s1">require</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'amdBase'</span><span class="s2">) + </span><span class="s4">'compat/inputData'</span><span class="s2">);</span>

      <span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">dataAdapter </span><span class="s2">= </span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">Decorate</span><span class="s2">(</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">dataAdapter</span><span class="s2">,</span>
        <span class="s1">InputCompat</span>
      <span class="s2">);</span>
    <span class="s2">}</span>
  <span class="s2">}</span>

  <span class="s1">Options</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">fromElement </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">$e</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">excludedData </span><span class="s2">= [</span><span class="s4">'select2'</span><span class="s2">];</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">multiple </span><span class="s2">== </span><span class="s3">null</span><span class="s2">) {</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">multiple </span><span class="s2">= </span><span class="s1">$e</span><span class="s2">.</span><span class="s1">prop</span><span class="s2">(</span><span class="s4">'multiple'</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">disabled </span><span class="s2">== </span><span class="s3">null</span><span class="s2">) {</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">disabled </span><span class="s2">= </span><span class="s1">$e</span><span class="s2">.</span><span class="s1">prop</span><span class="s2">(</span><span class="s4">'disabled'</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">dir </span><span class="s2">== </span><span class="s3">null</span><span class="s2">) {</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">$e</span><span class="s2">.</span><span class="s1">prop</span><span class="s2">(</span><span class="s4">'dir'</span><span class="s2">)) {</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">dir </span><span class="s2">= </span><span class="s1">$e</span><span class="s2">.</span><span class="s1">prop</span><span class="s2">(</span><span class="s4">'dir'</span><span class="s2">);</span>
      <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">$e</span><span class="s2">.</span><span class="s1">closest</span><span class="s2">(</span><span class="s4">'[dir]'</span><span class="s2">).</span><span class="s1">prop</span><span class="s2">(</span><span class="s4">'dir'</span><span class="s2">)) {</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">dir </span><span class="s2">= </span><span class="s1">$e</span><span class="s2">.</span><span class="s1">closest</span><span class="s2">(</span><span class="s4">'[dir]'</span><span class="s2">).</span><span class="s1">prop</span><span class="s2">(</span><span class="s4">'dir'</span><span class="s2">);</span>
      <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">dir </span><span class="s2">= </span><span class="s4">'ltr'</span><span class="s2">;</span>
      <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s1">$e</span><span class="s2">.</span><span class="s1">prop</span><span class="s2">(</span><span class="s4">'disabled'</span><span class="s2">, </span><span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">disabled</span><span class="s2">);</span>
    <span class="s1">$e</span><span class="s2">.</span><span class="s1">prop</span><span class="s2">(</span><span class="s4">'multiple'</span><span class="s2">, </span><span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">multiple</span><span class="s2">);</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">GetData</span><span class="s2">(</span><span class="s1">$e</span><span class="s2">[</span><span class="s8">0</span><span class="s2">], </span><span class="s4">'select2Tags'</span><span class="s2">)) {</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">debug </span><span class="s2">&amp;&amp; </span><span class="s1">window</span><span class="s2">.</span><span class="s1">console </span><span class="s2">&amp;&amp; </span><span class="s1">console</span><span class="s2">.</span><span class="s1">warn</span><span class="s2">) {</span>
        <span class="s1">console</span><span class="s2">.</span><span class="s1">warn</span><span class="s2">(</span>
          <span class="s4">'Select2: The `data-select2-tags` attribute has been changed to ' </span><span class="s2">+</span>
          <span class="s4">'use the `data-data` and `data-tags=&quot;true&quot;` attributes and will be ' </span><span class="s2">+</span>
          <span class="s4">'removed in future versions of Select2.'</span>
        <span class="s2">);</span>
      <span class="s2">}</span>

      <span class="s1">Utils</span><span class="s2">.</span><span class="s1">StoreData</span><span class="s2">(</span><span class="s1">$e</span><span class="s2">[</span><span class="s8">0</span><span class="s2">], </span><span class="s4">'data'</span><span class="s2">, </span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">GetData</span><span class="s2">(</span><span class="s1">$e</span><span class="s2">[</span><span class="s8">0</span><span class="s2">], </span><span class="s4">'select2Tags'</span><span class="s2">));</span>
      <span class="s1">Utils</span><span class="s2">.</span><span class="s1">StoreData</span><span class="s2">(</span><span class="s1">$e</span><span class="s2">[</span><span class="s8">0</span><span class="s2">], </span><span class="s4">'tags'</span><span class="s2">, </span><span class="s3">true</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">GetData</span><span class="s2">(</span><span class="s1">$e</span><span class="s2">[</span><span class="s8">0</span><span class="s2">], </span><span class="s4">'ajaxUrl'</span><span class="s2">)) {</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">debug </span><span class="s2">&amp;&amp; </span><span class="s1">window</span><span class="s2">.</span><span class="s1">console </span><span class="s2">&amp;&amp; </span><span class="s1">console</span><span class="s2">.</span><span class="s1">warn</span><span class="s2">) {</span>
        <span class="s1">console</span><span class="s2">.</span><span class="s1">warn</span><span class="s2">(</span>
          <span class="s4">'Select2: The `data-ajax-url` attribute has been changed to ' </span><span class="s2">+</span>
          <span class="s4">'`data-ajax--url` and support for the old attribute will be removed' </span><span class="s2">+</span>
          <span class="s4">' in future versions of Select2.'</span>
        <span class="s2">);</span>
      <span class="s2">}</span>

      <span class="s1">$e</span><span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'ajax--url'</span><span class="s2">, </span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">GetData</span><span class="s2">(</span><span class="s1">$e</span><span class="s2">[</span><span class="s8">0</span><span class="s2">], </span><span class="s4">'ajaxUrl'</span><span class="s2">));</span>
      <span class="s1">Utils</span><span class="s2">.</span><span class="s1">StoreData</span><span class="s2">(</span><span class="s1">$e</span><span class="s2">[</span><span class="s8">0</span><span class="s2">], </span><span class="s4">'ajax-Url'</span><span class="s2">, </span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">GetData</span><span class="s2">(</span><span class="s1">$e</span><span class="s2">[</span><span class="s8">0</span><span class="s2">], </span><span class="s4">'ajaxUrl'</span><span class="s2">));</span>
    <span class="s2">}</span>

    <span class="s3">var </span><span class="s1">dataset </span><span class="s2">= {};</span>

    <span class="s3">function </span><span class="s1">upperCaseLetter</span><span class="s2">(</span><span class="s1">_</span><span class="s2">, </span><span class="s1">letter</span><span class="s2">) {</span>
      <span class="s3">return </span><span class="s1">letter</span><span class="s2">.</span><span class="s1">toUpperCase</span><span class="s2">();</span>
    <span class="s2">}</span>

    <span class="s0">// Pre-load all of the attributes which are prefixed with `data-`</span>
    <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">attr </span><span class="s2">= </span><span class="s8">0</span><span class="s2">; </span><span class="s1">attr </span><span class="s2">&lt; </span><span class="s1">$e</span><span class="s2">[</span><span class="s8">0</span><span class="s2">].</span><span class="s1">attributes</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">attr</span><span class="s2">++) {</span>
      <span class="s3">var </span><span class="s1">attributeName </span><span class="s2">= </span><span class="s1">$e</span><span class="s2">[</span><span class="s8">0</span><span class="s2">].</span><span class="s1">attributes</span><span class="s2">[</span><span class="s1">attr</span><span class="s2">].</span><span class="s1">name</span><span class="s2">;</span>
      <span class="s3">var </span><span class="s1">prefix </span><span class="s2">= </span><span class="s4">'data-'</span><span class="s2">;</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">attributeName</span><span class="s2">.</span><span class="s1">substr</span><span class="s2">(</span><span class="s8">0</span><span class="s2">, </span><span class="s1">prefix</span><span class="s2">.</span><span class="s1">length</span><span class="s2">) == </span><span class="s1">prefix</span><span class="s2">) {</span>
        <span class="s0">// Get the contents of the attribute after `data-`</span>
        <span class="s3">var </span><span class="s1">dataName </span><span class="s2">= </span><span class="s1">attributeName</span><span class="s2">.</span><span class="s1">substring</span><span class="s2">(</span><span class="s1">prefix</span><span class="s2">.</span><span class="s1">length</span><span class="s2">);</span>

        <span class="s0">// Get the data contents from the consistent source</span>
        <span class="s0">// This is more than likely the jQuery data helper</span>
        <span class="s3">var </span><span class="s1">dataValue </span><span class="s2">= </span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">GetData</span><span class="s2">(</span><span class="s1">$e</span><span class="s2">[</span><span class="s8">0</span><span class="s2">], </span><span class="s1">dataName</span><span class="s2">);</span>

        <span class="s0">// camelCase the attribute name to match the spec</span>
        <span class="s3">var </span><span class="s1">camelDataName </span><span class="s2">= </span><span class="s1">dataName</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s7">/-([a-z])/g</span><span class="s2">, </span><span class="s1">upperCaseLetter</span><span class="s2">);</span>

        <span class="s0">// Store the data attribute contents into the dataset since</span>
        <span class="s1">dataset</span><span class="s2">[</span><span class="s1">camelDataName</span><span class="s2">] = </span><span class="s1">dataValue</span><span class="s2">;</span>
      <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s0">// Prefer the element's `dataset` attribute if it exists</span>
    <span class="s0">// jQuery 1.x does not correctly handle data attributes with multiple dashes</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">$</span><span class="s2">.</span><span class="s1">fn</span><span class="s2">.</span><span class="s1">jquery </span><span class="s2">&amp;&amp; </span><span class="s1">$</span><span class="s2">.</span><span class="s1">fn</span><span class="s2">.</span><span class="s1">jquery</span><span class="s2">.</span><span class="s1">substr</span><span class="s2">(</span><span class="s8">0</span><span class="s2">, </span><span class="s8">2</span><span class="s2">) == </span><span class="s4">'1.' </span><span class="s2">&amp;&amp; </span><span class="s1">$e</span><span class="s2">[</span><span class="s8">0</span><span class="s2">].</span><span class="s1">dataset</span><span class="s2">) {</span>
      <span class="s1">dataset </span><span class="s2">= </span><span class="s1">$</span><span class="s2">.</span><span class="s1">extend</span><span class="s2">(</span><span class="s3">true</span><span class="s2">, {}, </span><span class="s1">$e</span><span class="s2">[</span><span class="s8">0</span><span class="s2">].</span><span class="s1">dataset</span><span class="s2">, </span><span class="s1">dataset</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s0">// Prefer our internal data cache if it exists</span>
    <span class="s3">var </span><span class="s1">data </span><span class="s2">= </span><span class="s1">$</span><span class="s2">.</span><span class="s1">extend</span><span class="s2">(</span><span class="s3">true</span><span class="s2">, {}, </span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">GetData</span><span class="s2">(</span><span class="s1">$e</span><span class="s2">[</span><span class="s8">0</span><span class="s2">]), </span><span class="s1">dataset</span><span class="s2">);</span>

    <span class="s1">data </span><span class="s2">= </span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">_convertData</span><span class="s2">(</span><span class="s1">data</span><span class="s2">);</span>

    <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">key </span><span class="s3">in </span><span class="s1">data</span><span class="s2">) {</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">$</span><span class="s2">.</span><span class="s1">inArray</span><span class="s2">(</span><span class="s1">key</span><span class="s2">, </span><span class="s1">excludedData</span><span class="s2">) &gt; -</span><span class="s8">1</span><span class="s2">) {</span>
        <span class="s3">continue</span><span class="s2">;</span>
      <span class="s2">}</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">$</span><span class="s2">.</span><span class="s1">isPlainObject</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">[</span><span class="s1">key</span><span class="s2">])) {</span>
        <span class="s1">$</span><span class="s2">.</span><span class="s1">extend</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">[</span><span class="s1">key</span><span class="s2">], </span><span class="s1">data</span><span class="s2">[</span><span class="s1">key</span><span class="s2">]);</span>
      <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">[</span><span class="s1">key</span><span class="s2">] = </span><span class="s1">data</span><span class="s2">[</span><span class="s1">key</span><span class="s2">];</span>
      <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s3">return this</span><span class="s2">;</span>
  <span class="s2">};</span>

  <span class="s1">Options</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">get </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">key</span><span class="s2">) {</span>
    <span class="s3">return this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">[</span><span class="s1">key</span><span class="s2">];</span>
  <span class="s2">};</span>

  <span class="s1">Options</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">set </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">key</span><span class="s2">, </span><span class="s1">val</span><span class="s2">) {</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">[</span><span class="s1">key</span><span class="s2">] = </span><span class="s1">val</span><span class="s2">;</span>
  <span class="s2">};</span>

  <span class="s3">return </span><span class="s1">Options</span><span class="s2">;</span>
<span class="s2">});</span>

<span class="s1">S2</span><span class="s2">.</span><span class="s1">define</span><span class="s2">(</span><span class="s4">'select2/core'</span><span class="s2">,[</span>
  <span class="s4">'jquery'</span><span class="s2">,</span>
  <span class="s4">'./options'</span><span class="s2">,</span>
  <span class="s4">'./utils'</span><span class="s2">,</span>
  <span class="s4">'./keys'</span>
<span class="s2">], </span><span class="s3">function </span><span class="s2">(</span><span class="s1">$</span><span class="s2">, </span><span class="s1">Options</span><span class="s2">, </span><span class="s1">Utils</span><span class="s2">, </span><span class="s1">KEYS</span><span class="s2">) {</span>
  <span class="s3">var </span><span class="s1">Select2 </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">$element</span><span class="s2">, </span><span class="s1">options</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">GetData</span><span class="s2">(</span><span class="s1">$element</span><span class="s2">[</span><span class="s8">0</span><span class="s2">], </span><span class="s4">'select2'</span><span class="s2">) != </span><span class="s3">null</span><span class="s2">) {</span>
      <span class="s1">Utils</span><span class="s2">.</span><span class="s1">GetData</span><span class="s2">(</span><span class="s1">$element</span><span class="s2">[</span><span class="s8">0</span><span class="s2">], </span><span class="s4">'select2'</span><span class="s2">).</span><span class="s1">destroy</span><span class="s2">();</span>
    <span class="s2">}</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">$element </span><span class="s2">= </span><span class="s1">$element</span><span class="s2">;</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">id </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">_generateId</span><span class="s2">(</span><span class="s1">$element</span><span class="s2">);</span>

    <span class="s1">options </span><span class="s2">= </span><span class="s1">options </span><span class="s2">|| {};</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">options </span><span class="s2">= </span><span class="s3">new </span><span class="s1">Options</span><span class="s2">(</span><span class="s1">options</span><span class="s2">, </span><span class="s1">$element</span><span class="s2">);</span>

    <span class="s1">Select2</span><span class="s2">.</span><span class="s1">__super__</span><span class="s2">.</span><span class="s1">constructor</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">);</span>

    <span class="s0">// Set up the tabindex</span>

    <span class="s3">var </span><span class="s1">tabindex </span><span class="s2">= </span><span class="s1">$element</span><span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'tabindex'</span><span class="s2">) || </span><span class="s8">0</span><span class="s2">;</span>
    <span class="s1">Utils</span><span class="s2">.</span><span class="s1">StoreData</span><span class="s2">(</span><span class="s1">$element</span><span class="s2">[</span><span class="s8">0</span><span class="s2">], </span><span class="s4">'old-tabindex'</span><span class="s2">, </span><span class="s1">tabindex</span><span class="s2">);</span>
    <span class="s1">$element</span><span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'tabindex'</span><span class="s2">, </span><span class="s4">'-1'</span><span class="s2">);</span>

    <span class="s0">// Set up containers and adapters</span>

    <span class="s3">var </span><span class="s1">DataAdapter </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'dataAdapter'</span><span class="s2">);</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">dataAdapter </span><span class="s2">= </span><span class="s3">new </span><span class="s1">DataAdapter</span><span class="s2">(</span><span class="s1">$element</span><span class="s2">, </span><span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">);</span>

    <span class="s3">var </span><span class="s1">$container </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">render</span><span class="s2">();</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">_placeContainer</span><span class="s2">(</span><span class="s1">$container</span><span class="s2">);</span>

    <span class="s3">var </span><span class="s1">SelectionAdapter </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'selectionAdapter'</span><span class="s2">);</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">selection </span><span class="s2">= </span><span class="s3">new </span><span class="s1">SelectionAdapter</span><span class="s2">(</span><span class="s1">$element</span><span class="s2">, </span><span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">);</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">$selection </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">selection</span><span class="s2">.</span><span class="s1">render</span><span class="s2">();</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">selection</span><span class="s2">.</span><span class="s1">position</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">$selection</span><span class="s2">, </span><span class="s1">$container</span><span class="s2">);</span>

    <span class="s3">var </span><span class="s1">DropdownAdapter </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'dropdownAdapter'</span><span class="s2">);</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">dropdown </span><span class="s2">= </span><span class="s3">new </span><span class="s1">DropdownAdapter</span><span class="s2">(</span><span class="s1">$element</span><span class="s2">, </span><span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">);</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">$dropdown </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">dropdown</span><span class="s2">.</span><span class="s1">render</span><span class="s2">();</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">dropdown</span><span class="s2">.</span><span class="s1">position</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">$dropdown</span><span class="s2">, </span><span class="s1">$container</span><span class="s2">);</span>

    <span class="s3">var </span><span class="s1">ResultsAdapter </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'resultsAdapter'</span><span class="s2">);</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">results </span><span class="s2">= </span><span class="s3">new </span><span class="s1">ResultsAdapter</span><span class="s2">(</span><span class="s1">$element</span><span class="s2">, </span><span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">, </span><span class="s3">this</span><span class="s2">.</span><span class="s1">dataAdapter</span><span class="s2">);</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">$results </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">results</span><span class="s2">.</span><span class="s1">render</span><span class="s2">();</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">results</span><span class="s2">.</span><span class="s1">position</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">$results</span><span class="s2">, </span><span class="s3">this</span><span class="s2">.</span><span class="s1">$dropdown</span><span class="s2">);</span>

    <span class="s0">// Bind events</span>

    <span class="s3">var </span><span class="s1">self </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>

    <span class="s0">// Bind the container to all of the adapters</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">_bindAdapters</span><span class="s2">();</span>

    <span class="s0">// Register any DOM event handlers</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">_registerDomEvents</span><span class="s2">();</span>

    <span class="s0">// Register any internal event handlers</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">_registerDataEvents</span><span class="s2">();</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">_registerSelectionEvents</span><span class="s2">();</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">_registerDropdownEvents</span><span class="s2">();</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">_registerResultsEvents</span><span class="s2">();</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">_registerEvents</span><span class="s2">();</span>

    <span class="s0">// Set the initial state</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">dataAdapter</span><span class="s2">.</span><span class="s1">current</span><span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">initialData</span><span class="s2">) {</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'selection:update'</span><span class="s2">, {</span>
        <span class="s1">data</span><span class="s2">: </span><span class="s1">initialData</span>
      <span class="s2">});</span>
    <span class="s2">});</span>

    <span class="s0">// Hide the original select</span>
    <span class="s1">$element</span><span class="s2">.</span><span class="s1">addClass</span><span class="s2">(</span><span class="s4">'select2-hidden-accessible'</span><span class="s2">);</span>
    <span class="s1">$element</span><span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'aria-hidden'</span><span class="s2">, </span><span class="s4">'true'</span><span class="s2">);</span>

    <span class="s0">// Synchronize any monitored attributes</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">_syncAttributes</span><span class="s2">();</span>

    <span class="s1">Utils</span><span class="s2">.</span><span class="s1">StoreData</span><span class="s2">(</span><span class="s1">$element</span><span class="s2">[</span><span class="s8">0</span><span class="s2">], </span><span class="s4">'select2'</span><span class="s2">, </span><span class="s3">this</span><span class="s2">);</span>

    <span class="s0">// Ensure backwards compatibility with $element.data('select2').</span>
    <span class="s1">$element</span><span class="s2">.</span><span class="s1">data</span><span class="s2">(</span><span class="s4">'select2'</span><span class="s2">, </span><span class="s3">this</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s1">Utils</span><span class="s2">.</span><span class="s1">Extend</span><span class="s2">(</span><span class="s1">Select2</span><span class="s2">, </span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">Observable</span><span class="s2">);</span>

  <span class="s1">Select2</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">_generateId </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">$element</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">id </span><span class="s2">= </span><span class="s4">''</span><span class="s2">;</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">$element</span><span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'id'</span><span class="s2">) != </span><span class="s3">null</span><span class="s2">) {</span>
      <span class="s1">id </span><span class="s2">= </span><span class="s1">$element</span><span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'id'</span><span class="s2">);</span>
    <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">$element</span><span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'name'</span><span class="s2">) != </span><span class="s3">null</span><span class="s2">) {</span>
      <span class="s1">id </span><span class="s2">= </span><span class="s1">$element</span><span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'name'</span><span class="s2">) + </span><span class="s4">'-' </span><span class="s2">+ </span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">generateChars</span><span class="s2">(</span><span class="s8">2</span><span class="s2">);</span>
    <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
      <span class="s1">id </span><span class="s2">= </span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">generateChars</span><span class="s2">(</span><span class="s8">4</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s1">id </span><span class="s2">= </span><span class="s1">id</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s7">/(:|\.|\[|\]|,)/g</span><span class="s2">, </span><span class="s4">''</span><span class="s2">);</span>
    <span class="s1">id </span><span class="s2">= </span><span class="s4">'select2-' </span><span class="s2">+ </span><span class="s1">id</span><span class="s2">;</span>

    <span class="s3">return </span><span class="s1">id</span><span class="s2">;</span>
  <span class="s2">};</span>

  <span class="s1">Select2</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">_placeContainer </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">$container</span><span class="s2">) {</span>
    <span class="s1">$container</span><span class="s2">.</span><span class="s1">insertAfter</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">);</span>

    <span class="s3">var </span><span class="s1">width </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">_resolveWidth</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">, </span><span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'width'</span><span class="s2">));</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">width </span><span class="s2">!= </span><span class="s3">null</span><span class="s2">) {</span>
      <span class="s1">$container</span><span class="s2">.</span><span class="s1">css</span><span class="s2">(</span><span class="s4">'width'</span><span class="s2">, </span><span class="s1">width</span><span class="s2">);</span>
    <span class="s2">}</span>
  <span class="s2">};</span>

  <span class="s1">Select2</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">_resolveWidth </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">$element</span><span class="s2">, </span><span class="s1">method</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">WIDTH </span><span class="s2">= </span><span class="s7">/^width:(([-+]?([0-9]*\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc))/i</span><span class="s2">;</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">method </span><span class="s2">== </span><span class="s4">'resolve'</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">styleWidth </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">_resolveWidth</span><span class="s2">(</span><span class="s1">$element</span><span class="s2">, </span><span class="s4">'style'</span><span class="s2">);</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">styleWidth </span><span class="s2">!= </span><span class="s3">null</span><span class="s2">) {</span>
        <span class="s3">return </span><span class="s1">styleWidth</span><span class="s2">;</span>
      <span class="s2">}</span>

      <span class="s3">return this</span><span class="s2">.</span><span class="s1">_resolveWidth</span><span class="s2">(</span><span class="s1">$element</span><span class="s2">, </span><span class="s4">'element'</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">method </span><span class="s2">== </span><span class="s4">'element'</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">elementWidth </span><span class="s2">= </span><span class="s1">$element</span><span class="s2">.</span><span class="s1">outerWidth</span><span class="s2">(</span><span class="s3">false</span><span class="s2">);</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">elementWidth </span><span class="s2">&lt;= </span><span class="s8">0</span><span class="s2">) {</span>
        <span class="s3">return </span><span class="s4">'auto'</span><span class="s2">;</span>
      <span class="s2">}</span>

      <span class="s3">return </span><span class="s1">elementWidth </span><span class="s2">+ </span><span class="s4">'px'</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">method </span><span class="s2">== </span><span class="s4">'style'</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">style </span><span class="s2">= </span><span class="s1">$element</span><span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'style'</span><span class="s2">);</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof</span><span class="s2">(</span><span class="s1">style</span><span class="s2">) !== </span><span class="s4">'string'</span><span class="s2">) {</span>
        <span class="s3">return null</span><span class="s2">;</span>
      <span class="s2">}</span>

      <span class="s3">var </span><span class="s1">attrs </span><span class="s2">= </span><span class="s1">style</span><span class="s2">.</span><span class="s1">split</span><span class="s2">(</span><span class="s4">';'</span><span class="s2">);</span>

      <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">i </span><span class="s2">= </span><span class="s8">0</span><span class="s2">, </span><span class="s1">l </span><span class="s2">= </span><span class="s1">attrs</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">l</span><span class="s2">; </span><span class="s1">i </span><span class="s2">= </span><span class="s1">i </span><span class="s2">+ </span><span class="s8">1</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">attr </span><span class="s2">= </span><span class="s1">attrs</span><span class="s2">[</span><span class="s1">i</span><span class="s2">].</span><span class="s1">replace</span><span class="s2">(</span><span class="s7">/\s/g</span><span class="s2">, </span><span class="s4">''</span><span class="s2">);</span>
        <span class="s3">var </span><span class="s1">matches </span><span class="s2">= </span><span class="s1">attr</span><span class="s2">.</span><span class="s1">match</span><span class="s2">(</span><span class="s1">WIDTH</span><span class="s2">);</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">matches </span><span class="s2">!== </span><span class="s3">null </span><span class="s2">&amp;&amp; </span><span class="s1">matches</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt;= </span><span class="s8">1</span><span class="s2">) {</span>
          <span class="s3">return </span><span class="s1">matches</span><span class="s2">[</span><span class="s8">1</span><span class="s2">];</span>
        <span class="s2">}</span>
      <span class="s2">}</span>

      <span class="s3">return null</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">method </span><span class="s2">== </span><span class="s4">'computedstyle'</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">computedStyle </span><span class="s2">= </span><span class="s1">window</span><span class="s2">.</span><span class="s1">getComputedStyle</span><span class="s2">(</span><span class="s1">$element</span><span class="s2">[</span><span class="s8">0</span><span class="s2">]);</span>

      <span class="s3">return </span><span class="s1">computedStyle</span><span class="s2">.</span><span class="s1">width</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">return </span><span class="s1">method</span><span class="s2">;</span>
  <span class="s2">};</span>

  <span class="s1">Select2</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">_bindAdapters </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">dataAdapter</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s3">this</span><span class="s2">.</span><span class="s1">$container</span><span class="s2">);</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">selection</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s3">this</span><span class="s2">.</span><span class="s1">$container</span><span class="s2">);</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">dropdown</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s3">this</span><span class="s2">.</span><span class="s1">$container</span><span class="s2">);</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">results</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s3">this</span><span class="s2">.</span><span class="s1">$container</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s1">Select2</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">_registerDomEvents </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {</span>
    <span class="s3">var </span><span class="s1">self </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'change.select2'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">() {</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">dataAdapter</span><span class="s2">.</span><span class="s1">current</span><span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">data</span><span class="s2">) {</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'selection:update'</span><span class="s2">, {</span>
          <span class="s1">data</span><span class="s2">: </span><span class="s1">data</span>
        <span class="s2">});</span>
      <span class="s2">});</span>
    <span class="s2">});</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'focus.select2'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">evt</span><span class="s2">) {</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'focus'</span><span class="s2">, </span><span class="s1">evt</span><span class="s2">);</span>
    <span class="s2">});</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">_syncA </span><span class="s2">= </span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">_syncAttributes</span><span class="s2">, </span><span class="s3">this</span><span class="s2">);</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">_syncS </span><span class="s2">= </span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">_syncSubtree</span><span class="s2">, </span><span class="s3">this</span><span class="s2">);</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">[</span><span class="s8">0</span><span class="s2">].</span><span class="s1">attachEvent</span><span class="s2">) {</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">[</span><span class="s8">0</span><span class="s2">].</span><span class="s1">attachEvent</span><span class="s2">(</span><span class="s4">'onpropertychange'</span><span class="s2">, </span><span class="s3">this</span><span class="s2">.</span><span class="s1">_syncA</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">var </span><span class="s1">observer </span><span class="s2">= </span><span class="s1">window</span><span class="s2">.</span><span class="s1">MutationObserver </span><span class="s2">||</span>
      <span class="s1">window</span><span class="s2">.</span><span class="s1">WebKitMutationObserver </span><span class="s2">||</span>
      <span class="s1">window</span><span class="s2">.</span><span class="s1">MozMutationObserver</span>
    <span class="s2">;</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">observer </span><span class="s2">!= </span><span class="s3">null</span><span class="s2">) {</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">_observer </span><span class="s2">= </span><span class="s3">new </span><span class="s1">observer</span><span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">mutations</span><span class="s2">) {</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_syncA</span><span class="s2">();</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_syncS</span><span class="s2">(</span><span class="s3">null</span><span class="s2">, </span><span class="s1">mutations</span><span class="s2">);</span>
      <span class="s2">});</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">_observer</span><span class="s2">.</span><span class="s1">observe</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">[</span><span class="s8">0</span><span class="s2">], {</span>
        <span class="s1">attributes</span><span class="s2">: </span><span class="s3">true</span><span class="s2">,</span>
        <span class="s1">childList</span><span class="s2">: </span><span class="s3">true</span><span class="s2">,</span>
        <span class="s1">subtree</span><span class="s2">: </span><span class="s3">false</span>
      <span class="s2">});</span>
    <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">[</span><span class="s8">0</span><span class="s2">].</span><span class="s1">addEventListener</span><span class="s2">) {</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">[</span><span class="s8">0</span><span class="s2">].</span><span class="s1">addEventListener</span><span class="s2">(</span>
        <span class="s4">'DOMAttrModified'</span><span class="s2">,</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_syncA</span><span class="s2">,</span>
        <span class="s3">false</span>
      <span class="s2">);</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">[</span><span class="s8">0</span><span class="s2">].</span><span class="s1">addEventListener</span><span class="s2">(</span>
        <span class="s4">'DOMNodeInserted'</span><span class="s2">,</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_syncS</span><span class="s2">,</span>
        <span class="s3">false</span>
      <span class="s2">);</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">[</span><span class="s8">0</span><span class="s2">].</span><span class="s1">addEventListener</span><span class="s2">(</span>
        <span class="s4">'DOMNodeRemoved'</span><span class="s2">,</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_syncS</span><span class="s2">,</span>
        <span class="s3">false</span>
      <span class="s2">);</span>
    <span class="s2">}</span>
  <span class="s2">};</span>

  <span class="s1">Select2</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">_registerDataEvents </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {</span>
    <span class="s3">var </span><span class="s1">self </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">dataAdapter</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'*'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">name</span><span class="s2">, </span><span class="s1">params</span><span class="s2">) {</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s1">name</span><span class="s2">, </span><span class="s1">params</span><span class="s2">);</span>
    <span class="s2">});</span>
  <span class="s2">};</span>

  <span class="s1">Select2</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">_registerSelectionEvents </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {</span>
    <span class="s3">var </span><span class="s1">self </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>
    <span class="s3">var </span><span class="s1">nonRelayEvents </span><span class="s2">= [</span><span class="s4">'toggle'</span><span class="s2">, </span><span class="s4">'focus'</span><span class="s2">];</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">selection</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'toggle'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">() {</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">toggleDropdown</span><span class="s2">();</span>
    <span class="s2">});</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">selection</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'focus'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">params</span><span class="s2">) {</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">focus</span><span class="s2">(</span><span class="s1">params</span><span class="s2">);</span>
    <span class="s2">});</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">selection</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'*'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">name</span><span class="s2">, </span><span class="s1">params</span><span class="s2">) {</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">$</span><span class="s2">.</span><span class="s1">inArray</span><span class="s2">(</span><span class="s1">name</span><span class="s2">, </span><span class="s1">nonRelayEvents</span><span class="s2">) !== -</span><span class="s8">1</span><span class="s2">) {</span>
        <span class="s3">return</span><span class="s2">;</span>
      <span class="s2">}</span>

      <span class="s1">self</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s1">name</span><span class="s2">, </span><span class="s1">params</span><span class="s2">);</span>
    <span class="s2">});</span>
  <span class="s2">};</span>

  <span class="s1">Select2</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">_registerDropdownEvents </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {</span>
    <span class="s3">var </span><span class="s1">self </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">dropdown</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'*'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">name</span><span class="s2">, </span><span class="s1">params</span><span class="s2">) {</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s1">name</span><span class="s2">, </span><span class="s1">params</span><span class="s2">);</span>
    <span class="s2">});</span>
  <span class="s2">};</span>

  <span class="s1">Select2</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">_registerResultsEvents </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {</span>
    <span class="s3">var </span><span class="s1">self </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">results</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'*'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">name</span><span class="s2">, </span><span class="s1">params</span><span class="s2">) {</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s1">name</span><span class="s2">, </span><span class="s1">params</span><span class="s2">);</span>
    <span class="s2">});</span>
  <span class="s2">};</span>

  <span class="s1">Select2</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">_registerEvents </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {</span>
    <span class="s3">var </span><span class="s1">self </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'open'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">() {</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">$container</span><span class="s2">.</span><span class="s1">addClass</span><span class="s2">(</span><span class="s4">'select2-container--open'</span><span class="s2">);</span>
    <span class="s2">});</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'close'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">() {</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">$container</span><span class="s2">.</span><span class="s1">removeClass</span><span class="s2">(</span><span class="s4">'select2-container--open'</span><span class="s2">);</span>
    <span class="s2">});</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'enable'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">() {</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">$container</span><span class="s2">.</span><span class="s1">removeClass</span><span class="s2">(</span><span class="s4">'select2-container--disabled'</span><span class="s2">);</span>
    <span class="s2">});</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'disable'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">() {</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">$container</span><span class="s2">.</span><span class="s1">addClass</span><span class="s2">(</span><span class="s4">'select2-container--disabled'</span><span class="s2">);</span>
    <span class="s2">});</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'blur'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">() {</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">$container</span><span class="s2">.</span><span class="s1">removeClass</span><span class="s2">(</span><span class="s4">'select2-container--focus'</span><span class="s2">);</span>
    <span class="s2">});</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'query'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">params</span><span class="s2">) {</span>
      <span class="s3">if </span><span class="s2">(!</span><span class="s1">self</span><span class="s2">.</span><span class="s1">isOpen</span><span class="s2">()) {</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'open'</span><span class="s2">, {});</span>
      <span class="s2">}</span>

      <span class="s3">this</span><span class="s2">.</span><span class="s1">dataAdapter</span><span class="s2">.</span><span class="s1">query</span><span class="s2">(</span><span class="s1">params</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">data</span><span class="s2">) {</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'results:all'</span><span class="s2">, {</span>
          <span class="s1">data</span><span class="s2">: </span><span class="s1">data</span><span class="s2">,</span>
          <span class="s1">query</span><span class="s2">: </span><span class="s1">params</span>
        <span class="s2">});</span>
      <span class="s2">});</span>
    <span class="s2">});</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'query:append'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">params</span><span class="s2">) {</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">dataAdapter</span><span class="s2">.</span><span class="s1">query</span><span class="s2">(</span><span class="s1">params</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">data</span><span class="s2">) {</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'results:append'</span><span class="s2">, {</span>
          <span class="s1">data</span><span class="s2">: </span><span class="s1">data</span><span class="s2">,</span>
          <span class="s1">query</span><span class="s2">: </span><span class="s1">params</span>
        <span class="s2">});</span>
      <span class="s2">});</span>
    <span class="s2">});</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s4">'keypress'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">evt</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">key </span><span class="s2">= </span><span class="s1">evt</span><span class="s2">.</span><span class="s1">which</span><span class="s2">;</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">isOpen</span><span class="s2">()) {</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">key </span><span class="s2">=== </span><span class="s1">KEYS</span><span class="s2">.</span><span class="s1">ESC </span><span class="s2">|| </span><span class="s1">key </span><span class="s2">=== </span><span class="s1">KEYS</span><span class="s2">.</span><span class="s1">TAB </span><span class="s2">||</span>
            <span class="s2">(</span><span class="s1">key </span><span class="s2">=== </span><span class="s1">KEYS</span><span class="s2">.</span><span class="s1">UP </span><span class="s2">&amp;&amp; </span><span class="s1">evt</span><span class="s2">.</span><span class="s1">altKey</span><span class="s2">)) {</span>
          <span class="s1">self</span><span class="s2">.</span><span class="s1">close</span><span class="s2">(</span><span class="s1">evt</span><span class="s2">);</span>

          <span class="s1">evt</span><span class="s2">.</span><span class="s1">preventDefault</span><span class="s2">();</span>
        <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">key </span><span class="s2">=== </span><span class="s1">KEYS</span><span class="s2">.</span><span class="s1">ENTER</span><span class="s2">) {</span>
          <span class="s1">self</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'results:select'</span><span class="s2">, {});</span>

          <span class="s1">evt</span><span class="s2">.</span><span class="s1">preventDefault</span><span class="s2">();</span>
        <span class="s2">} </span><span class="s3">else if </span><span class="s2">((</span><span class="s1">key </span><span class="s2">=== </span><span class="s1">KEYS</span><span class="s2">.</span><span class="s1">SPACE </span><span class="s2">&amp;&amp; </span><span class="s1">evt</span><span class="s2">.</span><span class="s1">ctrlKey</span><span class="s2">)) {</span>
          <span class="s1">self</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'results:toggle'</span><span class="s2">, {});</span>

          <span class="s1">evt</span><span class="s2">.</span><span class="s1">preventDefault</span><span class="s2">();</span>
        <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">key </span><span class="s2">=== </span><span class="s1">KEYS</span><span class="s2">.</span><span class="s1">UP</span><span class="s2">) {</span>
          <span class="s1">self</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'results:previous'</span><span class="s2">, {});</span>

          <span class="s1">evt</span><span class="s2">.</span><span class="s1">preventDefault</span><span class="s2">();</span>
        <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">key </span><span class="s2">=== </span><span class="s1">KEYS</span><span class="s2">.</span><span class="s1">DOWN</span><span class="s2">) {</span>
          <span class="s1">self</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'results:next'</span><span class="s2">, {});</span>

          <span class="s1">evt</span><span class="s2">.</span><span class="s1">preventDefault</span><span class="s2">();</span>
        <span class="s2">}</span>
      <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">key </span><span class="s2">=== </span><span class="s1">KEYS</span><span class="s2">.</span><span class="s1">ENTER </span><span class="s2">|| </span><span class="s1">key </span><span class="s2">=== </span><span class="s1">KEYS</span><span class="s2">.</span><span class="s1">SPACE </span><span class="s2">||</span>
            <span class="s2">(</span><span class="s1">key </span><span class="s2">=== </span><span class="s1">KEYS</span><span class="s2">.</span><span class="s1">DOWN </span><span class="s2">&amp;&amp; </span><span class="s1">evt</span><span class="s2">.</span><span class="s1">altKey</span><span class="s2">)) {</span>
          <span class="s1">self</span><span class="s2">.</span><span class="s1">open</span><span class="s2">();</span>

          <span class="s1">evt</span><span class="s2">.</span><span class="s1">preventDefault</span><span class="s2">();</span>
        <span class="s2">}</span>
      <span class="s2">}</span>
    <span class="s2">});</span>
  <span class="s2">};</span>

  <span class="s1">Select2</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">_syncAttributes </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s4">'disabled'</span><span class="s2">, </span><span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">.</span><span class="s1">prop</span><span class="s2">(</span><span class="s4">'disabled'</span><span class="s2">));</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">isDisabled</span><span class="s2">()) {</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">isOpen</span><span class="s2">()) {</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">close</span><span class="s2">();</span>
      <span class="s2">}</span>

      <span class="s3">this</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'disable'</span><span class="s2">, {});</span>
    <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'enable'</span><span class="s2">, {});</span>
    <span class="s2">}</span>
  <span class="s2">};</span>

  <span class="s1">Select2</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">_isChangeMutation </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">evt</span><span class="s2">, </span><span class="s1">mutations</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">changed </span><span class="s2">= </span><span class="s3">false</span><span class="s2">;</span>
    <span class="s3">var </span><span class="s1">self </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>

    <span class="s0">// Ignore any mutation events raised for elements that aren't options or</span>
    <span class="s0">// optgroups. This handles the case when the select element is destroyed</span>
    <span class="s3">if </span><span class="s2">(</span>
      <span class="s1">evt </span><span class="s2">&amp;&amp; </span><span class="s1">evt</span><span class="s2">.</span><span class="s1">target </span><span class="s2">&amp;&amp; (</span>
        <span class="s1">evt</span><span class="s2">.</span><span class="s1">target</span><span class="s2">.</span><span class="s1">nodeName </span><span class="s2">!== </span><span class="s4">'OPTION' </span><span class="s2">&amp;&amp; </span><span class="s1">evt</span><span class="s2">.</span><span class="s1">target</span><span class="s2">.</span><span class="s1">nodeName </span><span class="s2">!== </span><span class="s4">'OPTGROUP'</span>
      <span class="s2">)</span>
    <span class="s2">) {</span>
      <span class="s3">return</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">if </span><span class="s2">(!</span><span class="s1">mutations</span><span class="s2">) {</span>
      <span class="s0">// If mutation events aren't supported, then we can only assume that the</span>
      <span class="s0">// change affected the selections</span>
      <span class="s1">changed </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
    <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">mutations</span><span class="s2">.</span><span class="s1">addedNodes </span><span class="s2">&amp;&amp; </span><span class="s1">mutations</span><span class="s2">.</span><span class="s1">addedNodes</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt; </span><span class="s8">0</span><span class="s2">) {</span>
      <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">n </span><span class="s2">= </span><span class="s8">0</span><span class="s2">; </span><span class="s1">n </span><span class="s2">&lt; </span><span class="s1">mutations</span><span class="s2">.</span><span class="s1">addedNodes</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">n</span><span class="s2">++) {</span>
        <span class="s3">var </span><span class="s1">node </span><span class="s2">= </span><span class="s1">mutations</span><span class="s2">.</span><span class="s1">addedNodes</span><span class="s2">[</span><span class="s1">n</span><span class="s2">];</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">selected</span><span class="s2">) {</span>
          <span class="s1">changed </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
        <span class="s2">}</span>
      <span class="s2">}</span>
    <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">mutations</span><span class="s2">.</span><span class="s1">removedNodes </span><span class="s2">&amp;&amp; </span><span class="s1">mutations</span><span class="s2">.</span><span class="s1">removedNodes</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt; </span><span class="s8">0</span><span class="s2">) {</span>
      <span class="s1">changed </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
    <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">$</span><span class="s2">.</span><span class="s1">isArray</span><span class="s2">(</span><span class="s1">mutations</span><span class="s2">)) {</span>
      <span class="s1">$</span><span class="s2">.</span><span class="s1">each</span><span class="s2">(</span><span class="s1">mutations</span><span class="s2">, </span><span class="s3">function</span><span class="s2">(</span><span class="s1">evt</span><span class="s2">, </span><span class="s1">mutation</span><span class="s2">) {</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_isChangeMutation</span><span class="s2">(</span><span class="s1">evt</span><span class="s2">, </span><span class="s1">mutation</span><span class="s2">)) {</span>
          <span class="s0">// We've found a change mutation.</span>
          <span class="s0">// Let's escape from the loop and continue</span>
          <span class="s1">changed </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
          <span class="s3">return false</span><span class="s2">;</span>
        <span class="s2">}</span>
      <span class="s2">});</span>
    <span class="s2">}</span>
    <span class="s3">return </span><span class="s1">changed</span><span class="s2">;</span>
  <span class="s2">};</span>

  <span class="s1">Select2</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">_syncSubtree </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">evt</span><span class="s2">, </span><span class="s1">mutations</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">changed </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">_isChangeMutation</span><span class="s2">(</span><span class="s1">evt</span><span class="s2">, </span><span class="s1">mutations</span><span class="s2">);</span>
    <span class="s3">var </span><span class="s1">self </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>

    <span class="s0">// Only re-pull the data if we think there is a change</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">changed</span><span class="s2">) {</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">dataAdapter</span><span class="s2">.</span><span class="s1">current</span><span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">currentData</span><span class="s2">) {</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'selection:update'</span><span class="s2">, {</span>
          <span class="s1">data</span><span class="s2">: </span><span class="s1">currentData</span>
        <span class="s2">});</span>
      <span class="s2">});</span>
    <span class="s2">}</span>
  <span class="s2">};</span>

  <span class="s5">/**</span>
   <span class="s5">* Override the trigger method to automatically trigger pre-events when</span>
   <span class="s5">* there are events that can be prevented.</span>
   <span class="s5">*/</span>
  <span class="s1">Select2</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">trigger </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">name</span><span class="s2">, </span><span class="s1">args</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">actualTrigger </span><span class="s2">= </span><span class="s1">Select2</span><span class="s2">.</span><span class="s1">__super__</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">;</span>
    <span class="s3">var </span><span class="s1">preTriggerMap </span><span class="s2">= {</span>
      <span class="s4">'open'</span><span class="s2">: </span><span class="s4">'opening'</span><span class="s2">,</span>
      <span class="s4">'close'</span><span class="s2">: </span><span class="s4">'closing'</span><span class="s2">,</span>
      <span class="s4">'select'</span><span class="s2">: </span><span class="s4">'selecting'</span><span class="s2">,</span>
      <span class="s4">'unselect'</span><span class="s2">: </span><span class="s4">'unselecting'</span><span class="s2">,</span>
      <span class="s4">'clear'</span><span class="s2">: </span><span class="s4">'clearing'</span>
    <span class="s2">};</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">args </span><span class="s2">=== </span><span class="s1">undefined</span><span class="s2">) {</span>
      <span class="s1">args </span><span class="s2">= {};</span>
    <span class="s2">}</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">name </span><span class="s3">in </span><span class="s1">preTriggerMap</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">preTriggerName </span><span class="s2">= </span><span class="s1">preTriggerMap</span><span class="s2">[</span><span class="s1">name</span><span class="s2">];</span>
      <span class="s3">var </span><span class="s1">preTriggerArgs </span><span class="s2">= {</span>
        <span class="s1">prevented</span><span class="s2">: </span><span class="s3">false</span><span class="s2">,</span>
        <span class="s1">name</span><span class="s2">: </span><span class="s1">name</span><span class="s2">,</span>
        <span class="s1">args</span><span class="s2">: </span><span class="s1">args</span>
      <span class="s2">};</span>

      <span class="s1">actualTrigger</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">preTriggerName</span><span class="s2">, </span><span class="s1">preTriggerArgs</span><span class="s2">);</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">preTriggerArgs</span><span class="s2">.</span><span class="s1">prevented</span><span class="s2">) {</span>
        <span class="s1">args</span><span class="s2">.</span><span class="s1">prevented </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>

        <span class="s3">return</span><span class="s2">;</span>
      <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s1">actualTrigger</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">args</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s1">Select2</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">toggleDropdown </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">isDisabled</span><span class="s2">()) {</span>
      <span class="s3">return</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">isOpen</span><span class="s2">()) {</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">close</span><span class="s2">();</span>
    <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">open</span><span class="s2">();</span>
    <span class="s2">}</span>
  <span class="s2">};</span>

  <span class="s1">Select2</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">open </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">isOpen</span><span class="s2">()) {</span>
      <span class="s3">return</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">isDisabled</span><span class="s2">()) {</span>
      <span class="s3">return</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'query'</span><span class="s2">, {});</span>
  <span class="s2">};</span>

  <span class="s1">Select2</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">close </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">evt</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(!</span><span class="s3">this</span><span class="s2">.</span><span class="s1">isOpen</span><span class="s2">()) {</span>
      <span class="s3">return</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'close'</span><span class="s2">, { </span><span class="s1">originalEvent </span><span class="s2">: </span><span class="s1">evt </span><span class="s2">});</span>
  <span class="s2">};</span>

  <span class="s5">/**</span>
   <span class="s5">* Helper method to abstract the &quot;enabled&quot; (not &quot;disabled&quot;) state of this</span>
   <span class="s5">* object.</span>
   <span class="s5">*</span>
   <span class="s5">* </span><span class="s6">@return </span><span class="s5">{true} if the instance is not disabled.</span>
   <span class="s5">* </span><span class="s6">@return </span><span class="s5">{false} if the instance is disabled.</span>
   <span class="s5">*/</span>
  <span class="s1">Select2</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">isEnabled </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {</span>
    <span class="s3">return </span><span class="s2">!</span><span class="s3">this</span><span class="s2">.</span><span class="s1">isDisabled</span><span class="s2">();</span>
  <span class="s2">};</span>

  <span class="s5">/**</span>
   <span class="s5">* Helper method to abstract the &quot;disabled&quot; state of this object.</span>
   <span class="s5">*</span>
   <span class="s5">* </span><span class="s6">@return </span><span class="s5">{true} if the disabled option is true.</span>
   <span class="s5">* </span><span class="s6">@return </span><span class="s5">{false} if the disabled option is false.</span>
   <span class="s5">*/</span>
  <span class="s1">Select2</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">isDisabled </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {</span>
    <span class="s3">return this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'disabled'</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s1">Select2</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">isOpen </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {</span>
    <span class="s3">return this</span><span class="s2">.</span><span class="s1">$container</span><span class="s2">.</span><span class="s1">hasClass</span><span class="s2">(</span><span class="s4">'select2-container--open'</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s1">Select2</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">hasFocus </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {</span>
    <span class="s3">return this</span><span class="s2">.</span><span class="s1">$container</span><span class="s2">.</span><span class="s1">hasClass</span><span class="s2">(</span><span class="s4">'select2-container--focus'</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s1">Select2</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">focus </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">data</span><span class="s2">) {</span>
    <span class="s0">// No need to re-trigger focus events if we are already focused</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">hasFocus</span><span class="s2">()) {</span>
      <span class="s3">return</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">$container</span><span class="s2">.</span><span class="s1">addClass</span><span class="s2">(</span><span class="s4">'select2-container--focus'</span><span class="s2">);</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'focus'</span><span class="s2">, {});</span>
  <span class="s2">};</span>

  <span class="s1">Select2</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">enable </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">args</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'debug'</span><span class="s2">) &amp;&amp; </span><span class="s1">window</span><span class="s2">.</span><span class="s1">console </span><span class="s2">&amp;&amp; </span><span class="s1">console</span><span class="s2">.</span><span class="s1">warn</span><span class="s2">) {</span>
      <span class="s1">console</span><span class="s2">.</span><span class="s1">warn</span><span class="s2">(</span>
        <span class="s4">'Select2: The `select2(&quot;enable&quot;)` method has been deprecated and will' </span><span class="s2">+</span>
        <span class="s4">' be removed in later Select2 versions. Use $element.prop(&quot;disabled&quot;)' </span><span class="s2">+</span>
        <span class="s4">' instead.'</span>
      <span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">args </span><span class="s2">== </span><span class="s3">null </span><span class="s2">|| </span><span class="s1">args</span><span class="s2">.</span><span class="s1">length </span><span class="s2">=== </span><span class="s8">0</span><span class="s2">) {</span>
      <span class="s1">args </span><span class="s2">= [</span><span class="s3">true</span><span class="s2">];</span>
    <span class="s2">}</span>

    <span class="s3">var </span><span class="s1">disabled </span><span class="s2">= !</span><span class="s1">args</span><span class="s2">[</span><span class="s8">0</span><span class="s2">];</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">.</span><span class="s1">prop</span><span class="s2">(</span><span class="s4">'disabled'</span><span class="s2">, </span><span class="s1">disabled</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s1">Select2</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">data </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'debug'</span><span class="s2">) &amp;&amp;</span>
        <span class="s1">arguments</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt; </span><span class="s8">0 </span><span class="s2">&amp;&amp; </span><span class="s1">window</span><span class="s2">.</span><span class="s1">console </span><span class="s2">&amp;&amp; </span><span class="s1">console</span><span class="s2">.</span><span class="s1">warn</span><span class="s2">) {</span>
      <span class="s1">console</span><span class="s2">.</span><span class="s1">warn</span><span class="s2">(</span>
        <span class="s4">'Select2: Data can no longer be set using `select2(&quot;data&quot;)`. You ' </span><span class="s2">+</span>
        <span class="s4">'should consider setting the value instead using `$element.val()`.'</span>
      <span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">var </span><span class="s1">data </span><span class="s2">= [];</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">dataAdapter</span><span class="s2">.</span><span class="s1">current</span><span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">currentData</span><span class="s2">) {</span>
      <span class="s1">data </span><span class="s2">= </span><span class="s1">currentData</span><span class="s2">;</span>
    <span class="s2">});</span>

    <span class="s3">return </span><span class="s1">data</span><span class="s2">;</span>
  <span class="s2">};</span>

  <span class="s1">Select2</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">val </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">args</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'debug'</span><span class="s2">) &amp;&amp; </span><span class="s1">window</span><span class="s2">.</span><span class="s1">console </span><span class="s2">&amp;&amp; </span><span class="s1">console</span><span class="s2">.</span><span class="s1">warn</span><span class="s2">) {</span>
      <span class="s1">console</span><span class="s2">.</span><span class="s1">warn</span><span class="s2">(</span>
        <span class="s4">'Select2: The `select2(&quot;val&quot;)` method has been deprecated and will be' </span><span class="s2">+</span>
        <span class="s4">' removed in later Select2 versions. Use $element.val() instead.'</span>
      <span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">args </span><span class="s2">== </span><span class="s3">null </span><span class="s2">|| </span><span class="s1">args</span><span class="s2">.</span><span class="s1">length </span><span class="s2">=== </span><span class="s8">0</span><span class="s2">) {</span>
      <span class="s3">return this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">.</span><span class="s1">val</span><span class="s2">();</span>
    <span class="s2">}</span>

    <span class="s3">var </span><span class="s1">newVal </span><span class="s2">= </span><span class="s1">args</span><span class="s2">[</span><span class="s8">0</span><span class="s2">];</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">$</span><span class="s2">.</span><span class="s1">isArray</span><span class="s2">(</span><span class="s1">newVal</span><span class="s2">)) {</span>
      <span class="s1">newVal </span><span class="s2">= </span><span class="s1">$</span><span class="s2">.</span><span class="s1">map</span><span class="s2">(</span><span class="s1">newVal</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">obj</span><span class="s2">) {</span>
        <span class="s3">return </span><span class="s1">obj</span><span class="s2">.</span><span class="s1">toString</span><span class="s2">();</span>
      <span class="s2">});</span>
    <span class="s2">}</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">.</span><span class="s1">val</span><span class="s2">(</span><span class="s1">newVal</span><span class="s2">).</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'input'</span><span class="s2">).</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'change'</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s1">Select2</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">destroy </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">$container</span><span class="s2">.</span><span class="s1">remove</span><span class="s2">();</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">[</span><span class="s8">0</span><span class="s2">].</span><span class="s1">detachEvent</span><span class="s2">) {</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">[</span><span class="s8">0</span><span class="s2">].</span><span class="s1">detachEvent</span><span class="s2">(</span><span class="s4">'onpropertychange'</span><span class="s2">, </span><span class="s3">this</span><span class="s2">.</span><span class="s1">_syncA</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">_observer </span><span class="s2">!= </span><span class="s3">null</span><span class="s2">) {</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">_observer</span><span class="s2">.</span><span class="s1">disconnect</span><span class="s2">();</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">_observer </span><span class="s2">= </span><span class="s3">null</span><span class="s2">;</span>
    <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">[</span><span class="s8">0</span><span class="s2">].</span><span class="s1">removeEventListener</span><span class="s2">) {</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">[</span><span class="s8">0</span><span class="s2">]</span>
        <span class="s2">.</span><span class="s1">removeEventListener</span><span class="s2">(</span><span class="s4">'DOMAttrModified'</span><span class="s2">, </span><span class="s3">this</span><span class="s2">.</span><span class="s1">_syncA</span><span class="s2">, </span><span class="s3">false</span><span class="s2">);</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">[</span><span class="s8">0</span><span class="s2">]</span>
        <span class="s2">.</span><span class="s1">removeEventListener</span><span class="s2">(</span><span class="s4">'DOMNodeInserted'</span><span class="s2">, </span><span class="s3">this</span><span class="s2">.</span><span class="s1">_syncS</span><span class="s2">, </span><span class="s3">false</span><span class="s2">);</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">[</span><span class="s8">0</span><span class="s2">]</span>
        <span class="s2">.</span><span class="s1">removeEventListener</span><span class="s2">(</span><span class="s4">'DOMNodeRemoved'</span><span class="s2">, </span><span class="s3">this</span><span class="s2">.</span><span class="s1">_syncS</span><span class="s2">, </span><span class="s3">false</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">_syncA </span><span class="s2">= </span><span class="s3">null</span><span class="s2">;</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">_syncS </span><span class="s2">= </span><span class="s3">null</span><span class="s2">;</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">.</span><span class="s1">off</span><span class="s2">(</span><span class="s4">'.select2'</span><span class="s2">);</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'tabindex'</span><span class="s2">,</span>
    <span class="s1">Utils</span><span class="s2">.</span><span class="s1">GetData</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">[</span><span class="s8">0</span><span class="s2">], </span><span class="s4">'old-tabindex'</span><span class="s2">));</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">.</span><span class="s1">removeClass</span><span class="s2">(</span><span class="s4">'select2-hidden-accessible'</span><span class="s2">);</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'aria-hidden'</span><span class="s2">, </span><span class="s4">'false'</span><span class="s2">);</span>
    <span class="s1">Utils</span><span class="s2">.</span><span class="s1">RemoveData</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">[</span><span class="s8">0</span><span class="s2">]);</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">.</span><span class="s1">removeData</span><span class="s2">(</span><span class="s4">'select2'</span><span class="s2">);</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">dataAdapter</span><span class="s2">.</span><span class="s1">destroy</span><span class="s2">();</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">selection</span><span class="s2">.</span><span class="s1">destroy</span><span class="s2">();</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">dropdown</span><span class="s2">.</span><span class="s1">destroy</span><span class="s2">();</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">results</span><span class="s2">.</span><span class="s1">destroy</span><span class="s2">();</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">dataAdapter </span><span class="s2">= </span><span class="s3">null</span><span class="s2">;</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">selection </span><span class="s2">= </span><span class="s3">null</span><span class="s2">;</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">dropdown </span><span class="s2">= </span><span class="s3">null</span><span class="s2">;</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">results </span><span class="s2">= </span><span class="s3">null</span><span class="s2">;</span>
  <span class="s2">};</span>

  <span class="s1">Select2</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">render </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {</span>
    <span class="s3">var </span><span class="s1">$container </span><span class="s2">= </span><span class="s1">$</span><span class="s2">(</span>
      <span class="s4">'&lt;span class=&quot;select2 select2-container&quot;&gt;' </span><span class="s2">+</span>
        <span class="s4">'&lt;span class=&quot;selection&quot;&gt;&lt;/span&gt;' </span><span class="s2">+</span>
        <span class="s4">'&lt;span class=&quot;dropdown-wrapper&quot; aria-hidden=&quot;true&quot;&gt;&lt;/span&gt;' </span><span class="s2">+</span>
      <span class="s4">'&lt;/span&gt;'</span>
    <span class="s2">);</span>

    <span class="s1">$container</span><span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'dir'</span><span class="s2">, </span><span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'dir'</span><span class="s2">));</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">$container </span><span class="s2">= </span><span class="s1">$container</span><span class="s2">;</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">$container</span><span class="s2">.</span><span class="s1">addClass</span><span class="s2">(</span><span class="s4">'select2-container--' </span><span class="s2">+ </span><span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'theme'</span><span class="s2">));</span>

    <span class="s1">Utils</span><span class="s2">.</span><span class="s1">StoreData</span><span class="s2">(</span><span class="s1">$container</span><span class="s2">[</span><span class="s8">0</span><span class="s2">], </span><span class="s4">'element'</span><span class="s2">, </span><span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">);</span>

    <span class="s3">return </span><span class="s1">$container</span><span class="s2">;</span>
  <span class="s2">};</span>

  <span class="s3">return </span><span class="s1">Select2</span><span class="s2">;</span>
<span class="s2">});</span>

<span class="s1">S2</span><span class="s2">.</span><span class="s1">define</span><span class="s2">(</span><span class="s4">'select2/compat/utils'</span><span class="s2">,[</span>
  <span class="s4">'jquery'</span>
<span class="s2">], </span><span class="s3">function </span><span class="s2">(</span><span class="s1">$</span><span class="s2">) {</span>
  <span class="s3">function </span><span class="s1">syncCssClasses </span><span class="s2">(</span><span class="s1">$dest</span><span class="s2">, </span><span class="s1">$src</span><span class="s2">, </span><span class="s1">adapter</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">classes</span><span class="s2">, </span><span class="s1">replacements </span><span class="s2">= [], </span><span class="s1">adapted</span><span class="s2">;</span>

    <span class="s1">classes </span><span class="s2">= </span><span class="s1">$</span><span class="s2">.</span><span class="s1">trim</span><span class="s2">(</span><span class="s1">$dest</span><span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'class'</span><span class="s2">));</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">classes</span><span class="s2">) {</span>
      <span class="s1">classes </span><span class="s2">= </span><span class="s4">'' </span><span class="s2">+ </span><span class="s1">classes</span><span class="s2">; </span><span class="s0">// for IE which returns object</span>

      <span class="s1">$</span><span class="s2">(</span><span class="s1">classes</span><span class="s2">.</span><span class="s1">split</span><span class="s2">(</span><span class="s7">/\s+/</span><span class="s2">)).</span><span class="s1">each</span><span class="s2">(</span><span class="s3">function </span><span class="s2">() {</span>
        <span class="s0">// Save all Select2 classes</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s4">'select2-'</span><span class="s2">) === </span><span class="s8">0</span><span class="s2">) {</span>
          <span class="s1">replacements</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s3">this</span><span class="s2">);</span>
        <span class="s2">}</span>
      <span class="s2">});</span>
    <span class="s2">}</span>

    <span class="s1">classes </span><span class="s2">= </span><span class="s1">$</span><span class="s2">.</span><span class="s1">trim</span><span class="s2">(</span><span class="s1">$src</span><span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'class'</span><span class="s2">));</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">classes</span><span class="s2">) {</span>
      <span class="s1">classes </span><span class="s2">= </span><span class="s4">'' </span><span class="s2">+ </span><span class="s1">classes</span><span class="s2">; </span><span class="s0">// for IE which returns object</span>

      <span class="s1">$</span><span class="s2">(</span><span class="s1">classes</span><span class="s2">.</span><span class="s1">split</span><span class="s2">(</span><span class="s7">/\s+/</span><span class="s2">)).</span><span class="s1">each</span><span class="s2">(</span><span class="s3">function </span><span class="s2">() {</span>
        <span class="s0">// Only adapt non-Select2 classes</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s4">'select2-'</span><span class="s2">) !== </span><span class="s8">0</span><span class="s2">) {</span>
          <span class="s1">adapted </span><span class="s2">= </span><span class="s1">adapter</span><span class="s2">(</span><span class="s3">this</span><span class="s2">);</span>

          <span class="s3">if </span><span class="s2">(</span><span class="s1">adapted </span><span class="s2">!= </span><span class="s3">null</span><span class="s2">) {</span>
            <span class="s1">replacements</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">adapted</span><span class="s2">);</span>
          <span class="s2">}</span>
        <span class="s2">}</span>
      <span class="s2">});</span>
    <span class="s2">}</span>

    <span class="s1">$dest</span><span class="s2">.</span><span class="s1">attr</span><span class="s2">(</span><span class="s4">'class'</span><span class="s2">, </span><span class="s1">replacements</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s4">' '</span><span class="s2">));</span>
  <span class="s2">}</span>

  <span class="s3">return </span><span class="s2">{</span>
    <span class="s1">syncCssClasses</span><span class="s2">: </span><span class="s1">syncCssClasses</span>
  <span class="s2">};</span>
<span class="s2">});</span>

<span class="s1">S2</span><span class="s2">.</span><span class="s1">define</span><span class="s2">(</span><span class="s4">'select2/compat/containerCss'</span><span class="s2">,[</span>
  <span class="s4">'jquery'</span><span class="s2">,</span>
  <span class="s4">'./utils'</span>
<span class="s2">], </span><span class="s3">function </span><span class="s2">(</span><span class="s1">$</span><span class="s2">, </span><span class="s1">CompatUtils</span><span class="s2">) {</span>
  <span class="s0">// No-op CSS adapter that discards all classes by default</span>
  <span class="s3">function </span><span class="s1">_containerAdapter </span><span class="s2">(</span><span class="s1">clazz</span><span class="s2">) {</span>
    <span class="s3">return null</span><span class="s2">;</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">ContainerCSS </span><span class="s2">() { }</span>

  <span class="s1">ContainerCSS</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">render </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">decorated</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">$container </span><span class="s2">= </span><span class="s1">decorated</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">);</span>

    <span class="s3">var </span><span class="s1">containerCssClass </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'containerCssClass'</span><span class="s2">) || </span><span class="s4">''</span><span class="s2">;</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">$</span><span class="s2">.</span><span class="s1">isFunction</span><span class="s2">(</span><span class="s1">containerCssClass</span><span class="s2">)) {</span>
      <span class="s1">containerCssClass </span><span class="s2">= </span><span class="s1">containerCssClass</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">var </span><span class="s1">containerCssAdapter </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'adaptContainerCssClass'</span><span class="s2">);</span>
    <span class="s1">containerCssAdapter </span><span class="s2">= </span><span class="s1">containerCssAdapter </span><span class="s2">|| </span><span class="s1">_containerAdapter</span><span class="s2">;</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">containerCssClass</span><span class="s2">.</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s4">':all:'</span><span class="s2">) !== -</span><span class="s8">1</span><span class="s2">) {</span>
      <span class="s1">containerCssClass </span><span class="s2">= </span><span class="s1">containerCssClass</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s4">':all:'</span><span class="s2">, </span><span class="s4">''</span><span class="s2">);</span>

      <span class="s3">var </span><span class="s1">_cssAdapter </span><span class="s2">= </span><span class="s1">containerCssAdapter</span><span class="s2">;</span>

      <span class="s1">containerCssAdapter </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">clazz</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">adapted </span><span class="s2">= </span><span class="s1">_cssAdapter</span><span class="s2">(</span><span class="s1">clazz</span><span class="s2">);</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">adapted </span><span class="s2">!= </span><span class="s3">null</span><span class="s2">) {</span>
          <span class="s0">// Append the old one along with the adapted one</span>
          <span class="s3">return </span><span class="s1">adapted </span><span class="s2">+ </span><span class="s4">' ' </span><span class="s2">+ </span><span class="s1">clazz</span><span class="s2">;</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">clazz</span><span class="s2">;</span>
      <span class="s2">};</span>
    <span class="s2">}</span>

    <span class="s3">var </span><span class="s1">containerCss </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'containerCss'</span><span class="s2">) || {};</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">$</span><span class="s2">.</span><span class="s1">isFunction</span><span class="s2">(</span><span class="s1">containerCss</span><span class="s2">)) {</span>
      <span class="s1">containerCss </span><span class="s2">= </span><span class="s1">containerCss</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s1">CompatUtils</span><span class="s2">.</span><span class="s1">syncCssClasses</span><span class="s2">(</span><span class="s1">$container</span><span class="s2">, </span><span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">, </span><span class="s1">containerCssAdapter</span><span class="s2">);</span>

    <span class="s1">$container</span><span class="s2">.</span><span class="s1">css</span><span class="s2">(</span><span class="s1">containerCss</span><span class="s2">);</span>
    <span class="s1">$container</span><span class="s2">.</span><span class="s1">addClass</span><span class="s2">(</span><span class="s1">containerCssClass</span><span class="s2">);</span>

    <span class="s3">return </span><span class="s1">$container</span><span class="s2">;</span>
  <span class="s2">};</span>

  <span class="s3">return </span><span class="s1">ContainerCSS</span><span class="s2">;</span>
<span class="s2">});</span>

<span class="s1">S2</span><span class="s2">.</span><span class="s1">define</span><span class="s2">(</span><span class="s4">'select2/compat/dropdownCss'</span><span class="s2">,[</span>
  <span class="s4">'jquery'</span><span class="s2">,</span>
  <span class="s4">'./utils'</span>
<span class="s2">], </span><span class="s3">function </span><span class="s2">(</span><span class="s1">$</span><span class="s2">, </span><span class="s1">CompatUtils</span><span class="s2">) {</span>
  <span class="s0">// No-op CSS adapter that discards all classes by default</span>
  <span class="s3">function </span><span class="s1">_dropdownAdapter </span><span class="s2">(</span><span class="s1">clazz</span><span class="s2">) {</span>
    <span class="s3">return null</span><span class="s2">;</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">DropdownCSS </span><span class="s2">() { }</span>

  <span class="s1">DropdownCSS</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">render </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">decorated</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">$dropdown </span><span class="s2">= </span><span class="s1">decorated</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">);</span>

    <span class="s3">var </span><span class="s1">dropdownCssClass </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'dropdownCssClass'</span><span class="s2">) || </span><span class="s4">''</span><span class="s2">;</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">$</span><span class="s2">.</span><span class="s1">isFunction</span><span class="s2">(</span><span class="s1">dropdownCssClass</span><span class="s2">)) {</span>
      <span class="s1">dropdownCssClass </span><span class="s2">= </span><span class="s1">dropdownCssClass</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">var </span><span class="s1">dropdownCssAdapter </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'adaptDropdownCssClass'</span><span class="s2">);</span>
    <span class="s1">dropdownCssAdapter </span><span class="s2">= </span><span class="s1">dropdownCssAdapter </span><span class="s2">|| </span><span class="s1">_dropdownAdapter</span><span class="s2">;</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">dropdownCssClass</span><span class="s2">.</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s4">':all:'</span><span class="s2">) !== -</span><span class="s8">1</span><span class="s2">) {</span>
      <span class="s1">dropdownCssClass </span><span class="s2">= </span><span class="s1">dropdownCssClass</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s4">':all:'</span><span class="s2">, </span><span class="s4">''</span><span class="s2">);</span>

      <span class="s3">var </span><span class="s1">_cssAdapter </span><span class="s2">= </span><span class="s1">dropdownCssAdapter</span><span class="s2">;</span>

      <span class="s1">dropdownCssAdapter </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">clazz</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">adapted </span><span class="s2">= </span><span class="s1">_cssAdapter</span><span class="s2">(</span><span class="s1">clazz</span><span class="s2">);</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">adapted </span><span class="s2">!= </span><span class="s3">null</span><span class="s2">) {</span>
          <span class="s0">// Append the old one along with the adapted one</span>
          <span class="s3">return </span><span class="s1">adapted </span><span class="s2">+ </span><span class="s4">' ' </span><span class="s2">+ </span><span class="s1">clazz</span><span class="s2">;</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">clazz</span><span class="s2">;</span>
      <span class="s2">};</span>
    <span class="s2">}</span>

    <span class="s3">var </span><span class="s1">dropdownCss </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'dropdownCss'</span><span class="s2">) || {};</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">$</span><span class="s2">.</span><span class="s1">isFunction</span><span class="s2">(</span><span class="s1">dropdownCss</span><span class="s2">)) {</span>
      <span class="s1">dropdownCss </span><span class="s2">= </span><span class="s1">dropdownCss</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s1">CompatUtils</span><span class="s2">.</span><span class="s1">syncCssClasses</span><span class="s2">(</span><span class="s1">$dropdown</span><span class="s2">, </span><span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">, </span><span class="s1">dropdownCssAdapter</span><span class="s2">);</span>

    <span class="s1">$dropdown</span><span class="s2">.</span><span class="s1">css</span><span class="s2">(</span><span class="s1">dropdownCss</span><span class="s2">);</span>
    <span class="s1">$dropdown</span><span class="s2">.</span><span class="s1">addClass</span><span class="s2">(</span><span class="s1">dropdownCssClass</span><span class="s2">);</span>

    <span class="s3">return </span><span class="s1">$dropdown</span><span class="s2">;</span>
  <span class="s2">};</span>

  <span class="s3">return </span><span class="s1">DropdownCSS</span><span class="s2">;</span>
<span class="s2">});</span>

<span class="s1">S2</span><span class="s2">.</span><span class="s1">define</span><span class="s2">(</span><span class="s4">'select2/compat/initSelection'</span><span class="s2">,[</span>
  <span class="s4">'jquery'</span>
<span class="s2">], </span><span class="s3">function </span><span class="s2">(</span><span class="s1">$</span><span class="s2">) {</span>
  <span class="s3">function </span><span class="s1">InitSelection </span><span class="s2">(</span><span class="s1">decorated</span><span class="s2">, </span><span class="s1">$element</span><span class="s2">, </span><span class="s1">options</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">options</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'debug'</span><span class="s2">) &amp;&amp; </span><span class="s1">window</span><span class="s2">.</span><span class="s1">console </span><span class="s2">&amp;&amp; </span><span class="s1">console</span><span class="s2">.</span><span class="s1">warn</span><span class="s2">) {</span>
      <span class="s1">console</span><span class="s2">.</span><span class="s1">warn</span><span class="s2">(</span>
        <span class="s4">'Select2: The `initSelection` option has been deprecated in favor' </span><span class="s2">+</span>
        <span class="s4">' of a custom data adapter that overrides the `current` method. ' </span><span class="s2">+</span>
        <span class="s4">'This method is now called multiple times instead of a single ' </span><span class="s2">+</span>
        <span class="s4">'time when the instance is initialized. Support will be removed ' </span><span class="s2">+</span>
        <span class="s4">'for the `initSelection` option in future versions of Select2'</span>
      <span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">initSelection </span><span class="s2">= </span><span class="s1">options</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'initSelection'</span><span class="s2">);</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">_isInitialized </span><span class="s2">= </span><span class="s3">false</span><span class="s2">;</span>

    <span class="s1">decorated</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">$element</span><span class="s2">, </span><span class="s1">options</span><span class="s2">);</span>
  <span class="s2">}</span>

  <span class="s1">InitSelection</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">current </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">decorated</span><span class="s2">, </span><span class="s1">callback</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">self </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">_isInitialized</span><span class="s2">) {</span>
      <span class="s1">decorated</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">callback</span><span class="s2">);</span>

      <span class="s3">return</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">initSelection</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">null</span><span class="s2">, </span><span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">data</span><span class="s2">) {</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">_isInitialized </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>

      <span class="s3">if </span><span class="s2">(!</span><span class="s1">$</span><span class="s2">.</span><span class="s1">isArray</span><span class="s2">(</span><span class="s1">data</span><span class="s2">)) {</span>
        <span class="s1">data </span><span class="s2">= [</span><span class="s1">data</span><span class="s2">];</span>
      <span class="s2">}</span>

      <span class="s1">callback</span><span class="s2">(</span><span class="s1">data</span><span class="s2">);</span>
    <span class="s2">});</span>
  <span class="s2">};</span>

  <span class="s3">return </span><span class="s1">InitSelection</span><span class="s2">;</span>
<span class="s2">});</span>

<span class="s1">S2</span><span class="s2">.</span><span class="s1">define</span><span class="s2">(</span><span class="s4">'select2/compat/inputData'</span><span class="s2">,[</span>
  <span class="s4">'jquery'</span><span class="s2">,</span>
  <span class="s4">'../utils'</span>
<span class="s2">], </span><span class="s3">function </span><span class="s2">(</span><span class="s1">$</span><span class="s2">, </span><span class="s1">Utils</span><span class="s2">) {</span>
  <span class="s3">function </span><span class="s1">InputData </span><span class="s2">(</span><span class="s1">decorated</span><span class="s2">, </span><span class="s1">$element</span><span class="s2">, </span><span class="s1">options</span><span class="s2">) {</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">_currentData </span><span class="s2">= [];</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">_valueSeparator </span><span class="s2">= </span><span class="s1">options</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'valueSeparator'</span><span class="s2">) || </span><span class="s4">','</span><span class="s2">;</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">$element</span><span class="s2">.</span><span class="s1">prop</span><span class="s2">(</span><span class="s4">'type'</span><span class="s2">) === </span><span class="s4">'hidden'</span><span class="s2">) {</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">options</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'debug'</span><span class="s2">) &amp;&amp; </span><span class="s1">console </span><span class="s2">&amp;&amp; </span><span class="s1">console</span><span class="s2">.</span><span class="s1">warn</span><span class="s2">) {</span>
        <span class="s1">console</span><span class="s2">.</span><span class="s1">warn</span><span class="s2">(</span>
          <span class="s4">'Select2: Using a hidden input with Select2 is no longer ' </span><span class="s2">+</span>
          <span class="s4">'supported and may stop working in the future. It is recommended ' </span><span class="s2">+</span>
          <span class="s4">'to use a `&lt;select&gt;` element instead.'</span>
        <span class="s2">);</span>
      <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s1">decorated</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">$element</span><span class="s2">, </span><span class="s1">options</span><span class="s2">);</span>
  <span class="s2">}</span>

  <span class="s1">InputData</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">current </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">_</span><span class="s2">, </span><span class="s1">callback</span><span class="s2">) {</span>
    <span class="s3">function </span><span class="s1">getSelected </span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">selectedIds</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">selected </span><span class="s2">= [];</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">data</span><span class="s2">.</span><span class="s1">selected </span><span class="s2">|| </span><span class="s1">$</span><span class="s2">.</span><span class="s1">inArray</span><span class="s2">(</span><span class="s1">data</span><span class="s2">.</span><span class="s1">id</span><span class="s2">, </span><span class="s1">selectedIds</span><span class="s2">) !== -</span><span class="s8">1</span><span class="s2">) {</span>
        <span class="s1">data</span><span class="s2">.</span><span class="s1">selected </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
        <span class="s1">selected</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">data</span><span class="s2">);</span>
      <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
        <span class="s1">data</span><span class="s2">.</span><span class="s1">selected </span><span class="s2">= </span><span class="s3">false</span><span class="s2">;</span>
      <span class="s2">}</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">data</span><span class="s2">.</span><span class="s1">children</span><span class="s2">) {</span>
        <span class="s1">selected</span><span class="s2">.</span><span class="s1">push</span><span class="s2">.</span><span class="s1">apply</span><span class="s2">(</span><span class="s1">selected</span><span class="s2">, </span><span class="s1">getSelected</span><span class="s2">(</span><span class="s1">data</span><span class="s2">.</span><span class="s1">children</span><span class="s2">, </span><span class="s1">selectedIds</span><span class="s2">));</span>
      <span class="s2">}</span>

      <span class="s3">return </span><span class="s1">selected</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">var </span><span class="s1">selected </span><span class="s2">= [];</span>

    <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">d </span><span class="s2">= </span><span class="s8">0</span><span class="s2">; </span><span class="s1">d </span><span class="s2">&lt; </span><span class="s3">this</span><span class="s2">.</span><span class="s1">_currentData</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">d</span><span class="s2">++) {</span>
      <span class="s3">var </span><span class="s1">data </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">_currentData</span><span class="s2">[</span><span class="s1">d</span><span class="s2">];</span>

      <span class="s1">selected</span><span class="s2">.</span><span class="s1">push</span><span class="s2">.</span><span class="s1">apply</span><span class="s2">(</span>
        <span class="s1">selected</span><span class="s2">,</span>
        <span class="s1">getSelected</span><span class="s2">(</span>
          <span class="s1">data</span><span class="s2">,</span>
          <span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">.</span><span class="s1">val</span><span class="s2">().</span><span class="s1">split</span><span class="s2">(</span>
            <span class="s3">this</span><span class="s2">.</span><span class="s1">_valueSeparator</span>
          <span class="s2">)</span>
        <span class="s2">)</span>
      <span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s1">callback</span><span class="s2">(</span><span class="s1">selected</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s1">InputData</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">select </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">_</span><span class="s2">, </span><span class="s1">data</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(!</span><span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'multiple'</span><span class="s2">)) {</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">current</span><span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">allData</span><span class="s2">) {</span>
        <span class="s1">$</span><span class="s2">.</span><span class="s1">map</span><span class="s2">(</span><span class="s1">allData</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">data</span><span class="s2">) {</span>
          <span class="s1">data</span><span class="s2">.</span><span class="s1">selected </span><span class="s2">= </span><span class="s3">false</span><span class="s2">;</span>
        <span class="s2">});</span>
      <span class="s2">});</span>

      <span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">.</span><span class="s1">val</span><span class="s2">(</span><span class="s1">data</span><span class="s2">.</span><span class="s1">id</span><span class="s2">);</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'input'</span><span class="s2">).</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'change'</span><span class="s2">);</span>
    <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
      <span class="s3">var </span><span class="s1">value </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">.</span><span class="s1">val</span><span class="s2">();</span>
      <span class="s1">value </span><span class="s2">+= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">_valueSeparator </span><span class="s2">+ </span><span class="s1">data</span><span class="s2">.</span><span class="s1">id</span><span class="s2">;</span>

      <span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">.</span><span class="s1">val</span><span class="s2">(</span><span class="s1">value</span><span class="s2">);</span>
      <span class="s3">this</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'input'</span><span class="s2">).</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'change'</span><span class="s2">);</span>
    <span class="s2">}</span>
  <span class="s2">};</span>

  <span class="s1">InputData</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">unselect </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">_</span><span class="s2">, </span><span class="s1">data</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">self </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>

    <span class="s1">data</span><span class="s2">.</span><span class="s1">selected </span><span class="s2">= </span><span class="s3">false</span><span class="s2">;</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">current</span><span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">allData</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">values </span><span class="s2">= [];</span>

      <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">d </span><span class="s2">= </span><span class="s8">0</span><span class="s2">; </span><span class="s1">d </span><span class="s2">&lt; </span><span class="s1">allData</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">d</span><span class="s2">++) {</span>
        <span class="s3">var </span><span class="s1">item </span><span class="s2">= </span><span class="s1">allData</span><span class="s2">[</span><span class="s1">d</span><span class="s2">];</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">data</span><span class="s2">.</span><span class="s1">id </span><span class="s2">== </span><span class="s1">item</span><span class="s2">.</span><span class="s1">id</span><span class="s2">) {</span>
          <span class="s3">continue</span><span class="s2">;</span>
        <span class="s2">}</span>

        <span class="s1">values</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">item</span><span class="s2">.</span><span class="s1">id</span><span class="s2">);</span>
      <span class="s2">}</span>

      <span class="s1">self</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">.</span><span class="s1">val</span><span class="s2">(</span><span class="s1">values</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_valueSeparator</span><span class="s2">));</span>
      <span class="s1">self</span><span class="s2">.</span><span class="s1">$element</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'input'</span><span class="s2">).</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'change'</span><span class="s2">);</span>
    <span class="s2">});</span>
  <span class="s2">};</span>

  <span class="s1">InputData</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">query </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">_</span><span class="s2">, </span><span class="s1">params</span><span class="s2">, </span><span class="s1">callback</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">results </span><span class="s2">= [];</span>

    <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">d </span><span class="s2">= </span><span class="s8">0</span><span class="s2">; </span><span class="s1">d </span><span class="s2">&lt; </span><span class="s3">this</span><span class="s2">.</span><span class="s1">_currentData</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">d</span><span class="s2">++) {</span>
      <span class="s3">var </span><span class="s1">data </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">_currentData</span><span class="s2">[</span><span class="s1">d</span><span class="s2">];</span>

      <span class="s3">var </span><span class="s1">matches </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">matches</span><span class="s2">(</span><span class="s1">params</span><span class="s2">, </span><span class="s1">data</span><span class="s2">);</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">matches </span><span class="s2">!== </span><span class="s3">null</span><span class="s2">) {</span>
        <span class="s1">results</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">matches</span><span class="s2">);</span>
      <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s1">callback</span><span class="s2">({</span>
      <span class="s1">results</span><span class="s2">: </span><span class="s1">results</span>
    <span class="s2">});</span>
  <span class="s2">};</span>

  <span class="s1">InputData</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">addOptions </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">_</span><span class="s2">, </span><span class="s1">$options</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">options </span><span class="s2">= </span><span class="s1">$</span><span class="s2">.</span><span class="s1">map</span><span class="s2">(</span><span class="s1">$options</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">$option</span><span class="s2">) {</span>
      <span class="s3">return </span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">GetData</span><span class="s2">(</span><span class="s1">$option</span><span class="s2">[</span><span class="s8">0</span><span class="s2">], </span><span class="s4">'data'</span><span class="s2">);</span>
    <span class="s2">});</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">_currentData</span><span class="s2">.</span><span class="s1">push</span><span class="s2">.</span><span class="s1">apply</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">_currentData</span><span class="s2">, </span><span class="s1">options</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s3">return </span><span class="s1">InputData</span><span class="s2">;</span>
<span class="s2">});</span>

<span class="s1">S2</span><span class="s2">.</span><span class="s1">define</span><span class="s2">(</span><span class="s4">'select2/compat/matcher'</span><span class="s2">,[</span>
  <span class="s4">'jquery'</span>
<span class="s2">], </span><span class="s3">function </span><span class="s2">(</span><span class="s1">$</span><span class="s2">) {</span>
  <span class="s3">function </span><span class="s1">oldMatcher </span><span class="s2">(</span><span class="s1">matcher</span><span class="s2">) {</span>
    <span class="s3">function </span><span class="s1">wrappedMatcher </span><span class="s2">(</span><span class="s1">params</span><span class="s2">, </span><span class="s1">data</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">match </span><span class="s2">= </span><span class="s1">$</span><span class="s2">.</span><span class="s1">extend</span><span class="s2">(</span><span class="s3">true</span><span class="s2">, {}, </span><span class="s1">data</span><span class="s2">);</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">params</span><span class="s2">.</span><span class="s1">term </span><span class="s2">== </span><span class="s3">null </span><span class="s2">|| </span><span class="s1">$</span><span class="s2">.</span><span class="s1">trim</span><span class="s2">(</span><span class="s1">params</span><span class="s2">.</span><span class="s1">term</span><span class="s2">) === </span><span class="s4">''</span><span class="s2">) {</span>
        <span class="s3">return </span><span class="s1">match</span><span class="s2">;</span>
      <span class="s2">}</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">data</span><span class="s2">.</span><span class="s1">children</span><span class="s2">) {</span>
        <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">c </span><span class="s2">= </span><span class="s1">data</span><span class="s2">.</span><span class="s1">children</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s8">1</span><span class="s2">; </span><span class="s1">c </span><span class="s2">&gt;= </span><span class="s8">0</span><span class="s2">; </span><span class="s1">c</span><span class="s2">--) {</span>
          <span class="s3">var </span><span class="s1">child </span><span class="s2">= </span><span class="s1">data</span><span class="s2">.</span><span class="s1">children</span><span class="s2">[</span><span class="s1">c</span><span class="s2">];</span>

          <span class="s0">// Check if the child object matches</span>
          <span class="s0">// The old matcher returned a boolean true or false</span>
          <span class="s3">var </span><span class="s1">doesMatch </span><span class="s2">= </span><span class="s1">matcher</span><span class="s2">(</span><span class="s1">params</span><span class="s2">.</span><span class="s1">term</span><span class="s2">, </span><span class="s1">child</span><span class="s2">.</span><span class="s1">text</span><span class="s2">, </span><span class="s1">child</span><span class="s2">);</span>

          <span class="s0">// If the child didn't match, pop it off</span>
          <span class="s3">if </span><span class="s2">(!</span><span class="s1">doesMatch</span><span class="s2">) {</span>
            <span class="s1">match</span><span class="s2">.</span><span class="s1">children</span><span class="s2">.</span><span class="s1">splice</span><span class="s2">(</span><span class="s1">c</span><span class="s2">, </span><span class="s8">1</span><span class="s2">);</span>
          <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">match</span><span class="s2">.</span><span class="s1">children</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt; </span><span class="s8">0</span><span class="s2">) {</span>
          <span class="s3">return </span><span class="s1">match</span><span class="s2">;</span>
        <span class="s2">}</span>
      <span class="s2">}</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">matcher</span><span class="s2">(</span><span class="s1">params</span><span class="s2">.</span><span class="s1">term</span><span class="s2">, </span><span class="s1">data</span><span class="s2">.</span><span class="s1">text</span><span class="s2">, </span><span class="s1">data</span><span class="s2">)) {</span>
        <span class="s3">return </span><span class="s1">match</span><span class="s2">;</span>
      <span class="s2">}</span>

      <span class="s3">return null</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">return </span><span class="s1">wrappedMatcher</span><span class="s2">;</span>
  <span class="s2">}</span>

  <span class="s3">return </span><span class="s1">oldMatcher</span><span class="s2">;</span>
<span class="s2">});</span>

<span class="s1">S2</span><span class="s2">.</span><span class="s1">define</span><span class="s2">(</span><span class="s4">'select2/compat/query'</span><span class="s2">,[</span>

<span class="s2">], </span><span class="s3">function </span><span class="s2">() {</span>
  <span class="s3">function </span><span class="s1">Query </span><span class="s2">(</span><span class="s1">decorated</span><span class="s2">, </span><span class="s1">$element</span><span class="s2">, </span><span class="s1">options</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">options</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'debug'</span><span class="s2">) &amp;&amp; </span><span class="s1">window</span><span class="s2">.</span><span class="s1">console </span><span class="s2">&amp;&amp; </span><span class="s1">console</span><span class="s2">.</span><span class="s1">warn</span><span class="s2">) {</span>
      <span class="s1">console</span><span class="s2">.</span><span class="s1">warn</span><span class="s2">(</span>
        <span class="s4">'Select2: The `query` option has been deprecated in favor of a ' </span><span class="s2">+</span>
        <span class="s4">'custom data adapter that overrides the `query` method. Support ' </span><span class="s2">+</span>
        <span class="s4">'will be removed for the `query` option in future versions of ' </span><span class="s2">+</span>
        <span class="s4">'Select2.'</span>
      <span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s1">decorated</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">$element</span><span class="s2">, </span><span class="s1">options</span><span class="s2">);</span>
  <span class="s2">}</span>

  <span class="s1">Query</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">query </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">_</span><span class="s2">, </span><span class="s1">params</span><span class="s2">, </span><span class="s1">callback</span><span class="s2">) {</span>
    <span class="s1">params</span><span class="s2">.</span><span class="s1">callback </span><span class="s2">= </span><span class="s1">callback</span><span class="s2">;</span>

    <span class="s3">var </span><span class="s1">query </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s4">'query'</span><span class="s2">);</span>

    <span class="s1">query</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">null</span><span class="s2">, </span><span class="s1">params</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s3">return </span><span class="s1">Query</span><span class="s2">;</span>
<span class="s2">});</span>

<span class="s1">S2</span><span class="s2">.</span><span class="s1">define</span><span class="s2">(</span><span class="s4">'select2/dropdown/attachContainer'</span><span class="s2">,[</span>

<span class="s2">], </span><span class="s3">function </span><span class="s2">() {</span>
  <span class="s3">function </span><span class="s1">AttachContainer </span><span class="s2">(</span><span class="s1">decorated</span><span class="s2">, </span><span class="s1">$element</span><span class="s2">, </span><span class="s1">options</span><span class="s2">) {</span>
    <span class="s1">decorated</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">$element</span><span class="s2">, </span><span class="s1">options</span><span class="s2">);</span>
  <span class="s2">}</span>

  <span class="s1">AttachContainer</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">position </span><span class="s2">=</span>
    <span class="s3">function </span><span class="s2">(</span><span class="s1">decorated</span><span class="s2">, </span><span class="s1">$dropdown</span><span class="s2">, </span><span class="s1">$container</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">$dropdownContainer </span><span class="s2">= </span><span class="s1">$container</span><span class="s2">.</span><span class="s1">find</span><span class="s2">(</span><span class="s4">'.dropdown-wrapper'</span><span class="s2">);</span>
    <span class="s1">$dropdownContainer</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">$dropdown</span><span class="s2">);</span>

    <span class="s1">$dropdown</span><span class="s2">.</span><span class="s1">addClass</span><span class="s2">(</span><span class="s4">'select2-dropdown--below'</span><span class="s2">);</span>
    <span class="s1">$container</span><span class="s2">.</span><span class="s1">addClass</span><span class="s2">(</span><span class="s4">'select2-container--below'</span><span class="s2">);</span>
  <span class="s2">};</span>

  <span class="s3">return </span><span class="s1">AttachContainer</span><span class="s2">;</span>
<span class="s2">});</span>

<span class="s1">S2</span><span class="s2">.</span><span class="s1">define</span><span class="s2">(</span><span class="s4">'select2/dropdown/stopPropagation'</span><span class="s2">,[</span>

<span class="s2">], </span><span class="s3">function </span><span class="s2">() {</span>
  <span class="s3">function </span><span class="s1">StopPropagation </span><span class="s2">() { }</span>

  <span class="s1">StopPropagation</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">bind </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">decorated</span><span class="s2">, </span><span class="s1">container</span><span class="s2">, </span><span class="s1">$container</span><span class="s2">) {</span>
    <span class="s1">decorated</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">container</span><span class="s2">, </span><span class="s1">$container</span><span class="s2">);</span>

    <span class="s3">var </span><span class="s1">stoppedEvents </span><span class="s2">= [</span>
    <span class="s4">'blur'</span><span class="s2">,</span>
    <span class="s4">'change'</span><span class="s2">,</span>
    <span class="s4">'click'</span><span class="s2">,</span>
    <span class="s4">'dblclick'</span><span class="s2">,</span>
    <span class="s4">'focus'</span><span class="s2">,</span>
    <span class="s4">'focusin'</span><span class="s2">,</span>
    <span class="s4">'focusout'</span><span class="s2">,</span>
    <span class="s4">'input'</span><span class="s2">,</span>
    <span class="s4">'keydown'</span><span class="s2">,</span>
    <span class="s4">'keyup'</span><span class="s2">,</span>
    <span class="s4">'keypress'</span><span class="s2">,</span>
    <span class="s4">'mousedown'</span><span class="s2">,</span>
    <span class="s4">'mouseenter'</span><span class="s2">,</span>
    <span class="s4">'mouseleave'</span><span class="s2">,</span>
    <span class="s4">'mousemove'</span><span class="s2">,</span>
    <span class="s4">'mouseover'</span><span class="s2">,</span>
    <span class="s4">'mouseup'</span><span class="s2">,</span>
    <span class="s4">'search'</span><span class="s2">,</span>
    <span class="s4">'touchend'</span><span class="s2">,</span>
    <span class="s4">'touchstart'</span>
    <span class="s2">];</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">$dropdown</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s1">stoppedEvents</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s4">' '</span><span class="s2">), </span><span class="s3">function </span><span class="s2">(</span><span class="s1">evt</span><span class="s2">) {</span>
      <span class="s1">evt</span><span class="s2">.</span><span class="s1">stopPropagation</span><span class="s2">();</span>
    <span class="s2">});</span>
  <span class="s2">};</span>

  <span class="s3">return </span><span class="s1">StopPropagation</span><span class="s2">;</span>
<span class="s2">});</span>

<span class="s1">S2</span><span class="s2">.</span><span class="s1">define</span><span class="s2">(</span><span class="s4">'select2/selection/stopPropagation'</span><span class="s2">,[</span>

<span class="s2">], </span><span class="s3">function </span><span class="s2">() {</span>
  <span class="s3">function </span><span class="s1">StopPropagation </span><span class="s2">() { }</span>

  <span class="s1">StopPropagation</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">bind </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">decorated</span><span class="s2">, </span><span class="s1">container</span><span class="s2">, </span><span class="s1">$container</span><span class="s2">) {</span>
    <span class="s1">decorated</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">container</span><span class="s2">, </span><span class="s1">$container</span><span class="s2">);</span>

    <span class="s3">var </span><span class="s1">stoppedEvents </span><span class="s2">= [</span>
      <span class="s4">'blur'</span><span class="s2">,</span>
      <span class="s4">'change'</span><span class="s2">,</span>
      <span class="s4">'click'</span><span class="s2">,</span>
      <span class="s4">'dblclick'</span><span class="s2">,</span>
      <span class="s4">'focus'</span><span class="s2">,</span>
      <span class="s4">'focusin'</span><span class="s2">,</span>
      <span class="s4">'focusout'</span><span class="s2">,</span>
      <span class="s4">'input'</span><span class="s2">,</span>
      <span class="s4">'keydown'</span><span class="s2">,</span>
      <span class="s4">'keyup'</span><span class="s2">,</span>
      <span class="s4">'keypress'</span><span class="s2">,</span>
      <span class="s4">'mousedown'</span><span class="s2">,</span>
      <span class="s4">'mouseenter'</span><span class="s2">,</span>
      <span class="s4">'mouseleave'</span><span class="s2">,</span>
      <span class="s4">'mousemove'</span><span class="s2">,</span>
      <span class="s4">'mouseover'</span><span class="s2">,</span>
      <span class="s4">'mouseup'</span><span class="s2">,</span>
      <span class="s4">'search'</span><span class="s2">,</span>
      <span class="s4">'touchend'</span><span class="s2">,</span>
      <span class="s4">'touchstart'</span>
    <span class="s2">];</span>

    <span class="s3">this</span><span class="s2">.</span><span class="s1">$selection</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s1">stoppedEvents</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s4">' '</span><span class="s2">), </span><span class="s3">function </span><span class="s2">(</span><span class="s1">evt</span><span class="s2">) {</span>
      <span class="s1">evt</span><span class="s2">.</span><span class="s1">stopPropagation</span><span class="s2">();</span>
    <span class="s2">});</span>
  <span class="s2">};</span>

  <span class="s3">return </span><span class="s1">StopPropagation</span><span class="s2">;</span>
<span class="s2">});</span>

<span class="s0">/*! 
 * jQuery Mousewheel 3.1.13 
 * 
 * Copyright jQuery Foundation and other contributors 
 * Released under the MIT license 
 * http://jquery.org/license 
 */</span>

<span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">factory</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">( </span><span class="s3">typeof </span><span class="s1">S2</span><span class="s2">.</span><span class="s1">define </span><span class="s2">=== </span><span class="s4">'function' </span><span class="s2">&amp;&amp; </span><span class="s1">S2</span><span class="s2">.</span><span class="s1">define</span><span class="s2">.</span><span class="s1">amd </span><span class="s2">) {</span>
        <span class="s0">// AMD. Register as an anonymous module.</span>
        <span class="s1">S2</span><span class="s2">.</span><span class="s1">define</span><span class="s2">(</span><span class="s4">'jquery-mousewheel'</span><span class="s2">,[</span><span class="s4">'jquery'</span><span class="s2">], </span><span class="s1">factory</span><span class="s2">);</span>
    <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">exports </span><span class="s2">=== </span><span class="s4">'object'</span><span class="s2">) {</span>
        <span class="s0">// Node/CommonJS style for Browserify</span>
        <span class="s1">module</span><span class="s2">.</span><span class="s1">exports </span><span class="s2">= </span><span class="s1">factory</span><span class="s2">;</span>
    <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
        <span class="s0">// Browser globals</span>
        <span class="s1">factory</span><span class="s2">(</span><span class="s1">jQuery</span><span class="s2">);</span>
    <span class="s2">}</span>
<span class="s2">}(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">$</span><span class="s2">) {</span>

    <span class="s3">var </span><span class="s1">toFix  </span><span class="s2">= [</span><span class="s4">'wheel'</span><span class="s2">, </span><span class="s4">'mousewheel'</span><span class="s2">, </span><span class="s4">'DOMMouseScroll'</span><span class="s2">, </span><span class="s4">'MozMousePixelScroll'</span><span class="s2">],</span>
        <span class="s1">toBind </span><span class="s2">= ( </span><span class="s4">'onwheel' </span><span class="s3">in </span><span class="s1">document </span><span class="s2">|| </span><span class="s1">document</span><span class="s2">.</span><span class="s1">documentMode </span><span class="s2">&gt;= </span><span class="s8">9 </span><span class="s2">) ?</span>
                    <span class="s2">[</span><span class="s4">'wheel'</span><span class="s2">] : [</span><span class="s4">'mousewheel'</span><span class="s2">, </span><span class="s4">'DomMouseScroll'</span><span class="s2">, </span><span class="s4">'MozMousePixelScroll'</span><span class="s2">],</span>
        <span class="s1">slice  </span><span class="s2">= </span><span class="s1">Array</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">,</span>
        <span class="s1">nullLowestDeltaTimeout</span><span class="s2">, </span><span class="s1">lowestDelta</span><span class="s2">;</span>

    <span class="s3">if </span><span class="s2">( </span><span class="s1">$</span><span class="s2">.</span><span class="s1">event</span><span class="s2">.</span><span class="s1">fixHooks </span><span class="s2">) {</span>
        <span class="s3">for </span><span class="s2">( </span><span class="s3">var </span><span class="s1">i </span><span class="s2">= </span><span class="s1">toFix</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">i</span><span class="s2">; ) {</span>
            <span class="s1">$</span><span class="s2">.</span><span class="s1">event</span><span class="s2">.</span><span class="s1">fixHooks</span><span class="s2">[ </span><span class="s1">toFix</span><span class="s2">[--</span><span class="s1">i</span><span class="s2">] ] = </span><span class="s1">$</span><span class="s2">.</span><span class="s1">event</span><span class="s2">.</span><span class="s1">mouseHooks</span><span class="s2">;</span>
        <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s3">var </span><span class="s1">special </span><span class="s2">= </span><span class="s1">$</span><span class="s2">.</span><span class="s1">event</span><span class="s2">.</span><span class="s1">special</span><span class="s2">.</span><span class="s1">mousewheel </span><span class="s2">= {</span>
        <span class="s1">version</span><span class="s2">: </span><span class="s4">'3.1.12'</span><span class="s2">,</span>

        <span class="s1">setup</span><span class="s2">: </span><span class="s3">function</span><span class="s2">() {</span>
            <span class="s3">if </span><span class="s2">( </span><span class="s3">this</span><span class="s2">.</span><span class="s1">addEventListener </span><span class="s2">) {</span>
                <span class="s3">for </span><span class="s2">( </span><span class="s3">var </span><span class="s1">i </span><span class="s2">= </span><span class="s1">toBind</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">i</span><span class="s2">; ) {</span>
                    <span class="s3">this</span><span class="s2">.</span><span class="s1">addEventListener</span><span class="s2">( </span><span class="s1">toBind</span><span class="s2">[--</span><span class="s1">i</span><span class="s2">], </span><span class="s1">handler</span><span class="s2">, </span><span class="s3">false </span><span class="s2">);</span>
                <span class="s2">}</span>
            <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                <span class="s3">this</span><span class="s2">.</span><span class="s1">onmousewheel </span><span class="s2">= </span><span class="s1">handler</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s0">// Store the line height and page height for this particular element</span>
            <span class="s1">$</span><span class="s2">.</span><span class="s1">data</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s4">'mousewheel-line-height'</span><span class="s2">, </span><span class="s1">special</span><span class="s2">.</span><span class="s1">getLineHeight</span><span class="s2">(</span><span class="s3">this</span><span class="s2">));</span>
            <span class="s1">$</span><span class="s2">.</span><span class="s1">data</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s4">'mousewheel-page-height'</span><span class="s2">, </span><span class="s1">special</span><span class="s2">.</span><span class="s1">getPageHeight</span><span class="s2">(</span><span class="s3">this</span><span class="s2">));</span>
        <span class="s2">},</span>

        <span class="s1">teardown</span><span class="s2">: </span><span class="s3">function</span><span class="s2">() {</span>
            <span class="s3">if </span><span class="s2">( </span><span class="s3">this</span><span class="s2">.</span><span class="s1">removeEventListener </span><span class="s2">) {</span>
                <span class="s3">for </span><span class="s2">( </span><span class="s3">var </span><span class="s1">i </span><span class="s2">= </span><span class="s1">toBind</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">i</span><span class="s2">; ) {</span>
                    <span class="s3">this</span><span class="s2">.</span><span class="s1">removeEventListener</span><span class="s2">( </span><span class="s1">toBind</span><span class="s2">[--</span><span class="s1">i</span><span class="s2">], </span><span class="s1">handler</span><span class="s2">, </span><span class="s3">false </span><span class="s2">);</span>
                <span class="s2">}</span>
            <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                <span class="s3">this</span><span class="s2">.</span><span class="s1">onmousewheel </span><span class="s2">= </span><span class="s3">null</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s0">// Clean up the data we added to the element</span>
            <span class="s1">$</span><span class="s2">.</span><span class="s1">removeData</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s4">'mousewheel-line-height'</span><span class="s2">);</span>
            <span class="s1">$</span><span class="s2">.</span><span class="s1">removeData</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s4">'mousewheel-page-height'</span><span class="s2">);</span>
        <span class="s2">},</span>

        <span class="s1">getLineHeight</span><span class="s2">: </span><span class="s3">function</span><span class="s2">(</span><span class="s1">elem</span><span class="s2">) {</span>
            <span class="s3">var </span><span class="s1">$elem </span><span class="s2">= </span><span class="s1">$</span><span class="s2">(</span><span class="s1">elem</span><span class="s2">),</span>
                <span class="s1">$parent </span><span class="s2">= </span><span class="s1">$elem</span><span class="s2">[</span><span class="s4">'offsetParent' </span><span class="s3">in </span><span class="s1">$</span><span class="s2">.</span><span class="s1">fn </span><span class="s2">? </span><span class="s4">'offsetParent' </span><span class="s2">: </span><span class="s4">'parent'</span><span class="s2">]();</span>
            <span class="s3">if </span><span class="s2">(!</span><span class="s1">$parent</span><span class="s2">.</span><span class="s1">length</span><span class="s2">) {</span>
                <span class="s1">$parent </span><span class="s2">= </span><span class="s1">$</span><span class="s2">(</span><span class="s4">'body'</span><span class="s2">);</span>
            <span class="s2">}</span>
            <span class="s3">return </span><span class="s1">parseInt</span><span class="s2">(</span><span class="s1">$parent</span><span class="s2">.</span><span class="s1">css</span><span class="s2">(</span><span class="s4">'fontSize'</span><span class="s2">), </span><span class="s8">10</span><span class="s2">) || </span><span class="s1">parseInt</span><span class="s2">(</span><span class="s1">$elem</span><span class="s2">.</span><span class="s1">css</span><span class="s2">(</span><span class="s4">'fontSize'</span><span class="s2">), </span><span class="s8">10</span><span class="s2">) || </span><span class="s8">16</span><span class="s2">;</span>
        <span class="s2">},</span>

        <span class="s1">getPageHeight</span><span class="s2">: </span><span class="s3">function</span><span class="s2">(</span><span class="s1">elem</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s1">$</span><span class="s2">(</span><span class="s1">elem</span><span class="s2">).</span><span class="s1">height</span><span class="s2">();</span>
        <span class="s2">},</span>

        <span class="s1">settings</span><span class="s2">: {</span>
            <span class="s1">adjustOldDeltas</span><span class="s2">: </span><span class="s3">true</span><span class="s2">, </span><span class="s0">// see shouldAdjustOldDeltas() below</span>
            <span class="s1">normalizeOffset</span><span class="s2">: </span><span class="s3">true  </span><span class="s0">// calls getBoundingClientRect for each event</span>
        <span class="s2">}</span>
    <span class="s2">};</span>

    <span class="s1">$</span><span class="s2">.</span><span class="s1">fn</span><span class="s2">.</span><span class="s1">extend</span><span class="s2">({</span>
        <span class="s1">mousewheel</span><span class="s2">: </span><span class="s3">function</span><span class="s2">(</span><span class="s1">fn</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s1">fn </span><span class="s2">? </span><span class="s3">this</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s4">'mousewheel'</span><span class="s2">, </span><span class="s1">fn</span><span class="s2">) : </span><span class="s3">this</span><span class="s2">.</span><span class="s1">trigger</span><span class="s2">(</span><span class="s4">'mousewheel'</span><span class="s2">);</span>
        <span class="s2">},</span>

        <span class="s1">unmousewheel</span><span class="s2">: </span><span class="s3">function</span><span class="s2">(</span><span class="s1">fn</span><span class="s2">) {</span>
            <span class="s3">return this</span><span class="s2">.</span><span class="s1">unbind</span><span class="s2">(</span><span class="s4">'mousewheel'</span><span class="s2">, </span><span class="s1">fn</span><span class="s2">);</span>
        <span class="s2">}</span>
    <span class="s2">});</span>


    <span class="s3">function </span><span class="s1">handler</span><span class="s2">(</span><span class="s1">event</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">orgEvent   </span><span class="s2">= </span><span class="s1">event </span><span class="s2">|| </span><span class="s1">window</span><span class="s2">.</span><span class="s1">event</span><span class="s2">,</span>
            <span class="s1">args       </span><span class="s2">= </span><span class="s1">slice</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">arguments</span><span class="s2">, </span><span class="s8">1</span><span class="s2">),</span>
            <span class="s1">delta      </span><span class="s2">= </span><span class="s8">0</span><span class="s2">,</span>
            <span class="s1">deltaX     </span><span class="s2">= </span><span class="s8">0</span><span class="s2">,</span>
            <span class="s1">deltaY     </span><span class="s2">= </span><span class="s8">0</span><span class="s2">,</span>
            <span class="s1">absDelta   </span><span class="s2">= </span><span class="s8">0</span><span class="s2">,</span>
            <span class="s1">offsetX    </span><span class="s2">= </span><span class="s8">0</span><span class="s2">,</span>
            <span class="s1">offsetY    </span><span class="s2">= </span><span class="s8">0</span><span class="s2">;</span>
        <span class="s1">event </span><span class="s2">= </span><span class="s1">$</span><span class="s2">.</span><span class="s1">event</span><span class="s2">.</span><span class="s1">fix</span><span class="s2">(</span><span class="s1">orgEvent</span><span class="s2">);</span>
        <span class="s1">event</span><span class="s2">.</span><span class="s1">type </span><span class="s2">= </span><span class="s4">'mousewheel'</span><span class="s2">;</span>

        <span class="s0">// Old school scrollwheel delta</span>
        <span class="s3">if </span><span class="s2">( </span><span class="s4">'detail'      </span><span class="s3">in </span><span class="s1">orgEvent </span><span class="s2">) { </span><span class="s1">deltaY </span><span class="s2">= </span><span class="s1">orgEvent</span><span class="s2">.</span><span class="s1">detail </span><span class="s2">* -</span><span class="s8">1</span><span class="s2">;      }</span>
        <span class="s3">if </span><span class="s2">( </span><span class="s4">'wheelDelta'  </span><span class="s3">in </span><span class="s1">orgEvent </span><span class="s2">) { </span><span class="s1">deltaY </span><span class="s2">= </span><span class="s1">orgEvent</span><span class="s2">.</span><span class="s1">wheelDelta</span><span class="s2">;       }</span>
        <span class="s3">if </span><span class="s2">( </span><span class="s4">'wheelDeltaY' </span><span class="s3">in </span><span class="s1">orgEvent </span><span class="s2">) { </span><span class="s1">deltaY </span><span class="s2">= </span><span class="s1">orgEvent</span><span class="s2">.</span><span class="s1">wheelDeltaY</span><span class="s2">;      }</span>
        <span class="s3">if </span><span class="s2">( </span><span class="s4">'wheelDeltaX' </span><span class="s3">in </span><span class="s1">orgEvent </span><span class="s2">) { </span><span class="s1">deltaX </span><span class="s2">= </span><span class="s1">orgEvent</span><span class="s2">.</span><span class="s1">wheelDeltaX </span><span class="s2">* -</span><span class="s8">1</span><span class="s2">; }</span>

        <span class="s0">// Firefox &lt; 17 horizontal scrolling related to DOMMouseScroll event</span>
        <span class="s3">if </span><span class="s2">( </span><span class="s4">'axis' </span><span class="s3">in </span><span class="s1">orgEvent </span><span class="s2">&amp;&amp; </span><span class="s1">orgEvent</span><span class="s2">.</span><span class="s1">axis </span><span class="s2">=== </span><span class="s1">orgEvent</span><span class="s2">.</span><span class="s1">HORIZONTAL_AXIS </span><span class="s2">) {</span>
            <span class="s1">deltaX </span><span class="s2">= </span><span class="s1">deltaY </span><span class="s2">* -</span><span class="s8">1</span><span class="s2">;</span>
            <span class="s1">deltaY </span><span class="s2">= </span><span class="s8">0</span><span class="s2">;</span>
        <span class="s2">}</span>

        <span class="s0">// Set delta to be deltaY or deltaX if deltaY is 0 for backwards compatabilitiy</span>
        <span class="s1">delta </span><span class="s2">= </span><span class="s1">deltaY </span><span class="s2">=== </span><span class="s8">0 </span><span class="s2">? </span><span class="s1">deltaX </span><span class="s2">: </span><span class="s1">deltaY</span><span class="s2">;</span>

        <span class="s0">// New school wheel delta (wheel event)</span>
        <span class="s3">if </span><span class="s2">( </span><span class="s4">'deltaY' </span><span class="s3">in </span><span class="s1">orgEvent </span><span class="s2">) {</span>
            <span class="s1">deltaY </span><span class="s2">= </span><span class="s1">orgEvent</span><span class="s2">.</span><span class="s1">deltaY </span><span class="s2">* -</span><span class="s8">1</span><span class="s2">;</span>
            <span class="s1">delta  </span><span class="s2">= </span><span class="s1">deltaY</span><span class="s2">;</span>
        <span class="s2">}</span>
        <span class="s3">if </span><span class="s2">( </span><span class="s4">'deltaX' </span><span class="s3">in </span><span class="s1">orgEvent </span><span class="s2">) {</span>
            <span class="s1">deltaX </span><span class="s2">= </span><span class="s1">orgEvent</span><span class="s2">.</span><span class="s1">deltaX</span><span class="s2">;</span>
            <span class="s3">if </span><span class="s2">( </span><span class="s1">deltaY </span><span class="s2">=== </span><span class="s8">0 </span><span class="s2">) { </span><span class="s1">delta  </span><span class="s2">= </span><span class="s1">deltaX </span><span class="s2">* -</span><span class="s8">1</span><span class="s2">; }</span>
        <span class="s2">}</span>

        <span class="s0">// No change actually happened, no reason to go any further</span>
        <span class="s3">if </span><span class="s2">( </span><span class="s1">deltaY </span><span class="s2">=== </span><span class="s8">0 </span><span class="s2">&amp;&amp; </span><span class="s1">deltaX </span><span class="s2">=== </span><span class="s8">0 </span><span class="s2">) { </span><span class="s3">return</span><span class="s2">; }</span>

        <span class="s0">// Need to convert lines and pages to pixels if we aren't already in pixels</span>
        <span class="s0">// There are three delta modes:</span>
        <span class="s0">//   * deltaMode 0 is by pixels, nothing to do</span>
        <span class="s0">//   * deltaMode 1 is by lines</span>
        <span class="s0">//   * deltaMode 2 is by pages</span>
        <span class="s3">if </span><span class="s2">( </span><span class="s1">orgEvent</span><span class="s2">.</span><span class="s1">deltaMode </span><span class="s2">=== </span><span class="s8">1 </span><span class="s2">) {</span>
            <span class="s3">var </span><span class="s1">lineHeight </span><span class="s2">= </span><span class="s1">$</span><span class="s2">.</span><span class="s1">data</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s4">'mousewheel-line-height'</span><span class="s2">);</span>
            <span class="s1">delta  </span><span class="s2">*= </span><span class="s1">lineHeight</span><span class="s2">;</span>
            <span class="s1">deltaY </span><span class="s2">*= </span><span class="s1">lineHeight</span><span class="s2">;</span>
            <span class="s1">deltaX </span><span class="s2">*= </span><span class="s1">lineHeight</span><span class="s2">;</span>
        <span class="s2">} </span><span class="s3">else if </span><span class="s2">( </span><span class="s1">orgEvent</span><span class="s2">.</span><span class="s1">deltaMode </span><span class="s2">=== </span><span class="s8">2 </span><span class="s2">) {</span>
            <span class="s3">var </span><span class="s1">pageHeight </span><span class="s2">= </span><span class="s1">$</span><span class="s2">.</span><span class="s1">data</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s4">'mousewheel-page-height'</span><span class="s2">);</span>
            <span class="s1">delta  </span><span class="s2">*= </span><span class="s1">pageHeight</span><span class="s2">;</span>
            <span class="s1">deltaY </span><span class="s2">*= </span><span class="s1">pageHeight</span><span class="s2">;</span>
            <span class="s1">deltaX </span><span class="s2">*= </span><span class="s1">pageHeight</span><span class="s2">;</span>
        <span class="s2">}</span>

        <span class="s0">// Store lowest absolute delta to normalize the delta values</span>
        <span class="s1">absDelta </span><span class="s2">= </span><span class="s1">Math</span><span class="s2">.</span><span class="s1">max</span><span class="s2">( </span><span class="s1">Math</span><span class="s2">.</span><span class="s1">abs</span><span class="s2">(</span><span class="s1">deltaY</span><span class="s2">), </span><span class="s1">Math</span><span class="s2">.</span><span class="s1">abs</span><span class="s2">(</span><span class="s1">deltaX</span><span class="s2">) );</span>

        <span class="s3">if </span><span class="s2">( !</span><span class="s1">lowestDelta </span><span class="s2">|| </span><span class="s1">absDelta </span><span class="s2">&lt; </span><span class="s1">lowestDelta </span><span class="s2">) {</span>
            <span class="s1">lowestDelta </span><span class="s2">= </span><span class="s1">absDelta</span><span class="s2">;</span>

            <span class="s0">// Adjust older deltas if necessary</span>
            <span class="s3">if </span><span class="s2">( </span><span class="s1">shouldAdjustOldDeltas</span><span class="s2">(</span><span class="s1">orgEvent</span><span class="s2">, </span><span class="s1">absDelta</span><span class="s2">) ) {</span>
                <span class="s1">lowestDelta </span><span class="s2">/= </span><span class="s8">40</span><span class="s2">;</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s0">// Adjust older deltas if necessary</span>
        <span class="s3">if </span><span class="s2">( </span><span class="s1">shouldAdjustOldDeltas</span><span class="s2">(</span><span class="s1">orgEvent</span><span class="s2">, </span><span class="s1">absDelta</span><span class="s2">) ) {</span>
            <span class="s0">// Divide all the things by 40!</span>
            <span class="s1">delta  </span><span class="s2">/= </span><span class="s8">40</span><span class="s2">;</span>
            <span class="s1">deltaX </span><span class="s2">/= </span><span class="s8">40</span><span class="s2">;</span>
            <span class="s1">deltaY </span><span class="s2">/= </span><span class="s8">40</span><span class="s2">;</span>
        <span class="s2">}</span>

        <span class="s0">// Get a whole, normalized value for the deltas</span>
        <span class="s1">delta  </span><span class="s2">= </span><span class="s1">Math</span><span class="s2">[ </span><span class="s1">delta  </span><span class="s2">&gt;= </span><span class="s8">1 </span><span class="s2">? </span><span class="s4">'floor' </span><span class="s2">: </span><span class="s4">'ceil' </span><span class="s2">](</span><span class="s1">delta  </span><span class="s2">/ </span><span class="s1">lowestDelta</span><span class="s2">);</span>
        <span class="s1">deltaX </span><span class="s2">= </span><span class="s1">Math</span><span class="s2">[ </span><span class="s1">deltaX </span><span class="s2">&gt;= </span><span class="s8">1 </span><span class="s2">? </span><span class="s4">'floor' </span><span class="s2">: </span><span class="s4">'ceil' </span><span class="s2">](</span><span class="s1">deltaX </span><span class="s2">/ </span><span class="s1">lowestDelta</span><span class="s2">);</span>
        <span class="s1">deltaY </span><span class="s2">= </span><span class="s1">Math</span><span class="s2">[ </span><span class="s1">deltaY </span><span class="s2">&gt;= </span><span class="s8">1 </span><span class="s2">? </span><span class="s4">'floor' </span><span class="s2">: </span><span class="s4">'ceil' </span><span class="s2">](</span><span class="s1">deltaY </span><span class="s2">/ </span><span class="s1">lowestDelta</span><span class="s2">);</span>

        <span class="s0">// Normalise offsetX and offsetY properties</span>
        <span class="s3">if </span><span class="s2">( </span><span class="s1">special</span><span class="s2">.</span><span class="s1">settings</span><span class="s2">.</span><span class="s1">normalizeOffset </span><span class="s2">&amp;&amp; </span><span class="s3">this</span><span class="s2">.</span><span class="s1">getBoundingClientRect </span><span class="s2">) {</span>
            <span class="s3">var </span><span class="s1">boundingRect </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">getBoundingClientRect</span><span class="s2">();</span>
            <span class="s1">offsetX </span><span class="s2">= </span><span class="s1">event</span><span class="s2">.</span><span class="s1">clientX </span><span class="s2">- </span><span class="s1">boundingRect</span><span class="s2">.</span><span class="s1">left</span><span class="s2">;</span>
            <span class="s1">offsetY </span><span class="s2">= </span><span class="s1">event</span><span class="s2">.</span><span class="s1">clientY </span><span class="s2">- </span><span class="s1">boundingRect</span><span class="s2">.</span><span class="s1">top</span><span class="s2">;</span>
        <span class="s2">}</span>

        <span class="s0">// Add information to the event object</span>
        <span class="s1">event</span><span class="s2">.</span><span class="s1">deltaX </span><span class="s2">= </span><span class="s1">deltaX</span><span class="s2">;</span>
        <span class="s1">event</span><span class="s2">.</span><span class="s1">deltaY </span><span class="s2">= </span><span class="s1">deltaY</span><span class="s2">;</span>
        <span class="s1">event</span><span class="s2">.</span><span class="s1">deltaFactor </span><span class="s2">= </span><span class="s1">lowestDelta</span><span class="s2">;</span>
        <span class="s1">event</span><span class="s2">.</span><span class="s1">offsetX </span><span class="s2">= </span><span class="s1">offsetX</span><span class="s2">;</span>
        <span class="s1">event</span><span class="s2">.</span><span class="s1">offsetY </span><span class="s2">= </span><span class="s1">offsetY</span><span class="s2">;</span>
        <span class="s0">// Go ahead and set deltaMode to 0 since we converted to pixels</span>
        <span class="s0">// Although this is a little odd since we overwrite the deltaX/Y</span>
        <span class="s0">// properties with normalized deltas.</span>
        <span class="s1">event</span><span class="s2">.</span><span class="s1">deltaMode </span><span class="s2">= </span><span class="s8">0</span><span class="s2">;</span>

        <span class="s0">// Add event and delta to the front of the arguments</span>
        <span class="s1">args</span><span class="s2">.</span><span class="s1">unshift</span><span class="s2">(</span><span class="s1">event</span><span class="s2">, </span><span class="s1">delta</span><span class="s2">, </span><span class="s1">deltaX</span><span class="s2">, </span><span class="s1">deltaY</span><span class="s2">);</span>

        <span class="s0">// Clearout lowestDelta after sometime to better</span>
        <span class="s0">// handle multiple device types that give different</span>
        <span class="s0">// a different lowestDelta</span>
        <span class="s0">// Ex: trackpad = 3 and mouse wheel = 120</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">nullLowestDeltaTimeout</span><span class="s2">) { </span><span class="s1">clearTimeout</span><span class="s2">(</span><span class="s1">nullLowestDeltaTimeout</span><span class="s2">); }</span>
        <span class="s1">nullLowestDeltaTimeout </span><span class="s2">= </span><span class="s1">setTimeout</span><span class="s2">(</span><span class="s1">nullLowestDelta</span><span class="s2">, </span><span class="s8">200</span><span class="s2">);</span>

        <span class="s3">return </span><span class="s2">(</span><span class="s1">$</span><span class="s2">.</span><span class="s1">event</span><span class="s2">.</span><span class="s1">dispatch </span><span class="s2">|| </span><span class="s1">$</span><span class="s2">.</span><span class="s1">event</span><span class="s2">.</span><span class="s1">handle</span><span class="s2">).</span><span class="s1">apply</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">args</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">nullLowestDelta</span><span class="s2">() {</span>
        <span class="s1">lowestDelta </span><span class="s2">= </span><span class="s3">null</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">shouldAdjustOldDeltas</span><span class="s2">(</span><span class="s1">orgEvent</span><span class="s2">, </span><span class="s1">absDelta</span><span class="s2">) {</span>
        <span class="s0">// If this is an older event and the delta is divisable by 120,</span>
        <span class="s0">// then we are assuming that the browser is treating this as an</span>
        <span class="s0">// older mouse wheel event and that we should divide the deltas</span>
        <span class="s0">// by 40 to try and get a more usable deltaFactor.</span>
        <span class="s0">// Side note, this actually impacts the reported scroll distance</span>
        <span class="s0">// in older browsers and can cause scrolling to be slower than native.</span>
        <span class="s0">// Turn this off by setting $.event.special.mousewheel.settings.adjustOldDeltas to false.</span>
        <span class="s3">return </span><span class="s1">special</span><span class="s2">.</span><span class="s1">settings</span><span class="s2">.</span><span class="s1">adjustOldDeltas </span><span class="s2">&amp;&amp; </span><span class="s1">orgEvent</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s4">'mousewheel' </span><span class="s2">&amp;&amp; </span><span class="s1">absDelta </span><span class="s2">% </span><span class="s8">120 </span><span class="s2">=== </span><span class="s8">0</span><span class="s2">;</span>
    <span class="s2">}</span>

<span class="s2">}));</span>

<span class="s1">S2</span><span class="s2">.</span><span class="s1">define</span><span class="s2">(</span><span class="s4">'jquery.select2'</span><span class="s2">,[</span>
  <span class="s4">'jquery'</span><span class="s2">,</span>
  <span class="s4">'jquery-mousewheel'</span><span class="s2">,</span>

  <span class="s4">'./select2/core'</span><span class="s2">,</span>
  <span class="s4">'./select2/defaults'</span><span class="s2">,</span>
  <span class="s4">'./select2/utils'</span>
<span class="s2">], </span><span class="s3">function </span><span class="s2">(</span><span class="s1">$</span><span class="s2">, </span><span class="s1">_</span><span class="s2">, </span><span class="s1">Select2</span><span class="s2">, </span><span class="s1">Defaults</span><span class="s2">, </span><span class="s1">Utils</span><span class="s2">) {</span>
  <span class="s3">if </span><span class="s2">(</span><span class="s1">$</span><span class="s2">.</span><span class="s1">fn</span><span class="s2">.</span><span class="s1">select2 </span><span class="s2">== </span><span class="s3">null</span><span class="s2">) {</span>
    <span class="s0">// All methods that should return the element</span>
    <span class="s3">var </span><span class="s1">thisMethods </span><span class="s2">= [</span><span class="s4">'open'</span><span class="s2">, </span><span class="s4">'close'</span><span class="s2">, </span><span class="s4">'destroy'</span><span class="s2">];</span>

    <span class="s1">$</span><span class="s2">.</span><span class="s1">fn</span><span class="s2">.</span><span class="s1">select2 </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">options</span><span class="s2">) {</span>
      <span class="s1">options </span><span class="s2">= </span><span class="s1">options </span><span class="s2">|| {};</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">options </span><span class="s2">=== </span><span class="s4">'object'</span><span class="s2">) {</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">each</span><span class="s2">(</span><span class="s3">function </span><span class="s2">() {</span>
          <span class="s3">var </span><span class="s1">instanceOptions </span><span class="s2">= </span><span class="s1">$</span><span class="s2">.</span><span class="s1">extend</span><span class="s2">(</span><span class="s3">true</span><span class="s2">, {}, </span><span class="s1">options</span><span class="s2">);</span>

          <span class="s3">var </span><span class="s1">instance </span><span class="s2">= </span><span class="s3">new </span><span class="s1">Select2</span><span class="s2">(</span><span class="s1">$</span><span class="s2">(</span><span class="s3">this</span><span class="s2">), </span><span class="s1">instanceOptions</span><span class="s2">);</span>
        <span class="s2">});</span>

        <span class="s3">return this</span><span class="s2">;</span>
      <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">options </span><span class="s2">=== </span><span class="s4">'string'</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">ret</span><span class="s2">;</span>
        <span class="s3">var </span><span class="s1">args </span><span class="s2">= </span><span class="s1">Array</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">arguments</span><span class="s2">, </span><span class="s8">1</span><span class="s2">);</span>

        <span class="s3">this</span><span class="s2">.</span><span class="s1">each</span><span class="s2">(</span><span class="s3">function </span><span class="s2">() {</span>
          <span class="s3">var </span><span class="s1">instance </span><span class="s2">= </span><span class="s1">Utils</span><span class="s2">.</span><span class="s1">GetData</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s4">'select2'</span><span class="s2">);</span>

          <span class="s3">if </span><span class="s2">(</span><span class="s1">instance </span><span class="s2">== </span><span class="s3">null </span><span class="s2">&amp;&amp; </span><span class="s1">window</span><span class="s2">.</span><span class="s1">console </span><span class="s2">&amp;&amp; </span><span class="s1">console</span><span class="s2">.</span><span class="s1">error</span><span class="s2">) {</span>
            <span class="s1">console</span><span class="s2">.</span><span class="s1">error</span><span class="s2">(</span>
              <span class="s4">'The select2(</span><span class="s3">\'</span><span class="s4">' </span><span class="s2">+ </span><span class="s1">options </span><span class="s2">+ </span><span class="s4">'</span><span class="s3">\'</span><span class="s4">) method was called on an ' </span><span class="s2">+</span>
              <span class="s4">'element that is not using Select2.'</span>
            <span class="s2">);</span>
          <span class="s2">}</span>

          <span class="s1">ret </span><span class="s2">= </span><span class="s1">instance</span><span class="s2">[</span><span class="s1">options</span><span class="s2">].</span><span class="s1">apply</span><span class="s2">(</span><span class="s1">instance</span><span class="s2">, </span><span class="s1">args</span><span class="s2">);</span>
        <span class="s2">});</span>

        <span class="s0">// Check if we should be returning `this`</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">$</span><span class="s2">.</span><span class="s1">inArray</span><span class="s2">(</span><span class="s1">options</span><span class="s2">, </span><span class="s1">thisMethods</span><span class="s2">) &gt; -</span><span class="s8">1</span><span class="s2">) {</span>
          <span class="s3">return this</span><span class="s2">;</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">ret</span><span class="s2">;</span>
      <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
        <span class="s3">throw new </span><span class="s1">Error</span><span class="s2">(</span><span class="s4">'Invalid arguments for Select2: ' </span><span class="s2">+ </span><span class="s1">options</span><span class="s2">);</span>
      <span class="s2">}</span>
    <span class="s2">};</span>
  <span class="s2">}</span>

  <span class="s3">if </span><span class="s2">(</span><span class="s1">$</span><span class="s2">.</span><span class="s1">fn</span><span class="s2">.</span><span class="s1">select2</span><span class="s2">.</span><span class="s1">defaults </span><span class="s2">== </span><span class="s3">null</span><span class="s2">) {</span>
    <span class="s1">$</span><span class="s2">.</span><span class="s1">fn</span><span class="s2">.</span><span class="s1">select2</span><span class="s2">.</span><span class="s1">defaults </span><span class="s2">= </span><span class="s1">Defaults</span><span class="s2">;</span>
  <span class="s2">}</span>

  <span class="s3">return </span><span class="s1">Select2</span><span class="s2">;</span>
<span class="s2">});</span>

  <span class="s0">// Return the AMD loader configuration so it can be used outside of this file</span>
  <span class="s3">return </span><span class="s2">{</span>
    <span class="s1">define</span><span class="s2">: </span><span class="s1">S2</span><span class="s2">.</span><span class="s1">define</span><span class="s2">,</span>
    <span class="s1">require</span><span class="s2">: </span><span class="s1">S2</span><span class="s2">.</span><span class="s1">require</span>
  <span class="s2">};</span>
<span class="s2">}());</span>

  <span class="s0">// Autoload the jQuery bindings</span>
  <span class="s0">// We know that all of the modules exist above this, so we're safe</span>
  <span class="s3">var </span><span class="s1">select2 </span><span class="s2">= </span><span class="s1">S2</span><span class="s2">.</span><span class="s1">require</span><span class="s2">(</span><span class="s4">'jquery.select2'</span><span class="s2">);</span>

  <span class="s0">// Hold the AMD module references on the jQuery function that was just loaded</span>
  <span class="s0">// This allows Select2 to use the internal loader outside of this file, such</span>
  <span class="s0">// as in the language files.</span>
  <span class="s1">jQuery</span><span class="s2">.</span><span class="s1">fn</span><span class="s2">.</span><span class="s1">select2</span><span class="s2">.</span><span class="s1">amd </span><span class="s2">= </span><span class="s1">S2</span><span class="s2">;</span>

  <span class="s0">// Return the Select2 instance for anyone who is importing it.</span>
  <span class="s3">return </span><span class="s1">select2</span><span class="s2">;</span>
<span class="s2">}));</span>
</pre>
</body>
</html>